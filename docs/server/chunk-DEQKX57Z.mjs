import './polyfills.server.mjs';
import{$ as zi,A as ie,Aa as zE,B as Pr,Ba as jE,C as It,Ca as Rp,D as Dt,E as Tp,F as Oa,G as kE,H as Us,I as Pa,J as Fa,K as Lt,L as me,M as NE,N as La,O as Fr,P as Fn,Q as xE,R as Ln,S as Cp,T as ME,U as C,V as N,W as X,X as OE,Y as Bt,Z as q,_ as Ba,a as Vs,aa as PE,b as TE,ba as bp,c as Yc,ca as FE,d as CE,e as Bi,f as qs,g as Pn,h as Or,i as ct,ia as Ap,j as bE,k as AE,ka as Ip,l as Ma,la as Dp,m as IE,n as DE,na as LE,o as Xc,oa as tu,p as Jc,pa as BE,q as Ep,qa as VE,r as Zc,s as Vi,t as wp,ta as qE,u as RE,v as qi,w as eu,x as Ui,xa as UE,y as At,z as qe}from"./chunk-QCJ7KFJU.mjs";import{a as GE,b as kp,c as HE,d as nu,e as KE,f as ru,g as WE,h as $E,i as ke,j as ji,k as Bn,l as iu,m as Va,n as QE,o as YE,p as Lr,q as Vt}from"./chunk-V33DDLTH.mjs";import{a as Zt,b as fr,c as he,e as E,g as wE,h as _p,i as g}from"./chunk-LK223424.mjs";var ce=E(tn=>{"use strict";Object.defineProperty(tn,"__esModule",{value:!0});tn.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=tn.DEFAULT_MAX_SEND_MESSAGE_LENGTH=tn.Propagate=tn.LogVerbosity=tn.Status=void 0;var kT=function(n){return n[n.OK=0]="OK",n[n.CANCELLED=1]="CANCELLED",n[n.UNKNOWN=2]="UNKNOWN",n[n.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",n[n.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",n[n.NOT_FOUND=5]="NOT_FOUND",n[n.ALREADY_EXISTS=6]="ALREADY_EXISTS",n[n.PERMISSION_DENIED=7]="PERMISSION_DENIED",n[n.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",n[n.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",n[n.ABORTED=10]="ABORTED",n[n.OUT_OF_RANGE=11]="OUT_OF_RANGE",n[n.UNIMPLEMENTED=12]="UNIMPLEMENTED",n[n.INTERNAL=13]="INTERNAL",n[n.UNAVAILABLE=14]="UNAVAILABLE",n[n.DATA_LOSS=15]="DATA_LOSS",n[n.UNAUTHENTICATED=16]="UNAUTHENTICATED",n}(kT||(tn.Status=kT={})),NT=function(n){return n[n.DEBUG=0]="DEBUG",n[n.INFO=1]="INFO",n[n.ERROR=2]="ERROR",n[n.NONE=3]="NONE",n}(NT||(tn.LogVerbosity=NT={})),xT=function(n){return n[n.DEADLINE=1]="DEADLINE",n[n.CENSUS_STATS_CONTEXT=2]="CENSUS_STATS_CONTEXT",n[n.CENSUS_TRACING_CONTEXT=4]="CENSUS_TRACING_CONTEXT",n[n.CANCELLATION=8]="CANCELLATION",n[n.DEFAULTS=65535]="DEFAULTS",n}(xT||(tn.Propagate=xT={}));tn.DEFAULT_MAX_SEND_MESSAGE_LENGTH=-1;tn.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=4*1024*1024});var Pg=E((FH,MM)=>{MM.exports={name:"@grpc/grpc-js",version:"1.9.13",description:"gRPC Library for Node - pure JS implementation",homepage:"https://grpc.io/",repository:"https://github.com/grpc/grpc-node/tree/master/packages/grpc-js",main:"build/src/index.js",engines:{node:"^8.13.0 || >=10.10.0"},keywords:[],author:{name:"Google Inc."},types:"build/src/index.d.ts",license:"Apache-2.0",devDependencies:{"@types/gulp":"^4.0.6","@types/gulp-mocha":"0.0.32","@types/lodash":"^4.14.186","@types/mocha":"^5.2.6","@types/ncp":"^2.0.1","@types/pify":"^3.0.2","@types/semver":"^7.3.9","@typescript-eslint/eslint-plugin":"^5.59.11","@typescript-eslint/parser":"^5.59.11","@typescript-eslint/typescript-estree":"^5.59.11","clang-format":"^1.0.55",eslint:"^8.42.0","eslint-config-prettier":"^8.8.0","eslint-plugin-node":"^11.1.0","eslint-plugin-prettier":"^4.2.1",execa:"^2.0.3",gulp:"^4.0.2","gulp-mocha":"^6.0.0",lodash:"^4.17.4",madge:"^5.0.1","mocha-jenkins-reporter":"^0.4.1",ncp:"^2.0.0",pify:"^4.0.1",prettier:"^2.8.8",rimraf:"^3.0.2",semver:"^7.3.5","ts-node":"^10.9.1",typescript:"^5.1.3"},contributors:[{name:"Google Inc."}],scripts:{build:"npm run compile",clean:"rimraf ./build",compile:"tsc -p .",format:'clang-format -i -style="{Language: JavaScript, BasedOnStyle: Google, ColumnLimit: 80}" src/*.ts test/*.ts',lint:"eslint src/*.ts test/*.ts",prepare:"npm run generate-types && npm run compile",test:"gulp test",check:"npm run lint",fix:"eslint --fix src/*.ts test/*.ts",pretest:"npm run generate-types && npm run generate-test-types && npm run compile",posttest:"npm run check && madge -c ./build/src","generate-types":"proto-loader-gen-types --keepCase --longs String --enums String --defaults --oneofs --includeComments --includeDirs proto/ --include-dirs test/fixtures/ -O src/generated/ --grpcLib ../index channelz.proto","generate-test-types":"proto-loader-gen-types --keepCase --longs String --enums String --defaults --oneofs --includeComments --include-dirs test/fixtures/ -O test/generated/ --grpcLib ../../src/index test_service.proto"},dependencies:{"@grpc/proto-loader":"^0.7.8","@types/node":">=12.12.47"},files:["src/**/*.ts","build/src/**/*.{js,d.ts,js.map}","proto/*.proto","LICENSE","deps/envoy-api/envoy/api/v2/**/*.proto","deps/envoy-api/envoy/config/**/*.proto","deps/envoy-api/envoy/service/**/*.proto","deps/envoy-api/envoy/type/**/*.proto","deps/udpa/udpa/**/*.proto","deps/googleapis/google/api/*.proto","deps/googleapis/google/rpc/*.proto","deps/protoc-gen-validate/validate/**/*.proto"]}});var Fe=E(kt=>{"use strict";var Fg,Lg,Bg,Vg;Object.defineProperty(kt,"__esModule",{value:!0});kt.isTracerEnabled=kt.trace=kt.log=kt.setLoggerVerbosity=kt.setLogger=kt.getLogger=void 0;var Ur=ce(),OM=he("process"),PM=Pg().version,FM={error:(n,...e)=>{console.error("E "+n,...e)},info:(n,...e)=>{console.error("I "+n,...e)},debug:(n,...e)=>{console.error("D "+n,...e)}},Yi=FM,Xs=Ur.LogVerbosity.ERROR,LM=(Lg=(Fg=process.env.GRPC_NODE_VERBOSITY)!==null&&Fg!==void 0?Fg:process.env.GRPC_VERBOSITY)!==null&&Lg!==void 0?Lg:"";switch(LM.toUpperCase()){case"DEBUG":Xs=Ur.LogVerbosity.DEBUG;break;case"INFO":Xs=Ur.LogVerbosity.INFO;break;case"ERROR":Xs=Ur.LogVerbosity.ERROR;break;case"NONE":Xs=Ur.LogVerbosity.NONE;break;default:}var BM=()=>Yi;kt.getLogger=BM;var VM=n=>{Yi=n};kt.setLogger=VM;var qM=n=>{Xs=n};kt.setLoggerVerbosity=qM;var UM=(n,...e)=>{let t;if(n>=Xs){switch(n){case Ur.LogVerbosity.DEBUG:t=Yi.debug;break;case Ur.LogVerbosity.INFO:t=Yi.info;break;case Ur.LogVerbosity.ERROR:t=Yi.error;break}t||(t=Yi.error),t&&t.bind(Yi)(...e)}};kt.log=UM;var zM=(Vg=(Bg=process.env.GRPC_NODE_TRACE)!==null&&Bg!==void 0?Bg:process.env.GRPC_TRACE)!==null&&Vg!==void 0?Vg:"",qg=new Set,MT=new Set;for(let n of zM.split(","))n.startsWith("-")?MT.add(n.substring(1)):qg.add(n);var jM=qg.has("all");function GM(n,e,t){OT(e)&&(0,kt.log)(n,new Date().toISOString()+" | v"+PM+" "+OM.pid+" | "+e+" | "+t)}kt.trace=GM;function OT(n){return!MT.has(n)&&(jM||qg.has(n))}kt.isTracerEnabled=OT});var Bu=E(Js=>{"use strict";Object.defineProperty(Js,"__esModule",{value:!0});Js.getErrorCode=Js.getErrorMessage=void 0;function HM(n){return n instanceof Error?n.message:String(n)}Js.getErrorMessage=HM;function KM(n){return typeof n=="object"&&n!==null&&"code"in n&&typeof n.code=="number"?n.code:null}Js.getErrorCode=KM});var Nt=E(qu=>{"use strict";Object.defineProperty(qu,"__esModule",{value:!0});qu.Metadata=void 0;var WM=Fe(),$M=ce(),QM=Bu(),YM=/^[0-9a-z_.-]+$/,XM=/^[ -~]*$/;function JM(n){return YM.test(n)}function ZM(n){return XM.test(n)}function FT(n){return n.endsWith("-bin")}function eO(n){return!n.startsWith("grpc-")}function Vu(n){return n.toLowerCase()}function PT(n,e){if(!JM(n))throw new Error('Metadata key "'+n+'" contains illegal characters');if(e!=null)if(FT(n)){if(!Buffer.isBuffer(e))throw new Error("keys that end with '-bin' must have Buffer values")}else{if(Buffer.isBuffer(e))throw new Error("keys that don't end with '-bin' must have String values");if(!ZM(e))throw new Error('Metadata string value "'+e+'" contains illegal characters')}}var Ug=class n{constructor(e={}){this.internalRepr=new Map,this.options=e}set(e,t){e=Vu(e),PT(e,t),this.internalRepr.set(e,[t])}add(e,t){e=Vu(e),PT(e,t);let r=this.internalRepr.get(e);r===void 0?this.internalRepr.set(e,[t]):r.push(t)}remove(e){e=Vu(e),this.internalRepr.delete(e)}get(e){return e=Vu(e),this.internalRepr.get(e)||[]}getMap(){let e={};for(let[t,r]of this.internalRepr)if(r.length>0){let i=r[0];e[t]=Buffer.isBuffer(i)?Buffer.from(i):i}return e}clone(){let e=new n(this.options),t=e.internalRepr;for(let[r,i]of this.internalRepr){let s=i.map(o=>Buffer.isBuffer(o)?Buffer.from(o):o);t.set(r,s)}return e}merge(e){for(let[t,r]of e.internalRepr){let i=(this.internalRepr.get(t)||[]).concat(r);this.internalRepr.set(t,i)}}setOptions(e){this.options=e}getOptions(){return this.options}toHttp2Headers(){let e={};for(let[t,r]of this.internalRepr)e[t]=r.map(tO);return e}toJSON(){let e={};for(let[t,r]of this.internalRepr)e[t]=r;return e}static fromHttp2Headers(e){let t=new n;for(let r of Object.keys(e)){if(r.charAt(0)===":")continue;let i=e[r];try{FT(r)?Array.isArray(i)?i.forEach(s=>{t.add(r,Buffer.from(s,"base64"))}):i!==void 0&&(eO(r)?i.split(",").forEach(s=>{t.add(r,Buffer.from(s.trim(),"base64"))}):t.add(r,Buffer.from(i,"base64"))):Array.isArray(i)?i.forEach(s=>{t.add(r,s)}):i!==void 0&&t.add(r,i)}catch(s){let o=`Failed to add metadata entry ${r}: ${i}. ${(0,QM.getErrorMessage)(s)}. For more information see https://github.com/grpc/grpc-node/issues/1173`;(0,WM.log)($M.LogVerbosity.ERROR,o)}}return t}};qu.Metadata=Ug;var tO=n=>Buffer.isBuffer(n)?n.toString("base64"):n});var Kg=E(Uu=>{"use strict";Object.defineProperty(Uu,"__esModule",{value:!0});Uu.CallCredentials=void 0;var Hg=Nt();function nO(n){return"getRequestHeaders"in n&&typeof n.getRequestHeaders=="function"}var Zs=class n{static createFromMetadataGenerator(e){return new jg(e)}static createFromGoogleCredential(e){return n.createFromMetadataGenerator((t,r)=>{let i;nO(e)?i=e.getRequestHeaders(t.service_url):i=new Promise((s,o)=>{e.getRequestMetadata(t.service_url,(a,l)=>{if(a){o(a);return}if(!l){o(new Error("Headers not set by metadata plugin"));return}s(l)})}),i.then(s=>{let o=new Hg.Metadata;for(let a of Object.keys(s))o.add(a,s[a]);r(null,o)},s=>{r(s)})})}static createEmpty(){return new Gg}};Uu.CallCredentials=Zs;var zg=class n extends Zs{constructor(e){super(),this.creds=e}generateMetadata(e){return g(this,null,function*(){let t=new Hg.Metadata,r=yield Promise.all(this.creds.map(i=>i.generateMetadata(e)));for(let i of r)t.merge(i);return t})}compose(e){return new n(this.creds.concat([e]))}_equals(e){return this===e?!0:e instanceof n?this.creds.every((t,r)=>t._equals(e.creds[r])):!1}},jg=class n extends Zs{constructor(e){super(),this.metadataGenerator=e}generateMetadata(e){return new Promise((t,r)=>{this.metadataGenerator(e,(i,s)=>{s!==void 0?t(s):r(i)})})}compose(e){return new zg([this,e])}_equals(e){return this===e?!0:e instanceof n?this.metadataGenerator===e.metadataGenerator:!1}},Gg=class n extends Zs{generateMetadata(e){return Promise.resolve(new Hg.Metadata)}compose(e){return e}_equals(e){return e instanceof n}}});var $g=E(eo=>{"use strict";Object.defineProperty(eo,"__esModule",{value:!0});eo.getDefaultRootsData=eo.CIPHER_SUITES=void 0;var rO=he("fs");eo.CIPHER_SUITES=process.env.GRPC_SSL_CIPHER_SUITES;var LT=process.env.GRPC_DEFAULT_SSL_ROOTS_FILE_PATH,Wg=null;function iO(){return LT?(Wg===null&&(Wg=rO.readFileSync(LT)),Wg):null}eo.getDefaultRootsData=iO});var Gu=E(ju=>{"use strict";Object.defineProperty(ju,"__esModule",{value:!0});ju.ChannelCredentials=void 0;var sO=he("tls"),oO=Kg(),BT=$g();function Qg(n,e){if(n&&!(n instanceof Buffer))throw new TypeError(`${e}, if provided, must be a Buffer.`)}var to=class{constructor(e){this.callCredentials=e||oO.CallCredentials.createEmpty()}_getCallCredentials(){return this.callCredentials}static createSsl(e,t,r,i){var s;if(Qg(e,"Root certificate"),Qg(t,"Private key"),Qg(r,"Certificate chain"),t&&!r)throw new Error("Private key must be given with accompanying certificate chain");if(!t&&r)throw new Error("Certificate chain must be given with accompanying private key");let o=(0,sO.createSecureContext)({ca:(s=e??(0,BT.getDefaultRootsData)())!==null&&s!==void 0?s:void 0,key:t??void 0,cert:r??void 0,ciphers:BT.CIPHER_SUITES});return new zu(o,i??{})}static createFromSecureContext(e,t){return new zu(e,t??{})}static createInsecure(){return new Yg}};ju.ChannelCredentials=to;var Yg=class n extends to{constructor(e){super(e)}compose(e){throw new Error("Cannot compose insecure credentials")}_getConnectionOptions(){return null}_isSecure(){return!1}_equals(e){return e instanceof n}},zu=class n extends to{constructor(e,t){super(),this.secureContext=e,this.verifyOptions=t,this.connectionOptions={secureContext:e},t?.checkServerIdentity&&(this.connectionOptions.checkServerIdentity=t.checkServerIdentity)}compose(e){let t=this.callCredentials.compose(e);return new Xg(this,t)}_getConnectionOptions(){return Object.assign({},this.connectionOptions)}_isSecure(){return!0}_equals(e){return this===e?!0:e instanceof n?this.secureContext===e.secureContext&&this.verifyOptions.checkServerIdentity===e.verifyOptions.checkServerIdentity:!1}},Xg=class n extends to{constructor(e,t){super(t),this.channelCredentials=e}compose(e){let t=this.callCredentials.compose(e);return new n(this.channelCredentials,t)}_getConnectionOptions(){return this.channelCredentials._getConnectionOptions()}_isSecure(){return!0}_equals(e){return this===e?!0:e instanceof n?this.channelCredentials._equals(e.channelCredentials)&&this.callCredentials._equals(e.callCredentials):!1}}});var jr=E(vt=>{"use strict";Object.defineProperty(vt,"__esModule",{value:!0});vt.validateLoadBalancingConfig=vt.getFirstUsableConfig=vt.isLoadBalancerNameRegistered=vt.createLoadBalancer=vt.registerDefaultLoadBalancerType=vt.registerLoadBalancerType=vt.createChildChannelControlHelper=void 0;function aO(n,e){var t,r,i,s,o,a,l,c,u,d;return{createSubchannel:(r=(t=e.createSubchannel)===null||t===void 0?void 0:t.bind(e))!==null&&r!==void 0?r:n.createSubchannel.bind(n),updateState:(s=(i=e.updateState)===null||i===void 0?void 0:i.bind(e))!==null&&s!==void 0?s:n.updateState.bind(n),requestReresolution:(a=(o=e.requestReresolution)===null||o===void 0?void 0:o.bind(e))!==null&&a!==void 0?a:n.requestReresolution.bind(n),addChannelzChild:(c=(l=e.addChannelzChild)===null||l===void 0?void 0:l.bind(e))!==null&&c!==void 0?c:n.addChannelzChild.bind(n),removeChannelzChild:(d=(u=e.removeChannelzChild)===null||u===void 0?void 0:u.bind(e))!==null&&d!==void 0?d:n.removeChannelzChild.bind(n)}}vt.createChildChannelControlHelper=aO;var zr={},Jg=null;function lO(n,e,t){zr[n]={LoadBalancer:e,LoadBalancingConfig:t}}vt.registerLoadBalancerType=lO;function cO(n){Jg=n}vt.registerDefaultLoadBalancerType=cO;function uO(n,e){let t=n.getLoadBalancerName();return t in zr?new zr[t].LoadBalancer(e):null}vt.createLoadBalancer=uO;function dO(n){return n in zr}vt.isLoadBalancerNameRegistered=dO;function hO(n,e=!1){for(let t of n)if(t.getLoadBalancerName()in zr)return t;return e&&Jg?new zr[Jg].LoadBalancingConfig:null}vt.getFirstUsableConfig=hO;function fO(n){if(!(n!==null&&typeof n=="object"))throw new Error("Load balancing config must be an object");let e=Object.keys(n);if(e.length!==1)throw new Error("Provided load balancing config has multiple conflicting entries");let t=e[0];if(t in zr)return zr[t].LoadBalancingConfig.createFromJson(n[t]);throw new Error(`Unrecognized load balancing config name ${t}`)}vt.validateLoadBalancingConfig=fO});var Zg=E(Gr=>{"use strict";Object.defineProperty(Gr,"__esModule",{value:!0});Gr.extractAndSelectServiceConfig=Gr.validateServiceConfig=Gr.validateRetryThrottling=void 0;var pO=he("os"),Hu=ce(),gO=jr(),Ku=/^\d+(\.\d{1,9})?s$/,mO="node";function yO(n){if("service"in n&&n.service!==""){if(typeof n.service!="string")throw new Error(`Invalid method config name: invalid service: expected type string, got ${typeof n.service}`);if("method"in n&&n.method!==""){if(typeof n.method!="string")throw new Error(`Invalid method config name: invalid method: expected type string, got ${typeof n.service}`);return{service:n.service,method:n.method}}else return{service:n.service}}else{if("method"in n&&n.method!==void 0)throw new Error("Invalid method config name: method set with empty or unset service");return{}}}function vO(n){if(!("maxAttempts"in n)||!Number.isInteger(n.maxAttempts)||n.maxAttempts<2)throw new Error("Invalid method config retry policy: maxAttempts must be an integer at least 2");if(!("initialBackoff"in n)||typeof n.initialBackoff!="string"||!Ku.test(n.initialBackoff))throw new Error("Invalid method config retry policy: initialBackoff must be a string consisting of a positive integer followed by s");if(!("maxBackoff"in n)||typeof n.maxBackoff!="string"||!Ku.test(n.maxBackoff))throw new Error("Invalid method config retry policy: maxBackoff must be a string consisting of a positive integer followed by s");if(!("backoffMultiplier"in n)||typeof n.backoffMultiplier!="number"||n.backoffMultiplier<=0)throw new Error("Invalid method config retry policy: backoffMultiplier must be a number greater than 0");if(!("retryableStatusCodes"in n&&Array.isArray(n.retryableStatusCodes)))throw new Error("Invalid method config retry policy: retryableStatusCodes is required");if(n.retryableStatusCodes.length===0)throw new Error("Invalid method config retry policy: retryableStatusCodes must be non-empty");for(let e of n.retryableStatusCodes)if(typeof e=="number"){if(!Object.values(Hu.Status).includes(e))throw new Error("Invalid method config retry policy: retryableStatusCodes value not in status code range")}else if(typeof e=="string"){if(!Object.values(Hu.Status).includes(e.toUpperCase()))throw new Error("Invalid method config retry policy: retryableStatusCodes value not a status code name")}else throw new Error("Invalid method config retry policy: retryableStatusCodes value must be a string or number");return{maxAttempts:n.maxAttempts,initialBackoff:n.initialBackoff,maxBackoff:n.maxBackoff,backoffMultiplier:n.backoffMultiplier,retryableStatusCodes:n.retryableStatusCodes}}function SO(n){if(!("maxAttempts"in n)||!Number.isInteger(n.maxAttempts)||n.maxAttempts<2)throw new Error("Invalid method config hedging policy: maxAttempts must be an integer at least 2");if("hedgingDelay"in n&&(typeof n.hedgingDelay!="string"||!Ku.test(n.hedgingDelay)))throw new Error("Invalid method config hedging policy: hedgingDelay must be a string consisting of a positive integer followed by s");if("nonFatalStatusCodes"in n&&Array.isArray(n.nonFatalStatusCodes))for(let t of n.nonFatalStatusCodes)if(typeof t=="number"){if(!Object.values(Hu.Status).includes(t))throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value not in status code range")}else if(typeof t=="string"){if(!Object.values(Hu.Status).includes(t.toUpperCase()))throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value not a status code name")}else throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value must be a string or number");let e={maxAttempts:n.maxAttempts};return n.hedgingDelay&&(e.hedgingDelay=n.hedgingDelay),n.nonFatalStatusCodes&&(e.nonFatalStatusCodes=n.nonFatalStatusCodes),e}function _O(n){var e;let t={name:[]};if(!("name"in n)||!Array.isArray(n.name))throw new Error("Invalid method config: invalid name array");for(let r of n.name)t.name.push(yO(r));if("waitForReady"in n){if(typeof n.waitForReady!="boolean")throw new Error("Invalid method config: invalid waitForReady");t.waitForReady=n.waitForReady}if("timeout"in n)if(typeof n.timeout=="object"){if(!("seconds"in n.timeout)||typeof n.timeout.seconds!="number")throw new Error("Invalid method config: invalid timeout.seconds");if(!("nanos"in n.timeout)||typeof n.timeout.nanos!="number")throw new Error("Invalid method config: invalid timeout.nanos");t.timeout=n.timeout}else if(typeof n.timeout=="string"&&Ku.test(n.timeout)){let r=n.timeout.substring(0,n.timeout.length-1).split(".");t.timeout={seconds:r[0]|0,nanos:((e=r[1])!==null&&e!==void 0?e:0)|0}}else throw new Error("Invalid method config: invalid timeout");if("maxRequestBytes"in n){if(typeof n.maxRequestBytes!="number")throw new Error("Invalid method config: invalid maxRequestBytes");t.maxRequestBytes=n.maxRequestBytes}if("maxResponseBytes"in n){if(typeof n.maxResponseBytes!="number")throw new Error("Invalid method config: invalid maxRequestBytes");t.maxResponseBytes=n.maxResponseBytes}if("retryPolicy"in n){if("hedgingPolicy"in n)throw new Error("Invalid method config: retryPolicy and hedgingPolicy cannot both be specified");t.retryPolicy=vO(n.retryPolicy)}else"hedgingPolicy"in n&&(t.hedgingPolicy=SO(n.hedgingPolicy));return t}function VT(n){if(!("maxTokens"in n)||typeof n.maxTokens!="number"||n.maxTokens<=0||n.maxTokens>1e3)throw new Error("Invalid retryThrottling: maxTokens must be a number in (0, 1000]");if(!("tokenRatio"in n)||typeof n.tokenRatio!="number"||n.tokenRatio<=0)throw new Error("Invalid retryThrottling: tokenRatio must be a number greater than 0");return{maxTokens:+n.maxTokens.toFixed(3),tokenRatio:+n.tokenRatio.toFixed(3)}}Gr.validateRetryThrottling=VT;function qT(n){let e={loadBalancingConfig:[],methodConfig:[]};if("loadBalancingPolicy"in n)if(typeof n.loadBalancingPolicy=="string")e.loadBalancingPolicy=n.loadBalancingPolicy;else throw new Error("Invalid service config: invalid loadBalancingPolicy");if("loadBalancingConfig"in n)if(Array.isArray(n.loadBalancingConfig))for(let r of n.loadBalancingConfig)e.loadBalancingConfig.push((0,gO.validateLoadBalancingConfig)(r));else throw new Error("Invalid service config: invalid loadBalancingConfig");if("methodConfig"in n&&Array.isArray(n.methodConfig))for(let r of n.methodConfig)e.methodConfig.push(_O(r));"retryThrottling"in n&&(e.retryThrottling=VT(n.retryThrottling));let t=[];for(let r of e.methodConfig)for(let i of r.name){for(let s of t)if(i.service===s.service&&i.method===s.method)throw new Error(`Invalid service config: duplicate name ${i.service}/${i.method}`);t.push(i)}return e}Gr.validateServiceConfig=qT;function EO(n){if(!("serviceConfig"in n))throw new Error("Invalid service config choice: missing service config");let e={serviceConfig:qT(n.serviceConfig)};if("clientLanguage"in n)if(Array.isArray(n.clientLanguage)){e.clientLanguage=[];for(let r of n.clientLanguage)if(typeof r=="string")e.clientLanguage.push(r);else throw new Error("Invalid service config choice: invalid clientLanguage")}else throw new Error("Invalid service config choice: invalid clientLanguage");if("clientHostname"in n)if(Array.isArray(n.clientHostname)){e.clientHostname=[];for(let r of n.clientHostname)if(typeof r=="string")e.clientHostname.push(r);else throw new Error("Invalid service config choice: invalid clientHostname")}else throw new Error("Invalid service config choice: invalid clientHostname");if("percentage"in n)if(typeof n.percentage=="number"&&0<=n.percentage&&n.percentage<=100)e.percentage=n.percentage;else throw new Error("Invalid service config choice: invalid percentage");let t=["clientLanguage","percentage","clientHostname","serviceConfig"];for(let r in n)if(!t.includes(r))throw new Error(`Invalid service config choice: unexpected field ${r}`);return e}function wO(n,e){if(!Array.isArray(n))throw new Error("Invalid service config list");for(let t of n){let r=EO(t);if(!(typeof r.percentage=="number"&&e>r.percentage)){if(Array.isArray(r.clientHostname)){let i=!1;for(let s of r.clientHostname)s===pO.hostname()&&(i=!0);if(!i)continue}if(Array.isArray(r.clientLanguage)){let i=!1;for(let s of r.clientLanguage)s===mO&&(i=!0);if(!i)continue}return r.serviceConfig}}throw new Error("No matching service config found")}function TO(n,e){for(let t of n)if(t.length>0&&t[0].startsWith("grpc_config=")){let r=t.join("").substring(12),i=JSON.parse(r);return wO(i,e)}return null}Gr.extractAndSelectServiceConfig=TO});var nn=E(Wu=>{"use strict";Object.defineProperty(Wu,"__esModule",{value:!0});Wu.ConnectivityState=void 0;var UT=function(n){return n[n.IDLE=0]="IDLE",n[n.CONNECTING=1]="CONNECTING",n[n.READY=2]="READY",n[n.TRANSIENT_FAILURE=3]="TRANSIENT_FAILURE",n[n.SHUTDOWN=4]="SHUTDOWN",n}(UT||(Wu.ConnectivityState=UT={}))});var Wt=E(Hr=>{"use strict";Object.defineProperty(Hr,"__esModule",{value:!0});Hr.uriToString=Hr.splitHostPort=Hr.parseUri=void 0;var CO=/^(?:([A-Za-z0-9+.-]+):)?(?:\/\/([^/]*)\/)?(.+)$/;function bO(n){let e=CO.exec(n);return e===null?null:{scheme:e[1],authority:e[2],path:e[3]}}Hr.parseUri=bO;var zT=/^\d+$/;function AO(n){if(n.startsWith("[")){let e=n.indexOf("]");if(e===-1)return null;let t=n.substring(1,e);if(t.indexOf(":")===-1)return null;if(n.length>e+1)if(n[e+1]===":"){let r=n.substring(e+2);return zT.test(r)?{host:t,port:+r}:null}else return null;else return{host:t}}else{let e=n.split(":");return e.length===2?zT.test(e[1])?{host:e[0],port:+e[1]}:null:{host:n}}}Hr.splitHostPort=AO;function IO(n){let e="";return n.scheme!==void 0&&(e+=n.scheme+":"),n.authority!==void 0&&(e+="//"+n.authority+"/"),e+=n.path,e}Hr.uriToString=IO});var zn=E(rn=>{"use strict";Object.defineProperty(rn,"__esModule",{value:!0});rn.mapUriDefaultScheme=rn.getDefaultAuthority=rn.createResolver=rn.registerDefaultScheme=rn.registerResolver=void 0;var tm=Wt(),no={},em=null;function DO(n,e){no[n]=e}rn.registerResolver=DO;function RO(n){em=n}rn.registerDefaultScheme=RO;function kO(n,e,t){if(n.scheme!==void 0&&n.scheme in no)return new no[n.scheme](n,e,t);throw new Error(`No resolver could be created for target ${(0,tm.uriToString)(n)}`)}rn.createResolver=kO;function NO(n){if(n.scheme!==void 0&&n.scheme in no)return no[n.scheme].getDefaultAuthority(n);throw new Error(`Invalid target ${(0,tm.uriToString)(n)}`)}rn.getDefaultAuthority=NO;function xO(n){return n.scheme===void 0||!(n.scheme in no)?em!==null?{scheme:em,authority:void 0,path:(0,tm.uriToString)(n)}:null:n}rn.mapUriDefaultScheme=xO});var Wr=E(Kr=>{"use strict";Object.defineProperty(Kr,"__esModule",{value:!0});Kr.QueuePicker=Kr.UnavailablePicker=Kr.PickResultType=void 0;var MO=Nt(),OO=ce(),$u=function(n){return n[n.COMPLETE=0]="COMPLETE",n[n.QUEUE=1]="QUEUE",n[n.TRANSIENT_FAILURE=2]="TRANSIENT_FAILURE",n[n.DROP=3]="DROP",n}($u||(Kr.PickResultType=$u={})),nm=class{constructor(e){this.status=Object.assign({code:OO.Status.UNAVAILABLE,details:"No connection established",metadata:new MO.Metadata},e)}pick(e){return{pickResultType:$u.TRANSIENT_FAILURE,subchannel:null,status:this.status,onCallStarted:null,onCallEnded:null}}};Kr.UnavailablePicker=nm;var rm=class{constructor(e){this.loadBalancer=e,this.calledExitIdle=!1}pick(e){return this.calledExitIdle||(process.nextTick(()=>{this.loadBalancer.exitIdle()}),this.calledExitIdle=!0),{pickResultType:$u.QUEUE,subchannel:null,status:null,onCallStarted:null,onCallEnded:null}}};Kr.QueuePicker=rm});var ul=E(Qu=>{"use strict";Object.defineProperty(Qu,"__esModule",{value:!0});Qu.BackoffTimeout=void 0;var PO=1e3,FO=1.6,LO=12e4,BO=.2;function VO(n,e){return Math.random()*(e-n)+n}var im=class{constructor(e,t){this.callback=e,this.initialDelay=PO,this.multiplier=FO,this.maxDelay=LO,this.jitter=BO,this.running=!1,this.hasRef=!0,this.startTime=new Date,this.endTime=new Date,t&&(t.initialDelay&&(this.initialDelay=t.initialDelay),t.multiplier&&(this.multiplier=t.multiplier),t.jitter&&(this.jitter=t.jitter),t.maxDelay&&(this.maxDelay=t.maxDelay)),this.nextDelay=this.initialDelay,this.timerId=setTimeout(()=>{},0),clearTimeout(this.timerId)}runTimer(e){var t,r;this.endTime=this.startTime,this.endTime.setMilliseconds(this.endTime.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),this.timerId=setTimeout(()=>{this.callback(),this.running=!1},e),this.hasRef||(r=(t=this.timerId).unref)===null||r===void 0||r.call(t)}runOnce(){this.running=!0,this.startTime=new Date,this.runTimer(this.nextDelay);let e=Math.min(this.nextDelay*this.multiplier,this.maxDelay),t=e*this.jitter;this.nextDelay=e+VO(-t,t)}stop(){clearTimeout(this.timerId),this.running=!1}reset(){if(this.nextDelay=this.initialDelay,this.running){let e=new Date,t=this.startTime;t.setMilliseconds(t.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),e<t?this.runTimer(t.getTime()-e.getTime()):this.running=!1}}isRunning(){return this.running}ref(){var e,t;this.hasRef=!0,(t=(e=this.timerId).ref)===null||t===void 0||t.call(e)}unref(){var e,t;this.hasRef=!1,(t=(e=this.timerId).unref)===null||t===void 0||t.call(e)}getEndTime(){return this.endTime}};Qu.BackoffTimeout=im});var Xu=E(Yu=>{"use strict";Object.defineProperty(Yu,"__esModule",{value:!0});Yu.ChildLoadBalancerHandler=void 0;var qO=jr(),UO=nn(),zO="child_load_balancer_helper",sm=class{constructor(e){this.channelControlHelper=e,this.currentChild=null,this.pendingChild=null,this.latestConfig=null,this.ChildPolicyHelper=class{constructor(t){this.parent=t,this.child=null}createSubchannel(t,r){return this.parent.channelControlHelper.createSubchannel(t,r)}updateState(t,r){var i;if(this.calledByPendingChild()){if(t===UO.ConnectivityState.CONNECTING)return;(i=this.parent.currentChild)===null||i===void 0||i.destroy(),this.parent.currentChild=this.parent.pendingChild,this.parent.pendingChild=null}else if(!this.calledByCurrentChild())return;this.parent.channelControlHelper.updateState(t,r)}requestReresolution(){var t;let r=(t=this.parent.pendingChild)!==null&&t!==void 0?t:this.parent.currentChild;this.child===r&&this.parent.channelControlHelper.requestReresolution()}setChild(t){this.child=t}addChannelzChild(t){this.parent.channelControlHelper.addChannelzChild(t)}removeChannelzChild(t){this.parent.channelControlHelper.removeChannelzChild(t)}calledByPendingChild(){return this.child===this.parent.pendingChild}calledByCurrentChild(){return this.child===this.parent.currentChild}}}configUpdateRequiresNewPolicyInstance(e,t){return e.getLoadBalancerName()!==t.getLoadBalancerName()}updateAddressList(e,t,r){let i;if(this.currentChild===null||this.latestConfig===null||this.configUpdateRequiresNewPolicyInstance(this.latestConfig,t)){let s=new this.ChildPolicyHelper(this),o=(0,qO.createLoadBalancer)(t,s);s.setChild(o),this.currentChild===null?(this.currentChild=o,i=this.currentChild):(this.pendingChild&&this.pendingChild.destroy(),this.pendingChild=o,i=this.pendingChild)}else this.pendingChild===null?i=this.currentChild:i=this.pendingChild;this.latestConfig=t,i.updateAddressList(e,t,r)}exitIdle(){this.currentChild&&(this.currentChild.exitIdle(),this.pendingChild&&this.pendingChild.exitIdle())}resetBackoff(){this.currentChild&&(this.currentChild.resetBackoff(),this.pendingChild&&this.pendingChild.resetBackoff())}destroy(){this.currentChild&&(this.currentChild.destroy(),this.currentChild=null),this.pendingChild&&(this.pendingChild.destroy(),this.pendingChild=null)}getTypeName(){return zO}};Yu.ChildLoadBalancerHandler=sm});var GT=E(Ju=>{"use strict";Object.defineProperty(Ju,"__esModule",{value:!0});Ju.ResolvingLoadBalancer=void 0;var jO=jr(),GO=Zg(),Ut=nn(),HO=zn(),ro=Wr(),KO=ul(),om=ce(),WO=Nt(),$O=Fe(),QO=ce(),YO=Wt(),XO=Xu(),JO="resolving_load_balancer";function jT(n){$O.trace(QO.LogVerbosity.DEBUG,JO,n)}var ZO=["SERVICE_AND_METHOD","SERVICE","EMPTY"];function eP(n,e,t,r){for(let i of t.name)switch(r){case"EMPTY":if(!i.service&&!i.method)return!0;break;case"SERVICE":if(i.service===n&&!i.method)return!0;break;case"SERVICE_AND_METHOD":if(i.service===n&&i.method===e)return!0}return!1}function tP(n,e,t,r){for(let i of t)if(eP(n,e,i,r))return i;return null}function nP(n){return function(t,r){var i,s;let o=t.split("/").filter(c=>c.length>0),a=(i=o[0])!==null&&i!==void 0?i:"",l=(s=o[1])!==null&&s!==void 0?s:"";if(n&&n.methodConfig)for(let c of ZO){let u=tP(a,l,n.methodConfig,c);if(u)return{methodConfig:u,pickInformation:{},status:om.Status.OK,dynamicFilterFactories:[]}}return{methodConfig:{name:[]},pickInformation:{},status:om.Status.OK,dynamicFilterFactories:[]}}}var am=class{constructor(e,t,r,i,s){this.target=e,this.channelControlHelper=t,this.onSuccessfulResolution=i,this.onFailedResolution=s,this.latestChildState=Ut.ConnectivityState.IDLE,this.latestChildPicker=new ro.QueuePicker(this),this.currentState=Ut.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1,r["grpc.service_config"]?this.defaultServiceConfig=(0,GO.validateServiceConfig)(JSON.parse(r["grpc.service_config"])):this.defaultServiceConfig={loadBalancingConfig:[],methodConfig:[]},this.updateState(Ut.ConnectivityState.IDLE,new ro.QueuePicker(this)),this.childLoadBalancer=new XO.ChildLoadBalancerHandler({createSubchannel:t.createSubchannel.bind(t),requestReresolution:()=>{this.backoffTimeout.isRunning()?(jT("requestReresolution delayed by backoff timer until "+this.backoffTimeout.getEndTime().toISOString()),this.continueResolving=!0):this.updateResolution()},updateState:(a,l)=>{this.latestChildState=a,this.latestChildPicker=l,this.updateState(a,l)},addChannelzChild:t.addChannelzChild.bind(t),removeChannelzChild:t.removeChannelzChild.bind(t)}),this.innerResolver=(0,HO.createResolver)(e,{onSuccessfulResolution:(a,l,c,u,d)=>{var h;this.backoffTimeout.stop(),this.backoffTimeout.reset();let p=null;l===null?c===null?(this.previousServiceConfig=null,p=this.defaultServiceConfig):this.previousServiceConfig===null?this.handleResolutionFailure(c):p=this.previousServiceConfig:(p=l,this.previousServiceConfig=l);let y=(h=p?.loadBalancingConfig)!==null&&h!==void 0?h:[],S=(0,jO.getFirstUsableConfig)(y,!0);if(S===null){this.handleResolutionFailure({code:om.Status.UNAVAILABLE,details:"All load balancer options in service config are not compatible",metadata:new WO.Metadata});return}this.childLoadBalancer.updateAddressList(a,S,d);let _=p??this.defaultServiceConfig;this.onSuccessfulResolution(_,u??nP(_))},onError:a=>{this.handleResolutionFailure(a)}},r);let o={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new KO.BackoffTimeout(()=>{this.continueResolving?(this.updateResolution(),this.continueResolving=!1):this.updateState(this.latestChildState,this.latestChildPicker)},o),this.backoffTimeout.unref()}updateResolution(){this.innerResolver.updateResolution(),this.currentState===Ut.ConnectivityState.IDLE&&this.updateState(Ut.ConnectivityState.CONNECTING,new ro.QueuePicker(this)),this.backoffTimeout.runOnce()}updateState(e,t){jT((0,YO.uriToString)(this.target)+" "+Ut.ConnectivityState[this.currentState]+" -> "+Ut.ConnectivityState[e]),e===Ut.ConnectivityState.IDLE&&(t=new ro.QueuePicker(this)),this.currentState=e,this.channelControlHelper.updateState(e,t)}handleResolutionFailure(e){this.latestChildState===Ut.ConnectivityState.IDLE&&(this.updateState(Ut.ConnectivityState.TRANSIENT_FAILURE,new ro.UnavailablePicker(e)),this.onFailedResolution(e))}exitIdle(){(this.currentState===Ut.ConnectivityState.IDLE||this.currentState===Ut.ConnectivityState.TRANSIENT_FAILURE)&&(this.backoffTimeout.isRunning()?this.continueResolving=!0:this.updateResolution()),this.childLoadBalancer.exitIdle()}updateAddressList(e,t){throw new Error("updateAddressList not supported on ResolvingLoadBalancer")}resetBackoff(){this.backoffTimeout.reset(),this.childLoadBalancer.resetBackoff()}destroy(){this.childLoadBalancer.destroy(),this.innerResolver.destroy(),this.backoffTimeout.reset(),this.backoffTimeout.stop(),this.latestChildState=Ut.ConnectivityState.IDLE,this.latestChildPicker=new ro.QueuePicker(this),this.currentState=Ut.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1}getTypeName(){return"resolving_load_balancer"}};Ju.ResolvingLoadBalancer=am});var HT=E(io=>{"use strict";Object.defineProperty(io,"__esModule",{value:!0});io.channelOptionsEqual=io.recognizedOptions=void 0;io.recognizedOptions={"grpc.ssl_target_name_override":!0,"grpc.primary_user_agent":!0,"grpc.secondary_user_agent":!0,"grpc.default_authority":!0,"grpc.keepalive_time_ms":!0,"grpc.keepalive_timeout_ms":!0,"grpc.keepalive_permit_without_calls":!0,"grpc.service_config":!0,"grpc.max_concurrent_streams":!0,"grpc.initial_reconnect_backoff_ms":!0,"grpc.max_reconnect_backoff_ms":!0,"grpc.use_local_subchannel_pool":!0,"grpc.max_send_message_length":!0,"grpc.max_receive_message_length":!0,"grpc.enable_http_proxy":!0,"grpc.enable_channelz":!0,"grpc.dns_min_time_between_resolutions_ms":!0,"grpc.enable_retries":!0,"grpc.per_rpc_retry_buffer_size":!0,"grpc.retry_buffer_size":!0,"grpc.max_connection_age_ms":!0,"grpc.max_connection_age_grace_ms":!0,"grpc-node.max_session_memory":!0,"grpc.service_config_disable_resolution":!0,"grpc.client_idle_timeout_ms":!0,"grpc-node.tls_enable_trace":!0};function rP(n,e){let t=Object.keys(n).sort(),r=Object.keys(e).sort();if(t.length!==r.length)return!1;for(let i=0;i<t.length;i+=1)if(t[i]!==r[i]||n[t[i]]!==e[r[i]])return!1;return!0}io.channelOptionsEqual=rP});var Gn=E(jn=>{"use strict";Object.defineProperty(jn,"__esModule",{value:!0});jn.stringToSubchannelAddress=jn.subchannelAddressToString=jn.subchannelAddressEqual=jn.isTcpSubchannelAddress=void 0;var iP=he("net");function dl(n){return"port"in n}jn.isTcpSubchannelAddress=dl;function sP(n,e){return!n&&!e?!0:!n||!e?!1:dl(n)?dl(e)&&n.host===e.host&&n.port===e.port:!dl(e)&&n.path===e.path}jn.subchannelAddressEqual=sP;function oP(n){return dl(n)?n.host+":"+n.port:n.path}jn.subchannelAddressToString=oP;var aP=443;function lP(n,e){return(0,iP.isIP)(n)?{host:n,port:e??aP}:{path:n}}jn.stringToSubchannelAddress=lP});var Zu=E(so=>{"use strict";Object.defineProperty(so,"__esModule",{value:!0});so.addAdminServicesToServer=so.registerAdminService=void 0;var KT=[];function cP(n,e){KT.push({getServiceDefinition:n,getHandlers:e})}so.registerAdminService=cP;function uP(n){for(let{getServiceDefinition:e,getHandlers:t}of KT)n.addService(e(),t())}so.addAdminServicesToServer=uP});var WT=E(sn=>{"use strict";Object.defineProperty(sn,"__esModule",{value:!0});sn.ClientDuplexStreamImpl=sn.ClientWritableStreamImpl=sn.ClientReadableStreamImpl=sn.ClientUnaryCallImpl=sn.callErrorFromStatus=void 0;var dP=he("events"),hm=he("stream"),hl=ce();function hP(n,e){let t=`${n.code} ${hl.Status[n.code]}: ${n.details}`,i=`${new Error(t).stack}
for call at
${e}`;return Object.assign(new Error(t),n,{stack:i})}sn.callErrorFromStatus=hP;var lm=class extends dP.EventEmitter{constructor(){super()}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(hl.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}};sn.ClientUnaryCallImpl=lm;var cm=class extends hm.Readable{constructor(e){super({objectMode:!0}),this.deserialize=e}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(hl.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_read(e){var t;(t=this.call)===null||t===void 0||t.startRead()}};sn.ClientReadableStreamImpl=cm;var um=class extends hm.Writable{constructor(e){super({objectMode:!0}),this.serialize=e}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(hl.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_write(e,t,r){var i;let s={callback:r},o=Number(t);Number.isNaN(o)||(s.flags=o),(i=this.call)===null||i===void 0||i.sendMessageWithContext(s,e)}_final(e){var t;(t=this.call)===null||t===void 0||t.halfClose(),e()}};sn.ClientWritableStreamImpl=um;var dm=class extends hm.Duplex{constructor(e,t){super({objectMode:!0}),this.serialize=e,this.deserialize=t}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(hl.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_read(e){var t;(t=this.call)===null||t===void 0||t.startRead()}_write(e,t,r){var i;let s={callback:r},o=Number(t);Number.isNaN(o)||(s.flags=o),(i=this.call)===null||i===void 0||i.sendMessageWithContext(s,e)}_final(e){var t;(t=this.call)===null||t===void 0||t.halfClose(),e()}};sn.ClientDuplexStreamImpl=dm});var $T=E(oo=>{"use strict";Object.defineProperty(oo,"__esModule",{value:!0});oo.InterceptingListenerImpl=oo.isInterceptingListener=void 0;function fP(n){return n.onReceiveMetadata!==void 0&&n.onReceiveMetadata.length===1}oo.isInterceptingListener=fP;var fm=class{constructor(e,t){this.listener=e,this.nextListener=t,this.processingMetadata=!1,this.hasPendingMessage=!1,this.processingMessage=!1,this.pendingStatus=null}processPendingMessage(){this.hasPendingMessage&&(this.nextListener.onReceiveMessage(this.pendingMessage),this.pendingMessage=null,this.hasPendingMessage=!1)}processPendingStatus(){this.pendingStatus&&this.nextListener.onReceiveStatus(this.pendingStatus)}onReceiveMetadata(e){this.processingMetadata=!0,this.listener.onReceiveMetadata(e,t=>{this.processingMetadata=!1,this.nextListener.onReceiveMetadata(t),this.processPendingMessage(),this.processPendingStatus()})}onReceiveMessage(e){this.processingMessage=!0,this.listener.onReceiveMessage(e,t=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessage=t,this.hasPendingMessage=!0):(this.nextListener.onReceiveMessage(t),this.processPendingStatus())})}onReceiveStatus(e){this.listener.onReceiveStatus(e,t=>{this.processingMetadata||this.processingMessage?this.pendingStatus=t:this.nextListener.onReceiveStatus(t)})}};oo.InterceptingListenerImpl=fm});var _m=E(on=>{"use strict";Object.defineProperty(on,"__esModule",{value:!0});on.getInterceptingCall=on.InterceptingCall=on.RequesterBuilder=on.ListenerBuilder=on.InterceptorConfigurationError=void 0;var pP=Nt(),QT=$T(),YT=ce(),XT=Bu(),pl=class n extends Error{constructor(e){super(e),this.name="InterceptorConfigurationError",Error.captureStackTrace(this,n)}};on.InterceptorConfigurationError=pl;var gm=class{constructor(){this.metadata=void 0,this.message=void 0,this.status=void 0}withOnReceiveMetadata(e){return this.metadata=e,this}withOnReceiveMessage(e){return this.message=e,this}withOnReceiveStatus(e){return this.status=e,this}build(){return{onReceiveMetadata:this.metadata,onReceiveMessage:this.message,onReceiveStatus:this.status}}};on.ListenerBuilder=gm;var mm=class{constructor(){this.start=void 0,this.message=void 0,this.halfClose=void 0,this.cancel=void 0}withStart(e){return this.start=e,this}withSendMessage(e){return this.message=e,this}withHalfClose(e){return this.halfClose=e,this}withCancel(e){return this.cancel=e,this}build(){return{start:this.start,sendMessage:this.message,halfClose:this.halfClose,cancel:this.cancel}}};on.RequesterBuilder=mm;var pm={onReceiveMetadata:(n,e)=>{e(n)},onReceiveMessage:(n,e)=>{e(n)},onReceiveStatus:(n,e)=>{e(n)}},fl={start:(n,e,t)=>{t(n,e)},sendMessage:(n,e)=>{e(n)},halfClose:n=>{n()},cancel:n=>{n()}},ym=class{constructor(e,t){var r,i,s,o;this.nextCall=e,this.processingMetadata=!1,this.pendingMessageContext=null,this.processingMessage=!1,this.pendingHalfClose=!1,t?this.requester={start:(r=t.start)!==null&&r!==void 0?r:fl.start,sendMessage:(i=t.sendMessage)!==null&&i!==void 0?i:fl.sendMessage,halfClose:(s=t.halfClose)!==null&&s!==void 0?s:fl.halfClose,cancel:(o=t.cancel)!==null&&o!==void 0?o:fl.cancel}:this.requester=fl}cancelWithStatus(e,t){this.requester.cancel(()=>{this.nextCall.cancelWithStatus(e,t)})}getPeer(){return this.nextCall.getPeer()}processPendingMessage(){this.pendingMessageContext&&(this.nextCall.sendMessageWithContext(this.pendingMessageContext,this.pendingMessage),this.pendingMessageContext=null,this.pendingMessage=null)}processPendingHalfClose(){this.pendingHalfClose&&this.nextCall.halfClose()}start(e,t){var r,i,s,o,a,l;let c={onReceiveMetadata:(i=(r=t?.onReceiveMetadata)===null||r===void 0?void 0:r.bind(t))!==null&&i!==void 0?i:u=>{},onReceiveMessage:(o=(s=t?.onReceiveMessage)===null||s===void 0?void 0:s.bind(t))!==null&&o!==void 0?o:u=>{},onReceiveStatus:(l=(a=t?.onReceiveStatus)===null||a===void 0?void 0:a.bind(t))!==null&&l!==void 0?l:u=>{}};this.processingMetadata=!0,this.requester.start(e,c,(u,d)=>{var h,p,y;this.processingMetadata=!1;let S;if((0,QT.isInterceptingListener)(d))S=d;else{let _={onReceiveMetadata:(h=d.onReceiveMetadata)!==null&&h!==void 0?h:pm.onReceiveMetadata,onReceiveMessage:(p=d.onReceiveMessage)!==null&&p!==void 0?p:pm.onReceiveMessage,onReceiveStatus:(y=d.onReceiveStatus)!==null&&y!==void 0?y:pm.onReceiveStatus};S=new QT.InterceptingListenerImpl(_,c)}this.nextCall.start(u,S),this.processPendingMessage(),this.processPendingHalfClose()})}sendMessageWithContext(e,t){this.processingMessage=!0,this.requester.sendMessage(t,r=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessageContext=e,this.pendingMessage=t):(this.nextCall.sendMessageWithContext(e,r),this.processPendingHalfClose())})}sendMessage(e){this.sendMessageWithContext({},e)}startRead(){this.nextCall.startRead()}halfClose(){this.requester.halfClose(()=>{this.processingMetadata||this.processingMessage?this.pendingHalfClose=!0:this.nextCall.halfClose()})}};on.InterceptingCall=ym;function gP(n,e,t){var r,i;let s=(r=t.deadline)!==null&&r!==void 0?r:1/0,o=t.host,a=(i=t.parent)!==null&&i!==void 0?i:null,l=t.propagate_flags,c=t.credentials,u=n.createCall(e,s,o,a,l);return c&&u.setCredentials(c),u}var ed=class{constructor(e,t){this.call=e,this.methodDefinition=t}cancelWithStatus(e,t){this.call.cancelWithStatus(e,t)}getPeer(){return this.call.getPeer()}sendMessageWithContext(e,t){let r;try{r=this.methodDefinition.requestSerialize(t)}catch(i){this.call.cancelWithStatus(YT.Status.INTERNAL,`Request message serialization failure: ${(0,XT.getErrorMessage)(i)}`);return}this.call.sendMessageWithContext(e,r)}sendMessage(e){this.sendMessageWithContext({},e)}start(e,t){let r=null;this.call.start(e,{onReceiveMetadata:i=>{var s;(s=t?.onReceiveMetadata)===null||s===void 0||s.call(t,i)},onReceiveMessage:i=>{var s;let o;try{o=this.methodDefinition.responseDeserialize(i)}catch(a){r={code:YT.Status.INTERNAL,details:`Response message parsing error: ${(0,XT.getErrorMessage)(a)}`,metadata:new pP.Metadata},this.call.cancelWithStatus(r.code,r.details);return}(s=t?.onReceiveMessage)===null||s===void 0||s.call(t,o)},onReceiveStatus:i=>{var s,o;r?(s=t?.onReceiveStatus)===null||s===void 0||s.call(t,r):(o=t?.onReceiveStatus)===null||o===void 0||o.call(t,i)}})}startRead(){this.call.startRead()}halfClose(){this.call.halfClose()}},vm=class extends ed{constructor(e,t){super(e,t)}start(e,t){var r,i;let s=!1,o={onReceiveMetadata:(i=(r=t?.onReceiveMetadata)===null||r===void 0?void 0:r.bind(t))!==null&&i!==void 0?i:a=>{},onReceiveMessage:a=>{var l;s=!0,(l=t?.onReceiveMessage)===null||l===void 0||l.call(t,a)},onReceiveStatus:a=>{var l,c;s||(l=t?.onReceiveMessage)===null||l===void 0||l.call(t,null),(c=t?.onReceiveStatus)===null||c===void 0||c.call(t,a)}};super.start(e,o),this.call.startRead()}},Sm=class extends ed{};function mP(n,e,t){let r=gP(n,t.path,e);return t.responseStream?new Sm(r,t):new vm(r,t)}function yP(n,e,t,r){if(n.clientInterceptors.length>0&&n.clientInterceptorProviders.length>0)throw new pl("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(n.callInterceptors.length>0&&n.callInterceptorProviders.length>0)throw new pl("Both interceptors and interceptor_providers were passed as call options. Only one of these is allowed.");let i=[];n.callInterceptors.length>0||n.callInterceptorProviders.length>0?i=[].concat(n.callInterceptors,n.callInterceptorProviders.map(a=>a(e))).filter(a=>a):i=[].concat(n.clientInterceptors,n.clientInterceptorProviders.map(a=>a(e))).filter(a=>a);let s=Object.assign({},t,{method_definition:e});return i.reduceRight((a,l)=>c=>l(c,a),a=>mP(r,a,e))(s)}on.getInterceptingCall=yP});var Tm=E(nd=>{"use strict";Object.defineProperty(nd,"__esModule",{value:!0});nd.Client=void 0;var Hn=WT(),vP=Cm(),SP=nn(),$r=ce(),ao=Nt(),td=_m(),En=Symbol(),lo=Symbol(),co=Symbol(),mr=Symbol();function Em(n){return typeof n=="function"}function uo(n){return n.stack.split(`
`).slice(1).join(`
`)}var wm=class{constructor(e,t,r={}){var i,s;if(r=Object.assign({},r),this[lo]=(i=r.interceptors)!==null&&i!==void 0?i:[],delete r.interceptors,this[co]=(s=r.interceptor_providers)!==null&&s!==void 0?s:[],delete r.interceptor_providers,this[lo].length>0&&this[co].length>0)throw new Error("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(this[mr]=r.callInvocationTransformer,delete r.callInvocationTransformer,r.channelOverride)this[En]=r.channelOverride;else if(r.channelFactoryOverride){let o=r.channelFactoryOverride;delete r.channelFactoryOverride,this[En]=o(e,t,r)}else this[En]=new vP.ChannelImplementation(e,t,r)}close(){this[En].close()}getChannel(){return this[En]}waitForReady(e,t){let r=i=>{if(i){t(new Error("Failed to connect before the deadline"));return}let s;try{s=this[En].getConnectivityState(!0)}catch{t(new Error("The channel has been closed"));return}if(s===SP.ConnectivityState.READY)t();else try{this[En].watchConnectivityState(s,e,r)}catch{t(new Error("The channel has been closed"))}};setImmediate(r)}checkOptionalUnaryResponseArguments(e,t,r){if(Em(e))return{metadata:new ao.Metadata,options:{},callback:e};if(Em(t))return e instanceof ao.Metadata?{metadata:e,options:{},callback:t}:{metadata:new ao.Metadata,options:e,callback:t};if(!(e instanceof ao.Metadata&&t instanceof Object&&Em(r)))throw new Error("Incorrect arguments passed");return{metadata:e,options:t,callback:r}}makeUnaryRequest(e,t,r,i,s,o,a){var l,c;let u=this.checkOptionalUnaryResponseArguments(s,o,a),d={path:e,requestStream:!1,responseStream:!1,requestSerialize:t,responseDeserialize:r},h={argument:i,metadata:u.metadata,call:new Hn.ClientUnaryCallImpl,channel:this[En],methodDefinition:d,callOptions:u.options,callback:u.callback};this[mr]&&(h=this[mr](h));let p=h.call,y={clientInterceptors:this[lo],clientInterceptorProviders:this[co],callInterceptors:(l=h.callOptions.interceptors)!==null&&l!==void 0?l:[],callInterceptorProviders:(c=h.callOptions.interceptor_providers)!==null&&c!==void 0?c:[]},S=(0,td.getInterceptingCall)(y,h.methodDefinition,h.callOptions,h.channel);p.call=S;let _=null,k=!1,w=new Error;return S.start(h.metadata,{onReceiveMetadata:x=>{p.emit("metadata",x)},onReceiveMessage(x){_!==null&&S.cancelWithStatus($r.Status.INTERNAL,"Too many responses received"),_=x},onReceiveStatus(x){if(!k){if(k=!0,x.code===$r.Status.OK)if(_===null){let M=uo(w);h.callback((0,Hn.callErrorFromStatus)({code:$r.Status.INTERNAL,details:"No message received",metadata:x.metadata},M))}else h.callback(null,_);else{let M=uo(w);h.callback((0,Hn.callErrorFromStatus)(x,M))}w=null,p.emit("status",x)}}}),S.sendMessage(i),S.halfClose(),p}makeClientStreamRequest(e,t,r,i,s,o){var a,l;let c=this.checkOptionalUnaryResponseArguments(i,s,o),u={path:e,requestStream:!0,responseStream:!1,requestSerialize:t,responseDeserialize:r},d={metadata:c.metadata,call:new Hn.ClientWritableStreamImpl(t),channel:this[En],methodDefinition:u,callOptions:c.options,callback:c.callback};this[mr]&&(d=this[mr](d));let h=d.call,p={clientInterceptors:this[lo],clientInterceptorProviders:this[co],callInterceptors:(a=d.callOptions.interceptors)!==null&&a!==void 0?a:[],callInterceptorProviders:(l=d.callOptions.interceptor_providers)!==null&&l!==void 0?l:[]},y=(0,td.getInterceptingCall)(p,d.methodDefinition,d.callOptions,d.channel);h.call=y;let S=null,_=!1,k=new Error;return y.start(d.metadata,{onReceiveMetadata:w=>{h.emit("metadata",w)},onReceiveMessage(w){S!==null&&y.cancelWithStatus($r.Status.INTERNAL,"Too many responses received"),S=w},onReceiveStatus(w){if(!_){if(_=!0,w.code===$r.Status.OK)if(S===null){let x=uo(k);d.callback((0,Hn.callErrorFromStatus)({code:$r.Status.INTERNAL,details:"No message received",metadata:w.metadata},x))}else d.callback(null,S);else{let x=uo(k);d.callback((0,Hn.callErrorFromStatus)(w,x))}k=null,h.emit("status",w)}}}),h}checkMetadataAndOptions(e,t){let r,i;return e instanceof ao.Metadata?(r=e,t?i=t:i={}):(e?i=e:i={},r=new ao.Metadata),{metadata:r,options:i}}makeServerStreamRequest(e,t,r,i,s,o){var a,l;let c=this.checkMetadataAndOptions(s,o),u={path:e,requestStream:!1,responseStream:!0,requestSerialize:t,responseDeserialize:r},d={argument:i,metadata:c.metadata,call:new Hn.ClientReadableStreamImpl(r),channel:this[En],methodDefinition:u,callOptions:c.options};this[mr]&&(d=this[mr](d));let h=d.call,p={clientInterceptors:this[lo],clientInterceptorProviders:this[co],callInterceptors:(a=d.callOptions.interceptors)!==null&&a!==void 0?a:[],callInterceptorProviders:(l=d.callOptions.interceptor_providers)!==null&&l!==void 0?l:[]},y=(0,td.getInterceptingCall)(p,d.methodDefinition,d.callOptions,d.channel);h.call=y;let S=!1,_=new Error;return y.start(d.metadata,{onReceiveMetadata(k){h.emit("metadata",k)},onReceiveMessage(k){h.push(k)},onReceiveStatus(k){if(!S){if(S=!0,h.push(null),k.code!==$r.Status.OK){let w=uo(_);h.emit("error",(0,Hn.callErrorFromStatus)(k,w))}_=null,h.emit("status",k)}}}),y.sendMessage(i),y.halfClose(),h}makeBidiStreamRequest(e,t,r,i,s){var o,a;let l=this.checkMetadataAndOptions(i,s),c={path:e,requestStream:!0,responseStream:!0,requestSerialize:t,responseDeserialize:r},u={metadata:l.metadata,call:new Hn.ClientDuplexStreamImpl(t,r),channel:this[En],methodDefinition:c,callOptions:l.options};this[mr]&&(u=this[mr](u));let d=u.call,h={clientInterceptors:this[lo],clientInterceptorProviders:this[co],callInterceptors:(o=u.callOptions.interceptors)!==null&&o!==void 0?o:[],callInterceptorProviders:(a=u.callOptions.interceptor_providers)!==null&&a!==void 0?a:[]},p=(0,td.getInterceptingCall)(h,u.methodDefinition,u.callOptions,u.channel);d.call=p;let y=!1,S=new Error;return p.start(u.metadata,{onReceiveMetadata(_){d.emit("metadata",_)},onReceiveMessage(_){d.push(_)},onReceiveStatus(_){if(!y){if(y=!0,d.push(null),_.code!==$r.Status.OK){let k=uo(S);d.emit("error",(0,Hn.callErrorFromStatus)(_,k))}S=null,d.emit("status",_)}}}),d}};nd.Client=wm});var Am=E(ho=>{"use strict";Object.defineProperty(ho,"__esModule",{value:!0});ho.loadPackageDefinition=ho.makeClientConstructor=void 0;var gl=Tm(),_P={unary:gl.Client.prototype.makeUnaryRequest,server_stream:gl.Client.prototype.makeServerStreamRequest,client_stream:gl.Client.prototype.makeClientStreamRequest,bidi:gl.Client.prototype.makeBidiStreamRequest};function bm(n){return["__proto__","prototype","constructor"].includes(n)}function JT(n,e,t){t||(t={});class r extends gl.Client{}return Object.keys(n).forEach(i=>{if(bm(i))return;let s=n[i],o;if(typeof i=="string"&&i.charAt(0)==="$")throw new Error("Method names cannot start with $");s.requestStream?s.responseStream?o="bidi":o="client_stream":s.responseStream?o="server_stream":o="unary";let a=s.requestSerialize,l=s.responseDeserialize,c=EP(_P[o],s.path,a,l);r.prototype[i]=c,Object.assign(r.prototype[i],s),s.originalName&&!bm(s.originalName)&&(r.prototype[s.originalName]=r.prototype[i])}),r.service=n,r.serviceName=e,r}ho.makeClientConstructor=JT;function EP(n,e,t,r){return function(...i){return n.call(this,e,t,r,...i)}}function wP(n){return"format"in n}function TP(n){let e={};for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t)){let r=n[t],i=t.split(".");if(i.some(a=>bm(a)))continue;let s=i[i.length-1],o=e;for(let a of i.slice(0,-1))o[a]||(o[a]={}),o=o[a];wP(r)?o[s]=r:o[s]=JT(r,s,{})}return e}ho.loadPackageDefinition=TP});var TC=E((lK,wC)=>{"use strict";var CP=1/0,bP="[object Symbol]",AP=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,IP=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,id="\\ud800-\\udfff",oC="\\u0300-\\u036f\\ufe20-\\ufe23",aC="\\u20d0-\\u20f0",lC="\\u2700-\\u27bf",cC="a-z\\xdf-\\xf6\\xf8-\\xff",DP="\\xac\\xb1\\xd7\\xf7",RP="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",kP="\\u2000-\\u206f",NP=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",uC="A-Z\\xc0-\\xd6\\xd8-\\xde",dC="\\ufe0e\\ufe0f",hC=DP+RP+kP+NP,Dm="['\u2019]",xP="["+id+"]",ZT="["+hC+"]",rd="["+oC+aC+"]",fC="\\d+",MP="["+lC+"]",pC="["+cC+"]",gC="[^"+id+hC+fC+lC+cC+uC+"]",Im="\\ud83c[\\udffb-\\udfff]",OP="(?:"+rd+"|"+Im+")",mC="[^"+id+"]",Rm="(?:\\ud83c[\\udde6-\\uddff]){2}",km="[\\ud800-\\udbff][\\udc00-\\udfff]",fo="["+uC+"]",yC="\\u200d",eC="(?:"+pC+"|"+gC+")",PP="(?:"+fo+"|"+gC+")",tC="(?:"+Dm+"(?:d|ll|m|re|s|t|ve))?",nC="(?:"+Dm+"(?:D|LL|M|RE|S|T|VE))?",vC=OP+"?",SC="["+dC+"]?",FP="(?:"+yC+"(?:"+[mC,Rm,km].join("|")+")"+SC+vC+")*",_C=SC+vC+FP,LP="(?:"+[MP,Rm,km].join("|")+")"+_C,BP="(?:"+[mC+rd+"?",rd,Rm,km,xP].join("|")+")",VP=RegExp(Dm,"g"),qP=RegExp(rd,"g"),UP=RegExp(Im+"(?="+Im+")|"+BP+_C,"g"),zP=RegExp([fo+"?"+pC+"+"+tC+"(?="+[ZT,fo,"$"].join("|")+")",PP+"+"+nC+"(?="+[ZT,fo+eC,"$"].join("|")+")",fo+"?"+eC+"+"+tC,fo+"+"+nC,fC,LP].join("|"),"g"),jP=RegExp("["+yC+id+oC+aC+dC+"]"),GP=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,HP={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"ss"},KP=typeof global=="object"&&global&&global.Object===Object&&global,WP=typeof self=="object"&&self&&self.Object===Object&&self,$P=KP||WP||Function("return this")();function QP(n,e,t,r){var i=-1,s=n?n.length:0;for(r&&s&&(t=n[++i]);++i<s;)t=e(t,n[i],i,n);return t}function YP(n){return n.split("")}function XP(n){return n.match(AP)||[]}function JP(n){return function(e){return n?.[e]}}var ZP=JP(HP);function EC(n){return jP.test(n)}function eF(n){return GP.test(n)}function tF(n){return EC(n)?nF(n):YP(n)}function nF(n){return n.match(UP)||[]}function rF(n){return n.match(zP)||[]}var iF=Object.prototype,sF=iF.toString,rC=$P.Symbol,iC=rC?rC.prototype:void 0,sC=iC?iC.toString:void 0;function oF(n,e,t){var r=-1,i=n.length;e<0&&(e=-e>i?0:i+e),t=t>i?i:t,t<0&&(t+=i),i=e>t?0:t-e>>>0,e>>>=0;for(var s=Array(i);++r<i;)s[r]=n[r+e];return s}function aF(n){if(typeof n=="string")return n;if(hF(n))return sC?sC.call(n):"";var e=n+"";return e=="0"&&1/n==-CP?"-0":e}function lF(n,e,t){var r=n.length;return t=t===void 0?r:t,!e&&t>=r?n:oF(n,e,t)}function cF(n){return function(e){e=sd(e);var t=EC(e)?tF(e):void 0,r=t?t[0]:e.charAt(0),i=t?lF(t,1).join(""):e.slice(1);return r[n]()+i}}function uF(n){return function(e){return QP(yF(gF(e).replace(VP,"")),n,"")}}function dF(n){return!!n&&typeof n=="object"}function hF(n){return typeof n=="symbol"||dF(n)&&sF.call(n)==bP}function sd(n){return n==null?"":aF(n)}var fF=uF(function(n,e,t){return e=e.toLowerCase(),n+(t?pF(e):e)});function pF(n){return mF(sd(n).toLowerCase())}function gF(n){return n=sd(n),n&&n.replace(IP,ZP).replace(qP,"")}var mF=cF("toUpperCase");function yF(n,e,t){return n=sd(n),e=t?void 0:e,e===void 0?eF(n)?rF(n):XP(n):n.match(e)||[]}wC.exports=fF});var Nm=E((cK,CC)=>{"use strict";CC.exports=vF;function vF(n,e){for(var t=new Array(arguments.length-1),r=0,i=2,s=!0;i<arguments.length;)t[r++]=arguments[i++];return new Promise(function(a,l){t[r]=function(u){if(s)if(s=!1,u)l(u);else{for(var d=new Array(arguments.length-1),h=0;h<d.length;)d[h++]=arguments[h];a.apply(null,d)}};try{n.apply(e||null,t)}catch(c){s&&(s=!1,l(c))}})}});var DC=E(IC=>{"use strict";var od=IC;od.length=function(e){var t=e.length;if(!t)return 0;for(var r=0;--t%4>1&&e.charAt(t)==="=";)++r;return Math.ceil(e.length*3)/4-r};var po=new Array(64),AC=new Array(123);for(wn=0;wn<64;)AC[po[wn]=wn<26?wn+65:wn<52?wn+71:wn<62?wn-4:wn-59|43]=wn++;var wn;od.encode=function(e,t,r){for(var i=null,s=[],o=0,a=0,l;t<r;){var c=e[t++];switch(a){case 0:s[o++]=po[c>>2],l=(c&3)<<4,a=1;break;case 1:s[o++]=po[l|c>>4],l=(c&15)<<2,a=2;break;case 2:s[o++]=po[l|c>>6],s[o++]=po[c&63],a=0;break}o>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,s)),o=0)}return a&&(s[o++]=po[l],s[o++]=61,a===1&&(s[o++]=61)),i?(o&&i.push(String.fromCharCode.apply(String,s.slice(0,o))),i.join("")):String.fromCharCode.apply(String,s.slice(0,o))};var bC="invalid encoding";od.decode=function(e,t,r){for(var i=r,s=0,o,a=0;a<e.length;){var l=e.charCodeAt(a++);if(l===61&&s>1)break;if((l=AC[l])===void 0)throw Error(bC);switch(s){case 0:o=l,s=1;break;case 1:t[r++]=o<<2|(l&48)>>4,o=l,s=2;break;case 2:t[r++]=(o&15)<<4|(l&60)>>2,o=l,s=3;break;case 3:t[r++]=(o&3)<<6|l,s=0;break}}if(s===1)throw Error(bC);return r-i};od.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}});var kC=E((dK,RC)=>{"use strict";RC.exports=ad;function ad(){this._listeners={}}ad.prototype.on=function(e,t,r){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:r||this}),this};ad.prototype.off=function(e,t){if(e===void 0)this._listeners={};else if(t===void 0)this._listeners[e]=[];else for(var r=this._listeners[e],i=0;i<r.length;)r[i].fn===t?r.splice(i,1):++i;return this};ad.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var r=[],i=1;i<arguments.length;)r.push(arguments[i++]);for(i=0;i<t.length;)t[i].fn.apply(t[i++].ctx,r)}return this}});var LC=E((hK,FC)=>{"use strict";FC.exports=NC(NC);function NC(n){return typeof Float32Array<"u"?function(){var e=new Float32Array([-0]),t=new Uint8Array(e.buffer),r=t[3]===128;function i(l,c,u){e[0]=l,c[u]=t[0],c[u+1]=t[1],c[u+2]=t[2],c[u+3]=t[3]}function s(l,c,u){e[0]=l,c[u]=t[3],c[u+1]=t[2],c[u+2]=t[1],c[u+3]=t[0]}n.writeFloatLE=r?i:s,n.writeFloatBE=r?s:i;function o(l,c){return t[0]=l[c],t[1]=l[c+1],t[2]=l[c+2],t[3]=l[c+3],e[0]}function a(l,c){return t[3]=l[c],t[2]=l[c+1],t[1]=l[c+2],t[0]=l[c+3],e[0]}n.readFloatLE=r?o:a,n.readFloatBE=r?a:o}():function(){function e(r,i,s,o){var a=i<0?1:0;if(a&&(i=-i),i===0)r(1/i>0?0:2147483648,s,o);else if(isNaN(i))r(2143289344,s,o);else if(i>34028234663852886e22)r((a<<31|2139095040)>>>0,s,o);else if(i<11754943508222875e-54)r((a<<31|Math.round(i/1401298464324817e-60))>>>0,s,o);else{var l=Math.floor(Math.log(i)/Math.LN2),c=Math.round(i*Math.pow(2,-l)*8388608)&8388607;r((a<<31|l+127<<23|c)>>>0,s,o)}}n.writeFloatLE=e.bind(null,xC),n.writeFloatBE=e.bind(null,MC);function t(r,i,s){var o=r(i,s),a=(o>>31)*2+1,l=o>>>23&255,c=o&8388607;return l===255?c?NaN:a*(1/0):l===0?a*1401298464324817e-60*c:a*Math.pow(2,l-150)*(c+8388608)}n.readFloatLE=t.bind(null,OC),n.readFloatBE=t.bind(null,PC)}(),typeof Float64Array<"u"?function(){var e=new Float64Array([-0]),t=new Uint8Array(e.buffer),r=t[7]===128;function i(l,c,u){e[0]=l,c[u]=t[0],c[u+1]=t[1],c[u+2]=t[2],c[u+3]=t[3],c[u+4]=t[4],c[u+5]=t[5],c[u+6]=t[6],c[u+7]=t[7]}function s(l,c,u){e[0]=l,c[u]=t[7],c[u+1]=t[6],c[u+2]=t[5],c[u+3]=t[4],c[u+4]=t[3],c[u+5]=t[2],c[u+6]=t[1],c[u+7]=t[0]}n.writeDoubleLE=r?i:s,n.writeDoubleBE=r?s:i;function o(l,c){return t[0]=l[c],t[1]=l[c+1],t[2]=l[c+2],t[3]=l[c+3],t[4]=l[c+4],t[5]=l[c+5],t[6]=l[c+6],t[7]=l[c+7],e[0]}function a(l,c){return t[7]=l[c],t[6]=l[c+1],t[5]=l[c+2],t[4]=l[c+3],t[3]=l[c+4],t[2]=l[c+5],t[1]=l[c+6],t[0]=l[c+7],e[0]}n.readDoubleLE=r?o:a,n.readDoubleBE=r?a:o}():function(){function e(r,i,s,o,a,l){var c=o<0?1:0;if(c&&(o=-o),o===0)r(0,a,l+i),r(1/o>0?0:2147483648,a,l+s);else if(isNaN(o))r(0,a,l+i),r(2146959360,a,l+s);else if(o>17976931348623157e292)r(0,a,l+i),r((c<<31|2146435072)>>>0,a,l+s);else{var u;if(o<22250738585072014e-324)u=o/5e-324,r(u>>>0,a,l+i),r((c<<31|u/4294967296)>>>0,a,l+s);else{var d=Math.floor(Math.log(o)/Math.LN2);d===1024&&(d=1023),u=o*Math.pow(2,-d),r(u*4503599627370496>>>0,a,l+i),r((c<<31|d+1023<<20|u*1048576&1048575)>>>0,a,l+s)}}}n.writeDoubleLE=e.bind(null,xC,0,4),n.writeDoubleBE=e.bind(null,MC,4,0);function t(r,i,s,o,a){var l=r(o,a+i),c=r(o,a+s),u=(c>>31)*2+1,d=c>>>20&2047,h=4294967296*(c&1048575)+l;return d===2047?h?NaN:u*(1/0):d===0?u*5e-324*h:u*Math.pow(2,d-1075)*(h+4503599627370496)}n.readDoubleLE=t.bind(null,OC,0,4),n.readDoubleBE=t.bind(null,PC,4,0)}(),n}function xC(n,e,t){e[t]=n&255,e[t+1]=n>>>8&255,e[t+2]=n>>>16&255,e[t+3]=n>>>24}function MC(n,e,t){e[t]=n>>>24,e[t+1]=n>>>16&255,e[t+2]=n>>>8&255,e[t+3]=n&255}function OC(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16|n[e+3]<<24)>>>0}function PC(n,e){return(n[e]<<24|n[e+1]<<16|n[e+2]<<8|n[e+3])>>>0}});var xm=E((exports,module)=>{"use strict";module.exports=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(n){}return null}});var VC=E(BC=>{"use strict";var Mm=BC;Mm.length=function(e){for(var t=0,r=0,i=0;i<e.length;++i)r=e.charCodeAt(i),r<128?t+=1:r<2048?t+=2:(r&64512)===55296&&(e.charCodeAt(i+1)&64512)===56320?(++i,t+=4):t+=3;return t};Mm.read=function(e,t,r){var i=r-t;if(i<1)return"";for(var s=null,o=[],a=0,l;t<r;)l=e[t++],l<128?o[a++]=l:l>191&&l<224?o[a++]=(l&31)<<6|e[t++]&63:l>239&&l<365?(l=((l&7)<<18|(e[t++]&63)<<12|(e[t++]&63)<<6|e[t++]&63)-65536,o[a++]=55296+(l>>10),o[a++]=56320+(l&1023)):o[a++]=(l&15)<<12|(e[t++]&63)<<6|e[t++]&63,a>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,o)),a=0);return s?(a&&s.push(String.fromCharCode.apply(String,o.slice(0,a))),s.join("")):String.fromCharCode.apply(String,o.slice(0,a))};Mm.write=function(e,t,r){for(var i=r,s,o,a=0;a<e.length;++a)s=e.charCodeAt(a),s<128?t[r++]=s:s<2048?(t[r++]=s>>6|192,t[r++]=s&63|128):(s&64512)===55296&&((o=e.charCodeAt(a+1))&64512)===56320?(s=65536+((s&1023)<<10)+(o&1023),++a,t[r++]=s>>18|240,t[r++]=s>>12&63|128,t[r++]=s>>6&63|128,t[r++]=s&63|128):(t[r++]=s>>12|224,t[r++]=s>>6&63|128,t[r++]=s&63|128);return r-i}});var UC=E((pK,qC)=>{"use strict";qC.exports=SF;function SF(n,e,t){var r=t||8192,i=r>>>1,s=null,o=r;return function(l){if(l<1||l>i)return n(l);o+l>r&&(s=n(r),o=0);var c=e.call(s,o,o+=l);return o&7&&(o=(o|7)+1),c}}});var jC=E((gK,zC)=>{"use strict";zC.exports=nt;var ml=Kn();function nt(n,e){this.lo=n>>>0,this.hi=e>>>0}var Xi=nt.zero=new nt(0,0);Xi.toNumber=function(){return 0};Xi.zzEncode=Xi.zzDecode=function(){return this};Xi.length=function(){return 1};var _F=nt.zeroHash="\0\0\0\0\0\0\0\0";nt.fromNumber=function(e){if(e===0)return Xi;var t=e<0;t&&(e=-e);var r=e>>>0,i=(e-r)/4294967296>>>0;return t&&(i=~i>>>0,r=~r>>>0,++r>4294967295&&(r=0,++i>4294967295&&(i=0))),new nt(r,i)};nt.from=function(e){if(typeof e=="number")return nt.fromNumber(e);if(ml.isString(e))if(ml.Long)e=ml.Long.fromString(e);else return nt.fromNumber(parseInt(e,10));return e.low||e.high?new nt(e.low>>>0,e.high>>>0):Xi};nt.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=~this.lo+1>>>0,r=~this.hi>>>0;return t||(r=r+1>>>0),-(t+r*4294967296)}return this.lo+this.hi*4294967296};nt.prototype.toLong=function(e){return ml.Long?new ml.Long(this.lo|0,this.hi|0,!!e):{low:this.lo|0,high:this.hi|0,unsigned:!!e}};var Qr=String.prototype.charCodeAt;nt.fromHash=function(e){return e===_F?Xi:new nt((Qr.call(e,0)|Qr.call(e,1)<<8|Qr.call(e,2)<<16|Qr.call(e,3)<<24)>>>0,(Qr.call(e,4)|Qr.call(e,5)<<8|Qr.call(e,6)<<16|Qr.call(e,7)<<24)>>>0)};nt.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)};nt.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this};nt.prototype.zzDecode=function(){var e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this};nt.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return r===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10}});var Kn=E(Om=>{"use strict";var G=Om;G.asPromise=Nm();G.base64=DC();G.EventEmitter=kC();G.float=LC();G.inquire=xm();G.utf8=VC();G.pool=UC();G.LongBits=jC();G.isNode=!!(typeof global<"u"&&global&&global.process&&global.process.versions&&global.process.versions.node);G.global=G.isNode&&global||typeof window<"u"&&window||typeof self<"u"&&self||Om;G.emptyArray=Object.freeze?Object.freeze([]):[];G.emptyObject=Object.freeze?Object.freeze({}):{};G.isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e};G.isString=function(e){return typeof e=="string"||e instanceof String};G.isObject=function(e){return e&&typeof e=="object"};G.isset=G.isSet=function(e,t){var r=e[t];return r!=null&&e.hasOwnProperty(t)?typeof r!="object"||(Array.isArray(r)?r.length:Object.keys(r).length)>0:!1};G.Buffer=function(){try{var n=G.inquire("buffer").Buffer;return n.prototype.utf8Write?n:null}catch{return null}}();G._Buffer_from=null;G._Buffer_allocUnsafe=null;G.newBuffer=function(e){return typeof e=="number"?G.Buffer?G._Buffer_allocUnsafe(e):new G.Array(e):G.Buffer?G._Buffer_from(e):typeof Uint8Array>"u"?e:new Uint8Array(e)};G.Array=typeof Uint8Array<"u"?Uint8Array:Array;G.Long=G.global.dcodeIO&&G.global.dcodeIO.Long||G.global.Long||G.inquire("long");G.key2Re=/^true|false|0|1$/;G.key32Re=/^-?(?:0|[1-9][0-9]*)$/;G.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/;G.longToHash=function(e){return e?G.LongBits.from(e).toHash():G.LongBits.zeroHash};G.longFromHash=function(e,t){var r=G.LongBits.fromHash(e);return G.Long?G.Long.fromBits(r.lo,r.hi,t):r.toNumber(!!t)};function GC(n,e,t){for(var r=Object.keys(e),i=0;i<r.length;++i)(n[r[i]]===void 0||!t)&&(n[r[i]]=e[r[i]]);return n}G.merge=GC;G.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)};function HC(n){function e(t,r){if(!(this instanceof e))return new e(t,r);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:new Error().stack||""}),r&&GC(this,r)}return e.prototype=Object.create(Error.prototype,{constructor:{value:e,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return n},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),e}G.newError=HC;G.ProtocolError=HC("ProtocolError");G.oneOfGetter=function(e){for(var t={},r=0;r<e.length;++r)t[e[r]]=1;return function(){for(var i=Object.keys(this),s=i.length-1;s>-1;--s)if(t[i[s]]===1&&this[i[s]]!==void 0&&this[i[s]]!==null)return i[s]}};G.oneOfSetter=function(e){return function(t){for(var r=0;r<e.length;++r)e[r]!==t&&delete this[e[r]]}};G.toJSONOptions={longs:String,enums:String,bytes:String,json:!0};G._configure=function(){var n=G.Buffer;if(!n){G._Buffer_from=G._Buffer_allocUnsafe=null;return}G._Buffer_from=n.from!==Uint8Array.from&&n.from||function(t,r){return new n(t,r)},G._Buffer_allocUnsafe=n.allocUnsafe||function(t){return new n(t)}}});var cd=E((yK,QC)=>{"use strict";QC.exports=le;var an=Kn(),Pm,ld=an.LongBits,KC=an.base64,WC=an.utf8;function yl(n,e,t){this.fn=n,this.len=e,this.next=void 0,this.val=t}function Lm(){}function EF(n){this.head=n.head,this.tail=n.tail,this.len=n.len,this.next=n.states}function le(){this.len=0,this.head=new yl(Lm,0,0),this.tail=this.head,this.states=null}var $C=function(){return an.Buffer?function(){return(le.create=function(){return new Pm})()}:function(){return new le}};le.create=$C();le.alloc=function(e){return new an.Array(e)};an.Array!==Array&&(le.alloc=an.pool(le.alloc,an.Array.prototype.subarray));le.prototype._push=function(e,t,r){return this.tail=this.tail.next=new yl(e,t,r),this.len+=t,this};function Bm(n,e,t){e[t]=n&255}function wF(n,e,t){for(;n>127;)e[t++]=n&127|128,n>>>=7;e[t]=n}function Vm(n,e){this.len=n,this.next=void 0,this.val=e}Vm.prototype=Object.create(yl.prototype);Vm.prototype.fn=wF;le.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new Vm((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this};le.prototype.int32=function(e){return e<0?this._push(qm,10,ld.fromNumber(e)):this.uint32(e)};le.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)};function qm(n,e,t){for(;n.hi;)e[t++]=n.lo&127|128,n.lo=(n.lo>>>7|n.hi<<25)>>>0,n.hi>>>=7;for(;n.lo>127;)e[t++]=n.lo&127|128,n.lo=n.lo>>>7;e[t++]=n.lo}le.prototype.uint64=function(e){var t=ld.from(e);return this._push(qm,t.length(),t)};le.prototype.int64=le.prototype.uint64;le.prototype.sint64=function(e){var t=ld.from(e).zzEncode();return this._push(qm,t.length(),t)};le.prototype.bool=function(e){return this._push(Bm,1,e?1:0)};function Fm(n,e,t){e[t]=n&255,e[t+1]=n>>>8&255,e[t+2]=n>>>16&255,e[t+3]=n>>>24}le.prototype.fixed32=function(e){return this._push(Fm,4,e>>>0)};le.prototype.sfixed32=le.prototype.fixed32;le.prototype.fixed64=function(e){var t=ld.from(e);return this._push(Fm,4,t.lo)._push(Fm,4,t.hi)};le.prototype.sfixed64=le.prototype.fixed64;le.prototype.float=function(e){return this._push(an.float.writeFloatLE,4,e)};le.prototype.double=function(e){return this._push(an.float.writeDoubleLE,8,e)};var TF=an.Array.prototype.set?function(e,t,r){t.set(e,r)}:function(e,t,r){for(var i=0;i<e.length;++i)t[r+i]=e[i]};le.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(Bm,1,0);if(an.isString(e)){var r=le.alloc(t=KC.length(e));KC.decode(e,r,0),e=r}return this.uint32(t)._push(TF,t,e)};le.prototype.string=function(e){var t=WC.length(e);return t?this.uint32(t)._push(WC.write,t,e):this._push(Bm,1,0)};le.prototype.fork=function(){return this.states=new EF(this),this.head=this.tail=new yl(Lm,0,0),this.len=0,this};le.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new yl(Lm,0,0),this.len=0),this};le.prototype.ldelim=function(){var e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this};le.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),r=0;e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t};le._configure=function(n){Pm=n,le.create=$C(),Pm._configure()}});var JC=E((vK,XC)=>{"use strict";XC.exports=Wn;var YC=cd();(Wn.prototype=Object.create(YC.prototype)).constructor=Wn;var Yr=Kn();function Wn(){YC.call(this)}Wn._configure=function(){Wn.alloc=Yr._Buffer_allocUnsafe,Wn.writeBytesBuffer=Yr.Buffer&&Yr.Buffer.prototype instanceof Uint8Array&&Yr.Buffer.prototype.set.name==="set"?function(e,t,r){t.set(e,r)}:function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(var i=0;i<e.length;)t[r++]=e[i++]}};Wn.prototype.bytes=function(e){Yr.isString(e)&&(e=Yr._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(Wn.writeBytesBuffer,t,e),this};function CF(n,e,t){n.length<40?Yr.utf8.write(n,e,t):e.utf8Write?e.utf8Write(n,t):e.write(n,t)}Wn.prototype.string=function(e){var t=Yr.Buffer.byteLength(e);return this.uint32(t),t&&this._push(CF,t,e),this};Wn._configure()});var dd=E((SK,rb)=>{"use strict";rb.exports=Ue;var Tn=Kn(),zm,tb=Tn.LongBits,bF=Tn.utf8;function Cn(n,e){return RangeError("index out of range: "+n.pos+" + "+(e||1)+" > "+n.len)}function Ue(n){this.buf=n,this.pos=0,this.len=n.length}var ZC=typeof Uint8Array<"u"?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new Ue(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new Ue(e);throw Error("illegal buffer")},nb=function(){return Tn.Buffer?function(t){return(Ue.create=function(i){return Tn.Buffer.isBuffer(i)?new zm(i):ZC(i)})(t)}:ZC};Ue.create=nb();Ue.prototype._slice=Tn.Array.prototype.subarray||Tn.Array.prototype.slice;Ue.prototype.uint32=function(){var e=4294967295;return function(){if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,Cn(this,10);return e}}();Ue.prototype.int32=function(){return this.uint32()|0};Ue.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(e&1)|0};function Um(){var n=new tb(0,0),e=0;if(this.len-this.pos>4){for(;e<4;++e)if(n.lo=(n.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return n;if(n.lo=(n.lo|(this.buf[this.pos]&127)<<28)>>>0,n.hi=(n.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return n;e=0}else{for(;e<3;++e){if(this.pos>=this.len)throw Cn(this);if(n.lo=(n.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return n}return n.lo=(n.lo|(this.buf[this.pos++]&127)<<e*7)>>>0,n}if(this.len-this.pos>4){for(;e<5;++e)if(n.hi=(n.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return n}else for(;e<5;++e){if(this.pos>=this.len)throw Cn(this);if(n.hi=(n.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return n}throw Error("invalid varint encoding")}Ue.prototype.bool=function(){return this.uint32()!==0};function ud(n,e){return(n[e-4]|n[e-3]<<8|n[e-2]<<16|n[e-1]<<24)>>>0}Ue.prototype.fixed32=function(){if(this.pos+4>this.len)throw Cn(this,4);return ud(this.buf,this.pos+=4)};Ue.prototype.sfixed32=function(){if(this.pos+4>this.len)throw Cn(this,4);return ud(this.buf,this.pos+=4)|0};function eb(){if(this.pos+8>this.len)throw Cn(this,8);return new tb(ud(this.buf,this.pos+=4),ud(this.buf,this.pos+=4))}Ue.prototype.float=function(){if(this.pos+4>this.len)throw Cn(this,4);var e=Tn.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e};Ue.prototype.double=function(){if(this.pos+8>this.len)throw Cn(this,4);var e=Tn.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e};Ue.prototype.bytes=function(){var e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw Cn(this,e);if(this.pos+=e,Array.isArray(this.buf))return this.buf.slice(t,r);if(t===r){var i=Tn.Buffer;return i?i.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,t,r)};Ue.prototype.string=function(){var e=this.bytes();return bF.read(e,0,e.length)};Ue.prototype.skip=function(e){if(typeof e=="number"){if(this.pos+e>this.len)throw Cn(this,e);this.pos+=e}else do if(this.pos>=this.len)throw Cn(this);while(this.buf[this.pos++]&128);return this};Ue.prototype.skipType=function(n){switch(n){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(n=this.uint32()&7)!==4;)this.skipType(n);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+n+" at offset "+this.pos)}return this};Ue._configure=function(n){zm=n,Ue.create=nb(),zm._configure();var e=Tn.Long?"toLong":"toNumber";Tn.merge(Ue.prototype,{int64:function(){return Um.call(this)[e](!1)},uint64:function(){return Um.call(this)[e](!0)},sint64:function(){return Um.call(this).zzDecode()[e](!1)},fixed64:function(){return eb.call(this)[e](!0)},sfixed64:function(){return eb.call(this)[e](!1)}})}});var ab=E((_K,ob)=>{"use strict";ob.exports=Ji;var sb=dd();(Ji.prototype=Object.create(sb.prototype)).constructor=Ji;var ib=Kn();function Ji(n){sb.call(this,n)}Ji._configure=function(){ib.Buffer&&(Ji.prototype._slice=ib.Buffer.prototype.slice)};Ji.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))};Ji._configure()});var cb=E((EK,lb)=>{"use strict";lb.exports=vl;var jm=Kn();(vl.prototype=Object.create(jm.EventEmitter.prototype)).constructor=vl;function vl(n,e,t){if(typeof n!="function")throw TypeError("rpcImpl must be a function");jm.EventEmitter.call(this),this.rpcImpl=n,this.requestDelimited=!!e,this.responseDelimited=!!t}vl.prototype.rpcCall=function n(e,t,r,i,s){if(!i)throw TypeError("request must be specified");var o=this;if(!s)return jm.asPromise(n,o,e,t,r,i);if(!o.rpcImpl){setTimeout(function(){s(Error("already ended"))},0);return}try{return o.rpcImpl(e,t[o.requestDelimited?"encodeDelimited":"encode"](i).finish(),function(l,c){if(l)return o.emit("error",l,e),s(l);if(c===null){o.end(!0);return}if(!(c instanceof r))try{c=r[o.responseDelimited?"decodeDelimited":"decode"](c)}catch(u){return o.emit("error",u,e),s(u)}return o.emit("data",c,e),s(null,c)})}catch(a){o.emit("error",a,e),setTimeout(function(){s(a)},0);return}};vl.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}});var Gm=E(ub=>{"use strict";var AF=ub;AF.Service=cb()});var Hm=E((TK,db)=>{"use strict";db.exports={}});var pb=E(fb=>{"use strict";var zt=fb;zt.build="minimal";zt.Writer=cd();zt.BufferWriter=JC();zt.Reader=dd();zt.BufferReader=ab();zt.util=Kn();zt.rpc=Gm();zt.roots=Hm();zt.configure=hb;function hb(){zt.util._configure(),zt.Writer._configure(zt.BufferWriter),zt.Reader._configure(zt.BufferReader)}hb()});var mb=E((bK,gb)=>{"use strict";gb.exports=Km;function Km(n,e){typeof n=="string"&&(e=n,n=void 0);var t=[];function r(s){if(typeof s!="string"){var o=i();if(Km.verbose&&console.log("codegen: "+o),o="return "+o,s){for(var a=Object.keys(s),l=new Array(a.length+1),c=new Array(a.length),u=0;u<a.length;)l[u]=a[u],c[u]=s[a[u++]];return l[u]=o,Function.apply(null,l).apply(null,c)}return Function(o)()}for(var d=new Array(arguments.length-1),h=0;h<d.length;)d[h]=arguments[++h];if(h=0,s=s.replace(/%([%dfijs])/g,function(y,S){var _=d[h++];switch(S){case"d":case"f":return String(Number(_));case"i":return String(Math.floor(_));case"j":return JSON.stringify(_);case"s":return String(_)}return"%"}),h!==d.length)throw Error("parameter count mismatch");return t.push(s),r}function i(s){return"function "+(s||e||"")+"("+(n&&n.join(",")||"")+`){
  `+t.join(`
  `)+`
}`}return r.toString=i,r}Km.verbose=!1});var vb=E((AK,yb)=>{"use strict";yb.exports=Sl;var IF=Nm(),DF=xm(),Wm=DF("fs");function Sl(n,e,t){return typeof e=="function"?(t=e,e={}):e||(e={}),t?!e.xhr&&Wm&&Wm.readFile?Wm.readFile(n,function(i,s){return i&&typeof XMLHttpRequest<"u"?Sl.xhr(n,e,t):i?t(i):t(null,e.binary?s:s.toString("utf8"))}):Sl.xhr(n,e,t):IF(Sl,this,n,e)}Sl.xhr=function(e,t,r){var i=new XMLHttpRequest;i.onreadystatechange=function(){if(i.readyState===4){if(i.status!==0&&i.status!==200)return r(Error("status "+i.status));if(t.binary){var o=i.response;if(!o){o=[];for(var a=0;a<i.responseText.length;++a)o.push(i.responseText.charCodeAt(a)&255)}return r(null,typeof Uint8Array<"u"?new Uint8Array(o):o)}return r(null,i.responseText)}},t.binary&&("overrideMimeType"in i&&i.overrideMimeType("text/plain; charset=x-user-defined"),i.responseType="arraybuffer"),i.open("GET",e),i.send()}});var Eb=E(_b=>{"use strict";var Qm=_b,Sb=Qm.isAbsolute=function(e){return/^(?:\/|\w+:)/.test(e)},$m=Qm.normalize=function(e){e=e.replace(/\\/g,"/").replace(/\/{2,}/g,"/");var t=e.split("/"),r=Sb(e),i="";r&&(i=t.shift()+"/");for(var s=0;s<t.length;)t[s]===".."?s>0&&t[s-1]!==".."?t.splice(--s,2):r?t.splice(s,1):++s:t[s]==="."?t.splice(s,1):++s;return i+t.join("/")};Qm.resolve=function(e,t,r){return r||(t=$m(t)),Sb(t)?t:(r||(e=$m(e)),(e=e.replace(/(?:\/|^)[^/]+$/,"")).length?$m(e+"/"+t):t)}});var Zi=E(wb=>{"use strict";var _l=wb,RF=rt(),kF=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function El(n,e){var t=0,r={};for(e|=0;t<n.length;)r[kF[t+e]]=n[t++];return r}_l.basic=El([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]);_l.defaults=El([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",RF.emptyArray,null]);_l.long=El([0,0,0,1,1],7);_l.mapKey=El([0,0,0,5,5,0,0,0,1,1,0,2],2);_l.packed=El([1,5,0,0,0,5,5,0,0,0,1,1,0])});var Xr=E((RK,bb)=>{"use strict";bb.exports=ln;var hd=es();((ln.prototype=Object.create(hd.prototype)).constructor=ln).className="Field";var Tb=bn(),Cb=Zi(),$e=rt(),Ym,NF=/^required|optional|repeated$/;ln.fromJSON=function(e,t){return new ln(e,t.id,t.type,t.rule,t.extend,t.options,t.comment)};function ln(n,e,t,r,i,s,o){if($e.isObject(r)?(o=i,s=r,r=i=void 0):$e.isObject(i)&&(o=s,s=i,i=void 0),hd.call(this,n,s),!$e.isInteger(e)||e<0)throw TypeError("id must be a non-negative integer");if(!$e.isString(t))throw TypeError("type must be a string");if(r!==void 0&&!NF.test(r=r.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(i!==void 0&&!$e.isString(i))throw TypeError("extend must be a string");r==="proto3_optional"&&(r="optional"),this.rule=r&&r!=="optional"?r:void 0,this.type=t,this.id=e,this.extend=i||void 0,this.required=r==="required",this.optional=!this.required,this.repeated=r==="repeated",this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=$e.Long?Cb.long[t]!==void 0:!1,this.bytes=t==="bytes",this.resolvedType=null,this.extensionField=null,this.declaringField=null,this._packed=null,this.comment=o}Object.defineProperty(ln.prototype,"packed",{get:function(){return this._packed===null&&(this._packed=this.getOption("packed")!==!1),this._packed}});ln.prototype.setOption=function(e,t,r){return e==="packed"&&(this._packed=null),hd.prototype.setOption.call(this,e,t,r)};ln.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return $e.toObject(["rule",this.rule!=="optional"&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])};ln.prototype.resolve=function(){if(this.resolved)return this;if((this.typeDefault=Cb.defaults[this.type])===void 0?(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof Ym?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]):this.options&&this.options.proto3_optional&&(this.typeDefault=null),this.options&&this.options.default!=null&&(this.typeDefault=this.options.default,this.resolvedType instanceof Tb&&typeof this.typeDefault=="string"&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&((this.options.packed===!0||this.options.packed!==void 0&&this.resolvedType&&!(this.resolvedType instanceof Tb))&&delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=$e.Long.fromNumber(this.typeDefault,this.type.charAt(0)==="u"),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&typeof this.typeDefault=="string"){var e;$e.base64.test(this.typeDefault)?$e.base64.decode(this.typeDefault,e=$e.newBuffer($e.base64.length(this.typeDefault)),0):$e.utf8.write(this.typeDefault,e=$e.newBuffer($e.utf8.length(this.typeDefault)),0),this.typeDefault=e}return this.map?this.defaultValue=$e.emptyObject:this.repeated?this.defaultValue=$e.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof Ym&&(this.parent.ctor.prototype[this.name]=this.defaultValue),hd.prototype.resolve.call(this)};ln.d=function(e,t,r,i){return typeof t=="function"?t=$e.decorateType(t).name:t&&typeof t=="object"&&(t=$e.decorateEnum(t).name),function(o,a){$e.decorateType(o.constructor).add(new ln(a,e,t,r,{default:i}))}};ln._configure=function(e){Ym=e}});var go=E((kK,Db)=>{"use strict";Db.exports=cn;var pd=es();((cn.prototype=Object.create(pd.prototype)).constructor=cn).className="OneOf";var Ab=Xr(),fd=rt();function cn(n,e,t,r){if(Array.isArray(e)||(t=e,e=void 0),pd.call(this,n,t),!(e===void 0||Array.isArray(e)))throw TypeError("fieldNames must be an Array");this.oneof=e||[],this.fieldsArray=[],this.comment=r}cn.fromJSON=function(e,t){return new cn(e,t.oneof,t.options,t.comment)};cn.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return fd.toObject(["options",this.options,"oneof",this.oneof,"comment",t?this.comment:void 0])};function Ib(n){if(n.parent)for(var e=0;e<n.fieldsArray.length;++e)n.fieldsArray[e].parent||n.parent.add(n.fieldsArray[e])}cn.prototype.add=function(e){if(!(e instanceof Ab))throw TypeError("field must be a Field");return e.parent&&e.parent!==this.parent&&e.parent.remove(e),this.oneof.push(e.name),this.fieldsArray.push(e),e.partOf=this,Ib(this),this};cn.prototype.remove=function(e){if(!(e instanceof Ab))throw TypeError("field must be a Field");var t=this.fieldsArray.indexOf(e);if(t<0)throw Error(e+" is not a member of "+this);return this.fieldsArray.splice(t,1),t=this.oneof.indexOf(e.name),t>-1&&this.oneof.splice(t,1),e.partOf=null,this};cn.prototype.onAdd=function(e){pd.prototype.onAdd.call(this,e);for(var t=this,r=0;r<this.oneof.length;++r){var i=e.get(this.oneof[r]);i&&!i.partOf&&(i.partOf=t,t.fieldsArray.push(i))}Ib(this)};cn.prototype.onRemove=function(e){for(var t=0,r;t<this.fieldsArray.length;++t)(r=this.fieldsArray[t]).parent&&r.parent.remove(r);pd.prototype.onRemove.call(this,e)};cn.d=function(){for(var e=new Array(arguments.length),t=0;t<arguments.length;)e[t]=arguments[t++];return function(i,s){fd.decorateType(i.constructor).add(new cn(s,e)),Object.defineProperty(i,s,{get:fd.oneOfGetter(e),set:fd.oneOfSetter(e)})}}});var vo=E((NK,xb)=>{"use strict";xb.exports=ue;var Xm=es();((ue.prototype=Object.create(Xm.prototype)).constructor=ue).className="Namespace";var Rb=Xr(),gd=rt(),xF=go(),mo,wl,yo;ue.fromJSON=function(e,t){return new ue(e,t.options).addJSON(t.nested)};function kb(n,e){if(n&&n.length){for(var t={},r=0;r<n.length;++r)t[n[r].name]=n[r].toJSON(e);return t}}ue.arrayToJSON=kb;ue.isReservedId=function(e,t){if(e){for(var r=0;r<e.length;++r)if(typeof e[r]!="string"&&e[r][0]<=t&&e[r][1]>t)return!0}return!1};ue.isReservedName=function(e,t){if(e){for(var r=0;r<e.length;++r)if(e[r]===t)return!0}return!1};function ue(n,e){Xm.call(this,n,e),this.nested=void 0,this._nestedArray=null}function Nb(n){return n._nestedArray=null,n}Object.defineProperty(ue.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=gd.toArray(this.nested))}});ue.prototype.toJSON=function(e){return gd.toObject(["options",this.options,"nested",kb(this.nestedArray,e)])};ue.prototype.addJSON=function(e){var t=this;if(e)for(var r=Object.keys(e),i=0,s;i<r.length;++i)s=e[r[i]],t.add((s.fields!==void 0?mo.fromJSON:s.values!==void 0?yo.fromJSON:s.methods!==void 0?wl.fromJSON:s.id!==void 0?Rb.fromJSON:ue.fromJSON)(r[i],s));return this};ue.prototype.get=function(e){return this.nested&&this.nested[e]||null};ue.prototype.getEnum=function(e){if(this.nested&&this.nested[e]instanceof yo)return this.nested[e].values;throw Error("no such enum: "+e)};ue.prototype.add=function(e){if(!(e instanceof Rb&&e.extend!==void 0||e instanceof mo||e instanceof xF||e instanceof yo||e instanceof wl||e instanceof ue))throw TypeError("object must be a valid nested object");if(!this.nested)this.nested={};else{var t=this.get(e.name);if(t)if(t instanceof ue&&e instanceof ue&&!(t instanceof mo||t instanceof wl)){for(var r=t.nestedArray,i=0;i<r.length;++i)e.add(r[i]);this.remove(t),this.nested||(this.nested={}),e.setOptions(t.options,!0)}else throw Error("duplicate name '"+e.name+"' in "+this)}return this.nested[e.name]=e,e.onAdd(this),Nb(this)};ue.prototype.remove=function(e){if(!(e instanceof Xm))throw TypeError("object must be a ReflectionObject");if(e.parent!==this)throw Error(e+" is not a member of "+this);return delete this.nested[e.name],Object.keys(this.nested).length||(this.nested=void 0),e.onRemove(this),Nb(this)};ue.prototype.define=function(e,t){if(gd.isString(e))e=e.split(".");else if(!Array.isArray(e))throw TypeError("illegal path");if(e&&e.length&&e[0]==="")throw Error("path must be relative");for(var r=this;e.length>0;){var i=e.shift();if(r.nested&&r.nested[i]){if(r=r.nested[i],!(r instanceof ue))throw Error("path conflicts with non-namespace objects")}else r.add(r=new ue(i))}return t&&r.addJSON(t),r};ue.prototype.resolveAll=function(){for(var e=this.nestedArray,t=0;t<e.length;)e[t]instanceof ue?e[t++].resolveAll():e[t++].resolve();return this.resolve()};ue.prototype.lookup=function(e,t,r){if(typeof t=="boolean"?(r=t,t=void 0):t&&!Array.isArray(t)&&(t=[t]),gd.isString(e)&&e.length){if(e===".")return this.root;e=e.split(".")}else if(!e.length)return this;if(e[0]==="")return this.root.lookup(e.slice(1),t);var i=this.get(e[0]);if(i){if(e.length===1){if(!t||t.indexOf(i.constructor)>-1)return i}else if(i instanceof ue&&(i=i.lookup(e.slice(1),t,!0)))return i}else for(var s=0;s<this.nestedArray.length;++s)if(this._nestedArray[s]instanceof ue&&(i=this._nestedArray[s].lookup(e,t,!0)))return i;return this.parent===null||r?null:this.parent.lookup(e,t)};ue.prototype.lookupType=function(e){var t=this.lookup(e,[mo]);if(!t)throw Error("no such type: "+e);return t};ue.prototype.lookupEnum=function(e){var t=this.lookup(e,[yo]);if(!t)throw Error("no such Enum '"+e+"' in "+this);return t};ue.prototype.lookupTypeOrEnum=function(e){var t=this.lookup(e,[mo,yo]);if(!t)throw Error("no such Type or Enum '"+e+"' in "+this);return t};ue.prototype.lookupService=function(e){var t=this.lookup(e,[wl]);if(!t)throw Error("no such Service '"+e+"' in "+this);return t};ue._configure=function(n,e,t){mo=n,wl=e,yo=t}});var md=E((xK,Mb)=>{"use strict";Mb.exports=yr;var Jm=Xr();((yr.prototype=Object.create(Jm.prototype)).constructor=yr).className="MapField";var MF=Zi(),Tl=rt();function yr(n,e,t,r,i,s){if(Jm.call(this,n,e,r,void 0,void 0,i,s),!Tl.isString(t))throw TypeError("keyType must be a string");this.keyType=t,this.resolvedKeyType=null,this.map=!0}yr.fromJSON=function(e,t){return new yr(e,t.id,t.keyType,t.type,t.options,t.comment)};yr.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return Tl.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])};yr.prototype.resolve=function(){if(this.resolved)return this;if(MF.mapKey[this.keyType]===void 0)throw Error("invalid key type: "+this.keyType);return Jm.prototype.resolve.call(this)};yr.d=function(e,t,r){return typeof r=="function"?r=Tl.decorateType(r).name:r&&typeof r=="object"&&(r=Tl.decorateEnum(r).name),function(s,o){Tl.decorateType(s.constructor).add(new yr(o,e,t,r))}}});var yd=E((MK,Ob)=>{"use strict";Ob.exports=ts;var Zm=es();((ts.prototype=Object.create(Zm.prototype)).constructor=ts).className="Method";var So=rt();function ts(n,e,t,r,i,s,o,a,l){if(So.isObject(i)?(o=i,i=s=void 0):So.isObject(s)&&(o=s,s=void 0),!(e===void 0||So.isString(e)))throw TypeError("type must be a string");if(!So.isString(t))throw TypeError("requestType must be a string");if(!So.isString(r))throw TypeError("responseType must be a string");Zm.call(this,n,o),this.type=e||"rpc",this.requestType=t,this.requestStream=i?!0:void 0,this.responseType=r,this.responseStream=s?!0:void 0,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=a,this.parsedOptions=l}ts.fromJSON=function(e,t){return new ts(e,t.type,t.requestType,t.responseType,t.requestStream,t.responseStream,t.options,t.comment,t.parsedOptions)};ts.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return So.toObject(["type",this.type!=="rpc"&&this.type||void 0,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",t?this.comment:void 0,"parsedOptions",this.parsedOptions])};ts.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),Zm.prototype.resolve.call(this))}});var vd=E((OK,Fb)=>{"use strict";Fb.exports=un;var Jr=vo();((un.prototype=Object.create(Jr.prototype)).constructor=un).className="Service";var ey=yd(),Cl=rt(),OF=Gm();function un(n,e){Jr.call(this,n,e),this.methods={},this._methodsArray=null}un.fromJSON=function(e,t){var r=new un(e,t.options);if(t.methods)for(var i=Object.keys(t.methods),s=0;s<i.length;++s)r.add(ey.fromJSON(i[s],t.methods[i[s]]));return t.nested&&r.addJSON(t.nested),r.comment=t.comment,r};un.prototype.toJSON=function(e){var t=Jr.prototype.toJSON.call(this,e),r=e?!!e.keepComments:!1;return Cl.toObject(["options",t&&t.options||void 0,"methods",Jr.arrayToJSON(this.methodsArray,e)||{},"nested",t&&t.nested||void 0,"comment",r?this.comment:void 0])};Object.defineProperty(un.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=Cl.toArray(this.methods))}});function Pb(n){return n._methodsArray=null,n}un.prototype.get=function(e){return this.methods[e]||Jr.prototype.get.call(this,e)};un.prototype.resolveAll=function(){for(var e=this.methodsArray,t=0;t<e.length;++t)e[t].resolve();return Jr.prototype.resolve.call(this)};un.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);return e instanceof ey?(this.methods[e.name]=e,e.parent=this,Pb(this)):Jr.prototype.add.call(this,e)};un.prototype.remove=function(e){if(e instanceof ey){if(this.methods[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.methods[e.name],e.parent=null,Pb(this)}return Jr.prototype.remove.call(this,e)};un.prototype.create=function(e,t,r){for(var i=new OF.Service(e,t,r),s=0,o;s<this.methodsArray.length;++s){var a=Cl.lcFirst((o=this._methodsArray[s]).resolve().name).replace(/[^$\w_]/g,"");i[a]=Cl.codegen(["r","c"],Cl.isReserved(a)?a+"_":a)("return this.rpcCall(m,q,s,r,c)")({m:o,q:o.resolvedRequestType.ctor,s:o.resolvedResponseType.ctor})}return i}});var Sd=E((PK,Lb)=>{"use strict";Lb.exports=$n;var PF=Kn();function $n(n){if(n)for(var e=Object.keys(n),t=0;t<e.length;++t)this[e[t]]=n[e[t]]}$n.create=function(e){return this.$type.create(e)};$n.encode=function(e,t){return this.$type.encode(e,t)};$n.encodeDelimited=function(e,t){return this.$type.encodeDelimited(e,t)};$n.decode=function(e){return this.$type.decode(e)};$n.decodeDelimited=function(e){return this.$type.decodeDelimited(e)};$n.verify=function(e){return this.$type.verify(e)};$n.fromObject=function(e){return this.$type.fromObject(e)};$n.toObject=function(e,t){return this.$type.toObject(e,t)};$n.prototype.toJSON=function(){return this.$type.toObject(this,PF.toJSONOptions)}});var ty=E((FK,Vb)=>{"use strict";Vb.exports=BF;var FF=bn(),vr=Zi(),Bb=rt();function LF(n){return"missing required '"+n.name+"'"}function BF(n){var e=Bb.codegen(["r","l"],n.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(n.fieldsArray.filter(function(a){return a.map}).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()");n.group&&e("if((t&7)===4)")("break"),e("switch(t>>>3){");for(var t=0;t<n.fieldsArray.length;++t){var r=n._fieldsArray[t].resolve(),i=r.resolvedType instanceof FF?"int32":r.type,s="m"+Bb.safeProp(r.name);e("case %i: {",r.id),r.map?(e("if(%s===util.emptyObject)",s)("%s={}",s)("var c2 = r.uint32()+r.pos"),vr.defaults[r.keyType]!==void 0?e("k=%j",vr.defaults[r.keyType]):e("k=null"),vr.defaults[i]!==void 0?e("value=%j",vr.defaults[i]):e("value=null"),e("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",r.keyType)("case 2:"),vr.basic[i]===void 0?e("value=types[%i].decode(r,r.uint32())",t):e("value=r.%s()",i),e("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),vr.long[r.keyType]!==void 0?e('%s[typeof k==="object"?util.longToHash(k):k]=value',s):e("%s[k]=value",s)):r.repeated?(e("if(!(%s&&%s.length))",s,s)("%s=[]",s),vr.packed[i]!==void 0&&e("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,i)("}else"),vr.basic[i]===void 0?e(r.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",s,t):e("%s.push(r.%s())",s,i)):vr.basic[i]===void 0?e(r.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",s,t):e("%s=r.%s()",s,i),e("break")("}")}for(e("default:")("r.skipType(t&7)")("break")("}")("}"),t=0;t<n._fieldsArray.length;++t){var o=n._fieldsArray[t];o.required&&e("if(!m.hasOwnProperty(%j))",o.name)("throw util.ProtocolError(%j,{instance:m})",LF(o))}return e("return m")}});var iy=E((LK,qb)=>{"use strict";qb.exports=UF;var VF=bn(),ny=rt();function dn(n,e){return n.name+": "+e+(n.repeated&&e!=="array"?"[]":n.map&&e!=="object"?"{k:"+n.keyType+"}":"")+" expected"}function ry(n,e,t,r){if(e.resolvedType)if(e.resolvedType instanceof VF){n("switch(%s){",r)("default:")("return%j",dn(e,"enum value"));for(var i=Object.keys(e.resolvedType.values),s=0;s<i.length;++s)n("case %i:",e.resolvedType.values[i[s]]);n("break")("}")}else n("{")("var e=types[%i].verify(%s);",t,r)("if(e)")("return%j+e",e.name+".")("}");else switch(e.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":n("if(!util.isInteger(%s))",r)("return%j",dn(e,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":n("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",r,r,r,r)("return%j",dn(e,"integer|Long"));break;case"float":case"double":n('if(typeof %s!=="number")',r)("return%j",dn(e,"number"));break;case"bool":n('if(typeof %s!=="boolean")',r)("return%j",dn(e,"boolean"));break;case"string":n("if(!util.isString(%s))",r)("return%j",dn(e,"string"));break;case"bytes":n('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',r,r,r)("return%j",dn(e,"buffer"));break}return n}function qF(n,e,t){switch(e.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":n("if(!util.key32Re.test(%s))",t)("return%j",dn(e,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":n("if(!util.key64Re.test(%s))",t)("return%j",dn(e,"integer|Long key"));break;case"bool":n("if(!util.key2Re.test(%s))",t)("return%j",dn(e,"boolean key"));break}return n}function UF(n){var e=ny.codegen(["m"],n.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),t=n.oneofsArray,r={};t.length&&e("var p={}");for(var i=0;i<n.fieldsArray.length;++i){var s=n._fieldsArray[i].resolve(),o="m"+ny.safeProp(s.name);if(s.optional&&e("if(%s!=null&&m.hasOwnProperty(%j)){",o,s.name),s.map)e("if(!util.isObject(%s))",o)("return%j",dn(s,"object"))("var k=Object.keys(%s)",o)("for(var i=0;i<k.length;++i){"),qF(e,s,"k[i]"),ry(e,s,i,o+"[k[i]]")("}");else if(s.repeated)e("if(!Array.isArray(%s))",o)("return%j",dn(s,"array"))("for(var i=0;i<%s.length;++i){",o),ry(e,s,i,o+"[i]")("}");else{if(s.partOf){var a=ny.safeProp(s.partOf.name);r[s.partOf.name]===1&&e("if(p%s===1)",a)("return%j",s.partOf.name+": multiple values"),r[s.partOf.name]=1,e("p%s=1",a)}ry(e,s,i,o)}s.optional&&e("}")}return e("return null")}});var ay=E(zb=>{"use strict";var Ub=zb,bl=bn(),Qn=rt();function sy(n,e,t,r){var i=!1;if(e.resolvedType)if(e.resolvedType instanceof bl){n("switch(d%s){",r);for(var s=e.resolvedType.values,o=Object.keys(s),a=0;a<o.length;++a)s[o[a]]===e.typeDefault&&!i&&(n("default:")('if(typeof(d%s)==="number"){m%s=d%s;break}',r,r,r),e.repeated||n("break"),i=!0),n("case%j:",o[a])("case %i:",s[o[a]])("m%s=%j",r,s[o[a]])("break");n("}")}else n('if(typeof d%s!=="object")',r)("throw TypeError(%j)",e.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",r,t,r);else{var l=!1;switch(e.type){case"double":case"float":n("m%s=Number(d%s)",r,r);break;case"uint32":case"fixed32":n("m%s=d%s>>>0",r,r);break;case"int32":case"sint32":case"sfixed32":n("m%s=d%s|0",r,r);break;case"uint64":l=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":n("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",r,r,l)('else if(typeof d%s==="string")',r)("m%s=parseInt(d%s,10)",r,r)('else if(typeof d%s==="number")',r)("m%s=d%s",r,r)('else if(typeof d%s==="object")',r)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",r,r,r,l?"true":"");break;case"bytes":n('if(typeof d%s==="string")',r)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",r,r,r)("else if(d%s.length >= 0)",r)("m%s=d%s",r,r);break;case"string":n("m%s=String(d%s)",r,r);break;case"bool":n("m%s=Boolean(d%s)",r,r);break}}return n}Ub.fromObject=function(e){var t=e.fieldsArray,r=Qn.codegen(["d"],e.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!t.length)return r("return new this.ctor");r("var m=new this.ctor");for(var i=0;i<t.length;++i){var s=t[i].resolve(),o=Qn.safeProp(s.name);s.map?(r("if(d%s){",o)('if(typeof d%s!=="object")',o)("throw TypeError(%j)",s.fullName+": object expected")("m%s={}",o)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",o),sy(r,s,i,o+"[ks[i]]")("}")("}")):s.repeated?(r("if(d%s){",o)("if(!Array.isArray(d%s))",o)("throw TypeError(%j)",s.fullName+": array expected")("m%s=[]",o)("for(var i=0;i<d%s.length;++i){",o),sy(r,s,i,o+"[i]")("}")("}")):(s.resolvedType instanceof bl||r("if(d%s!=null){",o),sy(r,s,i,o),s.resolvedType instanceof bl||r("}"))}return r("return m")};function oy(n,e,t,r){if(e.resolvedType)e.resolvedType instanceof bl?n("d%s=o.enums===String?(types[%i].values[m%s]===undefined?m%s:types[%i].values[m%s]):m%s",r,t,r,r,t,r,r):n("d%s=types[%i].toObject(m%s,o)",r,t,r);else{var i=!1;switch(e.type){case"double":case"float":n("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",r,r,r,r);break;case"uint64":i=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":n('if(typeof m%s==="number")',r)("d%s=o.longs===String?String(m%s):m%s",r,r,r)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",r,r,r,r,i?"true":"",r);break;case"bytes":n("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",r,r,r,r,r);break;default:n("d%s=m%s",r,r);break}}return n}Ub.toObject=function(e){var t=e.fieldsArray.slice().sort(Qn.compareFieldsById);if(!t.length)return Qn.codegen()("return {}");for(var r=Qn.codegen(["m","o"],e.name+"$toObject")("if(!o)")("o={}")("var d={}"),i=[],s=[],o=[],a=0;a<t.length;++a)t[a].partOf||(t[a].resolve().repeated?i:t[a].map?s:o).push(t[a]);if(i.length){for(r("if(o.arrays||o.defaults){"),a=0;a<i.length;++a)r("d%s=[]",Qn.safeProp(i[a].name));r("}")}if(s.length){for(r("if(o.objects||o.defaults){"),a=0;a<s.length;++a)r("d%s={}",Qn.safeProp(s[a].name));r("}")}if(o.length){for(r("if(o.defaults){"),a=0;a<o.length;++a){var l=o[a],c=Qn.safeProp(l.name);if(l.resolvedType instanceof bl)r("d%s=o.enums===String?%j:%j",c,l.resolvedType.valuesById[l.typeDefault],l.typeDefault);else if(l.long)r("if(util.Long){")("var n=new util.Long(%i,%i,%j)",l.typeDefault.low,l.typeDefault.high,l.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",c)("}else")("d%s=o.longs===String?%j:%i",c,l.typeDefault.toString(),l.typeDefault.toNumber());else if(l.bytes){var u="["+Array.prototype.slice.call(l.typeDefault).join(",")+"]";r("if(o.bytes===String)d%s=%j",c,String.fromCharCode.apply(String,l.typeDefault))("else{")("d%s=%s",c,u)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",c,c)("}")}else r("d%s=%j",c,l.typeDefault)}r("}")}var d=!1;for(a=0;a<t.length;++a){var l=t[a],h=e._fieldsArray.indexOf(l),c=Qn.safeProp(l.name);l.map?(d||(d=!0,r("var ks2")),r("if(m%s&&(ks2=Object.keys(m%s)).length){",c,c)("d%s={}",c)("for(var j=0;j<ks2.length;++j){"),oy(r,l,h,c+"[ks2[j]]")("}")):l.repeated?(r("if(m%s&&m%s.length){",c,c)("d%s=[]",c)("for(var j=0;j<m%s.length;++j){",c),oy(r,l,h,c+"[j]")("}")):(r("if(m%s!=null&&m.hasOwnProperty(%j)){",c,l.name),oy(r,l,h,c),l.partOf&&r("if(o.oneofs)")("d%s=%j",Qn.safeProp(l.partOf.name),l.name)),r("}")}return r("return d")}});var ly=E(jb=>{"use strict";var zF=jb,jF=Sd();zF[".google.protobuf.Any"]={fromObject:function(n){if(n&&n["@type"]){var e=n["@type"].substring(n["@type"].lastIndexOf("/")+1),t=this.lookup(e);if(t){var r=n["@type"].charAt(0)==="."?n["@type"].slice(1):n["@type"];return r.indexOf("/")===-1&&(r="/"+r),this.create({type_url:r,value:t.encode(t.fromObject(n)).finish()})}}return this.fromObject(n)},toObject:function(n,e){var t="type.googleapis.com/",r="",i="";if(e&&e.json&&n.type_url&&n.value){i=n.type_url.substring(n.type_url.lastIndexOf("/")+1),r=n.type_url.substring(0,n.type_url.lastIndexOf("/")+1);var s=this.lookup(i);s&&(n=s.decode(n.value))}if(!(n instanceof this.ctor)&&n instanceof jF){var o=n.$type.toObject(n,e),a=n.$type.fullName[0]==="."?n.$type.fullName.slice(1):n.$type.fullName;return r===""&&(r=t),i=r+a,o["@type"]=i,o}return this.toObject(n,e)}}});var wd=E((qK,Hb)=>{"use strict";Hb.exports=_e;var An=vo();((_e.prototype=Object.create(An.prototype)).constructor=_e).className="Type";var GF=bn(),dy=go(),_d=Xr(),HF=md(),KF=vd(),cy=Sd(),uy=dd(),WF=cd(),St=rt(),$F=hy(),QF=ty(),YF=iy(),Gb=ay(),XF=ly();function _e(n,e){An.call(this,n,e),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}Object.defineProperties(_e.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var n=Object.keys(this.fields),e=0;e<n.length;++e){var t=this.fields[n[e]],r=t.id;if(this._fieldsById[r])throw Error("duplicate id "+r+" in "+this);this._fieldsById[r]=t}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=St.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=St.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=_e.generateConstructor(this)())},set:function(n){var e=n.prototype;e instanceof cy||((n.prototype=new cy).constructor=n,St.merge(n.prototype,e)),n.$type=n.prototype.$type=this,St.merge(n,cy,!0),this._ctor=n;for(var t=0;t<this.fieldsArray.length;++t)this._fieldsArray[t].resolve();var r={};for(t=0;t<this.oneofsArray.length;++t)r[this._oneofsArray[t].resolve().name]={get:St.oneOfGetter(this._oneofsArray[t].oneof),set:St.oneOfSetter(this._oneofsArray[t].oneof)};t&&Object.defineProperties(n.prototype,r)}}});_e.generateConstructor=function(e){for(var t=St.codegen(["p"],e.name),r=0,i;r<e.fieldsArray.length;++r)(i=e._fieldsArray[r]).map?t("this%s={}",St.safeProp(i.name)):i.repeated&&t("this%s=[]",St.safeProp(i.name));return t("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")};function Ed(n){return n._fieldsById=n._fieldsArray=n._oneofsArray=null,delete n.encode,delete n.decode,delete n.verify,n}_e.fromJSON=function(e,t){var r=new _e(e,t.options);r.extensions=t.extensions,r.reserved=t.reserved;for(var i=Object.keys(t.fields),s=0;s<i.length;++s)r.add((typeof t.fields[i[s]].keyType<"u"?HF.fromJSON:_d.fromJSON)(i[s],t.fields[i[s]]));if(t.oneofs)for(i=Object.keys(t.oneofs),s=0;s<i.length;++s)r.add(dy.fromJSON(i[s],t.oneofs[i[s]]));if(t.nested)for(i=Object.keys(t.nested),s=0;s<i.length;++s){var o=t.nested[i[s]];r.add((o.id!==void 0?_d.fromJSON:o.fields!==void 0?_e.fromJSON:o.values!==void 0?GF.fromJSON:o.methods!==void 0?KF.fromJSON:An.fromJSON)(i[s],o))}return t.extensions&&t.extensions.length&&(r.extensions=t.extensions),t.reserved&&t.reserved.length&&(r.reserved=t.reserved),t.group&&(r.group=!0),t.comment&&(r.comment=t.comment),r};_e.prototype.toJSON=function(e){var t=An.prototype.toJSON.call(this,e),r=e?!!e.keepComments:!1;return St.toObject(["options",t&&t.options||void 0,"oneofs",An.arrayToJSON(this.oneofsArray,e),"fields",An.arrayToJSON(this.fieldsArray.filter(function(i){return!i.declaringField}),e)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",t&&t.nested||void 0,"comment",r?this.comment:void 0])};_e.prototype.resolveAll=function(){for(var e=this.fieldsArray,t=0;t<e.length;)e[t++].resolve();var r=this.oneofsArray;for(t=0;t<r.length;)r[t++].resolve();return An.prototype.resolveAll.call(this)};_e.prototype.get=function(e){return this.fields[e]||this.oneofs&&this.oneofs[e]||this.nested&&this.nested[e]||null};_e.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);if(e instanceof _d&&e.extend===void 0){if(this._fieldsById?this._fieldsById[e.id]:this.fieldsById[e.id])throw Error("duplicate id "+e.id+" in "+this);if(this.isReservedId(e.id))throw Error("id "+e.id+" is reserved in "+this);if(this.isReservedName(e.name))throw Error("name '"+e.name+"' is reserved in "+this);return e.parent&&e.parent.remove(e),this.fields[e.name]=e,e.message=this,e.onAdd(this),Ed(this)}return e instanceof dy?(this.oneofs||(this.oneofs={}),this.oneofs[e.name]=e,e.onAdd(this),Ed(this)):An.prototype.add.call(this,e)};_e.prototype.remove=function(e){if(e instanceof _d&&e.extend===void 0){if(!this.fields||this.fields[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.fields[e.name],e.parent=null,e.onRemove(this),Ed(this)}if(e instanceof dy){if(!this.oneofs||this.oneofs[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.oneofs[e.name],e.parent=null,e.onRemove(this),Ed(this)}return An.prototype.remove.call(this,e)};_e.prototype.isReservedId=function(e){return An.isReservedId(this.reserved,e)};_e.prototype.isReservedName=function(e){return An.isReservedName(this.reserved,e)};_e.prototype.create=function(e){return new this.ctor(e)};_e.prototype.setup=function(){for(var e=this.fullName,t=[],r=0;r<this.fieldsArray.length;++r)t.push(this._fieldsArray[r].resolve().resolvedType);this.encode=$F(this)({Writer:WF,types:t,util:St}),this.decode=QF(this)({Reader:uy,types:t,util:St}),this.verify=YF(this)({types:t,util:St}),this.fromObject=Gb.fromObject(this)({types:t,util:St}),this.toObject=Gb.toObject(this)({types:t,util:St});var i=XF[e];if(i){var s=Object.create(this);s.fromObject=this.fromObject,this.fromObject=i.fromObject.bind(s),s.toObject=this.toObject,this.toObject=i.toObject.bind(s)}return this};_e.prototype.encode=function(e,t){return this.setup().encode(e,t)};_e.prototype.encodeDelimited=function(e,t){return this.encode(e,t&&t.len?t.fork():t).ldelim()};_e.prototype.decode=function(e,t){return this.setup().decode(e,t)};_e.prototype.decodeDelimited=function(e){return e instanceof uy||(e=uy.create(e)),this.decode(e,e.uint32())};_e.prototype.verify=function(e){return this.setup().verify(e)};_e.prototype.fromObject=function(e){return this.setup().fromObject(e)};_e.prototype.toObject=function(e,t){return this.setup().toObject(e,t)};_e.d=function(e){return function(r){St.decorateType(r,e)}}});var bd=E((UK,Yb)=>{"use strict";Yb.exports=$t;var Cd=vo();(($t.prototype=Object.create(Cd.prototype)).constructor=$t).className="Root";var py=Xr(),Wb=bn(),JF=go(),Zr=rt(),$b,fy,Al;function $t(n){Cd.call(this,"",n),this.deferred=[],this.files=[]}$t.fromJSON=function(e,t){return t||(t=new $t),e.options&&t.setOptions(e.options),t.addJSON(e.nested)};$t.prototype.resolvePath=Zr.path.resolve;$t.prototype.fetch=Zr.fetch;function Qb(){}$t.prototype.load=function n(e,t,r){typeof t=="function"&&(r=t,t=void 0);var i=this;if(!r)return Zr.asPromise(n,i,e,t);var s=r===Qb;function o(p,y){if(r){var S=r;if(r=null,s)throw p;S(p,y)}}function a(p){var y=p.lastIndexOf("google/protobuf/");if(y>-1){var S=p.substring(y);if(S in Al)return S}return null}function l(p,y){try{if(Zr.isString(y)&&y.charAt(0)==="{"&&(y=JSON.parse(y)),!Zr.isString(y))i.setOptions(y.options).addJSON(y.nested);else{fy.filename=p;var S=fy(y,i,t),_,k=0;if(S.imports)for(;k<S.imports.length;++k)(_=a(S.imports[k])||i.resolvePath(p,S.imports[k]))&&c(_);if(S.weakImports)for(k=0;k<S.weakImports.length;++k)(_=a(S.weakImports[k])||i.resolvePath(p,S.weakImports[k]))&&c(_,!0)}}catch(w){o(w)}!s&&!u&&o(null,i)}function c(p,y){if(p=a(p)||p,!(i.files.indexOf(p)>-1)){if(i.files.push(p),p in Al){s?l(p,Al[p]):(++u,setTimeout(function(){--u,l(p,Al[p])}));return}if(s){var S;try{S=Zr.fs.readFileSync(p).toString("utf8")}catch(_){y||o(_);return}l(p,S)}else++u,i.fetch(p,function(_,k){if(--u,!!r){if(_){y?u||o(null,i):o(_);return}l(p,k)}})}}var u=0;Zr.isString(e)&&(e=[e]);for(var d=0,h;d<e.length;++d)(h=i.resolvePath("",e[d]))&&c(h);if(s)return i;u||o(null,i)};$t.prototype.loadSync=function(e,t){if(!Zr.isNode)throw Error("not supported");return this.load(e,t,Qb)};$t.prototype.resolveAll=function(){if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map(function(e){return"'extend "+e.extend+"' in "+e.parent.fullName}).join(", "));return Cd.prototype.resolveAll.call(this)};var Td=/^[A-Z]/;function Kb(n,e){var t=e.parent.lookup(e.extend);if(t){var r=new py(e.fullName,e.id,e.type,e.rule,void 0,e.options);return t.get(r.name)||(r.declaringField=e,e.extensionField=r,t.add(r)),!0}return!1}$t.prototype._handleAdd=function(e){if(e instanceof py)e.extend!==void 0&&!e.extensionField&&(Kb(this,e)||this.deferred.push(e));else if(e instanceof Wb)Td.test(e.name)&&(e.parent[e.name]=e.values);else if(!(e instanceof JF)){if(e instanceof $b)for(var t=0;t<this.deferred.length;)Kb(this,this.deferred[t])?this.deferred.splice(t,1):++t;for(var r=0;r<e.nestedArray.length;++r)this._handleAdd(e._nestedArray[r]);Td.test(e.name)&&(e.parent[e.name]=e)}};$t.prototype._handleRemove=function(e){if(e instanceof py){if(e.extend!==void 0)if(e.extensionField)e.extensionField.parent.remove(e.extensionField),e.extensionField=null;else{var t=this.deferred.indexOf(e);t>-1&&this.deferred.splice(t,1)}}else if(e instanceof Wb)Td.test(e.name)&&delete e.parent[e.name];else if(e instanceof Cd){for(var r=0;r<e.nestedArray.length;++r)this._handleRemove(e._nestedArray[r]);Td.test(e.name)&&delete e.parent[e.name]}};$t._configure=function(n,e,t){$b=n,fy=e,Al=t}});var rt=E((zK,Jb)=>{"use strict";var ze=Jb.exports=Kn(),Xb=Hm(),gy,my;ze.codegen=mb();ze.fetch=vb();ze.path=Eb();ze.fs=ze.inquire("fs");ze.toArray=function(e){if(e){for(var t=Object.keys(e),r=new Array(t.length),i=0;i<t.length;)r[i]=e[t[i++]];return r}return[]};ze.toObject=function(e){for(var t={},r=0;r<e.length;){var i=e[r++],s=e[r++];s!==void 0&&(t[i]=s)}return t};var ZF=/\\/g,e2=/"/g;ze.isReserved=function(e){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(e)};ze.safeProp=function(e){return!/^[$\w_]+$/.test(e)||ze.isReserved(e)?'["'+e.replace(ZF,"\\\\").replace(e2,'\\"')+'"]':"."+e};ze.ucFirst=function(e){return e.charAt(0).toUpperCase()+e.substring(1)};var t2=/_([a-z])/g;ze.camelCase=function(e){return e.substring(0,1)+e.substring(1).replace(t2,function(t,r){return r.toUpperCase()})};ze.compareFieldsById=function(e,t){return e.id-t.id};ze.decorateType=function(e,t){if(e.$type)return t&&e.$type.name!==t&&(ze.decorateRoot.remove(e.$type),e.$type.name=t,ze.decorateRoot.add(e.$type)),e.$type;gy||(gy=wd());var r=new gy(t||e.name);return ze.decorateRoot.add(r),r.ctor=e,Object.defineProperty(e,"$type",{value:r,enumerable:!1}),Object.defineProperty(e.prototype,"$type",{value:r,enumerable:!1}),r};var n2=0;ze.decorateEnum=function(e){if(e.$type)return e.$type;my||(my=bn());var t=new my("Enum"+n2++,e);return ze.decorateRoot.add(t),Object.defineProperty(e,"$type",{value:t,enumerable:!1}),t};ze.setProperty=function(e,t,r){function i(s,o,a){var l=o.shift();if(l==="__proto__"||l==="prototype")return s;if(o.length>0)s[l]=i(s[l]||{},o,a);else{var c=s[l];c&&(a=[].concat(c).concat(a)),s[l]=a}return s}if(typeof e!="object")throw TypeError("dst must be an object");if(!t)throw TypeError("path must be specified");return t=t.split("."),i(e,t,r)};Object.defineProperty(ze,"decorateRoot",{get:function(){return Xb.decorated||(Xb.decorated=new(bd()))}})});var es=E((jK,Zb)=>{"use strict";Zb.exports=Qt;Qt.className="ReflectionObject";var Ad=rt(),Id;function Qt(n,e){if(!Ad.isString(n))throw TypeError("name must be a string");if(e&&!Ad.isObject(e))throw TypeError("options must be an object");this.options=e,this.parsedOptions=null,this.name=n,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(Qt.prototype,{root:{get:function(){for(var n=this;n.parent!==null;)n=n.parent;return n}},fullName:{get:function(){for(var n=[this.name],e=this.parent;e;)n.unshift(e.name),e=e.parent;return n.join(".")}}});Qt.prototype.toJSON=function(){throw Error()};Qt.prototype.onAdd=function(e){this.parent&&this.parent!==e&&this.parent.remove(this),this.parent=e,this.resolved=!1;var t=e.root;t instanceof Id&&t._handleAdd(this)};Qt.prototype.onRemove=function(e){var t=e.root;t instanceof Id&&t._handleRemove(this),this.parent=null,this.resolved=!1};Qt.prototype.resolve=function(){return this.resolved?this:(this.root instanceof Id&&(this.resolved=!0),this)};Qt.prototype.getOption=function(e){if(this.options)return this.options[e]};Qt.prototype.setOption=function(e,t,r){return(!r||!this.options||this.options[e]===void 0)&&((this.options||(this.options={}))[e]=t),this};Qt.prototype.setParsedOption=function(e,t,r){this.parsedOptions||(this.parsedOptions=[]);var i=this.parsedOptions;if(r){var s=i.find(function(l){return Object.prototype.hasOwnProperty.call(l,e)});if(s){var o=s[e];Ad.setProperty(o,r,t)}else s={},s[e]=Ad.setProperty({},r,t),i.push(s)}else{var a={};a[e]=t,i.push(a)}return this};Qt.prototype.setOptions=function(e,t){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)this.setOption(r[i],e[r[i]],t);return this};Qt.prototype.toString=function(){var e=this.constructor.className,t=this.fullName;return t.length?e+" "+t:e};Qt._configure=function(n){Id=n}});var bn=E((GK,nA)=>{"use strict";nA.exports=Yn;var eA=es();((Yn.prototype=Object.create(eA.prototype)).constructor=Yn).className="Enum";var tA=vo(),Dd=rt();function Yn(n,e,t,r,i,s){if(eA.call(this,n,t),e&&typeof e!="object")throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=r,this.comments=i||{},this.valuesOptions=s,this.reserved=void 0,e)for(var o=Object.keys(e),a=0;a<o.length;++a)typeof e[o[a]]=="number"&&(this.valuesById[this.values[o[a]]=e[o[a]]]=o[a])}Yn.fromJSON=function(e,t){var r=new Yn(e,t.values,t.options,t.comment,t.comments);return r.reserved=t.reserved,r};Yn.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return Dd.toObject(["options",this.options,"valuesOptions",this.valuesOptions,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",t?this.comment:void 0,"comments",t?this.comments:void 0])};Yn.prototype.add=function(e,t,r,i){if(!Dd.isString(e))throw TypeError("name must be a string");if(!Dd.isInteger(t))throw TypeError("id must be an integer");if(this.values[e]!==void 0)throw Error("duplicate name '"+e+"' in "+this);if(this.isReservedId(t))throw Error("id "+t+" is reserved in "+this);if(this.isReservedName(e))throw Error("name '"+e+"' is reserved in "+this);if(this.valuesById[t]!==void 0){if(!(this.options&&this.options.allow_alias))throw Error("duplicate id "+t+" in "+this);this.values[e]=t}else this.valuesById[this.values[e]=t]=e;return i&&(this.valuesOptions===void 0&&(this.valuesOptions={}),this.valuesOptions[e]=i||null),this.comments[e]=r||null,this};Yn.prototype.remove=function(e){if(!Dd.isString(e))throw TypeError("name must be a string");var t=this.values[e];if(t==null)throw Error("name '"+e+"' does not exist in "+this);return delete this.valuesById[t],delete this.values[e],delete this.comments[e],this.valuesOptions&&delete this.valuesOptions[e],this};Yn.prototype.isReservedId=function(e){return tA.isReservedId(this.reserved,e)};Yn.prototype.isReservedName=function(e){return tA.isReservedName(this.reserved,e)}});var hy=E((HK,iA)=>{"use strict";iA.exports=i2;var r2=bn(),yy=Zi(),vy=rt();function rA(n,e,t,r){return e.resolvedType.group?n("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",t,r,(e.id<<3|3)>>>0,(e.id<<3|4)>>>0):n("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",t,r,(e.id<<3|2)>>>0)}function i2(n){for(var e=vy.codegen(["m","w"],n.name+"$encode")("if(!w)")("w=Writer.create()"),t,r,i=n.fieldsArray.slice().sort(vy.compareFieldsById),t=0;t<i.length;++t){var s=i[t].resolve(),o=n._fieldsArray.indexOf(s),a=s.resolvedType instanceof r2?"int32":s.type,l=yy.basic[a];r="m"+vy.safeProp(s.name),s.map?(e("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",r,s.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",r)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(s.id<<3|2)>>>0,8|yy.mapKey[s.keyType],s.keyType),l===void 0?e("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",o,r):e(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|l,a,r),e("}")("}")):s.repeated?(e("if(%s!=null&&%s.length){",r,r),s.packed&&yy.packed[a]!==void 0?e("w.uint32(%i).fork()",(s.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",r)("w.%s(%s[i])",a,r)("w.ldelim()"):(e("for(var i=0;i<%s.length;++i)",r),l===void 0?rA(e,s,o,r+"[i]"):e("w.uint32(%i).%s(%s[i])",(s.id<<3|l)>>>0,a,r)),e("}")):(s.optional&&e("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",r,s.name),l===void 0?rA(e,s,o,r):e("w.uint32(%i).%s(%s)",(s.id<<3|l)>>>0,a,r))}return e("return w")}});var oA=E((KK,sA)=>{"use strict";var se=sA.exports=pb();se.build="light";function s2(n,e,t){return typeof e=="function"?(t=e,e=new se.Root):e||(e=new se.Root),e.load(n,t)}se.load=s2;function o2(n,e){return e||(e=new se.Root),e.loadSync(n)}se.loadSync=o2;se.encoder=hy();se.decoder=ty();se.verifier=iy();se.converter=ay();se.ReflectionObject=es();se.Namespace=vo();se.Root=bd();se.Enum=bn();se.Type=wd();se.Field=Xr();se.OneOf=go();se.MapField=md();se.Service=vd();se.Method=yd();se.Message=Sd();se.wrappers=ly();se.types=Zi();se.util=rt();se.ReflectionObject._configure(se.Root);se.Namespace._configure(se.Type,se.Service,se.Enum);se.Root._configure(se.Type);se.Field._configure(se.Type)});var _y=E((WK,cA)=>{"use strict";cA.exports=lA;var Sy=/[\s{}=;:[\],'"()<>]/g,a2=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,l2=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,c2=/^ *[*/]+ */,u2=/^\s*\*?\/*/,d2=/\n/g,h2=/\s/,f2=/\\(.?)/g,p2={0:"\0",r:"\r",n:`
`,t:"	"};function aA(n){return n.replace(f2,function(e,t){switch(t){case"\\":case"":return t;default:return p2[t]||""}})}lA.unescape=aA;function lA(n,e){n=n.toString();var t=0,r=n.length,i=1,s=0,o={},a=[],l=null;function c(M){return Error("illegal "+M+" (line "+i+")")}function u(){var M=l==="'"?l2:a2;M.lastIndex=t-1;var z=M.exec(n);if(!z)throw c("string");return t=M.lastIndex,_(l),l=null,aA(z[1])}function d(M){return n.charAt(M)}function h(M,z,$){var te={type:n.charAt(M++),lineEmpty:!1,leading:$},Je;e?Je=2:Je=3;var ft=M-Je,Se;do if(--ft<0||(Se=n.charAt(ft))===`
`){te.lineEmpty=!0;break}while(Se===" "||Se==="	");for(var b=n.substring(M,z).split(d2),Me=0;Me<b.length;++Me)b[Me]=b[Me].replace(e?u2:c2,"").trim();te.text=b.join(`
`).trim(),o[i]=te,s=i}function p(M){var z=y(M),$=n.substring(M,z),te=/^\s*\/\//.test($);return te}function y(M){for(var z=M;z<r&&d(z)!==`
`;)z++;return z}function S(){if(a.length>0)return a.shift();if(l)return u();var M,z,$,te,Je,ft=t===0;do{if(t===r)return null;for(M=!1;h2.test($=d(t));)if($===`
`&&(ft=!0,++i),++t===r)return null;if(d(t)==="/"){if(++t===r)throw c("comment");if(d(t)==="/")if(e){if(te=t,Je=!1,p(t-1)){Je=!0;do if(t=y(t),t===r||(t++,!ft))break;while(p(t))}else t=Math.min(r,y(t)+1);Je&&(h(te,t,ft),ft=!0),i++,M=!0}else{for(Je=d(te=t+1)==="/";d(++t)!==`
`;)if(t===r)return null;++t,Je&&(h(te,t-1,ft),ft=!0),++i,M=!0}else if(($=d(t))==="*"){te=t+1,Je=e||d(te)==="*";do{if($===`
`&&++i,++t===r)throw c("comment");z=$,$=d(t)}while(z!=="*"||$!=="/");++t,Je&&(h(te,t-2,ft),ft=!0),M=!0}else return"/"}}while(M);var Se=t;Sy.lastIndex=0;var b=Sy.test(d(Se++));if(!b)for(;Se<r&&!Sy.test(d(Se));)++Se;var Me=n.substring(t,t=Se);return(Me==='"'||Me==="'")&&(l=Me),Me}function _(M){a.push(M)}function k(){if(!a.length){var M=S();if(M===null)return null;_(M)}return a[0]}function w(M,z){var $=k(),te=$===M;if(te)return S(),!0;if(!z)throw c("token '"+$+"', '"+M+"' expected");return!1}function x(M){var z=null,$;return M===void 0?($=o[i-1],delete o[i-1],$&&(e||$.type==="*"||$.lineEmpty)&&(z=$.leading?$.text:null)):(s<M&&k(),$=o[M],delete o[M],$&&!$.lineEmpty&&(e||$.type==="/")&&(z=$.leading?null:$.text)),z}return Object.defineProperty({next:S,peek:k,push:_,skip:w,cmnt:x},"line",{get:function(){return i}})}});var gA=E(($K,pA)=>{"use strict";pA.exports=Sr;Sr.filename=null;Sr.defaults={keepCase:!1};var g2=_y(),uA=bd(),dA=wd(),hA=Xr(),m2=md(),fA=go(),y2=bn(),v2=vd(),S2=yd(),Ey=Zi(),wy=rt(),_2=/^[1-9][0-9]*$/,E2=/^-?[1-9][0-9]*$/,w2=/^0[x][0-9a-fA-F]+$/,T2=/^-?0[x][0-9a-fA-F]+$/,C2=/^0[0-7]+$/,b2=/^-?0[0-7]+$/,A2=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/,Xn=/^[a-zA-Z_][a-zA-Z_0-9]*$/,Jn=/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/,I2=/^(?:\.[a-zA-Z_][a-zA-Z_0-9]*)+$/;function Sr(n,e,t){e instanceof uA||(t=e,e=new uA),t||(t=Sr.defaults);var r=t.preferTrailingComment||!1,i=g2(n,t.alternateCommentMode||!1),s=i.next,o=i.push,a=i.peek,l=i.skip,c=i.cmnt,u=!0,d,h,p,y,S=!1,_=e,k=t.keepCase?function(I){return I}:wy.camelCase;function w(I,D,O){var W=Sr.filename;return O||(Sr.filename=null),Error("illegal "+(D||"token")+" '"+I+"' ("+(W?W+", ":"")+"line "+i.line+")")}function x(){var I=[],D;do{if((D=s())!=='"'&&D!=="'")throw w(D);I.push(s()),l(D),D=a()}while(D==='"'||D==="'");return I.join("")}function M(I){var D=s();switch(D){case"'":case'"':return o(D),x();case"true":case"TRUE":return!0;case"false":case"FALSE":return!1}try{return $(D,!0)}catch{if(I&&Jn.test(D))return D;throw w(D,"value")}}function z(I,D){var O,W;do D&&((O=a())==='"'||O==="'")?I.push(x()):I.push([W=te(s()),l("to",!0)?te(s()):W]);while(l(",",!0));l(";")}function $(I,D){var O=1;switch(I.charAt(0)==="-"&&(O=-1,I=I.substring(1)),I){case"inf":case"INF":case"Inf":return O*(1/0);case"nan":case"NAN":case"Nan":case"NaN":return NaN;case"0":return 0}if(_2.test(I))return O*parseInt(I,10);if(w2.test(I))return O*parseInt(I,16);if(C2.test(I))return O*parseInt(I,8);if(A2.test(I))return O*parseFloat(I);throw w(I,"number",D)}function te(I,D){switch(I){case"max":case"MAX":case"Max":return 536870911;case"0":return 0}if(!D&&I.charAt(0)==="-")throw w(I,"id");if(E2.test(I))return parseInt(I,10);if(T2.test(I))return parseInt(I,16);if(b2.test(I))return parseInt(I,8);throw w(I,"id")}function Je(){if(d!==void 0)throw w("package");if(d=s(),!Jn.test(d))throw w(d,"name");_=_.define(d),l(";")}function ft(){var I=a(),D;switch(I){case"weak":D=p||(p=[]),s();break;case"public":s();default:D=h||(h=[]);break}I=x(),l(";"),D.push(I)}function Se(){if(l("="),y=x(),S=y==="proto3",!S&&y!=="proto2")throw w(y,"syntax");l(";")}function b(I,D){switch(D){case"option":return Te(I,D),l(";"),!0;case"message":return A(I,D),!0;case"enum":return ge(I,D),!0;case"service":return We(I,D),!0;case"extend":return Bs(I,D),!0}return!1}function Me(I,D,O){var W=i.line;if(I&&(typeof I.comment!="string"&&(I.comment=c()),I.filename=Sr.filename),l("{",!0)){for(var H;(H=s())!=="}";)D(H);l(";",!0)}else O&&O(),l(";"),I&&(typeof I.comment!="string"||r)&&(I.comment=c(W)||I.comment)}function A(I,D){if(!Xn.test(D=s()))throw w(D,"type name");var O=new dA(D);Me(O,function(H){if(!b(O,H))switch(H){case"map":ae(O,H);break;case"required":case"repeated":f(O,H);break;case"optional":S?f(O,"proto3_optional"):f(O,"optional");break;case"oneof":Ae(O,H);break;case"extensions":z(O.extensions||(O.extensions=[]));break;case"reserved":z(O.reserved||(O.reserved=[]),!0);break;default:if(!S||!Jn.test(H))throw w(H);o(H),f(O,"optional");break}}),I.add(O)}function f(I,D,O){var W=s();if(W==="group"){B(I,D);return}for(;W.endsWith(".")||a().startsWith(".");)W+=s();if(!Jn.test(W))throw w(W,"type");var H=s();if(!Xn.test(H))throw w(H,"name");H=k(H),l("=");var ne=new hA(H,te(s()),W,D,O);if(Me(ne,function(Ht){if(Ht==="option")Te(ne,Ht),l(";");else throw w(Ht)},function(){pt(ne)}),D==="proto3_optional"){var lt=new fA("_"+H);ne.setOption("proto3_optional",!0),lt.add(ne),I.add(lt)}else I.add(ne);!S&&ne.repeated&&(Ey.packed[W]!==void 0||Ey.basic[W]===void 0)&&ne.setOption("packed",!1,!0)}function B(I,D){var O=s();if(!Xn.test(O))throw w(O,"name");var W=wy.lcFirst(O);O===W&&(O=wy.ucFirst(O)),l("=");var H=te(s()),ne=new dA(O);ne.group=!0;var lt=new hA(W,H,O,D);lt.filename=Sr.filename,Me(ne,function(Ht){switch(Ht){case"option":Te(ne,Ht),l(";");break;case"required":case"repeated":f(ne,Ht);break;case"optional":S?f(ne,"proto3_optional"):f(ne,"optional");break;case"message":A(ne,Ht);break;case"enum":ge(ne,Ht);break;default:throw w(Ht)}}),I.add(ne).add(lt)}function ae(I){l("<");var D=s();if(Ey.mapKey[D]===void 0)throw w(D,"type");l(",");var O=s();if(!Jn.test(O))throw w(O,"type");l(">");var W=s();if(!Xn.test(W))throw w(W,"name");l("=");var H=new m2(k(W),te(s()),D,O);Me(H,function(lt){if(lt==="option")Te(H,lt),l(";");else throw w(lt)},function(){pt(H)}),I.add(H)}function Ae(I,D){if(!Xn.test(D=s()))throw w(D,"name");var O=new fA(k(D));Me(O,function(H){H==="option"?(Te(O,H),l(";")):(o(H),f(O,"optional"))}),I.add(O)}function ge(I,D){if(!Xn.test(D=s()))throw w(D,"name");var O=new y2(D);Me(O,function(H){switch(H){case"option":Te(O,H),l(";");break;case"reserved":z(O.reserved||(O.reserved=[]),!0);break;default:Ve(O,H)}}),I.add(O)}function Ve(I,D){if(!Xn.test(D))throw w(D,"name");l("=");var O=te(s(),!0),W={options:void 0};W.setOption=function(H,ne){this.options===void 0&&(this.options={}),this.options[H]=ne},Me(W,function(ne){if(ne==="option")Te(W,ne),l(";");else throw w(ne)},function(){pt(W)}),I.add(D,O,W.comment,W.options)}function Te(I,D){var O=l("(",!0);if(!Jn.test(D=s()))throw w(D,"name");var W=D,H=W,ne;O&&(l(")"),W="("+W+")",H=W,D=a(),I2.test(D)&&(ne=D.slice(1),W+=D,s())),l("=");var lt=Ct(I,W);Oe(I,H,lt,ne)}function Ct(I,D){if(l("{",!0)){for(var O={};!l("}",!0);){if(!Xn.test(gt=s()))throw w(gt,"name");if(gt===null)throw w(gt,"end of input");var W,H=gt;if(l(":",!0),a()==="{")W=Ct(I,D+"."+gt);else if(a()==="["){W=[];var ne;if(l("[",!0)){do ne=M(!0),W.push(ne);while(l(",",!0));l("]"),typeof ne<"u"&&Ke(I,D+"."+gt,ne)}}else W=M(!0),Ke(I,D+"."+gt,W);var lt=O[H];lt&&(W=[].concat(lt).concat(W)),O[H]=W,l(",",!0),l(";",!0)}return O}var Mr=M(!0);return Ke(I,D,Mr),Mr}function Ke(I,D,O){I.setOption&&I.setOption(D,O)}function Oe(I,D,O,W){I.setParsedOption&&I.setParsedOption(D,O,W)}function pt(I){if(l("[",!0)){do Te(I,"option");while(l(",",!0));l("]")}return I}function We(I,D){if(!Xn.test(D=s()))throw w(D,"service name");var O=new v2(D);Me(O,function(H){if(!b(O,H))if(H==="rpc")bt(O,H);else throw w(H)}),I.add(O)}function bt(I,D){var O=c(),W=D;if(!Xn.test(D=s()))throw w(D,"name");var H=D,ne,lt,Mr,Ht;if(l("("),l("stream",!0)&&(lt=!0),!Jn.test(D=s())||(ne=D,l(")"),l("returns"),l("("),l("stream",!0)&&(Ht=!0),!Jn.test(D=s())))throw w(D);Mr=D,l(")");var Qc=new S2(H,W,ne,Mr,lt,Ht);Qc.comment=O,Me(Qc,function(Sp){if(Sp==="option")Te(Qc,Sp),l(";");else throw w(Sp)}),I.add(Qc)}function Bs(I,D){if(!Jn.test(D=s()))throw w(D,"reference");var O=D;Me(null,function(H){switch(H){case"required":case"repeated":f(I,H,O);break;case"optional":S?f(I,"proto3_optional",O):f(I,"optional",O);break;default:if(!S||!Jn.test(H))throw w(H);o(H),f(I,"optional",O);break}})}for(var gt;(gt=s())!==null;)switch(gt){case"package":if(!u)throw w(gt);Je();break;case"import":if(!u)throw w(gt);ft();break;case"syntax":if(!u)throw w(gt);Se();break;case"option":Te(_,gt),l(";");break;default:if(b(_,gt)){u=!1;continue}throw w(gt)}return Sr.filename=null,{package:d,imports:h,weakImports:p,syntax:y,root:e}}});var vA=E((QK,yA)=>{"use strict";yA.exports=In;var D2=/\/|\./;function In(n,e){D2.test(n)||(n="google/protobuf/"+n+".proto",e={nested:{google:{nested:{protobuf:{nested:e}}}}}),In[n]=e}In("any",{Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}}});var mA;In("duration",{Duration:mA={fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}});In("timestamp",{Timestamp:mA});In("empty",{Empty:{fields:{}}});In("struct",{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}}});In("wrappers",{DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}}});In("field_mask",{FieldMask:{fields:{paths:{rule:"repeated",type:"string",id:1}}}});In.get=function(e){return In[e]||null}});var _A=E((YK,SA)=>{"use strict";var ei=SA.exports=oA();ei.build="full";ei.tokenize=_y();ei.parse=gA();ei.common=vA();ei.Root._configure(ei.Type,ei.parse,ei.common)});var Rd=E((XK,EA)=>{"use strict";EA.exports=_A()});var Ty=E((JK,R2)=>{R2.exports={nested:{google:{nested:{protobuf:{nested:{FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[8,8]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}}}}}}}}});var AA=E((ee,bA)=>{"use strict";var xt=Rd();bA.exports=ee=xt.descriptor=xt.Root.fromJSON(Ty()).lookup(".google.protobuf");var wA=xt.Namespace,Il=xt.Root,_r=xt.Enum,ti=xt.Type,ni=xt.Field,k2=xt.MapField,kd=xt.OneOf,Dl=xt.Service,Nd=xt.Method;Il.fromDescriptor=function(e){typeof e.length=="number"&&(e=ee.FileDescriptorSet.decode(e));var t=new Il;if(e.file)for(var r,i,s=0,o;s<e.file.length;++s){if(i=t,(r=e.file[s]).package&&r.package.length&&(i=t.define(r.package)),r.name&&r.name.length&&t.files.push(i.filename=r.name),r.messageType)for(o=0;o<r.messageType.length;++o)i.add(ti.fromDescriptor(r.messageType[o],r.syntax));if(r.enumType)for(o=0;o<r.enumType.length;++o)i.add(_r.fromDescriptor(r.enumType[o]));if(r.extension)for(o=0;o<r.extension.length;++o)i.add(ni.fromDescriptor(r.extension[o]));if(r.service)for(o=0;o<r.service.length;++o)i.add(Dl.fromDescriptor(r.service[o]));var a=_o(r.options,ee.FileOptions);if(a){var l=Object.keys(a);for(o=0;o<l.length;++o)i.setOption(l[o],a[l[o]])}}return t};Il.prototype.toDescriptor=function(e){var t=ee.FileDescriptorSet.create();return TA(this,t.file,e),t};function TA(n,e,t){var r=ee.FileDescriptorProto.create({name:n.filename||(n.fullName.substring(1).replace(/\./g,"_")||"root")+".proto"});t&&(r.syntax=t),n instanceof Il||(r.package=n.fullName.substring(1));for(var i=0,s;i<n.nestedArray.length;++i)(s=n._nestedArray[i])instanceof ti?r.messageType.push(s.toDescriptor(t)):s instanceof _r?r.enumType.push(s.toDescriptor()):s instanceof ni?r.extension.push(s.toDescriptor(t)):s instanceof Dl?r.service.push(s.toDescriptor()):s instanceof wA&&TA(s,e,t);r.options=Eo(n.options,ee.FileOptions),r.messageType.length+r.enumType.length+r.extension.length+r.service.length&&e.push(r)}var N2=0;ti.fromDescriptor=function(e,t){typeof e.length=="number"&&(e=ee.DescriptorProto.decode(e));var r=new ti(e.name.length?e.name:"Type"+N2++,_o(e.options,ee.MessageOptions)),i;if(e.oneofDecl)for(i=0;i<e.oneofDecl.length;++i)r.add(kd.fromDescriptor(e.oneofDecl[i]));if(e.field)for(i=0;i<e.field.length;++i){var s=ni.fromDescriptor(e.field[i],t);r.add(s),e.field[i].hasOwnProperty("oneofIndex")&&r.oneofsArray[e.field[i].oneofIndex].add(s)}if(e.extension)for(i=0;i<e.extension.length;++i)r.add(ni.fromDescriptor(e.extension[i],t));if(e.nestedType)for(i=0;i<e.nestedType.length;++i)r.add(ti.fromDescriptor(e.nestedType[i],t)),e.nestedType[i].options&&e.nestedType[i].options.mapEntry&&r.setOption("map_entry",!0);if(e.enumType)for(i=0;i<e.enumType.length;++i)r.add(_r.fromDescriptor(e.enumType[i]));if(e.extensionRange&&e.extensionRange.length)for(r.extensions=[],i=0;i<e.extensionRange.length;++i)r.extensions.push([e.extensionRange[i].start,e.extensionRange[i].end]);if(e.reservedRange&&e.reservedRange.length||e.reservedName&&e.reservedName.length){if(r.reserved=[],e.reservedRange)for(i=0;i<e.reservedRange.length;++i)r.reserved.push([e.reservedRange[i].start,e.reservedRange[i].end]);if(e.reservedName)for(i=0;i<e.reservedName.length;++i)r.reserved.push(e.reservedName[i])}return r};ti.prototype.toDescriptor=function(e){var t=ee.DescriptorProto.create({name:this.name}),r;for(r=0;r<this.fieldsArray.length;++r){var i;if(t.field.push(i=this._fieldsArray[r].toDescriptor(e)),this._fieldsArray[r]instanceof k2){var s=Cy(this._fieldsArray[r].keyType,this._fieldsArray[r].resolvedKeyType),o=Cy(this._fieldsArray[r].type,this._fieldsArray[r].resolvedType),a=o===11||o===14?this._fieldsArray[r].resolvedType&&CA(this.parent,this._fieldsArray[r].resolvedType)||this._fieldsArray[r].type:void 0;t.nestedType.push(ee.DescriptorProto.create({name:i.typeName,field:[ee.FieldDescriptorProto.create({name:"key",number:1,label:1,type:s}),ee.FieldDescriptorProto.create({name:"value",number:2,label:1,type:o,typeName:a})],options:ee.MessageOptions.create({mapEntry:!0})}))}}for(r=0;r<this.oneofsArray.length;++r)t.oneofDecl.push(this._oneofsArray[r].toDescriptor());for(r=0;r<this.nestedArray.length;++r)this._nestedArray[r]instanceof ni?t.field.push(this._nestedArray[r].toDescriptor(e)):this._nestedArray[r]instanceof ti?t.nestedType.push(this._nestedArray[r].toDescriptor(e)):this._nestedArray[r]instanceof _r&&t.enumType.push(this._nestedArray[r].toDescriptor());if(this.extensions)for(r=0;r<this.extensions.length;++r)t.extensionRange.push(ee.DescriptorProto.ExtensionRange.create({start:this.extensions[r][0],end:this.extensions[r][1]}));if(this.reserved)for(r=0;r<this.reserved.length;++r)typeof this.reserved[r]=="string"?t.reservedName.push(this.reserved[r]):t.reservedRange.push(ee.DescriptorProto.ReservedRange.create({start:this.reserved[r][0],end:this.reserved[r][1]}));return t.options=Eo(this.options,ee.MessageOptions),t};var x2=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/;ni.fromDescriptor=function(e,t){if(typeof e.length=="number"&&(e=ee.DescriptorProto.decode(e)),typeof e.number!="number")throw Error("missing field id");var r;e.typeName&&e.typeName.length?r=e.typeName:r=L2(e.type);var i;switch(e.label){case 1:i=void 0;break;case 2:i="required";break;case 3:i="repeated";break;default:throw Error("illegal label: "+e.label)}var s=e.extendee;e.extendee!==void 0&&(s=s.length?s:void 0);var o=new ni(e.name.length?e.name:"field"+e.number,e.number,r,i,s);if(o.options=_o(e.options,ee.FieldOptions),e.defaultValue&&e.defaultValue.length){var a=e.defaultValue;switch(a){case"true":case"TRUE":a=!0;break;case"false":case"FALSE":a=!1;break;default:var l=x2.exec(a);l&&(a=parseInt(a));break}o.setOption("default",a)}return B2(e.type)&&(t==="proto3"?e.options&&!e.options.packed&&o.setOption("packed",!1):e.options&&e.options.packed||o.setOption("packed",!1)),o};ni.prototype.toDescriptor=function(e){var t=ee.FieldDescriptorProto.create({name:this.name,number:this.id});if(this.map)t.type=11,t.typeName=xt.util.ucFirst(this.name),t.label=3;else{switch(t.type=Cy(this.type,this.resolve().resolvedType)){case 10:case 11:case 14:t.typeName=this.resolvedType?CA(this.parent,this.resolvedType):this.type;break}switch(this.rule){case"repeated":t.label=3;break;case"required":t.label=2;break;default:t.label=1;break}}if(t.extendee=this.extensionField?this.extensionField.parent.fullName:this.extend,this.partOf&&(t.oneofIndex=this.parent.oneofsArray.indexOf(this.partOf))<0)throw Error("missing oneof");return this.options&&(t.options=Eo(this.options,ee.FieldOptions),this.options.default!=null&&(t.defaultValue=String(this.options.default))),e==="proto3"?this.packed||((t.options||(t.options=ee.FieldOptions.create())).packed=!1):this.packed&&((t.options||(t.options=ee.FieldOptions.create())).packed=!0),t};var M2=0;_r.fromDescriptor=function(e){typeof e.length=="number"&&(e=ee.EnumDescriptorProto.decode(e));var t={};if(e.value)for(var r=0;r<e.value.length;++r){var i=e.value[r].name,s=e.value[r].number||0;t[i&&i.length?i:"NAME"+s]=s}return new _r(e.name&&e.name.length?e.name:"Enum"+M2++,t,_o(e.options,ee.EnumOptions))};_r.prototype.toDescriptor=function(){for(var e=[],t=0,r=Object.keys(this.values);t<r.length;++t)e.push(ee.EnumValueDescriptorProto.create({name:r[t],number:this.values[r[t]]}));return ee.EnumDescriptorProto.create({name:this.name,value:e,options:Eo(this.options,ee.EnumOptions)})};var O2=0;kd.fromDescriptor=function(e){return typeof e.length=="number"&&(e=ee.OneofDescriptorProto.decode(e)),new kd(e.name&&e.name.length?e.name:"oneof"+O2++)};kd.prototype.toDescriptor=function(){return ee.OneofDescriptorProto.create({name:this.name})};var P2=0;Dl.fromDescriptor=function(e){typeof e.length=="number"&&(e=ee.ServiceDescriptorProto.decode(e));var t=new Dl(e.name&&e.name.length?e.name:"Service"+P2++,_o(e.options,ee.ServiceOptions));if(e.method)for(var r=0;r<e.method.length;++r)t.add(Nd.fromDescriptor(e.method[r]));return t};Dl.prototype.toDescriptor=function(){for(var e=[],t=0;t<this.methodsArray.length;++t)e.push(this._methodsArray[t].toDescriptor());return ee.ServiceDescriptorProto.create({name:this.name,method:e,options:Eo(this.options,ee.ServiceOptions)})};var F2=0;Nd.fromDescriptor=function(e){return typeof e.length=="number"&&(e=ee.MethodDescriptorProto.decode(e)),new Nd(e.name&&e.name.length?e.name:"Method"+F2++,"rpc",e.inputType,e.outputType,!!e.clientStreaming,!!e.serverStreaming,_o(e.options,ee.MethodOptions))};Nd.prototype.toDescriptor=function(){return ee.MethodDescriptorProto.create({name:this.name,inputType:this.resolvedRequestType?this.resolvedRequestType.fullName:this.requestType,outputType:this.resolvedResponseType?this.resolvedResponseType.fullName:this.responseType,clientStreaming:this.requestStream,serverStreaming:this.responseStream,options:Eo(this.options,ee.MethodOptions)})};function L2(n){switch(n){case 1:return"double";case 2:return"float";case 3:return"int64";case 4:return"uint64";case 5:return"int32";case 6:return"fixed64";case 7:return"fixed32";case 8:return"bool";case 9:return"string";case 12:return"bytes";case 13:return"uint32";case 15:return"sfixed32";case 16:return"sfixed64";case 17:return"sint32";case 18:return"sint64"}throw Error("illegal type: "+n)}function B2(n){switch(n){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 13:case 14:case 15:case 16:case 17:case 18:return!0}return!1}function Cy(n,e){switch(n){case"double":return 1;case"float":return 2;case"int64":return 3;case"uint64":return 4;case"int32":return 5;case"fixed64":return 6;case"fixed32":return 7;case"bool":return 8;case"string":return 9;case"bytes":return 12;case"uint32":return 13;case"sfixed32":return 15;case"sfixed64":return 16;case"sint32":return 17;case"sint64":return 18}if(e instanceof _r)return 14;if(e instanceof ti)return e.group?10:11;throw Error("illegal type: "+n)}function _o(n,e){if(n){for(var t=[],r=0,i,s,o;r<e.fieldsArray.length;++r)(s=(i=e._fieldsArray[r]).name)!=="uninterpretedOption"&&n.hasOwnProperty(s)&&(o=n[s],i.resolvedType instanceof _r&&typeof o=="number"&&i.resolvedType.valuesById[o]!==void 0&&(o=i.resolvedType.valuesById[o]),t.push(V2(s),o));return t.length?xt.util.toObject(t):void 0}}function Eo(n,e){if(n){for(var t=[],r=0,i=Object.keys(n),s,o;r<i.length;++r)if(o=n[s=i[r]],s!=="default"){var a=e.fields[s];!a&&!(a=e.fields[s=xt.util.camelCase(s)])||t.push(s,o)}return t.length?e.fromObject(xt.util.toObject(t)):void 0}}function CA(n,e){var t=n.fullName.split("."),r=e.fullName.split("."),i=0,s=0,o=r.length-1;if(!(n instanceof Il)&&e instanceof wA)for(;i<t.length&&s<o&&t[i]===r[s];){var a=e.lookup(t[i++],!0);if(a!==null&&a!==e)break;++s}else for(;i<t.length&&s<o&&t[i]===r[s];++i,++s);return r.slice(s).join(".")}function V2(n){return n.substring(0,1)+n.substring(1).replace(/([A-Z])(?=[a-z]|$)/g,function(e,t){return"_"+t.toLowerCase()})}});var IA=E((ZK,q2)=>{q2.exports={nested:{google:{nested:{protobuf:{nested:{Api:{fields:{name:{type:"string",id:1},methods:{rule:"repeated",type:"Method",id:2},options:{rule:"repeated",type:"Option",id:3},version:{type:"string",id:4},sourceContext:{type:"SourceContext",id:5},mixins:{rule:"repeated",type:"Mixin",id:6},syntax:{type:"Syntax",id:7}}},Method:{fields:{name:{type:"string",id:1},requestTypeUrl:{type:"string",id:2},requestStreaming:{type:"bool",id:3},responseTypeUrl:{type:"string",id:4},responseStreaming:{type:"bool",id:5},options:{rule:"repeated",type:"Option",id:6},syntax:{type:"Syntax",id:7}}},Mixin:{fields:{name:{type:"string",id:1},root:{type:"string",id:2}}},SourceContext:{fields:{fileName:{type:"string",id:1}}},Option:{fields:{name:{type:"string",id:1},value:{type:"Any",id:2}}},Syntax:{values:{SYNTAX_PROTO2:0,SYNTAX_PROTO3:1}}}}}}}}});var DA=E((eW,U2)=>{U2.exports={nested:{google:{nested:{protobuf:{nested:{SourceContext:{fields:{fileName:{type:"string",id:1}}}}}}}}}});var RA=E((tW,z2)=>{z2.exports={nested:{google:{nested:{protobuf:{nested:{Type:{fields:{name:{type:"string",id:1},fields:{rule:"repeated",type:"Field",id:2},oneofs:{rule:"repeated",type:"string",id:3},options:{rule:"repeated",type:"Option",id:4},sourceContext:{type:"SourceContext",id:5},syntax:{type:"Syntax",id:6}}},Field:{fields:{kind:{type:"Kind",id:1},cardinality:{type:"Cardinality",id:2},number:{type:"int32",id:3},name:{type:"string",id:4},typeUrl:{type:"string",id:6},oneofIndex:{type:"int32",id:7},packed:{type:"bool",id:8},options:{rule:"repeated",type:"Option",id:9},jsonName:{type:"string",id:10},defaultValue:{type:"string",id:11}},nested:{Kind:{values:{TYPE_UNKNOWN:0,TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Cardinality:{values:{CARDINALITY_UNKNOWN:0,CARDINALITY_OPTIONAL:1,CARDINALITY_REQUIRED:2,CARDINALITY_REPEATED:3}}}},Enum:{fields:{name:{type:"string",id:1},enumvalue:{rule:"repeated",type:"EnumValue",id:2},options:{rule:"repeated",type:"Option",id:3},sourceContext:{type:"SourceContext",id:4},syntax:{type:"Syntax",id:5}}},EnumValue:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{rule:"repeated",type:"Option",id:3}}},Option:{fields:{name:{type:"string",id:1},value:{type:"Any",id:2}}},Syntax:{values:{SYNTAX_PROTO2:0,SYNTAX_PROTO3:1}},Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}},SourceContext:{fields:{fileName:{type:"string",id:1}}}}}}}}}});var MA=E(ri=>{"use strict";Object.defineProperty(ri,"__esModule",{value:!0});ri.addCommonProtos=ri.loadProtosWithOptionsSync=ri.loadProtosWithOptions=void 0;var kA=he("fs"),NA=he("path"),wo=Rd();function xA(n,e){let t=n.resolvePath;n.resolvePath=(r,i)=>{if(NA.isAbsolute(i))return i;for(let s of e){let o=NA.join(s,i);try{return kA.accessSync(o,kA.constants.R_OK),o}catch{continue}}return process.emitWarning(`${i} not found in any of the include paths ${e}`),t(r,i)}}function j2(n,e){return g(this,null,function*(){let t=new wo.Root;if(e=e||{},e.includeDirs){if(!Array.isArray(e.includeDirs))return Promise.reject(new Error("The includeDirs option must be an array"));xA(t,e.includeDirs)}let r=yield t.load(n,e);return r.resolveAll(),r})}ri.loadProtosWithOptions=j2;function G2(n,e){let t=new wo.Root;if(e=e||{},e.includeDirs){if(!Array.isArray(e.includeDirs))throw new Error("The includeDirs option must be an array");xA(t,e.includeDirs)}let r=t.loadSync(n,e);return r.resolveAll(),r}ri.loadProtosWithOptionsSync=G2;function H2(){let n=IA(),e=Ty(),t=DA(),r=RA();wo.common("api",n.nested.google.nested.protobuf.nested),wo.common("descriptor",e.nested.google.nested.protobuf.nested),wo.common("source_context",t.nested.google.nested.protobuf.nested),wo.common("type",r.nested.google.nested.protobuf.nested)}ri.addCommonProtos=H2});var FA=E((PA,by)=>{"use strict";var OA=function(n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var e=null;try{e=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function t(A,f,B){this.low=A|0,this.high=f|0,this.unsigned=!!B}t.prototype.__isLong__,Object.defineProperty(t.prototype,"__isLong__",{value:!0});function r(A){return(A&&A.__isLong__)===!0}function i(A){var f=Math.clz32(A&-A);return A?31-f:f}t.isLong=r;var s={},o={};function a(A,f){var B,ae,Ae;return f?(A>>>=0,(Ae=0<=A&&A<256)&&(ae=o[A],ae)?ae:(B=c(A,0,!0),Ae&&(o[A]=B),B)):(A|=0,(Ae=-128<=A&&A<128)&&(ae=s[A],ae)?ae:(B=c(A,A<0?-1:0,!1),Ae&&(s[A]=B),B))}t.fromInt=a;function l(A,f){if(isNaN(A))return f?M:x;if(f){if(A<0)return M;if(A>=_)return ft}else{if(A<=-k)return Se;if(A+1>=k)return Je}return A<0?l(-A,f).neg():c(A%S|0,A/S|0,f)}t.fromNumber=l;function c(A,f,B){return new t(A,f,B)}t.fromBits=c;var u=Math.pow;function d(A,f,B){if(A.length===0)throw Error("empty string");if(typeof f=="number"?(B=f,f=!1):f=!!f,A==="NaN"||A==="Infinity"||A==="+Infinity"||A==="-Infinity")return f?M:x;if(B=B||10,B<2||36<B)throw RangeError("radix");var ae;if((ae=A.indexOf("-"))>0)throw Error("interior hyphen");if(ae===0)return d(A.substring(1),f,B).neg();for(var Ae=l(u(B,8)),ge=x,Ve=0;Ve<A.length;Ve+=8){var Te=Math.min(8,A.length-Ve),Ct=parseInt(A.substring(Ve,Ve+Te),B);if(Te<8){var Ke=l(u(B,Te));ge=ge.mul(Ke).add(l(Ct))}else ge=ge.mul(Ae),ge=ge.add(l(Ct))}return ge.unsigned=f,ge}t.fromString=d;function h(A,f){return typeof A=="number"?l(A,f):typeof A=="string"?d(A,f):c(A.low,A.high,typeof f=="boolean"?f:A.unsigned)}t.fromValue=h;var p=65536,y=1<<24,S=p*p,_=S*S,k=_/2,w=a(y),x=a(0);t.ZERO=x;var M=a(0,!0);t.UZERO=M;var z=a(1);t.ONE=z;var $=a(1,!0);t.UONE=$;var te=a(-1);t.NEG_ONE=te;var Je=c(-1,2147483647,!1);t.MAX_VALUE=Je;var ft=c(-1,-1,!0);t.MAX_UNSIGNED_VALUE=ft;var Se=c(0,-2147483648,!1);t.MIN_VALUE=Se;var b=t.prototype;b.toInt=function(){return this.unsigned?this.low>>>0:this.low},b.toNumber=function(){return this.unsigned?(this.high>>>0)*S+(this.low>>>0):this.high*S+(this.low>>>0)},b.toString=function(f){if(f=f||10,f<2||36<f)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Se)){var B=l(f),ae=this.div(B),Ae=ae.mul(B).sub(this);return ae.toString(f)+Ae.toInt().toString(f)}else return"-"+this.neg().toString(f);for(var ge=l(u(f,6),this.unsigned),Ve=this,Te="";;){var Ct=Ve.div(ge),Ke=Ve.sub(Ct.mul(ge)).toInt()>>>0,Oe=Ke.toString(f);if(Ve=Ct,Ve.isZero())return Oe+Te;for(;Oe.length<6;)Oe="0"+Oe;Te=""+Oe+Te}},b.getHighBits=function(){return this.high},b.getHighBitsUnsigned=function(){return this.high>>>0},b.getLowBits=function(){return this.low},b.getLowBitsUnsigned=function(){return this.low>>>0},b.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Se)?64:this.neg().getNumBitsAbs();for(var f=this.high!=0?this.high:this.low,B=31;B>0&&!(f&1<<B);B--);return this.high!=0?B+33:B+1},b.isZero=function(){return this.high===0&&this.low===0},b.eqz=b.isZero,b.isNegative=function(){return!this.unsigned&&this.high<0},b.isPositive=function(){return this.unsigned||this.high>=0},b.isOdd=function(){return(this.low&1)===1},b.isEven=function(){return(this.low&1)===0},b.equals=function(f){return r(f)||(f=h(f)),this.unsigned!==f.unsigned&&this.high>>>31===1&&f.high>>>31===1?!1:this.high===f.high&&this.low===f.low},b.eq=b.equals,b.notEquals=function(f){return!this.eq(f)},b.neq=b.notEquals,b.ne=b.notEquals,b.lessThan=function(f){return this.comp(f)<0},b.lt=b.lessThan,b.lessThanOrEqual=function(f){return this.comp(f)<=0},b.lte=b.lessThanOrEqual,b.le=b.lessThanOrEqual,b.greaterThan=function(f){return this.comp(f)>0},b.gt=b.greaterThan,b.greaterThanOrEqual=function(f){return this.comp(f)>=0},b.gte=b.greaterThanOrEqual,b.ge=b.greaterThanOrEqual,b.compare=function(f){if(r(f)||(f=h(f)),this.eq(f))return 0;var B=this.isNegative(),ae=f.isNegative();return B&&!ae?-1:!B&&ae?1:this.unsigned?f.high>>>0>this.high>>>0||f.high===this.high&&f.low>>>0>this.low>>>0?-1:1:this.sub(f).isNegative()?-1:1},b.comp=b.compare,b.negate=function(){return!this.unsigned&&this.eq(Se)?Se:this.not().add(z)},b.neg=b.negate,b.add=function(f){r(f)||(f=h(f));var B=this.high>>>16,ae=this.high&65535,Ae=this.low>>>16,ge=this.low&65535,Ve=f.high>>>16,Te=f.high&65535,Ct=f.low>>>16,Ke=f.low&65535,Oe=0,pt=0,We=0,bt=0;return bt+=ge+Ke,We+=bt>>>16,bt&=65535,We+=Ae+Ct,pt+=We>>>16,We&=65535,pt+=ae+Te,Oe+=pt>>>16,pt&=65535,Oe+=B+Ve,Oe&=65535,c(We<<16|bt,Oe<<16|pt,this.unsigned)},b.subtract=function(f){return r(f)||(f=h(f)),this.add(f.neg())},b.sub=b.subtract,b.multiply=function(f){if(this.isZero())return this;if(r(f)||(f=h(f)),e){var B=e.mul(this.low,this.high,f.low,f.high);return c(B,e.get_high(),this.unsigned)}if(f.isZero())return this.unsigned?M:x;if(this.eq(Se))return f.isOdd()?Se:x;if(f.eq(Se))return this.isOdd()?Se:x;if(this.isNegative())return f.isNegative()?this.neg().mul(f.neg()):this.neg().mul(f).neg();if(f.isNegative())return this.mul(f.neg()).neg();if(this.lt(w)&&f.lt(w))return l(this.toNumber()*f.toNumber(),this.unsigned);var ae=this.high>>>16,Ae=this.high&65535,ge=this.low>>>16,Ve=this.low&65535,Te=f.high>>>16,Ct=f.high&65535,Ke=f.low>>>16,Oe=f.low&65535,pt=0,We=0,bt=0,Bs=0;return Bs+=Ve*Oe,bt+=Bs>>>16,Bs&=65535,bt+=ge*Oe,We+=bt>>>16,bt&=65535,bt+=Ve*Ke,We+=bt>>>16,bt&=65535,We+=Ae*Oe,pt+=We>>>16,We&=65535,We+=ge*Ke,pt+=We>>>16,We&=65535,We+=Ve*Ct,pt+=We>>>16,We&=65535,pt+=ae*Oe+Ae*Ke+ge*Ct+Ve*Te,pt&=65535,c(bt<<16|Bs,pt<<16|We,this.unsigned)},b.mul=b.multiply,b.divide=function(f){if(r(f)||(f=h(f)),f.isZero())throw Error("division by zero");if(e){if(!this.unsigned&&this.high===-2147483648&&f.low===-1&&f.high===-1)return this;var B=(this.unsigned?e.div_u:e.div_s)(this.low,this.high,f.low,f.high);return c(B,e.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?M:x;var ae,Ae,ge;if(this.unsigned){if(f.unsigned||(f=f.toUnsigned()),f.gt(this))return M;if(f.gt(this.shru(1)))return $;ge=M}else{if(this.eq(Se)){if(f.eq(z)||f.eq(te))return Se;if(f.eq(Se))return z;var Ve=this.shr(1);return ae=Ve.div(f).shl(1),ae.eq(x)?f.isNegative()?z:te:(Ae=this.sub(f.mul(ae)),ge=ae.add(Ae.div(f)),ge)}else if(f.eq(Se))return this.unsigned?M:x;if(this.isNegative())return f.isNegative()?this.neg().div(f.neg()):this.neg().div(f).neg();if(f.isNegative())return this.div(f.neg()).neg();ge=x}for(Ae=this;Ae.gte(f);){ae=Math.max(1,Math.floor(Ae.toNumber()/f.toNumber()));for(var Te=Math.ceil(Math.log(ae)/Math.LN2),Ct=Te<=48?1:u(2,Te-48),Ke=l(ae),Oe=Ke.mul(f);Oe.isNegative()||Oe.gt(Ae);)ae-=Ct,Ke=l(ae,this.unsigned),Oe=Ke.mul(f);Ke.isZero()&&(Ke=z),ge=ge.add(Ke),Ae=Ae.sub(Oe)}return ge},b.div=b.divide,b.modulo=function(f){if(r(f)||(f=h(f)),e){var B=(this.unsigned?e.rem_u:e.rem_s)(this.low,this.high,f.low,f.high);return c(B,e.get_high(),this.unsigned)}return this.sub(this.div(f).mul(f))},b.mod=b.modulo,b.rem=b.modulo,b.not=function(){return c(~this.low,~this.high,this.unsigned)},b.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},b.clz=b.countLeadingZeros,b.countTrailingZeros=function(){return this.low?i(this.low):i(this.high)+32},b.ctz=b.countTrailingZeros,b.and=function(f){return r(f)||(f=h(f)),c(this.low&f.low,this.high&f.high,this.unsigned)},b.or=function(f){return r(f)||(f=h(f)),c(this.low|f.low,this.high|f.high,this.unsigned)},b.xor=function(f){return r(f)||(f=h(f)),c(this.low^f.low,this.high^f.high,this.unsigned)},b.shiftLeft=function(f){return r(f)&&(f=f.toInt()),(f&=63)===0?this:f<32?c(this.low<<f,this.high<<f|this.low>>>32-f,this.unsigned):c(0,this.low<<f-32,this.unsigned)},b.shl=b.shiftLeft,b.shiftRight=function(f){return r(f)&&(f=f.toInt()),(f&=63)===0?this:f<32?c(this.low>>>f|this.high<<32-f,this.high>>f,this.unsigned):c(this.high>>f-32,this.high>=0?0:-1,this.unsigned)},b.shr=b.shiftRight,b.shiftRightUnsigned=function(f){return r(f)&&(f=f.toInt()),(f&=63)===0?this:f<32?c(this.low>>>f|this.high<<32-f,this.high>>>f,this.unsigned):f===32?c(this.high,0,this.unsigned):c(this.high>>>f-32,0,this.unsigned)},b.shru=b.shiftRightUnsigned,b.shr_u=b.shiftRightUnsigned,b.rotateLeft=function(f){var B;return r(f)&&(f=f.toInt()),(f&=63)===0?this:f===32?c(this.high,this.low,this.unsigned):f<32?(B=32-f,c(this.low<<f|this.high>>>B,this.high<<f|this.low>>>B,this.unsigned)):(f-=32,B=32-f,c(this.high<<f|this.low>>>B,this.low<<f|this.high>>>B,this.unsigned))},b.rotl=b.rotateLeft,b.rotateRight=function(f){var B;return r(f)&&(f=f.toInt()),(f&=63)===0?this:f===32?c(this.high,this.low,this.unsigned):f<32?(B=32-f,c(this.high<<B|this.low>>>f,this.low<<B|this.high>>>f,this.unsigned)):(f-=32,B=32-f,c(this.low<<B|this.high>>>f,this.high<<B|this.low>>>f,this.unsigned))},b.rotr=b.rotateRight,b.toSigned=function(){return this.unsigned?c(this.low,this.high,!1):this},b.toUnsigned=function(){return this.unsigned?this:c(this.low,this.high,!0)},b.toBytes=function(f){return f?this.toBytesLE():this.toBytesBE()},b.toBytesLE=function(){var f=this.high,B=this.low;return[B&255,B>>>8&255,B>>>16&255,B>>>24,f&255,f>>>8&255,f>>>16&255,f>>>24]},b.toBytesBE=function(){var f=this.high,B=this.low;return[f>>>24,f>>>16&255,f>>>8&255,f&255,B>>>24,B>>>16&255,B>>>8&255,B&255]},t.fromBytes=function(f,B,ae){return ae?t.fromBytesLE(f,B):t.fromBytesBE(f,B)},t.fromBytesLE=function(f,B){return new t(f[0]|f[1]<<8|f[2]<<16|f[3]<<24,f[4]|f[5]<<8|f[6]<<16|f[7]<<24,B)},t.fromBytesBE=function(f,B){return new t(f[4]<<24|f[5]<<16|f[6]<<8|f[7],f[0]<<24|f[1]<<16|f[2]<<8|f[3],B)};var Me=t;return n.default=Me,"default"in n?n.default:n}({});typeof define=="function"&&define.amd?define([],function(){return OA}):typeof by=="object"&&typeof PA=="object"&&(by.exports=OA)});var Ry=E(_t=>{"use strict";Object.defineProperty(_t,"__esModule",{value:!0});_t.loadFileDescriptorSetFromObject=_t.loadFileDescriptorSetFromBuffer=_t.fromJSON=_t.loadSync=_t.load=_t.isAnyExtension=_t.Long=void 0;var K2=TC(),Zn=Rd(),Iy=AA(),Dy=MA(),W2=FA();_t.Long=W2;function $2(n){return"@type"in n&&typeof n["@type"]=="string"}_t.isAnyExtension=$2;var VA={longs:String,enums:String,bytes:String,defaults:!0,oneofs:!0,json:!0};function Q2(n,e){return n===""?e:n+"."+e}function Y2(n){return n instanceof Zn.Service||n instanceof Zn.Type||n instanceof Zn.Enum}function X2(n){return n instanceof Zn.Namespace||n instanceof Zn.Root}function qA(n,e){let t=Q2(e,n.name);return Y2(n)?[[t,n]]:X2(n)&&typeof n.nested<"u"?Object.keys(n.nested).map(r=>qA(n.nested[r],t)).reduce((r,i)=>r.concat(i),[]):[]}function LA(n,e){return function(r){return n.toObject(n.decode(r),e)}}function BA(n){return function(t){if(Array.isArray(t))throw new Error(`Failed to serialize message: expected object with ${n.name} structure, got array instead`);let r=n.fromObject(t);return n.encode(r).finish()}}function J2(n,e,t,r){let i=n.resolvedRequestType,s=n.resolvedResponseType;return{path:"/"+e+"/"+n.name,requestStream:!!n.requestStream,responseStream:!!n.responseStream,requestSerialize:BA(i),requestDeserialize:LA(i,t),responseSerialize:BA(s),responseDeserialize:LA(s,t),originalName:K2(n.name),requestType:Ay(i,r),responseType:Ay(s,r)}}function Z2(n,e,t,r){let i={};for(let s of n.methodsArray)i[s.name]=J2(s,e,t,r);return i}function Ay(n,e){let t=n.toDescriptor("proto3");return{format:"Protocol Buffer 3 DescriptorProto",type:t.$type.toObject(t,VA),fileDescriptorProtos:e}}function eL(n,e){let t=n.toDescriptor("proto3");return{format:"Protocol Buffer 3 EnumDescriptorProto",type:t.$type.toObject(t,VA),fileDescriptorProtos:e}}function tL(n,e,t,r){if(n instanceof Zn.Service)return Z2(n,e,t,r);if(n instanceof Zn.Type)return Ay(n,r);if(n instanceof Zn.Enum)return eL(n,r);throw new Error("Type mismatch in reflection object handling")}function xd(n,e){let t={};n.resolveAll();let i=n.toDescriptor("proto3").file.map(s=>Buffer.from(Iy.FileDescriptorProto.encode(s).finish()));for(let[s,o]of qA(n,""))t[s]=tL(o,s,e,i);return t}function UA(n,e){e=e||{};let t=Zn.Root.fromDescriptor(n);return t.resolveAll(),xd(t,e)}function nL(n,e){return(0,Dy.loadProtosWithOptions)(n,e).then(t=>xd(t,e))}_t.load=nL;function rL(n,e){let t=(0,Dy.loadProtosWithOptionsSync)(n,e);return xd(t,e)}_t.loadSync=rL;function iL(n,e){e=e||{};let t=Zn.Root.fromJSON(n);return t.resolveAll(),xd(t,e)}_t.fromJSON=iL;function sL(n,e){let t=Iy.FileDescriptorSet.decode(n);return UA(t,e)}_t.loadFileDescriptorSetFromBuffer=sL;function oL(n,e){let t=Iy.FileDescriptorSet.fromObject(n);return UA(t,e)}_t.loadFileDescriptorSetFromObject=oL;(0,Dy.addCommonProtos)()});var ns=E(Ie=>{"use strict";Object.defineProperty(Ie,"__esModule",{value:!0});Ie.setup=Ie.getChannelzServiceDefinition=Ie.getChannelzHandlers=Ie.unregisterChannelzRef=Ie.registerChannelzSocket=Ie.registerChannelzServer=Ie.registerChannelzSubchannel=Ie.registerChannelzChannel=Ie.ChannelzCallTracker=Ie.ChannelzChildrenTracker=Ie.ChannelzTrace=void 0;var zA=he("net"),Rl=nn(),Nl=ce(),aL=Gn(),lL=Zu(),cL=Am();function ky(n){return{channel_id:n.id,name:n.name}}function Oy(n){return{subchannel_id:n.id,name:n.name}}function uL(n){return{server_id:n.id}}function Od(n){return{socket_id:n.id,name:n.name}}var jA=32,Ny=class{constructor(){this.events=[],this.eventsLogged=0,this.creationTimestamp=new Date}addTrace(e,t,r){let i=new Date;this.events.push({description:t,severity:e,timestamp:i,childChannel:r?.kind==="channel"?r:void 0,childSubchannel:r?.kind==="subchannel"?r:void 0}),this.events.length>=jA*2&&(this.events=this.events.slice(jA)),this.eventsLogged+=1}getTraceMessage(){return{creation_timestamp:Er(this.creationTimestamp),num_events_logged:this.eventsLogged,events:this.events.map(e=>({description:e.description,severity:e.severity,timestamp:Er(e.timestamp),channel_ref:e.childChannel?ky(e.childChannel):null,subchannel_ref:e.childSubchannel?Oy(e.childSubchannel):null}))}}};Ie.ChannelzTrace=Ny;var xy=class{constructor(){this.channelChildren=new Map,this.subchannelChildren=new Map,this.socketChildren=new Map}refChild(e){var t,r,i;switch(e.kind){case"channel":{let s=(t=this.channelChildren.get(e.id))!==null&&t!==void 0?t:{ref:e,count:0};s.count+=1,this.channelChildren.set(e.id,s);break}case"subchannel":{let s=(r=this.subchannelChildren.get(e.id))!==null&&r!==void 0?r:{ref:e,count:0};s.count+=1,this.subchannelChildren.set(e.id,s);break}case"socket":{let s=(i=this.socketChildren.get(e.id))!==null&&i!==void 0?i:{ref:e,count:0};s.count+=1,this.socketChildren.set(e.id,s);break}}}unrefChild(e){switch(e.kind){case"channel":{let t=this.channelChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.channelChildren.delete(e.id):this.channelChildren.set(e.id,t));break}case"subchannel":{let t=this.subchannelChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.subchannelChildren.delete(e.id):this.subchannelChildren.set(e.id,t));break}case"socket":{let t=this.socketChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.socketChildren.delete(e.id):this.socketChildren.set(e.id,t));break}}}getChildLists(){let e=[];for(let{ref:i}of this.channelChildren.values())e.push(i);let t=[];for(let{ref:i}of this.subchannelChildren.values())t.push(i);let r=[];for(let{ref:i}of this.socketChildren.values())r.push(i);return{channels:e,subchannels:t,sockets:r}}};Ie.ChannelzChildrenTracker=xy;var My=class{constructor(){this.callsStarted=0,this.callsSucceeded=0,this.callsFailed=0,this.lastCallStartedTimestamp=null}addCallStarted(){this.callsStarted+=1,this.lastCallStartedTimestamp=new Date}addCallSucceeded(){this.callsSucceeded+=1}addCallFailed(){this.callsFailed+=1}};Ie.ChannelzCallTracker=My;var dL=1;function Pd(){return dL++}var kl=[],Py=[],ii=[],Fy=[];function hL(n,e,t){let r=Pd(),i={id:r,name:n,kind:"channel"};return t&&(kl[r]={ref:i,getInfo:e}),i}Ie.registerChannelzChannel=hL;function fL(n,e,t){let r=Pd(),i={id:r,name:n,kind:"subchannel"};return t&&(Py[r]={ref:i,getInfo:e}),i}Ie.registerChannelzSubchannel=fL;function pL(n,e){let t=Pd(),r={id:t,kind:"server"};return e&&(ii[t]={ref:r,getInfo:n}),r}Ie.registerChannelzServer=pL;function gL(n,e,t){let r=Pd(),i={id:r,name:n,kind:"socket"};return t&&(Fy[r]={ref:i,getInfo:e}),i}Ie.registerChannelzSocket=gL;function mL(n){switch(n.kind){case"channel":delete kl[n.id];return;case"subchannel":delete Py[n.id];return;case"server":delete ii[n.id];return;case"socket":delete Fy[n.id];return}}Ie.unregisterChannelzRef=mL;function yL(n){let e=Number.parseInt(n,16);return[e/256|0,e%256]}function GA(n){if(n==="")return[];let e=n.split(":").map(r=>yL(r));return[].concat(...e)}function vL(n){if((0,zA.isIPv4)(n))return Buffer.from(Uint8Array.from(n.split(".").map(e=>Number.parseInt(e))));if((0,zA.isIPv6)(n)){let e,t,r=n.indexOf("::");r===-1?(e=n,t=""):(e=n.substring(0,r),t=n.substring(r+2));let i=Buffer.from(GA(e)),s=Buffer.from(GA(t)),o=Buffer.alloc(16-i.length-s.length,0);return Buffer.concat([i,o,s])}else return null}function KA(n){switch(n){case Rl.ConnectivityState.CONNECTING:return{state:"CONNECTING"};case Rl.ConnectivityState.IDLE:return{state:"IDLE"};case Rl.ConnectivityState.READY:return{state:"READY"};case Rl.ConnectivityState.SHUTDOWN:return{state:"SHUTDOWN"};case Rl.ConnectivityState.TRANSIENT_FAILURE:return{state:"TRANSIENT_FAILURE"};default:return{state:"UNKNOWN"}}}function Er(n){if(!n)return null;let e=n.getTime();return{seconds:e/1e3|0,nanos:e%1e3*1e6}}function WA(n){let e=n.getInfo();return{ref:ky(n.ref),data:{target:e.target,state:KA(e.state),calls_started:e.callTracker.callsStarted,calls_succeeded:e.callTracker.callsSucceeded,calls_failed:e.callTracker.callsFailed,last_call_started_timestamp:Er(e.callTracker.lastCallStartedTimestamp),trace:e.trace.getTraceMessage()},channel_ref:e.children.channels.map(t=>ky(t)),subchannel_ref:e.children.subchannels.map(t=>Oy(t))}}function SL(n,e){let t=Number.parseInt(n.request.channel_id),r=kl[t];if(r===void 0){e({code:Nl.Status.NOT_FOUND,details:"No channel data found for id "+t});return}e(null,{channel:WA(r)})}function _L(n,e){let t=Number.parseInt(n.request.max_results),r=[],i=Number.parseInt(n.request.start_channel_id);for(;i<kl.length;i++){let s=kl[i];if(s!==void 0&&(r.push(WA(s)),r.length>=t))break}e(null,{channel:r,end:i>=ii.length})}function $A(n){let e=n.getInfo();return{ref:uL(n.ref),data:{calls_started:e.callTracker.callsStarted,calls_succeeded:e.callTracker.callsSucceeded,calls_failed:e.callTracker.callsFailed,last_call_started_timestamp:Er(e.callTracker.lastCallStartedTimestamp),trace:e.trace.getTraceMessage()},listen_socket:e.listenerChildren.sockets.map(t=>Od(t))}}function EL(n,e){let t=Number.parseInt(n.request.server_id),r=ii[t];if(r===void 0){e({code:Nl.Status.NOT_FOUND,details:"No server data found for id "+t});return}e(null,{server:$A(r)})}function wL(n,e){let t=Number.parseInt(n.request.max_results),r=[],i=Number.parseInt(n.request.start_server_id);for(;i<ii.length;i++){let s=ii[i];if(s!==void 0&&(r.push($A(s)),r.length>=t))break}e(null,{server:r,end:i>=ii.length})}function TL(n,e){let t=Number.parseInt(n.request.subchannel_id),r=Py[t];if(r===void 0){e({code:Nl.Status.NOT_FOUND,details:"No subchannel data found for id "+t});return}let i=r.getInfo(),s={ref:Oy(r.ref),data:{target:i.target,state:KA(i.state),calls_started:i.callTracker.callsStarted,calls_succeeded:i.callTracker.callsSucceeded,calls_failed:i.callTracker.callsFailed,last_call_started_timestamp:Er(i.callTracker.lastCallStartedTimestamp),trace:i.trace.getTraceMessage()},socket_ref:i.children.sockets.map(o=>Od(o))};e(null,{subchannel:s})}function HA(n){var e;return(0,aL.isTcpSubchannelAddress)(n)?{address:"tcpip_address",tcpip_address:{ip_address:(e=vL(n.host))!==null&&e!==void 0?e:void 0,port:n.port}}:{address:"uds_address",uds_address:{filename:n.path}}}function CL(n,e){var t,r,i,s,o;let a=Number.parseInt(n.request.socket_id),l=Fy[a];if(l===void 0){e({code:Nl.Status.NOT_FOUND,details:"No socket data found for id "+a});return}let c=l.getInfo(),u=c.security?{model:"tls",tls:{cipher_suite:c.security.cipherSuiteStandardName?"standard_name":"other_name",standard_name:(t=c.security.cipherSuiteStandardName)!==null&&t!==void 0?t:void 0,other_name:(r=c.security.cipherSuiteOtherName)!==null&&r!==void 0?r:void 0,local_certificate:(i=c.security.localCertificate)!==null&&i!==void 0?i:void 0,remote_certificate:(s=c.security.remoteCertificate)!==null&&s!==void 0?s:void 0}}:null,d={ref:Od(l.ref),local:c.localAddress?HA(c.localAddress):null,remote:c.remoteAddress?HA(c.remoteAddress):null,remote_name:(o=c.remoteName)!==null&&o!==void 0?o:void 0,security:u,data:{keep_alives_sent:c.keepAlivesSent,streams_started:c.streamsStarted,streams_succeeded:c.streamsSucceeded,streams_failed:c.streamsFailed,last_local_stream_created_timestamp:Er(c.lastLocalStreamCreatedTimestamp),last_remote_stream_created_timestamp:Er(c.lastRemoteStreamCreatedTimestamp),messages_received:c.messagesReceived,messages_sent:c.messagesSent,last_message_received_timestamp:Er(c.lastMessageReceivedTimestamp),last_message_sent_timestamp:Er(c.lastMessageSentTimestamp),local_flow_control_window:c.localFlowControlWindow?{value:c.localFlowControlWindow}:null,remote_flow_control_window:c.remoteFlowControlWindow?{value:c.remoteFlowControlWindow}:null}};e(null,{socket:d})}function bL(n,e){let t=Number.parseInt(n.request.server_id),r=ii[t];if(r===void 0){e({code:Nl.Status.NOT_FOUND,details:"No server data found for id "+t});return}let i=Number.parseInt(n.request.start_socket_id),s=Number.parseInt(n.request.max_results),a=r.getInfo().sessionChildren.sockets.sort((u,d)=>u.id-d.id),l=[],c=0;for(;c<a.length&&!(a[c].id>=i&&(l.push(Od(a[c])),l.length>=s));c++);e(null,{socket_ref:l,end:c>=a.length})}function QA(){return{GetChannel:SL,GetTopChannels:_L,GetServer:EL,GetServers:wL,GetSubchannel:TL,GetSocket:CL,GetServerSockets:bL}}Ie.getChannelzHandlers=QA;var Md=null;function YA(){if(Md)return Md;let n=Ry().loadSync,e=n("channelz.proto",{keepCase:!0,longs:String,enums:String,defaults:!0,oneofs:!0,includeDirs:[`${__dirname}/../../proto`]});return Md=(0,cL.loadPackageDefinition)(e).grpc.channelz.v1.Channelz.service,Md}Ie.getChannelzServiceDefinition=YA;function AL(){(0,lL.registerAdminService)(YA,QA)}Ie.setup=AL});var XA=E(Ld=>{"use strict";Object.defineProperty(Ld,"__esModule",{value:!0});Ld.Subchannel=void 0;var Ee=nn(),IL=ul(),Ly=Fe(),Fd=ce(),DL=Wt(),RL=Gn(),To=ns(),kL="subchannel",NL=~(1<<31),By=class{constructor(e,t,r,i,s){var o;this.channelTarget=e,this.subchannelAddress=t,this.options=r,this.credentials=i,this.connector=s,this.connectivityState=Ee.ConnectivityState.IDLE,this.transport=null,this.continueConnecting=!1,this.stateListeners=new Set,this.refcount=0,this.channelzEnabled=!0,this.callTracker=new To.ChannelzCallTracker,this.childrenTracker=new To.ChannelzChildrenTracker,this.streamTracker=new To.ChannelzCallTracker;let a={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new IL.BackoffTimeout(()=>{this.handleBackoffTimer()},a),this.backoffTimeout.unref(),this.subchannelAddressString=(0,RL.subchannelAddressToString)(t),this.keepaliveTime=(o=r["grpc.keepalive_time_ms"])!==null&&o!==void 0?o:-1,r["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzTrace=new To.ChannelzTrace,this.channelzRef=(0,To.registerChannelzSubchannel)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Subchannel created"),this.trace("Subchannel constructed with options "+JSON.stringify(r,void 0,2))}getChannelzInfo(){return{state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists(),target:this.subchannelAddressString}}trace(e){Ly.trace(Fd.LogVerbosity.DEBUG,kL,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}refTrace(e){Ly.trace(Fd.LogVerbosity.DEBUG,"subchannel_refcount","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}handleBackoffTimer(){this.continueConnecting?this.transitionToState([Ee.ConnectivityState.TRANSIENT_FAILURE],Ee.ConnectivityState.CONNECTING):this.transitionToState([Ee.ConnectivityState.TRANSIENT_FAILURE],Ee.ConnectivityState.IDLE)}startBackoff(){this.backoffTimeout.runOnce()}stopBackoff(){this.backoffTimeout.stop(),this.backoffTimeout.reset()}startConnectingInternal(){let e=this.options;if(e["grpc.keepalive_time_ms"]){let t=Math.min(this.keepaliveTime,NL);e=Object.assign(Object.assign({},e),{"grpc.keepalive_time_ms":t})}this.connector.connect(this.subchannelAddress,this.credentials,e).then(t=>{this.transitionToState([Ee.ConnectivityState.CONNECTING],Ee.ConnectivityState.READY)&&(this.transport=t,this.channelzEnabled&&this.childrenTracker.refChild(t.getChannelzRef()),t.addDisconnectListener(r=>{this.transitionToState([Ee.ConnectivityState.READY],Ee.ConnectivityState.IDLE),r&&this.keepaliveTime>0&&(this.keepaliveTime*=2,Ly.log(Fd.LogVerbosity.ERROR,`Connection to ${(0,DL.uriToString)(this.channelTarget)} at ${this.subchannelAddressString} rejected by server because of excess pings. Increasing ping interval to ${this.keepaliveTime} ms`))}))},t=>{this.transitionToState([Ee.ConnectivityState.CONNECTING],Ee.ConnectivityState.TRANSIENT_FAILURE,`${t}`)})}transitionToState(e,t,r){var i,s;if(e.indexOf(this.connectivityState)===-1)return!1;this.trace(Ee.ConnectivityState[this.connectivityState]+" -> "+Ee.ConnectivityState[t]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+Ee.ConnectivityState[t]);let o=this.connectivityState;switch(this.connectivityState=t,t){case Ee.ConnectivityState.READY:this.stopBackoff();break;case Ee.ConnectivityState.CONNECTING:this.startBackoff(),this.startConnectingInternal(),this.continueConnecting=!1;break;case Ee.ConnectivityState.TRANSIENT_FAILURE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),(i=this.transport)===null||i===void 0||i.shutdown(),this.transport=null,this.backoffTimeout.isRunning()||process.nextTick(()=>{this.handleBackoffTimer()});break;case Ee.ConnectivityState.IDLE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),(s=this.transport)===null||s===void 0||s.shutdown(),this.transport=null;break;default:throw new Error(`Invalid state: unknown ConnectivityState ${t}`)}for(let a of this.stateListeners)a(this,o,t,this.keepaliveTime,r);return!0}ref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount+1)),this.refcount+=1}unref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount-1)),this.refcount-=1,this.refcount===0&&(this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Shutting down"),this.channelzEnabled&&(0,To.unregisterChannelzRef)(this.channelzRef),process.nextTick(()=>{this.transitionToState([Ee.ConnectivityState.CONNECTING,Ee.ConnectivityState.READY],Ee.ConnectivityState.IDLE)}))}unrefIfOneRef(){return this.refcount===1?(this.unref(),!0):!1}createCall(e,t,r,i){if(!this.transport)throw new Error("Cannot create call, subchannel not READY");let s;return this.channelzEnabled?(this.callTracker.addCallStarted(),this.streamTracker.addCallStarted(),s={onCallEnd:o=>{o.code===Fd.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}}):s={},this.transport.createCall(e,t,r,i,s)}startConnecting(){process.nextTick(()=>{this.transitionToState([Ee.ConnectivityState.IDLE],Ee.ConnectivityState.CONNECTING)||this.connectivityState===Ee.ConnectivityState.TRANSIENT_FAILURE&&(this.continueConnecting=!0)})}getConnectivityState(){return this.connectivityState}addConnectivityStateListener(e){this.stateListeners.add(e)}removeConnectivityStateListener(e){this.stateListeners.delete(e)}resetBackoff(){process.nextTick(()=>{this.backoffTimeout.reset(),this.transitionToState([Ee.ConnectivityState.TRANSIENT_FAILURE],Ee.ConnectivityState.CONNECTING)})}getAddress(){return this.subchannelAddressString}getChannelzRef(){return this.channelzRef}getRealSubchannel(){return this}realSubchannelEquals(e){return e.getRealSubchannel()===this}throttleKeepalive(e){e>this.keepaliveTime&&(this.keepaliveTime=e)}};Ld.Subchannel=By});var zy=E(ai=>{"use strict";Object.defineProperty(ai,"__esModule",{value:!0});ai.setup=ai.DEFAULT_PORT=void 0;var JA=zn(),eI=he("dns"),tI=he("util"),xL=Zg(),Vy=ce(),qy=Nt(),ML=Fe(),OL=ce(),si=Wt(),ZA=he("net"),PL=ul(),FL="dns_resolver";function oi(n){ML.trace(OL.LogVerbosity.DEBUG,FL,n)}ai.DEFAULT_PORT=443;var LL=3e4,BL=tI.promisify(eI.resolveTxt),VL=tI.promisify(eI.lookup);function qL(...n){let e=[];for(let t=0;t<Math.max.apply(null,n.map(r=>r.length));t++)for(let r of n)t<r.length&&e.push(r[t]);return e}var Uy=class{constructor(e,t,r){var i,s,o;this.target=e,this.listener=t,this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.continueResolving=!1,this.isNextResolutionTimerRunning=!1,this.isServiceConfigEnabled=!0,this.returnedIpResult=!1,oi("Resolver constructed for target "+(0,si.uriToString)(e));let a=(0,si.splitHostPort)(e.path);a===null?(this.ipResult=null,this.dnsHostname=null,this.port=null):(0,ZA.isIPv4)(a.host)||(0,ZA.isIPv6)(a.host)?(this.ipResult=[{host:a.host,port:(i=a.port)!==null&&i!==void 0?i:ai.DEFAULT_PORT}],this.dnsHostname=null,this.port=null):(this.ipResult=null,this.dnsHostname=a.host,this.port=(s=a.port)!==null&&s!==void 0?s:ai.DEFAULT_PORT),this.percentage=Math.random()*100,r["grpc.service_config_disable_resolution"]===1&&(this.isServiceConfigEnabled=!1),this.defaultResolutionError={code:Vy.Status.UNAVAILABLE,details:`Name resolution failed for target ${(0,si.uriToString)(this.target)}`,metadata:new qy.Metadata};let l={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoff=new PL.BackoffTimeout(()=>{this.continueResolving&&this.startResolutionWithBackoff()},l),this.backoff.unref(),this.minTimeBetweenResolutionsMs=(o=r["grpc.dns_min_time_between_resolutions_ms"])!==null&&o!==void 0?o:LL,this.nextResolutionTimer=setTimeout(()=>{},0),clearTimeout(this.nextResolutionTimer)}startResolution(){if(this.ipResult!==null){this.returnedIpResult||(oi("Returning IP address for target "+(0,si.uriToString)(this.target)),setImmediate(()=>{this.listener.onSuccessfulResolution(this.ipResult,null,null,null,{})}),this.returnedIpResult=!0),this.backoff.stop(),this.backoff.reset(),this.stopNextResolutionTimer();return}if(this.dnsHostname===null)oi("Failed to parse DNS address "+(0,si.uriToString)(this.target)),setImmediate(()=>{this.listener.onError({code:Vy.Status.UNAVAILABLE,details:`Failed to parse DNS address ${(0,si.uriToString)(this.target)}`,metadata:new qy.Metadata})}),this.stopNextResolutionTimer();else{if(this.pendingLookupPromise!==null)return;oi("Looking up DNS hostname "+this.dnsHostname),this.latestLookupResult=null;let e=this.dnsHostname;this.pendingLookupPromise=VL(e,{all:!0}),this.pendingLookupPromise.then(t=>{if(this.pendingLookupPromise===null)return;this.pendingLookupPromise=null,this.backoff.reset(),this.backoff.stop();let r=t.filter(o=>o.family===4),i=t.filter(o=>o.family===6);this.latestLookupResult=qL(i,r).map(o=>({host:o.address,port:+this.port}));let s="["+this.latestLookupResult.map(o=>o.host+":"+o.port).join(",")+"]";if(oi("Resolved addresses for target "+(0,si.uriToString)(this.target)+": "+s),this.latestLookupResult.length===0){this.listener.onError(this.defaultResolutionError);return}this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})},t=>{this.pendingLookupPromise!==null&&(oi("Resolution error for target "+(0,si.uriToString)(this.target)+": "+t.message),this.pendingLookupPromise=null,this.stopNextResolutionTimer(),this.listener.onError(this.defaultResolutionError))}),this.isServiceConfigEnabled&&this.pendingTxtPromise===null&&(this.pendingTxtPromise=BL(e),this.pendingTxtPromise.then(t=>{if(this.pendingTxtPromise!==null){this.pendingTxtPromise=null;try{this.latestServiceConfig=(0,xL.extractAndSelectServiceConfig)(t,this.percentage)}catch(r){this.latestServiceConfigError={code:Vy.Status.UNAVAILABLE,details:`Parsing service config failed with error ${r.message}`,metadata:new qy.Metadata}}this.latestLookupResult!==null&&this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})}},t=>{}))}}startNextResolutionTimer(){var e,t;clearTimeout(this.nextResolutionTimer),this.nextResolutionTimer=(t=(e=setTimeout(()=>{this.stopNextResolutionTimer(),this.continueResolving&&this.startResolutionWithBackoff()},this.minTimeBetweenResolutionsMs)).unref)===null||t===void 0?void 0:t.call(e),this.isNextResolutionTimerRunning=!0}stopNextResolutionTimer(){clearTimeout(this.nextResolutionTimer),this.isNextResolutionTimerRunning=!1}startResolutionWithBackoff(){this.pendingLookupPromise===null&&(this.continueResolving=!1,this.backoff.runOnce(),this.startNextResolutionTimer(),this.startResolution())}updateResolution(){this.pendingLookupPromise===null&&(this.isNextResolutionTimerRunning||this.backoff.isRunning()?(this.isNextResolutionTimerRunning?oi('resolution update delayed by "min time between resolutions" rate limit'):oi("resolution update delayed by backoff timer until "+this.backoff.getEndTime().toISOString()),this.continueResolving=!0):this.startResolutionWithBackoff())}destroy(){this.continueResolving=!1,this.backoff.reset(),this.backoff.stop(),this.stopNextResolutionTimer(),this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.returnedIpResult=!1}static getDefaultAuthority(e){return e.path}};function UL(){(0,JA.registerResolver)("dns",Uy),(0,JA.registerDefaultScheme)("dns")}ai.setup=UL});var jy=E(Ao=>{"use strict";Object.defineProperty(Ao,"__esModule",{value:!0});Ao.getProxiedConnection=Ao.mapProxyName=void 0;var xl=Fe(),Co=ce(),zL=zn(),jL=he("http"),GL=he("tls"),HL=Fe(),nI=Gn(),bo=Wt(),KL=he("url"),WL=zy(),$L="proxy";function li(n){HL.trace(Co.LogVerbosity.DEBUG,$L,n)}function QL(){let n="",e="";if(process.env.grpc_proxy)e="grpc_proxy",n=process.env.grpc_proxy;else if(process.env.https_proxy)e="https_proxy",n=process.env.https_proxy;else if(process.env.http_proxy)e="http_proxy",n=process.env.http_proxy;else return{};let t;try{t=new KL.URL(n)}catch{return(0,xl.log)(Co.LogVerbosity.ERROR,`cannot parse value of "${e}" env var`),{}}if(t.protocol!=="http:")return(0,xl.log)(Co.LogVerbosity.ERROR,`"${t.protocol}" scheme not supported in proxy URI`),{};let r=null;t.username&&(t.password?((0,xl.log)(Co.LogVerbosity.INFO,"userinfo found in proxy URI"),r=`${t.username}:${t.password}`):r=t.username);let i=t.hostname,s=t.port;s===""&&(s="80");let o={address:`${i}:${s}`};return r&&(o.creds=r),li("Proxy server "+o.address+" set by environment variable "+e),o}function YL(){let n=process.env.no_grpc_proxy,e="no_grpc_proxy";return n||(n=process.env.no_proxy,e="no_proxy"),n?(li("No proxy server list set by environment variable "+e),n.split(",")):[]}function XL(n,e){var t;let r={target:n,extraOptions:{}};if(((t=e["grpc.enable_http_proxy"])!==null&&t!==void 0?t:1)===0||n.scheme==="unix")return r;let i=QL();if(!i.address)return r;let s=(0,bo.splitHostPort)(n.path);if(!s)return r;let o=s.host;for(let l of YL())if(l===o)return li("Not using proxy for target in no_proxy list: "+(0,bo.uriToString)(n)),r;let a={"grpc.http_connect_target":(0,bo.uriToString)(n)};return i.creds&&(a["grpc.http_connect_creds"]=i.creds),{target:{scheme:"dns",path:i.address},extraOptions:a}}Ao.mapProxyName=XL;function JL(n,e,t){var r;if(!("grpc.http_connect_target"in e))return Promise.resolve({});let i=e["grpc.http_connect_target"],s=(0,bo.parseUri)(i);if(s===null)return Promise.resolve({});let o=(0,bo.splitHostPort)(s.path);if(o===null)return Promise.resolve({});let a=`${o.host}:${(r=o.port)!==null&&r!==void 0?r:WL.DEFAULT_PORT}`,l={method:"CONNECT",path:a},c={Host:a};(0,nI.isTcpSubchannelAddress)(n)?(l.host=n.host,l.port=n.port):l.socketPath=n.path,"grpc.http_connect_creds"in e&&(c["Proxy-Authorization"]="Basic "+Buffer.from(e["grpc.http_connect_creds"]).toString("base64")),l.headers=c;let u=(0,nI.subchannelAddressToString)(n);return li("Using proxy "+u+" to connect to "+l.path),new Promise((d,h)=>{let p=jL.request(l);p.once("connect",(y,S,_)=>{var k;if(p.removeAllListeners(),S.removeAllListeners(),y.statusCode===200)if(li("Successfully connected to "+l.path+" through proxy "+u),"secureContext"in t){let w=(0,zL.getDefaultAuthority)(s),x=(0,bo.splitHostPort)(w),M=(k=x?.host)!==null&&k!==void 0?k:w,z=GL.connect(Object.assign({host:M,servername:M,socket:S},t),()=>{li("Successfully established a TLS connection to "+l.path+" through proxy "+u),d({socket:z,realTarget:s})});z.on("error",$=>{li("Failed to establish a TLS connection to "+l.path+" through proxy "+u+" with error "+$.message),h()})}else li("Successfully established a plaintext connection to "+l.path+" through proxy "+u),d({socket:S,realTarget:s});else(0,xl.log)(Co.LogVerbosity.ERROR,"Failed to connect to "+l.path+" through proxy "+u+" with status "+y.statusCode),h()}),p.once("error",y=>{p.removeAllListeners(),(0,xl.log)(Co.LogVerbosity.ERROR,"Failed to connect to proxy "+u+" with error "+y.message),h()}),p.end()})}Ao.getProxiedConnection=JL});var Hy=E(Bd=>{"use strict";Object.defineProperty(Bd,"__esModule",{value:!0});Bd.StreamDecoder=void 0;var wr=function(n){return n[n.NO_DATA=0]="NO_DATA",n[n.READING_SIZE=1]="READING_SIZE",n[n.READING_MESSAGE=2]="READING_MESSAGE",n}(wr||{}),Gy=class{constructor(){this.readState=wr.NO_DATA,this.readCompressFlag=Buffer.alloc(1),this.readPartialSize=Buffer.alloc(4),this.readSizeRemaining=4,this.readMessageSize=0,this.readPartialMessage=[],this.readMessageRemaining=0}write(e){let t=0,r,i=[];for(;t<e.length;)switch(this.readState){case wr.NO_DATA:this.readCompressFlag=e.slice(t,t+1),t+=1,this.readState=wr.READING_SIZE,this.readPartialSize.fill(0),this.readSizeRemaining=4,this.readMessageSize=0,this.readMessageRemaining=0,this.readPartialMessage=[];break;case wr.READING_SIZE:if(r=Math.min(e.length-t,this.readSizeRemaining),e.copy(this.readPartialSize,4-this.readSizeRemaining,t,t+r),this.readSizeRemaining-=r,t+=r,this.readSizeRemaining===0)if(this.readMessageSize=this.readPartialSize.readUInt32BE(0),this.readMessageRemaining=this.readMessageSize,this.readMessageRemaining>0)this.readState=wr.READING_MESSAGE;else{let s=Buffer.concat([this.readCompressFlag,this.readPartialSize],5);this.readState=wr.NO_DATA,i.push(s)}break;case wr.READING_MESSAGE:if(r=Math.min(e.length-t,this.readMessageRemaining),this.readPartialMessage.push(e.slice(t,t+r)),this.readMessageRemaining-=r,t+=r,this.readMessageRemaining===0){let s=[this.readCompressFlag,this.readPartialSize].concat(this.readPartialMessage),o=Buffer.concat(s,this.readMessageSize+5);this.readState=wr.NO_DATA,i.push(o)}break;default:throw new Error("Unexpected read state")}return i}};Bd.StreamDecoder=Gy});var rI=E(Vd=>{"use strict";Object.defineProperty(Vd,"__esModule",{value:!0});Vd.Http2SubchannelCall=void 0;var Tr=he("http2"),ZL=he("os"),ye=ce(),ci=Nt(),eB=Hy(),tB=Fe(),nB=ce(),rB="subchannel_call";function iB(n){for(let[e,t]of Object.entries(ZL.constants.errno))if(t===n)return e;return"Unknown system error "+n}var Ky=class{constructor(e,t,r,i,s){this.http2Stream=e,this.callEventTracker=t,this.listener=r,this.transport=i,this.callId=s,this.decoder=new eB.StreamDecoder,this.isReadFilterPending=!1,this.isPushPending=!1,this.canPush=!1,this.readsClosed=!1,this.statusOutput=!1,this.unpushedReadMessages=[],this.mappedStatusCode=ye.Status.UNKNOWN,this.finalStatus=null,this.internalError=null,e.on("response",(o,a)=>{let l="";for(let c of Object.keys(o))l+="		"+c+": "+o[c]+`
`;switch(this.trace(`Received server headers:
`+l),o[":status"]){case 400:this.mappedStatusCode=ye.Status.INTERNAL;break;case 401:this.mappedStatusCode=ye.Status.UNAUTHENTICATED;break;case 403:this.mappedStatusCode=ye.Status.PERMISSION_DENIED;break;case 404:this.mappedStatusCode=ye.Status.UNIMPLEMENTED;break;case 429:case 502:case 503:case 504:this.mappedStatusCode=ye.Status.UNAVAILABLE;break;default:this.mappedStatusCode=ye.Status.UNKNOWN}if(a&Tr.constants.NGHTTP2_FLAG_END_STREAM)this.handleTrailers(o);else{let c;try{c=ci.Metadata.fromHttp2Headers(o)}catch(u){this.endCall({code:ye.Status.UNKNOWN,details:u.message,metadata:new ci.Metadata});return}this.listener.onReceiveMetadata(c)}}),e.on("trailers",o=>{this.handleTrailers(o)}),e.on("data",o=>{if(this.statusOutput)return;this.trace("receive HTTP/2 data frame of length "+o.length);let a=this.decoder.write(o);for(let l of a)this.trace("parsed message of length "+l.length),this.callEventTracker.addMessageReceived(),this.tryPush(l)}),e.on("end",()=>{this.readsClosed=!0,this.maybeOutputStatus()}),e.on("close",()=>{process.nextTick(()=>{var o;if(this.trace("HTTP/2 stream closed with code "+e.rstCode),((o=this.finalStatus)===null||o===void 0?void 0:o.code)===ye.Status.OK)return;let a,l="";switch(e.rstCode){case Tr.constants.NGHTTP2_NO_ERROR:if(this.finalStatus!==null)return;a=ye.Status.INTERNAL,l=`Received RST_STREAM with code ${e.rstCode}`;break;case Tr.constants.NGHTTP2_REFUSED_STREAM:a=ye.Status.UNAVAILABLE,l="Stream refused by server";break;case Tr.constants.NGHTTP2_CANCEL:a=ye.Status.CANCELLED,l="Call cancelled";break;case Tr.constants.NGHTTP2_ENHANCE_YOUR_CALM:a=ye.Status.RESOURCE_EXHAUSTED,l="Bandwidth exhausted or memory limit exceeded";break;case Tr.constants.NGHTTP2_INADEQUATE_SECURITY:a=ye.Status.PERMISSION_DENIED,l="Protocol not secure enough";break;case Tr.constants.NGHTTP2_INTERNAL_ERROR:a=ye.Status.INTERNAL,this.internalError===null?l=`Received RST_STREAM with code ${e.rstCode} (Internal server error)`:this.internalError.code==="ECONNRESET"||this.internalError.code==="ETIMEDOUT"?(a=ye.Status.UNAVAILABLE,l=this.internalError.message):l=`Received RST_STREAM with code ${e.rstCode} triggered by internal client error: ${this.internalError.message}`;break;default:a=ye.Status.INTERNAL,l=`Received RST_STREAM with code ${e.rstCode}`}this.endCall({code:a,details:l,metadata:new ci.Metadata,rstCode:e.rstCode})})}),e.on("error",o=>{o.code!=="ERR_HTTP2_STREAM_ERROR"&&(this.trace("Node error event: message="+o.message+" code="+o.code+" errno="+iB(o.errno)+" syscall="+o.syscall),this.internalError=o),this.callEventTracker.onStreamEnd(!1)})}onDisconnect(){this.endCall({code:ye.Status.UNAVAILABLE,details:"Connection dropped",metadata:new ci.Metadata})}outputStatus(){this.statusOutput||(this.statusOutput=!0,this.trace("ended with status: code="+this.finalStatus.code+' details="'+this.finalStatus.details+'"'),this.callEventTracker.onCallEnd(this.finalStatus),process.nextTick(()=>{this.listener.onReceiveStatus(this.finalStatus)}),this.http2Stream.resume())}trace(e){tB.trace(nB.LogVerbosity.DEBUG,rB,"["+this.callId+"] "+e)}endCall(e){(this.finalStatus===null||this.finalStatus.code===ye.Status.OK)&&(this.finalStatus=e,this.maybeOutputStatus()),this.destroyHttp2Stream()}maybeOutputStatus(){this.finalStatus!==null&&(this.finalStatus.code!==ye.Status.OK||this.readsClosed&&this.unpushedReadMessages.length===0&&!this.isReadFilterPending&&!this.isPushPending)&&this.outputStatus()}push(e){this.trace("pushing to reader message of length "+(e instanceof Buffer?e.length:null)),this.canPush=!1,this.isPushPending=!0,process.nextTick(()=>{this.isPushPending=!1,!this.statusOutput&&(this.listener.onReceiveMessage(e),this.maybeOutputStatus())})}tryPush(e){this.canPush?(this.http2Stream.pause(),this.push(e)):(this.trace("unpushedReadMessages.push message of length "+e.length),this.unpushedReadMessages.push(e))}handleTrailers(e){this.callEventTracker.onStreamEnd(!0);let t="";for(let l of Object.keys(e))t+="		"+l+": "+e[l]+`
`;this.trace(`Received server trailers:
`+t);let r;try{r=ci.Metadata.fromHttp2Headers(e)}catch{r=new ci.Metadata}let i=r.getMap(),s=this.mappedStatusCode;if(s===ye.Status.UNKNOWN&&typeof i["grpc-status"]=="string"){let l=Number(i["grpc-status"]);l in ye.Status&&(s=l,this.trace("received status code "+l+" from server")),r.remove("grpc-status")}let o="";if(typeof i["grpc-message"]=="string"){try{o=decodeURI(i["grpc-message"])}catch{o=i["grpc-message"]}r.remove("grpc-message"),this.trace('received status details string "'+o+'" from server')}let a={code:s,details:o,metadata:r};this.endCall(a)}destroyHttp2Stream(){var e;if(!this.http2Stream.destroyed){let t;((e=this.finalStatus)===null||e===void 0?void 0:e.code)===ye.Status.OK?t=Tr.constants.NGHTTP2_NO_ERROR:t=Tr.constants.NGHTTP2_CANCEL,this.trace("close http2 stream with code "+t),this.http2Stream.close(t)}}cancelWithStatus(e,t){this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.endCall({code:e,details:t,metadata:new ci.Metadata})}getStatus(){return this.finalStatus}getPeer(){return this.transport.getPeerName()}getCallNumber(){return this.callId}startRead(){if(this.finalStatus!==null&&this.finalStatus.code!==ye.Status.OK){this.readsClosed=!0,this.maybeOutputStatus();return}if(this.canPush=!0,this.unpushedReadMessages.length>0){let e=this.unpushedReadMessages.shift();this.push(e);return}this.http2Stream.resume()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length);let r=i=>{process.nextTick(()=>{var s;let o=ye.Status.UNAVAILABLE;i?.code==="ERR_STREAM_WRITE_AFTER_END"&&(o=ye.Status.INTERNAL),i&&this.cancelWithStatus(o,`Write error: ${i.message}`),(s=e.callback)===null||s===void 0||s.call(e)})};this.trace("sending data chunk of length "+t.length),this.callEventTracker.addMessageSent();try{this.http2Stream.write(t,r)}catch(i){this.endCall({code:ye.Status.UNAVAILABLE,details:`Write failed with error ${i.message}`,metadata:new ci.Metadata})}}halfClose(){this.trace("end() called"),this.trace("calling end() on HTTP/2 stream"),this.http2Stream.end()}};Vd.Http2SubchannelCall=Ky});var Wy=E(qd=>{"use strict";Object.defineProperty(qd,"__esModule",{value:!0});qd.getNextCallNumber=void 0;var sB=0;function oB(){return sB++}qd.getNextCallNumber=oB});var oI=E(zd=>{"use strict";Object.defineProperty(zd,"__esModule",{value:!0});zd.Http2SubchannelConnector=void 0;var Jy=he("http2"),iI=he("tls"),$y=ns(),Ml=ce(),aB=jy(),Do=Fe(),sI=zn(),Ud=Gn(),Io=Wt(),lB=he("net"),cB=rI(),uB=Wy(),Qy="transport",dB="transport_flowctrl",hB=Pg().version,{HTTP2_HEADER_AUTHORITY:fB,HTTP2_HEADER_CONTENT_TYPE:pB,HTTP2_HEADER_METHOD:gB,HTTP2_HEADER_PATH:mB,HTTP2_HEADER_TE:yB,HTTP2_HEADER_USER_AGENT:vB}=Jy.constants,SB=2e4,_B=Buffer.from("too_many_pings","ascii"),Yy=class{constructor(e,t,r,i){this.session=e,this.remoteName=i,this.keepaliveTimeMs=-1,this.keepaliveTimeoutMs=SB,this.keepaliveTimerId=null,this.pendingSendKeepalivePing=!1,this.keepaliveTimeoutId=null,this.keepaliveWithoutCalls=!1,this.activeCalls=new Set,this.disconnectListeners=[],this.disconnectHandled=!1,this.channelzEnabled=!0,this.streamTracker=new $y.ChannelzCallTracker,this.keepalivesSent=0,this.messagesSent=0,this.messagesReceived=0,this.lastMessageSentTimestamp=null,this.lastMessageReceivedTimestamp=null,this.subchannelAddressString=(0,Ud.subchannelAddressToString)(t),r["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzRef=(0,$y.registerChannelzSocket)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.userAgent=[r["grpc.primary_user_agent"],`grpc-node-js/${hB}`,r["grpc.secondary_user_agent"]].filter(s=>s).join(" "),"grpc.keepalive_time_ms"in r&&(this.keepaliveTimeMs=r["grpc.keepalive_time_ms"]),"grpc.keepalive_timeout_ms"in r&&(this.keepaliveTimeoutMs=r["grpc.keepalive_timeout_ms"]),"grpc.keepalive_permit_without_calls"in r?this.keepaliveWithoutCalls=r["grpc.keepalive_permit_without_calls"]===1:this.keepaliveWithoutCalls=!1,e.once("close",()=>{this.trace("session closed"),this.stopKeepalivePings(),this.handleDisconnect()}),e.once("goaway",(s,o,a)=>{let l=!1;s===Jy.constants.NGHTTP2_ENHANCE_YOUR_CALM&&a&&a.equals(_B)&&(l=!0),this.trace("connection closed by GOAWAY with code "+s+" and data "+a?.toString()),this.reportDisconnectToOwner(l)}),e.once("error",s=>{this.trace("connection closed with error "+s.message)}),Do.isTracerEnabled(Qy)&&(e.on("remoteSettings",s=>{this.trace("new settings received"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(s))}),e.on("localSettings",s=>{this.trace("local settings acknowledged by remote"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(s))})),this.keepaliveWithoutCalls&&this.maybeStartKeepalivePingTimer()}getChannelzInfo(){var e,t,r;let i=this.session.socket,s=i.remoteAddress?(0,Ud.stringToSubchannelAddress)(i.remoteAddress,i.remotePort):null,o=i.localAddress?(0,Ud.stringToSubchannelAddress)(i.localAddress,i.localPort):null,a;if(this.session.encrypted){let c=i,u=c.getCipher(),d=c.getCertificate(),h=c.getPeerCertificate();a={cipherSuiteStandardName:(e=u.standardName)!==null&&e!==void 0?e:null,cipherSuiteOtherName:u.standardName?null:u.name,localCertificate:d&&"raw"in d?d.raw:null,remoteCertificate:h&&"raw"in h?h.raw:null}}else a=null;return{remoteAddress:s,localAddress:o,security:a,remoteName:this.remoteName,streamsStarted:this.streamTracker.callsStarted,streamsSucceeded:this.streamTracker.callsSucceeded,streamsFailed:this.streamTracker.callsFailed,messagesSent:this.messagesSent,messagesReceived:this.messagesReceived,keepAlivesSent:this.keepalivesSent,lastLocalStreamCreatedTimestamp:this.streamTracker.lastCallStartedTimestamp,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:this.lastMessageSentTimestamp,lastMessageReceivedTimestamp:this.lastMessageReceivedTimestamp,localFlowControlWindow:(t=this.session.state.localWindowSize)!==null&&t!==void 0?t:null,remoteFlowControlWindow:(r=this.session.state.remoteWindowSize)!==null&&r!==void 0?r:null}}trace(e){Do.trace(Ml.LogVerbosity.DEBUG,Qy,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}keepaliveTrace(e){Do.trace(Ml.LogVerbosity.DEBUG,"keepalive","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}flowControlTrace(e){Do.trace(Ml.LogVerbosity.DEBUG,dB,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}internalsTrace(e){Do.trace(Ml.LogVerbosity.DEBUG,"transport_internals","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}reportDisconnectToOwner(e){this.disconnectHandled||(this.disconnectHandled=!0,this.disconnectListeners.forEach(t=>t(e)))}handleDisconnect(){this.reportDisconnectToOwner(!1),setImmediate(()=>{for(let e of this.activeCalls)e.onDisconnect()})}addDisconnectListener(e){this.disconnectListeners.push(e)}clearKeepaliveTimer(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null)}clearKeepaliveTimeout(){this.keepaliveTimeoutId&&(clearTimeout(this.keepaliveTimeoutId),this.keepaliveTimeoutId=null)}canSendPing(){return this.keepaliveTimeMs>0&&(this.keepaliveWithoutCalls||this.activeCalls.size>0)}maybeSendPing(){var e,t;if(this.clearKeepaliveTimer(),!this.canSendPing()){this.pendingSendKeepalivePing=!0;return}this.channelzEnabled&&(this.keepalivesSent+=1),this.keepaliveTrace("Sending ping with timeout "+this.keepaliveTimeoutMs+"ms"),this.keepaliveTimeoutId||(this.keepaliveTimeoutId=setTimeout(()=>{this.keepaliveTrace("Ping timeout passed without response"),this.handleDisconnect()},this.keepaliveTimeoutMs),(t=(e=this.keepaliveTimeoutId).unref)===null||t===void 0||t.call(e));try{this.session.ping((r,i,s)=>{r&&(this.keepaliveTrace("Ping failed with error "+r.message),this.handleDisconnect()),this.keepaliveTrace("Received ping response"),this.clearKeepaliveTimeout(),this.maybeStartKeepalivePingTimer()})}catch{this.handleDisconnect()}}maybeStartKeepalivePingTimer(){var e,t;this.canSendPing()&&(this.pendingSendKeepalivePing?(this.pendingSendKeepalivePing=!1,this.maybeSendPing()):!this.keepaliveTimerId&&!this.keepaliveTimeoutId&&(this.keepaliveTrace("Starting keepalive timer for "+this.keepaliveTimeMs+"ms"),this.keepaliveTimerId=(t=(e=setTimeout(()=>{this.maybeSendPing()},this.keepaliveTimeMs)).unref)===null||t===void 0?void 0:t.call(e)))}stopKeepalivePings(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null),this.clearKeepaliveTimeout()}removeActiveCall(e){this.activeCalls.delete(e),this.activeCalls.size===0&&this.session.unref()}addActiveCall(e){this.activeCalls.add(e),this.activeCalls.size===1&&(this.session.ref(),this.keepaliveWithoutCalls||this.maybeStartKeepalivePingTimer())}createCall(e,t,r,i,s){let o=e.toHttp2Headers();o[fB]=t,o[vB]=this.userAgent,o[pB]="application/grpc",o[gB]="POST",o[mB]=r,o[yB]="trailers";let a;try{a=this.session.request(o)}catch(u){throw this.handleDisconnect(),u}this.flowControlTrace("local window size: "+this.session.state.localWindowSize+" remote window size: "+this.session.state.remoteWindowSize),this.internalsTrace("session.closed="+this.session.closed+" session.destroyed="+this.session.destroyed+" session.socket.destroyed="+this.session.socket.destroyed);let l,c;return this.channelzEnabled?(this.streamTracker.addCallStarted(),l={addMessageSent:()=>{var u;this.messagesSent+=1,this.lastMessageSentTimestamp=new Date,(u=s.addMessageSent)===null||u===void 0||u.call(s)},addMessageReceived:()=>{var u;this.messagesReceived+=1,this.lastMessageReceivedTimestamp=new Date,(u=s.addMessageReceived)===null||u===void 0||u.call(s)},onCallEnd:u=>{var d;(d=s.onCallEnd)===null||d===void 0||d.call(s,u),this.removeActiveCall(c)},onStreamEnd:u=>{var d;u?this.streamTracker.addCallSucceeded():this.streamTracker.addCallFailed(),(d=s.onStreamEnd)===null||d===void 0||d.call(s,u)}}):l={addMessageSent:()=>{var u;(u=s.addMessageSent)===null||u===void 0||u.call(s)},addMessageReceived:()=>{var u;(u=s.addMessageReceived)===null||u===void 0||u.call(s)},onCallEnd:u=>{var d;(d=s.onCallEnd)===null||d===void 0||d.call(s,u),this.removeActiveCall(c)},onStreamEnd:u=>{var d;(d=s.onStreamEnd)===null||d===void 0||d.call(s,u)}},c=new cB.Http2SubchannelCall(a,l,i,this,(0,uB.getNextCallNumber)()),this.addActiveCall(c),c}getChannelzRef(){return this.channelzRef}getPeerName(){return this.subchannelAddressString}shutdown(){this.session.close(),(0,$y.unregisterChannelzRef)(this.channelzRef)}},Xy=class{constructor(e){this.channelTarget=e,this.session=null,this.isShutdown=!1}trace(e){Do.trace(Ml.LogVerbosity.DEBUG,Qy,(0,Io.uriToString)(this.channelTarget)+" "+e)}createSession(e,t,r,i){return this.isShutdown?Promise.reject():new Promise((s,o)=>{var a,l,c;let u;i.realTarget?(u=(0,Io.uriToString)(i.realTarget),this.trace("creating HTTP/2 session through proxy to "+(0,Io.uriToString)(i.realTarget))):(u=null,this.trace("creating HTTP/2 session to "+(0,Ud.subchannelAddressToString)(e)));let d=(0,sI.getDefaultAuthority)((a=i.realTarget)!==null&&a!==void 0?a:this.channelTarget),h=t._getConnectionOptions()||{};h.maxSendHeaderBlockLength=Number.MAX_SAFE_INTEGER,"grpc-node.max_session_memory"in r?h.maxSessionMemory=r["grpc-node.max_session_memory"]:h.maxSessionMemory=Number.MAX_SAFE_INTEGER;let p="http://";if("secureContext"in h){if(p="https://",r["grpc.ssl_target_name_override"]){let _=r["grpc.ssl_target_name_override"];h.checkServerIdentity=(k,w)=>(0,iI.checkServerIdentity)(_,w),h.servername=_}else{let _=(c=(l=(0,Io.splitHostPort)(d))===null||l===void 0?void 0:l.host)!==null&&c!==void 0?c:"localhost";h.servername=_}i.socket&&(h.createConnection=(_,k)=>i.socket)}else h.createConnection=(_,k)=>i.socket?i.socket:lB.connect(e);h=Object.assign(Object.assign(Object.assign({},h),e),{enableTrace:r["grpc-node.tls_enable_trace"]===1});let y=Jy.connect(p+d,h);this.session=y;let S="Failed to connect";y.unref(),y.once("connect",()=>{y.removeAllListeners(),s(new Yy(y,e,r,u)),this.session=null}),y.once("close",()=>{this.session=null,setImmediate(()=>{o(`${S} (${new Date().toISOString()})`)})}),y.once("error",_=>{S=_.message,this.trace("connection failed with error "+S)})})}connect(e,t,r){var i,s;if(this.isShutdown)return Promise.reject();let o=t._getConnectionOptions()||{};if("secureContext"in o){if(o.ALPNProtocols=["h2"],r["grpc.ssl_target_name_override"]){let a=r["grpc.ssl_target_name_override"];o.checkServerIdentity=(l,c)=>(0,iI.checkServerIdentity)(a,c),o.servername=a}else if("grpc.http_connect_target"in r){let a=(0,sI.getDefaultAuthority)((i=(0,Io.parseUri)(r["grpc.http_connect_target"]))!==null&&i!==void 0?i:{path:"localhost"}),l=(0,Io.splitHostPort)(a);o.servername=(s=l?.host)!==null&&s!==void 0?s:a}r["grpc-node.tls_enable_trace"]&&(o.enableTrace=!0)}return(0,aB.getProxiedConnection)(e,r,o).then(a=>this.createSession(e,t,r,a))}shutdown(){var e;this.isShutdown=!0,(e=this.session)===null||e===void 0||e.close(),this.session=null}};zd.Http2SubchannelConnector=Xy});var aI=E(Ro=>{"use strict";Object.defineProperty(Ro,"__esModule",{value:!0});Ro.getSubchannelPool=Ro.SubchannelPool=void 0;var EB=HT(),wB=XA(),TB=Gn(),CB=Wt(),bB=oI(),AB=1e4,Ol=class{constructor(){this.pool=Object.create(null),this.cleanupTimer=null}unrefUnusedSubchannels(){let e=!0;for(let t in this.pool){let i=this.pool[t].filter(s=>!s.subchannel.unrefIfOneRef());i.length>0&&(e=!1),this.pool[t]=i}e&&this.cleanupTimer!==null&&(clearInterval(this.cleanupTimer),this.cleanupTimer=null)}ensureCleanupTask(){var e,t;this.cleanupTimer===null&&(this.cleanupTimer=setInterval(()=>{this.unrefUnusedSubchannels()},AB),(t=(e=this.cleanupTimer).unref)===null||t===void 0||t.call(e))}getOrCreateSubchannel(e,t,r,i){this.ensureCleanupTask();let s=(0,CB.uriToString)(e);if(s in this.pool){let a=this.pool[s];for(let l of a)if((0,TB.subchannelAddressEqual)(t,l.subchannelAddress)&&(0,EB.channelOptionsEqual)(r,l.channelArguments)&&i._equals(l.channelCredentials))return l.subchannel}let o=new wB.Subchannel(e,t,r,i,new bB.Http2SubchannelConnector(e));return s in this.pool||(this.pool[s]=[]),this.pool[s].push({subchannelAddress:t,channelArguments:r,channelCredentials:i,subchannel:o}),o.ref(),o}};Ro.SubchannelPool=Ol;var IB=new Ol;function DB(n){return n?IB:new Ol}Ro.getSubchannelPool=DB});var ev=E(ko=>{"use strict";Object.defineProperty(ko,"__esModule",{value:!0});ko.FilterStackFactory=ko.FilterStack=void 0;var jd=class{constructor(e){this.filters=e}sendMetadata(e){let t=e;for(let r=0;r<this.filters.length;r++)t=this.filters[r].sendMetadata(t);return t}receiveMetadata(e){let t=e;for(let r=this.filters.length-1;r>=0;r--)t=this.filters[r].receiveMetadata(t);return t}sendMessage(e){let t=e;for(let r=0;r<this.filters.length;r++)t=this.filters[r].sendMessage(t);return t}receiveMessage(e){let t=e;for(let r=this.filters.length-1;r>=0;r--)t=this.filters[r].receiveMessage(t);return t}receiveTrailers(e){let t=e;for(let r=this.filters.length-1;r>=0;r--)t=this.filters[r].receiveTrailers(t);return t}push(e){this.filters.unshift(...e)}getFilters(){return this.filters}};ko.FilterStack=jd;var Zy=class n{constructor(e){this.factories=e}push(e){this.factories.unshift(...e)}clone(){return new n([...this.factories])}createFilter(){return new jd(this.factories.map(e=>e.createFilter()))}};ko.FilterStackFactory=Zy});var tv=E(Gd=>{"use strict";Object.defineProperty(Gd,"__esModule",{value:!0});Gd.CompressionAlgorithms=void 0;var lI=function(n){return n[n.identity=0]="identity",n[n.deflate=1]="deflate",n[n.gzip=2]="gzip",n}(lI||(Gd.CompressionAlgorithms=lI={}))});var Kd=E(Hd=>{"use strict";Object.defineProperty(Hd,"__esModule",{value:!0});Hd.BaseFilter=void 0;var nv=class{sendMetadata(e){return g(this,null,function*(){return e})}receiveMetadata(e){return e}sendMessage(e){return g(this,null,function*(){return e})}receiveMessage(e){return g(this,null,function*(){return e})}receiveTrailers(e){return e}};Hd.BaseFilter=nv});var dI=E(xo=>{"use strict";Object.defineProperty(xo,"__esModule",{value:!0});xo.CompressionFilterFactory=xo.CompressionFilter=void 0;var Wd=he("zlib"),uI=tv(),RB=ce(),kB=Kd(),NB=Fe(),xB=n=>typeof n=="number"&&typeof uI.CompressionAlgorithms[n]=="string",No=class{writeMessage(e,t){return g(this,null,function*(){let r=e;t&&(r=yield this.compressMessage(r));let i=Buffer.allocUnsafe(r.length+5);return i.writeUInt8(t?1:0,0),i.writeUInt32BE(r.length,1),r.copy(i,5),i})}readMessage(e){return g(this,null,function*(){let t=e.readUInt8(0)===1,r=e.slice(5);return t&&(r=yield this.decompressMessage(r)),r})}},rs=class extends No{compressMessage(e){return g(this,null,function*(){return e})}writeMessage(e,t){return g(this,null,function*(){let r=Buffer.allocUnsafe(e.length+5);return r.writeUInt8(0,0),r.writeUInt32BE(e.length,1),e.copy(r,5),r})}decompressMessage(e){return Promise.reject(new Error('Received compressed message but "grpc-encoding" header was identity'))}},rv=class extends No{compressMessage(e){return new Promise((t,r)=>{Wd.deflate(e,(i,s)=>{i?r(i):t(s)})})}decompressMessage(e){return new Promise((t,r)=>{Wd.inflate(e,(i,s)=>{i?r(i):t(s)})})}},iv=class extends No{compressMessage(e){return new Promise((t,r)=>{Wd.gzip(e,(i,s)=>{i?r(i):t(s)})})}decompressMessage(e){return new Promise((t,r)=>{Wd.unzip(e,(i,s)=>{i?r(i):t(s)})})}},sv=class extends No{constructor(e){super(),this.compressionName=e}compressMessage(e){return Promise.reject(new Error(`Received message compressed with unsupported compression method ${this.compressionName}`))}decompressMessage(e){return Promise.reject(new Error(`Compression method not supported: ${this.compressionName}`))}};function cI(n){switch(n){case"identity":return new rs;case"deflate":return new rv;case"gzip":return new iv;default:return new sv(n)}}var $d=class extends kB.BaseFilter{constructor(e,t){var r;super(),this.sharedFilterConfig=t,this.sendCompression=new rs,this.receiveCompression=new rs,this.currentCompressionAlgorithm="identity";let i=e["grpc.default_compression_algorithm"];if(i!==void 0)if(xB(i)){let s=uI.CompressionAlgorithms[i],o=(r=t.serverSupportedEncodingHeader)===null||r===void 0?void 0:r.split(",");(!o||o.includes(s))&&(this.currentCompressionAlgorithm=s,this.sendCompression=cI(this.currentCompressionAlgorithm))}else NB.log(RB.LogVerbosity.ERROR,`Invalid value provided for grpc.default_compression_algorithm option: ${i}`)}sendMetadata(e){return g(this,null,function*(){let t=yield e;return t.set("grpc-accept-encoding","identity,deflate,gzip"),t.set("accept-encoding","identity"),this.currentCompressionAlgorithm==="identity"?t.remove("grpc-encoding"):t.set("grpc-encoding",this.currentCompressionAlgorithm),t})}receiveMetadata(e){let t=e.get("grpc-encoding");if(t.length>0){let i=t[0];typeof i=="string"&&(this.receiveCompression=cI(i))}e.remove("grpc-encoding");let r=e.get("grpc-accept-encoding")[0];return r&&(this.sharedFilterConfig.serverSupportedEncodingHeader=r,r.split(",").includes(this.currentCompressionAlgorithm)||(this.sendCompression=new rs,this.currentCompressionAlgorithm="identity")),e.remove("grpc-accept-encoding"),e}sendMessage(e){return g(this,null,function*(){var t;let r=yield e,i;return this.sendCompression instanceof rs?i=!1:i=(((t=r.flags)!==null&&t!==void 0?t:0)&2)===0,{message:yield this.sendCompression.writeMessage(r.message,i),flags:r.flags}})}receiveMessage(e){return g(this,null,function*(){return this.receiveCompression.readMessage(yield e)})}};xo.CompressionFilter=$d;var ov=class{constructor(e,t){this.options=t,this.sharedFilterConfig={}}createFilter(){return new $d(this.options,this.sharedFilterConfig)}};xo.CompressionFilterFactory=ov});var fI=E(Mo=>{"use strict";Object.defineProperty(Mo,"__esModule",{value:!0});Mo.MaxMessageSizeFilterFactory=Mo.MaxMessageSizeFilter=void 0;var MB=Kd(),Qd=ce(),hI=Nt(),Yd=class extends MB.BaseFilter{constructor(e){super(),this.maxSendMessageSize=Qd.DEFAULT_MAX_SEND_MESSAGE_LENGTH,this.maxReceiveMessageSize=Qd.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,"grpc.max_send_message_length"in e&&(this.maxSendMessageSize=e["grpc.max_send_message_length"]),"grpc.max_receive_message_length"in e&&(this.maxReceiveMessageSize=e["grpc.max_receive_message_length"])}sendMessage(e){return g(this,null,function*(){if(this.maxSendMessageSize===-1)return e;{let t=yield e;if(t.message.length>this.maxSendMessageSize)throw{code:Qd.Status.RESOURCE_EXHAUSTED,details:`Sent message larger than max (${t.message.length} vs. ${this.maxSendMessageSize})`,metadata:new hI.Metadata};return t}})}receiveMessage(e){return g(this,null,function*(){if(this.maxReceiveMessageSize===-1)return e;{let t=yield e;if(t.length>this.maxReceiveMessageSize)throw{code:Qd.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${t.length} vs. ${this.maxReceiveMessageSize})`,metadata:new hI.Metadata};return t}})}};Mo.MaxMessageSizeFilter=Yd;var av=class{constructor(e){this.options=e}createFilter(){return new Yd(this.options)}};Mo.MaxMessageSizeFilterFactory=av});var Xd=E(er=>{"use strict";Object.defineProperty(er,"__esModule",{value:!0});er.deadlineToString=er.getRelativeTimeout=er.getDeadlineTimeoutString=er.minDeadline=void 0;function OB(...n){let e=1/0;for(let t of n){let r=t instanceof Date?t.getTime():t;r<e&&(e=r)}return e}er.minDeadline=OB;var PB=[["m",1],["S",1e3],["M",60*1e3],["H",60*60*1e3]];function FB(n){let e=new Date().getTime();n instanceof Date&&(n=n.getTime());let t=Math.max(n-e,0);for(let[r,i]of PB){let s=t/i;if(s<1e8)return String(Math.ceil(s))+r}throw new Error("Deadline is too far in the future")}er.getDeadlineTimeoutString=FB;var LB=2147483647;function BB(n){let e=n instanceof Date?n.getTime():n,t=new Date().getTime(),r=e-t;return r<0?0:r>LB?1/0:r}er.getRelativeTimeout=BB;function VB(n){if(n instanceof Date)return n.toISOString();{let e=new Date(n);return Number.isNaN(e.getTime())?""+n:e.toISOString()}}er.deadlineToString=VB});var Zd=E(Jd=>{"use strict";Object.defineProperty(Jd,"__esModule",{value:!0});Jd.restrictControlPlaneStatusCode=void 0;var tr=ce(),qB=[tr.Status.OK,tr.Status.INVALID_ARGUMENT,tr.Status.NOT_FOUND,tr.Status.ALREADY_EXISTS,tr.Status.FAILED_PRECONDITION,tr.Status.ABORTED,tr.Status.OUT_OF_RANGE,tr.Status.DATA_LOSS];function UB(n,e){return qB.includes(n)?{code:tr.Status.INTERNAL,details:`Invalid status from control plane: ${n} ${tr.Status[n]} ${e}`}:{code:n,details:e}}Jd.restrictControlPlaneStatusCode=UB});var gI=E(nh=>{"use strict";Object.defineProperty(nh,"__esModule",{value:!0});nh.LoadBalancingCall=void 0;var pI=nn(),eh=ce(),zB=Xd(),th=Nt(),Pl=Wr(),jB=Wt(),GB=Fe(),lv=Zd(),HB=he("http2"),KB="load_balancing_call",cv=class{constructor(e,t,r,i,s,o,a){var l,c;this.channel=e,this.callConfig=t,this.methodName=r,this.host=i,this.credentials=s,this.deadline=o,this.callNumber=a,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.metadata=null,this.listener=null,this.onCallEnded=null;let u=this.methodName.split("/"),d="";u.length>=2&&(d=u[1]);let h=(c=(l=(0,jB.splitHostPort)(this.host))===null||l===void 0?void 0:l.host)!==null&&c!==void 0?c:"localhost";this.serviceUrl=`https://${h}/${d}`}trace(e){GB.trace(eh.LogVerbosity.DEBUG,KB,"["+this.callNumber+"] "+e)}outputStatus(e,t){var r,i;if(!this.ended){this.ended=!0,this.trace("ended with status: code="+e.code+' details="'+e.details+'"');let s=Object.assign(Object.assign({},e),{progress:t});(r=this.listener)===null||r===void 0||r.onReceiveStatus(s),(i=this.onCallEnded)===null||i===void 0||i.call(this,s.code)}}doPick(){var e,t;if(this.ended)return;if(!this.metadata)throw new Error("doPick called before start");this.trace("Pick called");let r=this.channel.doPick(this.metadata,this.callConfig.pickInformation),i=r.subchannel?"("+r.subchannel.getChannelzRef().id+") "+r.subchannel.getAddress():""+r.subchannel;switch(this.trace("Pick result: "+Pl.PickResultType[r.pickResultType]+" subchannel: "+i+" status: "+((e=r.status)===null||e===void 0?void 0:e.code)+" "+((t=r.status)===null||t===void 0?void 0:t.details)),r.pickResultType){case Pl.PickResultType.COMPLETE:this.credentials.generateMetadata({service_url:this.serviceUrl}).then(a=>{var l,c,u;if(this.ended){this.trace("Credentials metadata generation finished after call ended");return}let d=this.metadata.clone();if(d.merge(a),d.get("authorization").length>1&&this.outputStatus({code:eh.Status.INTERNAL,details:'"authorization" metadata cannot have multiple values',metadata:new th.Metadata},"PROCESSED"),r.subchannel.getConnectivityState()!==pI.ConnectivityState.READY){this.trace("Picked subchannel "+i+" has state "+pI.ConnectivityState[r.subchannel.getConnectivityState()]+" after getting credentials metadata. Retrying pick"),this.doPick();return}this.deadline!==1/0&&d.set("grpc-timeout",(0,zB.getDeadlineTimeoutString)(this.deadline));try{this.child=r.subchannel.getRealSubchannel().createCall(d,this.host,this.methodName,{onReceiveMetadata:h=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(h)},onReceiveMessage:h=>{this.trace("Received message"),this.listener.onReceiveMessage(h)},onReceiveStatus:h=>{this.trace("Received status"),h.rstCode===HB.constants.NGHTTP2_REFUSED_STREAM?this.outputStatus(h,"REFUSED"):this.outputStatus(h,"PROCESSED")}})}catch(h){this.trace("Failed to start call on picked subchannel "+i+" with error "+h.message),this.outputStatus({code:eh.Status.INTERNAL,details:"Failed to start HTTP/2 stream with error "+h.message,metadata:new th.Metadata},"NOT_STARTED");return}(c=(l=this.callConfig).onCommitted)===null||c===void 0||c.call(l),(u=r.onCallStarted)===null||u===void 0||u.call(r),this.onCallEnded=r.onCallEnded,this.trace("Created child call ["+this.child.getCallNumber()+"]"),this.readPending&&this.child.startRead(),this.pendingMessage&&this.child.sendMessageWithContext(this.pendingMessage.context,this.pendingMessage.message),this.pendingHalfClose&&this.child.halfClose()},a=>{let{code:l,details:c}=(0,lv.restrictControlPlaneStatusCode)(typeof a.code=="number"?a.code:eh.Status.UNKNOWN,`Getting metadata from plugin failed with error: ${a.message}`);this.outputStatus({code:l,details:c,metadata:new th.Metadata},"PROCESSED")});break;case Pl.PickResultType.DROP:let{code:s,details:o}=(0,lv.restrictControlPlaneStatusCode)(r.status.code,r.status.details);setImmediate(()=>{this.outputStatus({code:s,details:o,metadata:r.status.metadata},"DROP")});break;case Pl.PickResultType.TRANSIENT_FAILURE:if(this.metadata.getOptions().waitForReady)this.channel.queueCallForPick(this);else{let{code:a,details:l}=(0,lv.restrictControlPlaneStatusCode)(r.status.code,r.status.details);setImmediate(()=>{this.outputStatus({code:a,details:l,metadata:r.status.metadata},"PROCESSED")})}break;case Pl.PickResultType.QUEUE:this.channel.queueCallForPick(this)}}cancelWithStatus(e,t){var r;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),(r=this.child)===null||r===void 0||r.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new th.Metadata},"PROCESSED")}getPeer(){var e,t;return(t=(e=this.child)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.listener=t,this.metadata=e,this.doPick()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.child.sendMessageWithContext(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){throw new Error("Method not implemented.")}getCallNumber(){return this.callNumber}};nh.LoadBalancingCall=cv});var yI=E(ih=>{"use strict";Object.defineProperty(ih,"__esModule",{value:!0});ih.ResolvingCall=void 0;var Oo=ce(),rh=Xd(),mI=Nt(),WB=Fe(),$B=Zd(),QB="resolving_call",uv=class{constructor(e,t,r,i,s,o){this.channel=e,this.method=t,this.filterStackFactory=i,this.credentials=s,this.callNumber=o,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.readFilterPending=!1,this.writeFilterPending=!1,this.pendingChildStatus=null,this.metadata=null,this.listener=null,this.statusWatchers=[],this.deadlineTimer=setTimeout(()=>{},0),this.filterStack=null,this.deadline=r.deadline,this.host=r.host,r.parentCall&&(r.flags&Oo.Propagate.CANCELLATION&&r.parentCall.on("cancelled",()=>{this.cancelWithStatus(Oo.Status.CANCELLED,"Cancelled by parent call")}),r.flags&Oo.Propagate.DEADLINE&&(this.trace("Propagating deadline from parent: "+r.parentCall.getDeadline()),this.deadline=(0,rh.minDeadline)(this.deadline,r.parentCall.getDeadline()))),this.trace("Created"),this.runDeadlineTimer()}trace(e){WB.trace(Oo.LogVerbosity.DEBUG,QB,"["+this.callNumber+"] "+e)}runDeadlineTimer(){clearTimeout(this.deadlineTimer),this.trace("Deadline: "+(0,rh.deadlineToString)(this.deadline));let e=(0,rh.getRelativeTimeout)(this.deadline);if(e!==1/0){this.trace("Deadline will be reached in "+e+"ms");let t=()=>{this.cancelWithStatus(Oo.Status.DEADLINE_EXCEEDED,"Deadline exceeded")};e<=0?process.nextTick(t):this.deadlineTimer=setTimeout(t,e)}}outputStatus(e){if(!this.ended){this.ended=!0,this.filterStack||(this.filterStack=this.filterStackFactory.createFilter()),clearTimeout(this.deadlineTimer);let t=this.filterStack.receiveTrailers(e);this.trace("ended with status: code="+t.code+' details="'+t.details+'"'),this.statusWatchers.forEach(r=>r(t)),process.nextTick(()=>{var r;(r=this.listener)===null||r===void 0||r.onReceiveStatus(t)})}}sendMessageOnChild(e,t){if(!this.child)throw new Error("sendMessageonChild called with child not populated");let r=this.child;this.writeFilterPending=!0,this.filterStack.sendMessage(Promise.resolve({message:t,flags:e.flags})).then(i=>{this.writeFilterPending=!1,r.sendMessageWithContext(e,i.message),this.pendingHalfClose&&r.halfClose()},i=>{this.cancelWithStatus(i.code,i.details)})}getConfig(){if(this.ended)return;if(!this.metadata||!this.listener)throw new Error("getConfig called before start");let e=this.channel.getConfig(this.method,this.metadata);if(e.type==="NONE"){this.channel.queueCallForConfig(this);return}else if(e.type==="ERROR"){this.metadata.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(e.error);return}let t=e.config;if(t.status!==Oo.Status.OK){let{code:r,details:i}=(0,$B.restrictControlPlaneStatusCode)(t.status,"Failed to route call to method "+this.method);this.outputStatus({code:r,details:i,metadata:new mI.Metadata});return}if(t.methodConfig.timeout){let r=new Date;r.setSeconds(r.getSeconds()+t.methodConfig.timeout.seconds),r.setMilliseconds(r.getMilliseconds()+t.methodConfig.timeout.nanos/1e6),this.deadline=(0,rh.minDeadline)(this.deadline,r),this.runDeadlineTimer()}this.filterStackFactory.push(t.dynamicFilterFactories),this.filterStack=this.filterStackFactory.createFilter(),this.filterStack.sendMetadata(Promise.resolve(this.metadata)).then(r=>{this.child=this.channel.createInnerCall(t,this.method,this.host,this.credentials,this.deadline),this.trace("Created child ["+this.child.getCallNumber()+"]"),this.child.start(r,{onReceiveMetadata:i=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(this.filterStack.receiveMetadata(i))},onReceiveMessage:i=>{this.trace("Received message"),this.readFilterPending=!0,this.filterStack.receiveMessage(i).then(s=>{this.trace("Finished filtering received message"),this.readFilterPending=!1,this.listener.onReceiveMessage(s),this.pendingChildStatus&&this.outputStatus(this.pendingChildStatus)},s=>{this.cancelWithStatus(s.code,s.details)})},onReceiveStatus:i=>{this.trace("Received status"),this.readFilterPending?this.pendingChildStatus=i:this.outputStatus(i)}}),this.readPending&&this.child.startRead(),this.pendingMessage?this.sendMessageOnChild(this.pendingMessage.context,this.pendingMessage.message):this.pendingHalfClose&&this.child.halfClose()},r=>{this.outputStatus(r)})}reportResolverError(e){var t;!((t=this.metadata)===null||t===void 0)&&t.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(e)}cancelWithStatus(e,t){var r;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),(r=this.child)===null||r===void 0||r.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new mI.Metadata})}getPeer(){var e,t;return(t=(e=this.child)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.metadata=e.clone(),this.listener=t,this.getConfig()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.sendMessageOnChild(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child&&!this.writeFilterPending?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){this.credentials=this.credentials.compose(e)}addStatusWatcher(e){this.statusWatchers.push(e)}getCallNumber(){return this.callNumber}};ih.ResolvingCall=uv});var vI=E(ui=>{"use strict";Object.defineProperty(ui,"__esModule",{value:!0});ui.RetryingCall=ui.MessageBufferTracker=ui.RetryThrottler=void 0;var sh=ce(),YB=Nt(),XB=Fe(),JB="retrying_call",hv=class{constructor(e,t,r){this.maxTokens=e,this.tokenRatio=t,r?this.tokens=r.tokens*(e/r.maxTokens):this.tokens=e}addCallSucceeded(){this.tokens=Math.max(this.tokens+this.tokenRatio,this.maxTokens)}addCallFailed(){this.tokens=Math.min(this.tokens-1,0)}canRetryCall(){return this.tokens>this.maxTokens/2}};ui.RetryThrottler=hv;var fv=class{constructor(e,t){this.totalLimit=e,this.limitPerCall=t,this.totalAllocated=0,this.allocatedPerCall=new Map}allocate(e,t){var r;let i=(r=this.allocatedPerCall.get(t))!==null&&r!==void 0?r:0;return this.limitPerCall-i<e||this.totalLimit-this.totalAllocated<e?!1:(this.allocatedPerCall.set(t,i+e),this.totalAllocated+=e,!0)}free(e,t){var r;if(this.totalAllocated<e)throw new Error(`Invalid buffer allocation state: call ${t} freed ${e} > total allocated ${this.totalAllocated}`);this.totalAllocated-=e;let i=(r=this.allocatedPerCall.get(t))!==null&&r!==void 0?r:0;if(i<e)throw new Error(`Invalid buffer allocation state: call ${t} freed ${e} > allocated for call ${i}`);this.allocatedPerCall.set(t,i-e)}freeAll(e){var t;let r=(t=this.allocatedPerCall.get(e))!==null&&t!==void 0?t:0;if(this.totalAllocated<r)throw new Error(`Invalid buffer allocation state: call ${e} allocated ${r} > total allocated ${this.totalAllocated}`);this.totalAllocated-=r,this.allocatedPerCall.delete(e)}};ui.MessageBufferTracker=fv;var dv="grpc-previous-rpc-attempts",pv=class{constructor(e,t,r,i,s,o,a,l,c){if(this.channel=e,this.callConfig=t,this.methodName=r,this.host=i,this.credentials=s,this.deadline=o,this.callNumber=a,this.bufferTracker=l,this.retryThrottler=c,this.listener=null,this.initialMetadata=null,this.underlyingCalls=[],this.writeBuffer=[],this.writeBufferOffset=0,this.readStarted=!1,this.transparentRetryUsed=!1,this.attempts=0,this.hedgingTimer=null,this.committedCallIndex=null,this.initialRetryBackoffSec=0,this.nextRetryBackoffSec=0,t.methodConfig.retryPolicy){this.state="RETRY";let u=t.methodConfig.retryPolicy;this.nextRetryBackoffSec=this.initialRetryBackoffSec=Number(u.initialBackoff.substring(0,u.initialBackoff.length-1))}else t.methodConfig.hedgingPolicy?this.state="HEDGING":this.state="TRANSPARENT_ONLY"}getCallNumber(){return this.callNumber}trace(e){XB.trace(sh.LogVerbosity.DEBUG,JB,"["+this.callNumber+"] "+e)}reportStatus(e){this.trace("ended with status: code="+e.code+' details="'+e.details+'"'),this.bufferTracker.freeAll(this.callNumber),this.writeBufferOffset=this.writeBufferOffset+this.writeBuffer.length,this.writeBuffer=[],process.nextTick(()=>{var t;(t=this.listener)===null||t===void 0||t.onReceiveStatus({code:e.code,details:e.details,metadata:e.metadata})})}cancelWithStatus(e,t){this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.reportStatus({code:e,details:t,metadata:new YB.Metadata});for(let{call:r}of this.underlyingCalls)r.cancelWithStatus(e,t)}getPeer(){return this.committedCallIndex!==null?this.underlyingCalls[this.committedCallIndex].call.getPeer():"unknown"}getBufferEntry(e){var t;return(t=this.writeBuffer[e-this.writeBufferOffset])!==null&&t!==void 0?t:{entryType:"FREED",allocated:!1}}getNextBufferIndex(){return this.writeBufferOffset+this.writeBuffer.length}clearSentMessages(){if(this.state!=="COMMITTED")return;let e=this.underlyingCalls[this.committedCallIndex].nextMessageToSend;for(let t=this.writeBufferOffset;t<e;t++){let r=this.getBufferEntry(t);r.allocated&&this.bufferTracker.free(r.message.message.length,this.callNumber)}this.writeBuffer=this.writeBuffer.slice(e-this.writeBufferOffset),this.writeBufferOffset=e}commitCall(e){if(this.state!=="COMMITTED"&&this.underlyingCalls[e].state!=="COMPLETED"){this.trace("Committing call ["+this.underlyingCalls[e].call.getCallNumber()+"] at index "+e),this.state="COMMITTED",this.committedCallIndex=e;for(let t=0;t<this.underlyingCalls.length;t++)t!==e&&this.underlyingCalls[t].state!=="COMPLETED"&&(this.underlyingCalls[t].state="COMPLETED",this.underlyingCalls[t].call.cancelWithStatus(sh.Status.CANCELLED,"Discarded in favor of other hedged attempt"));this.clearSentMessages()}}commitCallWithMostMessages(){if(this.state==="COMMITTED")return;let e=-1,t=-1;for(let[r,i]of this.underlyingCalls.entries())i.state==="ACTIVE"&&i.nextMessageToSend>e&&(e=i.nextMessageToSend,t=r);t===-1?this.state="TRANSPARENT_ONLY":this.commitCall(t)}isStatusCodeInList(e,t){return e.some(r=>r===t||r.toString().toLowerCase()===sh.Status[t].toLowerCase())}getNextRetryBackoffMs(){var e;let t=(e=this.callConfig)===null||e===void 0?void 0:e.methodConfig.retryPolicy;if(!t)return 0;let r=Math.random()*this.nextRetryBackoffSec*1e3,i=Number(t.maxBackoff.substring(0,t.maxBackoff.length-1));return this.nextRetryBackoffSec=Math.min(this.nextRetryBackoffSec*t.backoffMultiplier,i),r}maybeRetryCall(e,t){if(this.state!=="RETRY"){t(!1);return}let r=this.callConfig.methodConfig.retryPolicy;if(this.attempts>=Math.min(r.maxAttempts,5)){t(!1);return}let i;if(e===null)i=this.getNextRetryBackoffMs();else if(e<0){this.state="TRANSPARENT_ONLY",t(!1);return}else i=e,this.nextRetryBackoffSec=this.initialRetryBackoffSec;setTimeout(()=>{var s,o;if(this.state!=="RETRY"){t(!1);return}(!((o=(s=this.retryThrottler)===null||s===void 0?void 0:s.canRetryCall())!==null&&o!==void 0)||o)&&(t(!0),this.attempts+=1,this.startNewAttempt())},i)}countActiveCalls(){let e=0;for(let t of this.underlyingCalls)t?.state==="ACTIVE"&&(e+=1);return e}handleProcessedStatus(e,t,r){var i,s,o;switch(this.state){case"COMMITTED":case"TRANSPARENT_ONLY":this.commitCall(t),this.reportStatus(e);break;case"HEDGING":if(this.isStatusCodeInList((i=this.callConfig.methodConfig.hedgingPolicy.nonFatalStatusCodes)!==null&&i!==void 0?i:[],e.code)){(s=this.retryThrottler)===null||s===void 0||s.addCallFailed();let a;if(r===null)a=0;else if(r<0){this.state="TRANSPARENT_ONLY",this.commitCall(t),this.reportStatus(e);return}else a=r;setTimeout(()=>{this.maybeStartHedgingAttempt(),this.countActiveCalls()===0&&(this.commitCall(t),this.reportStatus(e))},a)}else this.commitCall(t),this.reportStatus(e);break;case"RETRY":this.isStatusCodeInList(this.callConfig.methodConfig.retryPolicy.retryableStatusCodes,e.code)?((o=this.retryThrottler)===null||o===void 0||o.addCallFailed(),this.maybeRetryCall(r,a=>{a||(this.commitCall(t),this.reportStatus(e))})):(this.commitCall(t),this.reportStatus(e));break}}getPushback(e){let t=e.get("grpc-retry-pushback-ms");if(t.length===0)return null;try{return parseInt(t[0])}catch{return-1}}handleChildStatus(e,t){var r;if(this.underlyingCalls[t].state==="COMPLETED")return;if(this.trace("state="+this.state+" handling status with progress "+e.progress+" from child ["+this.underlyingCalls[t].call.getCallNumber()+"] in state "+this.underlyingCalls[t].state),this.underlyingCalls[t].state="COMPLETED",e.code===sh.Status.OK){(r=this.retryThrottler)===null||r===void 0||r.addCallSucceeded(),this.commitCall(t),this.reportStatus(e);return}if(this.state==="COMMITTED"){this.reportStatus(e);return}let i=this.getPushback(e.metadata);switch(e.progress){case"NOT_STARTED":this.startNewAttempt();break;case"REFUSED":this.transparentRetryUsed?this.handleProcessedStatus(e,t,i):(this.transparentRetryUsed=!0,this.startNewAttempt());break;case"DROP":this.commitCall(t),this.reportStatus(e);break;case"PROCESSED":this.handleProcessedStatus(e,t,i);break}}maybeStartHedgingAttempt(){if(this.state!=="HEDGING"||!this.callConfig.methodConfig.hedgingPolicy)return;let e=this.callConfig.methodConfig.hedgingPolicy;this.attempts>=Math.min(e.maxAttempts,5)||(this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer())}maybeStartHedgingTimer(){var e,t,r;if(this.hedgingTimer&&clearTimeout(this.hedgingTimer),this.state!=="HEDGING"||!this.callConfig.methodConfig.hedgingPolicy)return;let i=this.callConfig.methodConfig.hedgingPolicy;if(this.attempts>=Math.min(i.maxAttempts,5))return;let s=(e=i.hedgingDelay)!==null&&e!==void 0?e:"0s",o=Number(s.substring(0,s.length-1));this.hedgingTimer=setTimeout(()=>{this.maybeStartHedgingAttempt()},o*1e3),(r=(t=this.hedgingTimer).unref)===null||r===void 0||r.call(t)}startNewAttempt(){let e=this.channel.createLoadBalancingCall(this.callConfig,this.methodName,this.host,this.credentials,this.deadline);this.trace("Created child call ["+e.getCallNumber()+"] for attempt "+this.attempts);let t=this.underlyingCalls.length;this.underlyingCalls.push({state:"ACTIVE",call:e,nextMessageToSend:0});let r=this.attempts-1,i=this.initialMetadata.clone();r>0&&i.set(dv,`${r}`);let s=!1;e.start(i,{onReceiveMetadata:o=>{this.trace("Received metadata from child ["+e.getCallNumber()+"]"),this.commitCall(t),s=!0,r>0&&o.set(dv,`${r}`),this.underlyingCalls[t].state==="ACTIVE"&&this.listener.onReceiveMetadata(o)},onReceiveMessage:o=>{this.trace("Received message from child ["+e.getCallNumber()+"]"),this.commitCall(t),this.underlyingCalls[t].state==="ACTIVE"&&this.listener.onReceiveMessage(o)},onReceiveStatus:o=>{this.trace("Received status from child ["+e.getCallNumber()+"]"),!s&&r>0&&o.metadata.set(dv,`${r}`),this.handleChildStatus(o,t)}}),this.sendNextChildMessage(t),this.readStarted&&e.startRead()}start(e,t){this.trace("start called"),this.listener=t,this.initialMetadata=e,this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer()}handleChildWriteCompleted(e){var t,r;let i=this.underlyingCalls[e],s=i.nextMessageToSend;(r=(t=this.getBufferEntry(s)).callback)===null||r===void 0||r.call(t),this.clearSentMessages(),i.nextMessageToSend+=1,this.sendNextChildMessage(e)}sendNextChildMessage(e){let t=this.underlyingCalls[e];if(t.state!=="COMPLETED"&&this.getBufferEntry(t.nextMessageToSend)){let r=this.getBufferEntry(t.nextMessageToSend);switch(r.entryType){case"MESSAGE":t.call.sendMessageWithContext({callback:i=>{this.handleChildWriteCompleted(e)}},r.message.message);break;case"HALF_CLOSE":t.nextMessageToSend+=1,t.call.halfClose();break;case"FREED":break}}}sendMessageWithContext(e,t){var r;this.trace("write() called with message of length "+t.length);let i={message:t,flags:e.flags},s=this.getNextBufferIndex(),o={entryType:"MESSAGE",message:i,allocated:this.bufferTracker.allocate(t.length,this.callNumber)};if(this.writeBuffer.push(o),o.allocated){(r=e.callback)===null||r===void 0||r.call(e);for(let[a,l]of this.underlyingCalls.entries())l.state==="ACTIVE"&&l.nextMessageToSend===s&&l.call.sendMessageWithContext({callback:c=>{this.handleChildWriteCompleted(a)}},t)}else{if(this.commitCallWithMostMessages(),this.committedCallIndex===null)return;let a=this.underlyingCalls[this.committedCallIndex];o.callback=e.callback,a.state==="ACTIVE"&&a.nextMessageToSend===s&&a.call.sendMessageWithContext({callback:l=>{this.handleChildWriteCompleted(this.committedCallIndex)}},t)}}startRead(){this.trace("startRead called"),this.readStarted=!0;for(let e of this.underlyingCalls)e?.state==="ACTIVE"&&e.call.startRead()}halfClose(){this.trace("halfClose called");let e=this.getNextBufferIndex();this.writeBuffer.push({entryType:"HALF_CLOSE",allocated:!1});for(let t of this.underlyingCalls)t?.state==="ACTIVE"&&t.nextMessageToSend===e&&(t.nextMessageToSend+=1,t.call.halfClose())}setCredentials(e){throw new Error("Method not implemented.")}getMethod(){return this.methodName}getHost(){return this.host}};ui.RetryingCall=pv});var ah=E(oh=>{"use strict";Object.defineProperty(oh,"__esModule",{value:!0});oh.BaseSubchannelWrapper=void 0;var gv=class{constructor(e){this.child=e}getConnectivityState(){return this.child.getConnectivityState()}addConnectivityStateListener(e){this.child.addConnectivityStateListener(e)}removeConnectivityStateListener(e){this.child.removeConnectivityStateListener(e)}startConnecting(){this.child.startConnecting()}getAddress(){return this.child.getAddress()}throttleKeepalive(e){this.child.throttleKeepalive(e)}ref(){this.child.ref()}unref(){this.child.unref()}getChannelzRef(){return this.child.getChannelzRef()}getRealSubchannel(){return this.child.getRealSubchannel()}realSubchannelEquals(e){return this.getRealSubchannel()===e.getRealSubchannel()}};oh.BaseSubchannelWrapper=gv});var EI=E(uh=>{"use strict";Object.defineProperty(uh,"__esModule",{value:!0});uh.InternalChannel=void 0;var ZB=Gu(),eV=GT(),tV=aI(),SI=Wr(),Fl=ce(),nV=ev(),rV=dI(),_I=zn(),mv=Fe(),iV=fI(),sV=jy(),lh=Wt(),nr=nn(),Ll=ns(),oV=gI(),aV=Xd(),lV=yI(),yv=Wy(),cV=Zd(),vv=vI(),uV=ah(),dV=2147483647,hV=1e3,fV=30*60*1e3,ch=new Map,pV=1<<24,gV=1<<20,Sv=class extends uV.BaseSubchannelWrapper{constructor(e,t){super(e),this.channel=t,this.refCount=0,this.subchannelStateListener=(r,i,s,o)=>{t.throttleKeepalive(o)},e.addConnectivityStateListener(this.subchannelStateListener)}ref(){this.child.ref(),this.refCount+=1}unref(){this.child.unref(),this.refCount-=1,this.refCount<=0&&(this.child.removeConnectivityStateListener(this.subchannelStateListener),this.channel.removeWrappedSubchannel(this))}},_v=class{constructor(e,t,r){var i,s,o,a,l,c,u,d;if(this.credentials=t,this.options=r,this.connectivityState=nr.ConnectivityState.IDLE,this.currentPicker=new SI.UnavailablePicker,this.configSelectionQueue=[],this.pickQueue=[],this.connectivityStateWatchers=[],this.configSelector=null,this.currentResolutionError=null,this.wrappedSubchannels=new Set,this.callCount=0,this.idleTimer=null,this.channelzEnabled=!0,this.callTracker=new Ll.ChannelzCallTracker,this.childrenTracker=new Ll.ChannelzChildrenTracker,typeof e!="string")throw new TypeError("Channel target must be a string");if(!(t instanceof ZB.ChannelCredentials))throw new TypeError("Channel credentials must be a ChannelCredentials object");if(r&&typeof r!="object")throw new TypeError("Channel options must be an object");this.originalTarget=e;let h=(0,lh.parseUri)(e);if(h===null)throw new Error(`Could not parse target name "${e}"`);let p=(0,_I.mapUriDefaultScheme)(h);if(p===null)throw new Error(`Could not find a default scheme for target name "${e}"`);this.callRefTimer=setInterval(()=>{},dV),(s=(i=this.callRefTimer).unref)===null||s===void 0||s.call(i),this.options["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzTrace=new Ll.ChannelzTrace,this.channelzRef=(0,Ll.registerChannelzChannel)(e,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Channel created"),this.options["grpc.default_authority"]?this.defaultAuthority=this.options["grpc.default_authority"]:this.defaultAuthority=(0,_I.getDefaultAuthority)(p);let y=(0,sV.mapProxyName)(p,r);this.target=y.target,this.options=Object.assign({},this.options,y.extraOptions),this.subchannelPool=(0,tV.getSubchannelPool)(((o=r["grpc.use_local_subchannel_pool"])!==null&&o!==void 0?o:0)===0),this.retryBufferTracker=new vv.MessageBufferTracker((a=r["grpc.retry_buffer_size"])!==null&&a!==void 0?a:pV,(l=r["grpc.per_rpc_retry_buffer_size"])!==null&&l!==void 0?l:gV),this.keepaliveTime=(c=r["grpc.keepalive_time_ms"])!==null&&c!==void 0?c:-1,this.idleTimeoutMs=Math.max((u=r["grpc.client_idle_timeout_ms"])!==null&&u!==void 0?u:fV,hV);let S={createSubchannel:(k,w)=>{let x=this.subchannelPool.getOrCreateSubchannel(this.target,k,Object.assign({},this.options,w),this.credentials);x.throttleKeepalive(this.keepaliveTime),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Created subchannel or used existing subchannel",x.getChannelzRef());let M=new Sv(x,this);return this.wrappedSubchannels.add(M),M},updateState:(k,w)=>{this.currentPicker=w;let x=this.pickQueue.slice();this.pickQueue=[],x.length>0&&this.callRefTimerUnref();for(let M of x)M.doPick();this.updateState(k)},requestReresolution:()=>{throw new Error("Resolving load balancer should never call requestReresolution")},addChannelzChild:k=>{this.channelzEnabled&&this.childrenTracker.refChild(k)},removeChannelzChild:k=>{this.channelzEnabled&&this.childrenTracker.unrefChild(k)}};this.resolvingLoadBalancer=new eV.ResolvingLoadBalancer(this.target,S,r,(k,w)=>{k.retryThrottling?ch.set(this.getTarget(),new vv.RetryThrottler(k.retryThrottling.maxTokens,k.retryThrottling.tokenRatio,ch.get(this.getTarget()))):ch.delete(this.getTarget()),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Address resolution succeeded"),this.configSelector=w,this.currentResolutionError=null,process.nextTick(()=>{let x=this.configSelectionQueue;this.configSelectionQueue=[],x.length>0&&this.callRefTimerUnref();for(let M of x)M.getConfig()})},k=>{this.channelzEnabled&&this.channelzTrace.addTrace("CT_WARNING","Address resolution failed with code "+k.code+' and details "'+k.details+'"'),this.configSelectionQueue.length>0&&this.trace("Name resolution failed with calls queued for config selection"),this.configSelector===null&&(this.currentResolutionError=Object.assign(Object.assign({},(0,cV.restrictControlPlaneStatusCode)(k.code,k.details)),{metadata:k.metadata}));let w=this.configSelectionQueue;this.configSelectionQueue=[],w.length>0&&this.callRefTimerUnref();for(let x of w)x.reportResolverError(k)}),this.filterStackFactory=new nV.FilterStackFactory([new iV.MaxMessageSizeFilterFactory(this.options),new rV.CompressionFilterFactory(this,this.options)]),this.trace("Channel constructed with options "+JSON.stringify(r,void 0,2));let _=new Error;(0,mv.trace)(Fl.LogVerbosity.DEBUG,"channel_stacktrace","("+this.channelzRef.id+`) Channel constructed 
`+((d=_.stack)===null||d===void 0?void 0:d.substring(_.stack.indexOf(`
`)+1)))}getChannelzInfo(){return{target:this.originalTarget,state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists()}}trace(e,t){(0,mv.trace)(t??Fl.LogVerbosity.DEBUG,"channel","("+this.channelzRef.id+") "+(0,lh.uriToString)(this.target)+" "+e)}callRefTimerRef(){var e,t,r,i;!((t=(e=this.callRefTimer).hasRef)===null||t===void 0)&&t.call(e)||(this.trace("callRefTimer.ref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),(i=(r=this.callRefTimer).ref)===null||i===void 0||i.call(r))}callRefTimerUnref(){var e,t;(!this.callRefTimer.hasRef||this.callRefTimer.hasRef())&&(this.trace("callRefTimer.unref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),(t=(e=this.callRefTimer).unref)===null||t===void 0||t.call(e))}removeConnectivityStateWatcher(e){let t=this.connectivityStateWatchers.findIndex(r=>r===e);t>=0&&this.connectivityStateWatchers.splice(t,1)}updateState(e){(0,mv.trace)(Fl.LogVerbosity.DEBUG,"connectivity_state","("+this.channelzRef.id+") "+(0,lh.uriToString)(this.target)+" "+nr.ConnectivityState[this.connectivityState]+" -> "+nr.ConnectivityState[e]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+nr.ConnectivityState[e]),this.connectivityState=e;let t=this.connectivityStateWatchers.slice();for(let r of t)e!==r.currentState&&(r.timer&&clearTimeout(r.timer),this.removeConnectivityStateWatcher(r),r.callback());e!==nr.ConnectivityState.TRANSIENT_FAILURE&&(this.currentResolutionError=null)}throttleKeepalive(e){if(e>this.keepaliveTime){this.keepaliveTime=e;for(let t of this.wrappedSubchannels)t.throttleKeepalive(e)}}removeWrappedSubchannel(e){this.wrappedSubchannels.delete(e)}doPick(e,t){return this.currentPicker.pick({metadata:e,extraPickInfo:t})}queueCallForPick(e){this.pickQueue.push(e),this.callRefTimerRef()}getConfig(e,t){return this.resolvingLoadBalancer.exitIdle(),this.configSelector?{type:"SUCCESS",config:this.configSelector(e,t)}:this.currentResolutionError?{type:"ERROR",error:this.currentResolutionError}:{type:"NONE"}}queueCallForConfig(e){this.configSelectionQueue.push(e),this.callRefTimerRef()}enterIdle(){this.resolvingLoadBalancer.destroy(),this.updateState(nr.ConnectivityState.IDLE),this.currentPicker=new SI.QueuePicker(this.resolvingLoadBalancer)}maybeStartIdleTimer(){var e,t;this.connectivityState!==nr.ConnectivityState.SHUTDOWN&&this.callCount===0&&(this.idleTimer=setTimeout(()=>{this.trace("Idle timer triggered after "+this.idleTimeoutMs+"ms of inactivity"),this.enterIdle()},this.idleTimeoutMs),(t=(e=this.idleTimer).unref)===null||t===void 0||t.call(e))}onCallStart(){this.channelzEnabled&&this.callTracker.addCallStarted(),this.callCount+=1,this.idleTimer&&(clearTimeout(this.idleTimer),this.idleTimer=null)}onCallEnd(e){this.channelzEnabled&&(e.code===Fl.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()),this.callCount-=1,this.maybeStartIdleTimer()}createLoadBalancingCall(e,t,r,i,s){let o=(0,yv.getNextCallNumber)();return this.trace("createLoadBalancingCall ["+o+'] method="'+t+'"'),new oV.LoadBalancingCall(this,e,t,r,i,s,o)}createRetryingCall(e,t,r,i,s){let o=(0,yv.getNextCallNumber)();return this.trace("createRetryingCall ["+o+'] method="'+t+'"'),new vv.RetryingCall(this,e,t,r,i,s,o,this.retryBufferTracker,ch.get(this.getTarget()))}createInnerCall(e,t,r,i,s){return this.options["grpc.enable_retries"]===0?this.createLoadBalancingCall(e,t,r,i,s):this.createRetryingCall(e,t,r,i,s)}createResolvingCall(e,t,r,i,s){let o=(0,yv.getNextCallNumber)();this.trace("createResolvingCall ["+o+'] method="'+e+'", deadline='+(0,aV.deadlineToString)(t));let a={deadline:t,flags:s??Fl.Propagate.DEFAULTS,host:r??this.defaultAuthority,parentCall:i},l=new lV.ResolvingCall(this,e,a,this.filterStackFactory.clone(),this.credentials._getCallCredentials(),o);return this.onCallStart(),l.addStatusWatcher(c=>{this.onCallEnd(c)}),l}close(){this.resolvingLoadBalancer.destroy(),this.updateState(nr.ConnectivityState.SHUTDOWN),clearInterval(this.callRefTimer),this.idleTimer&&clearTimeout(this.idleTimer),this.channelzEnabled&&(0,Ll.unregisterChannelzRef)(this.channelzRef),this.subchannelPool.unrefUnusedSubchannels()}getTarget(){return(0,lh.uriToString)(this.target)}getConnectivityState(e){let t=this.connectivityState;return e&&(this.resolvingLoadBalancer.exitIdle(),this.maybeStartIdleTimer()),t}watchConnectivityState(e,t,r){if(this.connectivityState===nr.ConnectivityState.SHUTDOWN)throw new Error("Channel has been shut down");let i=null;if(t!==1/0){let o=t instanceof Date?t:new Date(t),a=new Date;if(t===-1/0||o<=a){process.nextTick(r,new Error("Deadline passed without connectivity state change"));return}i=setTimeout(()=>{this.removeConnectivityStateWatcher(s),r(new Error("Deadline passed without connectivity state change"))},o.getTime()-a.getTime())}let s={currentState:e,callback:r,timer:i};this.connectivityStateWatchers.push(s)}getChannelzRef(){return this.channelzRef}createCall(e,t,r,i,s){if(typeof e!="string")throw new TypeError("Channel#createCall: method must be a string");if(!(typeof t=="number"||t instanceof Date))throw new TypeError("Channel#createCall: deadline must be a number or Date");if(this.connectivityState===nr.ConnectivityState.SHUTDOWN)throw new Error("Channel has been shut down");return this.createResolvingCall(e,t,r,i,s)}};uh.InternalChannel=_v});var Cm=E(dh=>{"use strict";Object.defineProperty(dh,"__esModule",{value:!0});dh.ChannelImplementation=void 0;var mV=Gu(),yV=EI(),Ev=class{constructor(e,t,r){if(typeof e!="string")throw new TypeError("Channel target must be a string");if(!(t instanceof mV.ChannelCredentials))throw new TypeError("Channel credentials must be a ChannelCredentials object");if(r&&typeof r!="object")throw new TypeError("Channel options must be an object");this.internalChannel=new yV.InternalChannel(e,t,r)}close(){this.internalChannel.close()}getTarget(){return this.internalChannel.getTarget()}getConnectivityState(e){return this.internalChannel.getConnectivityState(e)}watchConnectivityState(e,t,r){this.internalChannel.watchConnectivityState(e,t,r)}getChannelzRef(){return this.internalChannel.getChannelzRef()}createCall(e,t,r,i,s){if(typeof e!="string")throw new TypeError("Channel#createCall: method must be a string");if(!(typeof t=="number"||t instanceof Date))throw new TypeError("Channel#createCall: deadline must be a number or Date");return this.internalChannel.createCall(e,t,r,i,s)}};dh.ChannelImplementation=Ev});var NI=E(hn=>{"use strict";Object.defineProperty(hn,"__esModule",{value:!0});hn.Http2ServerCallStream=hn.ServerDuplexStreamImpl=hn.ServerWritableStreamImpl=hn.ServerReadableStreamImpl=hn.ServerUnaryCallImpl=void 0;var AI=he("events"),Po=he("http2"),Cv=he("stream"),II=he("zlib"),DI=he("util"),De=ce(),bv=Nt(),vV=Hy(),RI=Fe(),Vl=Bu(),kI="server_call",SV=(0,DI.promisify)(II.unzip),_V=(0,DI.promisify)(II.inflate);function Bl(n){RI.trace(De.LogVerbosity.DEBUG,kI,n)}var EV="grpc-accept-encoding",wV="grpc-encoding",wI="grpc-message",TI="grpc-status",CI="grpc-timeout",TV=/(\d{1,8})\s*([HMSmun])/,CV={H:36e5,M:6e4,S:1e3,m:1,u:.001,n:1e-6},bV={[EV]:"identity,deflate,gzip",[wV]:"identity"},bI={[Po.constants.HTTP2_HEADER_STATUS]:Po.constants.HTTP_STATUS_OK,[Po.constants.HTTP2_HEADER_CONTENT_TYPE]:"application/grpc+proto"},AV={waitForTrailers:!0},wv=class extends AI.EventEmitter{constructor(e,t,r){super(),this.call=e,this.metadata=t,this.request=r,this.cancelled=!1,this.call.setupSurfaceCall(this)}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}};hn.ServerUnaryCallImpl=wv;var hh=class extends Cv.Readable{constructor(e,t,r,i){super({objectMode:!0}),this.call=e,this.metadata=t,this.deserialize=r,this.cancelled=!1,this.call.setupSurfaceCall(this),this.call.setupReadable(this,i)}_read(e){this.call.consumeUnpushedMessages(this)&&this.call.resume()}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}};hn.ServerReadableStreamImpl=hh;var ql=class extends Cv.Writable{constructor(e,t,r,i){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=r,this.request=i,this.cancelled=!1,this.trailingMetadata=new bv.Metadata,this.call.setupSurfaceCall(this),this.on("error",s=>{this.call.sendError(s),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}_write(e,t,r){try{let i=this.call.serializeMessage(e);if(!this.call.write(i)){this.call.once("drain",r);return}}catch(i){this.emit("error",{details:(0,Vl.getErrorMessage)(i),code:De.Status.INTERNAL})}r()}_final(e){this.call.sendStatus({code:De.Status.OK,details:"OK",metadata:this.trailingMetadata}),e(null)}end(e){return e&&(this.trailingMetadata=e),super.end()}};hn.ServerWritableStreamImpl=ql;var Fo=class extends Cv.Duplex{constructor(e,t,r,i,s){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=r,this.deserialize=i,this.cancelled=!1,this.trailingMetadata=new bv.Metadata,this.call.setupSurfaceCall(this),this.call.setupReadable(this,s),this.on("error",o=>{this.call.sendError(o),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}end(e){return e&&(this.trailingMetadata=e),super.end()}};hn.ServerDuplexStreamImpl=Fo;Fo.prototype._read=hh.prototype._read;Fo.prototype._write=ql.prototype._write;Fo.prototype._final=ql.prototype._final;var Tv=class extends AI.EventEmitter{constructor(e,t,r){super(),this.stream=e,this.handler=t,this.cancelled=!1,this.deadlineTimer=null,this.statusSent=!1,this.deadline=1/0,this.wantTrailers=!1,this.metadataSent=!1,this.canPush=!1,this.isPushPending=!1,this.bufferedMessages=[],this.messagesToPush=[],this.maxSendMessageSize=De.DEFAULT_MAX_SEND_MESSAGE_LENGTH,this.maxReceiveMessageSize=De.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,this.stream.once("error",i=>{}),this.stream.once("close",()=>{var i;Bl("Request to method "+((i=this.handler)===null||i===void 0?void 0:i.path)+" stream closed with rstCode "+this.stream.rstCode),this.statusSent||(this.cancelled=!0,this.emit("cancelled","cancelled"),this.emit("streamEnd",!1),this.sendStatus({code:De.Status.CANCELLED,details:"Cancelled by client",metadata:null}),this.deadlineTimer&&clearTimeout(this.deadlineTimer))}),this.stream.on("drain",()=>{this.emit("drain")}),"grpc.max_send_message_length"in r&&(this.maxSendMessageSize=r["grpc.max_send_message_length"]),"grpc.max_receive_message_length"in r&&(this.maxReceiveMessageSize=r["grpc.max_receive_message_length"])}checkCancelled(){return(this.stream.destroyed||this.stream.closed)&&(this.cancelled=!0),this.cancelled}getDecompressedMessage(e,t){return t==="deflate"?_V(e.subarray(5)):t==="gzip"?SV(e.subarray(5)):t==="identity"?e.subarray(5):Promise.reject({code:De.Status.UNIMPLEMENTED,details:`Received message compressed with unsupported encoding "${t}"`})}sendMetadata(e){if(this.checkCancelled()||this.metadataSent)return;this.metadataSent=!0;let t=e?e.toHttp2Headers():null,r=Object.assign(Object.assign(Object.assign({},bI),bV),t);this.stream.respond(r,AV)}receiveMetadata(e){let t=bv.Metadata.fromHttp2Headers(e);RI.isTracerEnabled(kI)&&Bl("Request to "+this.handler.path+" received headers "+JSON.stringify(t.toJSON()));let r=t.get(CI);if(r.length>0){let i=r[0].toString().match(TV);if(i===null){let a=new Error("Invalid deadline");return a.code=De.Status.OUT_OF_RANGE,this.sendError(a),t}let s=+i[1]*CV[i[2]]|0,o=new Date;this.deadline=o.setMilliseconds(o.getMilliseconds()+s),this.deadlineTimer=setTimeout(IV,s,this),t.remove(CI)}return t.remove(Po.constants.HTTP2_HEADER_ACCEPT_ENCODING),t.remove(Po.constants.HTTP2_HEADER_TE),t.remove(Po.constants.HTTP2_HEADER_CONTENT_TYPE),t.remove("grpc-accept-encoding"),t}receiveUnaryMessage(e){return new Promise((t,r)=>{let{stream:i}=this,s=0,o=this,a=[],l=this.maxReceiveMessageSize;this.stream.on("data",c),this.stream.on("end",u),this.stream.on("error",u);function c(d){if(s+=d.byteLength,l!==-1&&s>l){i.removeListener("data",c),i.removeListener("end",u),i.removeListener("error",u),r({code:De.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${s} vs. ${l})`});return}a.push(d)}function u(d){if(i.removeListener("data",c),i.removeListener("end",u),i.removeListener("error",u),d!==void 0){r({code:De.Status.INTERNAL,details:d.message});return}if(s===0){r({code:De.Status.INTERNAL,details:"received empty unary message"});return}o.emit("receiveMessage");let h=Buffer.concat(a,s),y=h.readUInt8(0)===1?e:"identity",S=o.getDecompressedMessage(h,y);if(Buffer.isBuffer(S)){t(o.deserializeMessageWithInternalError(S));return}S.then(_=>t(o.deserializeMessageWithInternalError(_)),_=>r(_.code?_:{code:De.Status.INTERNAL,details:`Received "grpc-encoding" header "${e}" but ${e} decompression failed`}))}})}deserializeMessageWithInternalError(e){return g(this,null,function*(){try{return this.deserializeMessage(e)}catch(t){throw{details:(0,Vl.getErrorMessage)(t),code:De.Status.INTERNAL}}})}serializeMessage(e){let t=this.handler.serialize(e),r=t.byteLength,i=Buffer.allocUnsafe(r+5);return i.writeUInt8(0,0),i.writeUInt32BE(r,1),t.copy(i,5),i}deserializeMessage(e){return this.handler.deserialize(e)}sendUnaryMessage(e,t,r,i){return g(this,null,function*(){if(!this.checkCancelled()){if(r===void 0&&(r=null),e){!Object.prototype.hasOwnProperty.call(e,"metadata")&&r&&(e.metadata=r),this.sendError(e);return}try{let s=this.serializeMessage(t);this.write(s),this.sendStatus({code:De.Status.OK,details:"OK",metadata:r})}catch(s){this.sendError({details:(0,Vl.getErrorMessage)(s),code:De.Status.INTERNAL})}}})}sendStatus(e){var t,r;if(this.emit("callEnd",e.code),this.emit("streamEnd",e.code===De.Status.OK),!this.checkCancelled())if(Bl("Request to method "+((t=this.handler)===null||t===void 0?void 0:t.path)+" ended with status code: "+De.Status[e.code]+" details: "+e.details),this.deadlineTimer&&clearTimeout(this.deadlineTimer),this.stream.headersSent)this.wantTrailers||(this.wantTrailers=!0,this.stream.once("wantTrailers",()=>{var i;let s=Object.assign({[TI]:e.code,[wI]:encodeURI(e.details)},(i=e.metadata)===null||i===void 0?void 0:i.toHttp2Headers());this.stream.sendTrailers(s),this.statusSent=!0}),this.stream.end());else{let i=Object.assign(Object.assign({[TI]:e.code,[wI]:encodeURI(e.details)},bI),(r=e.metadata)===null||r===void 0?void 0:r.toHttp2Headers());this.stream.respond(i,{endStream:!0}),this.statusSent=!0}}sendError(e){let t={code:De.Status.UNKNOWN,details:"message"in e?e.message:"Unknown Error",metadata:"metadata"in e&&e.metadata!==void 0?e.metadata:null};"code"in e&&typeof e.code=="number"&&Number.isInteger(e.code)&&(t.code=e.code,"details"in e&&typeof e.details=="string"&&(t.details=e.details)),this.sendStatus(t)}write(e){if(!this.checkCancelled()){if(this.maxSendMessageSize!==-1&&e.length>this.maxSendMessageSize){this.sendError({code:De.Status.RESOURCE_EXHAUSTED,details:`Sent message larger than max (${e.length} vs. ${this.maxSendMessageSize})`});return}return this.sendMetadata(),this.emit("sendMessage"),this.stream.write(e)}}resume(){this.stream.resume()}setupSurfaceCall(e){this.once("cancelled",t=>{e.cancelled=!0,e.emit("cancelled",t)}),this.once("callEnd",t=>e.emit("callEnd",t))}setupReadable(e,t){let r=new vV.StreamDecoder,i=!1,s=!1,o=!1,a=()=>g(this,null,function*(){!o&&i&&!s&&(o=!0,yield this.pushOrBufferMessage(e,null))});this.stream.on("data",l=>g(this,null,function*(){let c=r.write(l);s=!0,this.stream.pause();for(let u of c){if(this.maxReceiveMessageSize!==-1&&u.length>this.maxReceiveMessageSize){this.sendError({code:De.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${u.length} vs. ${this.maxReceiveMessageSize})`});return}this.emit("receiveMessage");let h=u.readUInt8(0)===1?t:"identity",p=yield this.getDecompressedMessage(u,h);if(!p)return;yield this.pushOrBufferMessage(e,p)}s=!1,this.stream.resume(),yield a()})),this.stream.once("end",()=>g(this,null,function*(){i=!0,yield a()}))}consumeUnpushedMessages(e){for(this.canPush=!0;this.messagesToPush.length>0;){let t=this.messagesToPush.shift(),r=e.push(t);if(t===null||r===!1){this.canPush=!1;break}}return this.canPush}pushOrBufferMessage(e,t){return g(this,null,function*(){this.isPushPending?this.bufferedMessages.push(t):yield this.pushMessage(e,t)})}pushMessage(e,t){return g(this,null,function*(){if(t===null){Bl("Received end of stream"),this.canPush?e.push(null):this.messagesToPush.push(null);return}Bl("Received message of length "+t.length),this.isPushPending=!0;try{let r=yield this.deserializeMessage(t);this.canPush?e.push(r)||(this.canPush=!1,this.stream.pause()):this.messagesToPush.push(r)}catch(r){this.bufferedMessages.length=0;let i=(0,Vl.getErrorCode)(r);(i===null||i<De.Status.OK||i>De.Status.UNAUTHENTICATED)&&(i=De.Status.INTERNAL),e.emit("error",{details:(0,Vl.getErrorMessage)(r),code:i})}this.isPushPending=!1,this.bufferedMessages.length>0&&(yield this.pushMessage(e,this.bufferedMessages.shift()))})}getPeer(){var e;let t=(e=this.stream.session)===null||e===void 0?void 0:e.socket;return t?.remoteAddress?t.remotePort?`${t.remoteAddress}:${t.remotePort}`:t.remoteAddress:"unknown"}getDeadline(){return this.deadline}getPath(){return this.handler.path}};hn.Http2ServerCallStream=Tv;function IV(n){let e=new Error("Deadline exceeded");e.code=De.Status.DEADLINE_EXCEEDED,n.sendError(e),n.cancelled=!0,n.emit("cancelled","deadline")}});var Dv=E(fh=>{"use strict";Object.defineProperty(fh,"__esModule",{value:!0});fh.ServerCredentials=void 0;var xI=$g(),Ul=class{static createInsecure(){return new Av}static createSsl(e,t,r=!1){if(e!==null&&!Buffer.isBuffer(e))throw new TypeError("rootCerts must be null or a Buffer");if(!Array.isArray(t))throw new TypeError("keyCertPairs must be an array");if(typeof r!="boolean")throw new TypeError("checkClientCertificate must be a boolean");let i=[],s=[];for(let o=0;o<t.length;o++){let a=t[o];if(a===null||typeof a!="object")throw new TypeError(`keyCertPair[${o}] must be an object`);if(!Buffer.isBuffer(a.private_key))throw new TypeError(`keyCertPair[${o}].private_key must be a Buffer`);if(!Buffer.isBuffer(a.cert_chain))throw new TypeError(`keyCertPair[${o}].cert_chain must be a Buffer`);i.push(a.cert_chain),s.push(a.private_key)}return new Iv({ca:e||(0,xI.getDefaultRootsData)()||void 0,cert:i,key:s,requestCert:r,ciphers:xI.CIPHER_SUITES})}};fh.ServerCredentials=Ul;var Av=class extends Ul{_isSecure(){return!1}_getSettings(){return null}},Iv=class extends Ul{constructor(e){super(),this.options=e}_isSecure(){return!0}_getSettings(){return this.options}}});var PI=E(mh=>{"use strict";Object.defineProperty(mh,"__esModule",{value:!0});mh.Server=void 0;var di=he("http2"),Cr=ce(),is=NI(),DV=Dv(),MI=zn(),ph=Fe(),Dn=Gn(),RV=Wt(),jt=ns(),gh=~(1<<31),kV=~(1<<31),NV=2e4,{HTTP2_HEADER_PATH:OI}=di.constants,xV="server";function MV(){}function Rv(n){return{code:Cr.Status.UNIMPLEMENTED,details:`The server does not implement the method ${n}`}}function OV(n,e){let t=Rv(e);switch(n){case"unary":return(r,i)=>{i(t,null)};case"clientStream":return(r,i)=>{i(t,null)};case"serverStream":return r=>{r.emit("error",t)};case"bidi":return r=>{r.emit("error",t)};default:throw new Error(`Invalid handlerType ${n}`)}}var kv=class{constructor(e){var t,r,i,s;this.http2ServerList=[],this.handlers=new Map,this.sessions=new Map,this.started=!1,this.shutdown=!1,this.serverAddressString="null",this.channelzEnabled=!0,this.channelzTrace=new jt.ChannelzTrace,this.callTracker=new jt.ChannelzCallTracker,this.listenerChildrenTracker=new jt.ChannelzChildrenTracker,this.sessionChildrenTracker=new jt.ChannelzChildrenTracker,this.options=e??{},this.options["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzRef=(0,jt.registerChannelzServer)(()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Server created"),this.maxConnectionAgeMs=(t=this.options["grpc.max_connection_age_ms"])!==null&&t!==void 0?t:gh,this.maxConnectionAgeGraceMs=(r=this.options["grpc.max_connection_age_grace_ms"])!==null&&r!==void 0?r:gh,this.keepaliveTimeMs=(i=this.options["grpc.keepalive_time_ms"])!==null&&i!==void 0?i:kV,this.keepaliveTimeoutMs=(s=this.options["grpc.keepalive_timeout_ms"])!==null&&s!==void 0?s:NV,this.trace("Server constructed")}getChannelzInfo(){return{trace:this.channelzTrace,callTracker:this.callTracker,listenerChildren:this.listenerChildrenTracker.getChildLists(),sessionChildren:this.sessionChildrenTracker.getChildLists()}}getChannelzSessionInfoGetter(e){return()=>{var t,r,i;let s=this.sessions.get(e),o=e.socket,a=o.remoteAddress?(0,Dn.stringToSubchannelAddress)(o.remoteAddress,o.remotePort):null,l=o.localAddress?(0,Dn.stringToSubchannelAddress)(o.localAddress,o.localPort):null,c;if(e.encrypted){let d=o,h=d.getCipher(),p=d.getCertificate(),y=d.getPeerCertificate();c={cipherSuiteStandardName:(t=h.standardName)!==null&&t!==void 0?t:null,cipherSuiteOtherName:h.standardName?null:h.name,localCertificate:p&&"raw"in p?p.raw:null,remoteCertificate:y&&"raw"in y?y.raw:null}}else c=null;return{remoteAddress:a,localAddress:l,security:c,remoteName:null,streamsStarted:s.streamTracker.callsStarted,streamsSucceeded:s.streamTracker.callsSucceeded,streamsFailed:s.streamTracker.callsFailed,messagesSent:s.messagesSent,messagesReceived:s.messagesReceived,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:s.streamTracker.lastCallStartedTimestamp,lastMessageSentTimestamp:s.lastMessageSentTimestamp,lastMessageReceivedTimestamp:s.lastMessageReceivedTimestamp,localFlowControlWindow:(r=e.state.localWindowSize)!==null&&r!==void 0?r:null,remoteFlowControlWindow:(i=e.state.remoteWindowSize)!==null&&i!==void 0?i:null}}}trace(e){ph.trace(Cr.LogVerbosity.DEBUG,xV,"("+this.channelzRef.id+") "+e)}addProtoService(){throw new Error("Not implemented. Use addService() instead")}addService(e,t){if(e===null||typeof e!="object"||t===null||typeof t!="object")throw new Error("addService() requires two objects as arguments");let r=Object.keys(e);if(r.length===0)throw new Error("Cannot add an empty service to a server");r.forEach(i=>{let s=e[i],o;s.requestStream?s.responseStream?o="bidi":o="clientStream":s.responseStream?o="serverStream":o="unary";let a=t[i],l;if(a===void 0&&typeof s.originalName=="string"&&(a=t[s.originalName]),a!==void 0?l=a.bind(t):l=OV(o,i),this.register(s.path,l,s.responseSerialize,s.requestDeserialize,o)===!1)throw new Error(`Method handler for ${s.path} already provided.`)})}removeService(e){if(e===null||typeof e!="object")throw new Error("removeService() requires object as argument");Object.keys(e).forEach(r=>{let i=e[r];this.unregister(i.path)})}bind(e,t){throw new Error("Not implemented. Use bindAsync() instead")}bindAsync(e,t,r){if(this.started===!0)throw new Error("server is already started");if(this.shutdown)throw new Error("bindAsync called after shutdown");if(typeof e!="string")throw new TypeError("port must be a string");if(t===null||!(t instanceof DV.ServerCredentials))throw new TypeError("creds must be a ServerCredentials object");if(typeof r!="function")throw new TypeError("callback must be a function");let i=(0,RV.parseUri)(e);if(i===null)throw new Error(`Could not parse port "${e}"`);let s=(0,MI.mapUriDefaultScheme)(i);if(s===null)throw new Error(`Could not get a default scheme for port "${e}"`);let o={maxSendHeaderBlockLength:Number.MAX_SAFE_INTEGER};"grpc-node.max_session_memory"in this.options?o.maxSessionMemory=this.options["grpc-node.max_session_memory"]:o.maxSessionMemory=Number.MAX_SAFE_INTEGER,"grpc.max_concurrent_streams"in this.options&&(o.settings={maxConcurrentStreams:this.options["grpc.max_concurrent_streams"]});let a=(p,y)=>{process.nextTick(()=>r(p,y))},l=()=>{let p;if(t._isSecure()){let y=Object.assign(o,t._getSettings());y.enableTrace=this.options["grpc-node.tls_enable_trace"]===1,p=di.createSecureServer(y),p.on("secureConnection",S=>{S.on("error",_=>{this.trace("An incoming TLS connection closed with error: "+_.message)})})}else p=di.createServer(o);return p.setTimeout(0,MV),this._setupHandlers(p),p},c=(p,y,S)=>p.length===0?Promise.resolve({port:y,count:S}):Promise.all(p.map(_=>{this.trace("Attempting to bind "+(0,Dn.subchannelAddressToString)(_));let k;(0,Dn.isTcpSubchannelAddress)(_)?k={host:_.host,port:y}:k=_;let w=l();return new Promise((x,M)=>{let z=$=>{this.trace("Failed to bind "+(0,Dn.subchannelAddressToString)(_)+" with error "+$.message),x($)};w.once("error",z),w.listen(k,()=>{if(this.shutdown){w.close(),x(new Error("bindAsync failed because server is shutdown"));return}let $=w.address(),te;typeof $=="string"?te={path:$}:te={host:$.address,port:$.port};let Je=(0,jt.registerChannelzSocket)((0,Dn.subchannelAddressToString)(te),()=>({localAddress:te,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(Je),this.http2ServerList.push({server:w,channelzRef:Je}),this.trace("Successfully bound "+(0,Dn.subchannelAddressToString)(te)),x("port"in te?te.port:y),w.removeListener("error",z)})})})).then(_=>{let k=0;for(let w of _)if(typeof w=="number"&&(k+=1,w!==y))throw new Error("Invalid state: multiple port numbers added from single address");return{port:y,count:k+S}}),u=p=>{if(p.length===0)return Promise.resolve({port:0,count:0});let y=p[0],S=l();return new Promise((_,k)=>{let w=x=>{this.trace("Failed to bind "+(0,Dn.subchannelAddressToString)(y)+" with error "+x.message),_(u(p.slice(1)))};S.once("error",w),S.listen(y,()=>{if(this.shutdown){S.close(),_({port:0,count:0});return}let x=S.address(),M={host:x.address,port:x.port},z=(0,jt.registerChannelzSocket)((0,Dn.subchannelAddressToString)(M),()=>({localAddress:M,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(z),this.http2ServerList.push({server:S,channelzRef:z}),this.trace("Successfully bound "+(0,Dn.subchannelAddressToString)(M)),_(c(p.slice(1),x.port,1)),S.removeListener("error",w)})})},d={onSuccessfulResolution:(p,y,S)=>{if(d.onSuccessfulResolution=()=>{},this.shutdown&&a(new Error("bindAsync failed because server is shutdown"),0),p.length===0){a(new Error(`No addresses resolved for port ${e}`),0);return}let _;(0,Dn.isTcpSubchannelAddress)(p[0])?p[0].port===0?_=u(p):_=c(p,p[0].port,0):_=c(p,1,0),_.then(k=>{if(k.count===0){let w=`No address added out of total ${p.length} resolved`;ph.log(Cr.LogVerbosity.ERROR,w),a(new Error(w),0)}else k.count<p.length&&ph.log(Cr.LogVerbosity.INFO,`WARNING Only ${k.count} addresses added out of total ${p.length} resolved`),a(null,k.port)},k=>{let w=`No address added out of total ${p.length} resolved`;ph.log(Cr.LogVerbosity.ERROR,w),a(new Error(w),0)})},onError:p=>{a(new Error(p.details),0)}};(0,MI.createResolver)(s,d,this.options).updateResolution()}forceShutdown(){for(let{server:e,channelzRef:t}of this.http2ServerList)e.listening&&e.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(t),(0,jt.unregisterChannelzRef)(t))});this.started=!1,this.shutdown=!0,this.sessions.forEach((e,t)=>{t.destroy(di.constants.NGHTTP2_CANCEL)}),this.sessions.clear(),this.channelzEnabled&&(0,jt.unregisterChannelzRef)(this.channelzRef)}register(e,t,r,i,s){return this.handlers.has(e)?!1:(this.handlers.set(e,{func:t,serialize:r,deserialize:i,type:s,path:e}),!0)}unregister(e){return this.handlers.delete(e)}start(){if(this.http2ServerList.length===0||this.http2ServerList.every(({server:e})=>e.listening!==!0))throw new Error("server must be bound in order to start");if(this.started===!0)throw new Error("server is already started");this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Starting"),this.started=!0}tryShutdown(e){let t=s=>{this.channelzEnabled&&(0,jt.unregisterChannelzRef)(this.channelzRef),e(s)},r=0;function i(){r--,r===0&&t()}this.started=!1,this.shutdown=!0;for(let{server:s,channelzRef:o}of this.http2ServerList)s.listening&&(r++,s.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(o),(0,jt.unregisterChannelzRef)(o)),i()}));this.sessions.forEach((s,o)=>{o.closed||(r+=1,o.close(i))}),r===0&&t()}addHttp2Port(){throw new Error("Not yet implemented")}getChannelzRef(){return this.channelzRef}_verifyContentType(e,t){let r=t[di.constants.HTTP2_HEADER_CONTENT_TYPE];return typeof r!="string"||!r.startsWith("application/grpc")?(e.respond({[di.constants.HTTP2_HEADER_STATUS]:di.constants.HTTP_STATUS_UNSUPPORTED_MEDIA_TYPE},{endStream:!0}),!1):!0}_retrieveHandler(e){this.trace("Received call to method "+e+" at address "+this.serverAddressString);let t=this.handlers.get(e);return t===void 0?(this.trace("No handler registered for method "+e+". Sending UNIMPLEMENTED status."),null):t}_respondWithError(e,t,r=null){let i=new is.Http2ServerCallStream(t,null,this.options);e.code===void 0&&(e.code=Cr.Status.INTERNAL),this.channelzEnabled&&(this.callTracker.addCallFailed(),r?.streamTracker.addCallFailed()),i.sendError(e)}_channelzHandler(e,t){let r=this.sessions.get(e.session);if(this.callTracker.addCallStarted(),r?.streamTracker.addCallStarted(),!this._verifyContentType(e,t)){this.callTracker.addCallFailed(),r?.streamTracker.addCallFailed();return}let i=t[OI],s=this._retrieveHandler(i);if(!s){this._respondWithError(Rv(i),e,r);return}let o=new is.Http2ServerCallStream(e,s,this.options);o.once("callEnd",a=>{a===Cr.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}),r&&(o.once("streamEnd",a=>{a?r.streamTracker.addCallSucceeded():r.streamTracker.addCallFailed()}),o.on("sendMessage",()=>{r.messagesSent+=1,r.lastMessageSentTimestamp=new Date}),o.on("receiveMessage",()=>{r.messagesReceived+=1,r.lastMessageReceivedTimestamp=new Date})),this._runHandlerForCall(o,s,t)||(this.callTracker.addCallFailed(),r?.streamTracker.addCallFailed(),o.sendError({code:Cr.Status.INTERNAL,details:`Unknown handler type: ${s.type}`}))}_streamHandler(e,t){if(this._verifyContentType(e,t)!==!0)return;let r=t[OI],i=this._retrieveHandler(r);if(!i){this._respondWithError(Rv(r),e,null);return}let s=new is.Http2ServerCallStream(e,i,this.options);this._runHandlerForCall(s,i,t)||s.sendError({code:Cr.Status.INTERNAL,details:`Unknown handler type: ${i.type}`})}_runHandlerForCall(e,t,r){var i;let s=e.receiveMetadata(r),o=(i=s.get("grpc-encoding")[0])!==null&&i!==void 0?i:"identity";s.remove("grpc-encoding");let{type:a}=t;if(a==="unary")PV(e,t,s,o);else if(a==="clientStream")FV(e,t,s,o);else if(a==="serverStream")LV(e,t,s,o);else if(a==="bidi")BV(e,t,s,o);else return!1;return!0}_setupHandlers(e){if(e===null)return;let t=e.address(),r="null";t&&(typeof t=="string"?r=t:r=t.address+":"+t.port),this.serverAddressString=r;let i=this.channelzEnabled?this._channelzHandler:this._streamHandler;e.on("stream",i.bind(this)),e.on("session",s=>{var o,a,l,c,u;if(!this.started){s.destroy();return}let d=(0,jt.registerChannelzSocket)((o=s.socket.remoteAddress)!==null&&o!==void 0?o:"unknown",this.getChannelzSessionInfoGetter(s),this.channelzEnabled),h={ref:d,streamTracker:new jt.ChannelzCallTracker,messagesSent:0,messagesReceived:0,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null};this.sessions.set(s,h);let p=s.socket.remoteAddress;this.channelzEnabled&&(this.channelzTrace.addTrace("CT_INFO","Connection established by client "+p),this.sessionChildrenTracker.refChild(d));let y=null,S=null,_=!1;if(this.maxConnectionAgeMs!==gh){let w=this.maxConnectionAgeMs/10,x=Math.random()*w*2-w;y=(l=(a=setTimeout(()=>{var M,z;_=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by max connection age from "+p);try{s.goaway(di.constants.NGHTTP2_NO_ERROR,~(1<<31),Buffer.from("max_age"))}catch{s.destroy();return}s.close(),this.maxConnectionAgeGraceMs!==gh&&(S=(z=(M=setTimeout(()=>{s.destroy()},this.maxConnectionAgeGraceMs)).unref)===null||z===void 0?void 0:z.call(M))},this.maxConnectionAgeMs+x)).unref)===null||l===void 0?void 0:l.call(a)}let k=(u=(c=setInterval(()=>{var w,x;let M=(x=(w=setTimeout(()=>{_=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by keepalive timeout from "+p),s.close()},this.keepaliveTimeoutMs)).unref)===null||x===void 0?void 0:x.call(w);try{s.ping((z,$,te)=>{clearTimeout(M)})}catch{s.destroy()}},this.keepaliveTimeMs)).unref)===null||u===void 0?void 0:u.call(c);s.on("close",()=>{this.channelzEnabled&&(_||this.channelzTrace.addTrace("CT_INFO","Connection dropped by client "+p),this.sessionChildrenTracker.unrefChild(d),(0,jt.unregisterChannelzRef)(d)),y&&clearTimeout(y),S&&clearTimeout(S),k&&clearTimeout(k),this.sessions.delete(s)})})}};mh.Server=kv;function PV(n,e,t,r){return g(this,null,function*(){try{let i=yield n.receiveUnaryMessage(r);if(i===void 0||n.cancelled)return;let s=new is.ServerUnaryCallImpl(n,t,i);e.func(s,(o,a,l,c)=>{n.sendUnaryMessage(o,a,l,c)})}catch(i){n.sendError(i)}})}function FV(n,e,t,r){let i=new is.ServerReadableStreamImpl(n,t,e.deserialize,r);function s(o,a,l,c){i.destroy(),n.sendUnaryMessage(o,a,l,c)}n.cancelled||(i.on("error",s),e.func(i,s))}function LV(n,e,t,r){return g(this,null,function*(){try{let i=yield n.receiveUnaryMessage(r);if(i===void 0||n.cancelled)return;let s=new is.ServerWritableStreamImpl(n,t,e.serialize,i);e.func(s)}catch(i){n.sendError(i)}})}function BV(n,e,t,r){let i=new is.ServerDuplexStreamImpl(n,t,e.serialize,e.deserialize,r);n.cancelled||e.func(i)}});var FI=E(yh=>{"use strict";Object.defineProperty(yh,"__esModule",{value:!0});yh.StatusBuilder=void 0;var Nv=class{constructor(){this.code=null,this.details=null,this.metadata=null}withCode(e){return this.code=e,this}withDetails(e){return this.details=e,this}withMetadata(e){return this.metadata=e,this}build(){let e={};return this.code!==null&&(e.code=this.code),this.details!==null&&(e.details=this.details),this.metadata!==null&&(e.metadata=this.metadata),e}};yh.StatusBuilder=Nv});var xv=E(hi=>{"use strict";Object.defineProperty(hi,"__esModule",{value:!0});hi.isDuration=hi.durationToMs=hi.msToDuration=void 0;function VV(n){return{seconds:n/1e3|0,nanos:n%1e3*1e6|0}}hi.msToDuration=VV;function qV(n){return n.seconds*1e3+n.nanos/1e6|0}hi.durationToMs=qV;function UV(n){return typeof n.seconds=="number"&&typeof n.nanos=="number"}hi.isDuration=UV});var qv=E(fi=>{"use strict";var Mv;Object.defineProperty(fi,"__esModule",{value:!0});fi.setup=fi.OutlierDetectionLoadBalancer=fi.OutlierDetectionLoadBalancingConfig=void 0;var Sh=nn(),BI=ce(),ss=xv(),VI=Uv(),qI=jr(),zV=Xu(),jV=Wr(),LI=Gn(),GV=ah(),HV=Fe(),KV="outlier_detection";function it(n){HV.trace(BI.LogVerbosity.DEBUG,KV,n)}var Vv="outlier_detection",WV=((Mv=process.env.GRPC_EXPERIMENTAL_ENABLE_OUTLIER_DETECTION)!==null&&Mv!==void 0?Mv:"true")==="true",$V={stdev_factor:1900,enforcement_percentage:100,minimum_hosts:5,request_volume:100},QV={threshold:85,enforcement_percentage:100,minimum_hosts:5,request_volume:50};function Lo(n,e,t,r){if(e in n&&typeof n[e]!==t){let i=r?`${r}.${e}`:e;throw new Error(`outlier detection config ${i} parse error: expected ${t}, got ${typeof n[e]}`)}}function Ov(n,e,t){let r=t?`${t}.${e}`:e;if(e in n){if(!(0,ss.isDuration)(n[e]))throw new Error(`outlier detection config ${r} parse error: expected Duration, got ${typeof n[e]}`);if(!(n[e].seconds>=0&&n[e].seconds<=315576e6&&n[e].nanos>=0&&n[e].nanos<=999999999))throw new Error(`outlier detection config ${r} parse error: values out of range for non-negative Duaration`)}}function vh(n,e,t){let r=t?`${t}.${e}`:e;if(Lo(n,e,"number",t),e in n&&!(n[e]>=0&&n[e]<=100))throw new Error(`outlier detection config ${r} parse error: value out of range for percentage (0-100)`)}var zl=class n{constructor(e,t,r,i,s,o,a){if(this.childPolicy=a,a.length>0&&a[0].getLoadBalancerName()==="pick_first")throw new Error("outlier_detection LB policy cannot have a pick_first child policy");this.intervalMs=e??1e4,this.baseEjectionTimeMs=t??3e4,this.maxEjectionTimeMs=r??3e5,this.maxEjectionPercent=i??10,this.successRateEjection=s?Object.assign(Object.assign({},$V),s):null,this.failurePercentageEjection=o?Object.assign(Object.assign({},QV),o):null}getLoadBalancerName(){return Vv}toJsonObject(){return{interval:(0,ss.msToDuration)(this.intervalMs),base_ejection_time:(0,ss.msToDuration)(this.baseEjectionTimeMs),max_ejection_time:(0,ss.msToDuration)(this.maxEjectionTimeMs),max_ejection_percent:this.maxEjectionPercent,success_rate_ejection:this.successRateEjection,failure_percentage_ejection:this.failurePercentageEjection,child_policy:this.childPolicy.map(e=>e.toJsonObject())}}getIntervalMs(){return this.intervalMs}getBaseEjectionTimeMs(){return this.baseEjectionTimeMs}getMaxEjectionTimeMs(){return this.maxEjectionTimeMs}getMaxEjectionPercent(){return this.maxEjectionPercent}getSuccessRateEjectionConfig(){return this.successRateEjection}getFailurePercentageEjectionConfig(){return this.failurePercentageEjection}getChildPolicy(){return this.childPolicy}copyWithChildPolicy(e){return new n(this.intervalMs,this.baseEjectionTimeMs,this.maxEjectionTimeMs,this.maxEjectionPercent,this.successRateEjection,this.failurePercentageEjection,e)}static createFromJson(e){var t;if(Ov(e,"interval"),Ov(e,"base_ejection_time"),Ov(e,"max_ejection_time"),vh(e,"max_ejection_percent"),"success_rate_ejection"in e){if(typeof e.success_rate_ejection!="object")throw new Error("outlier detection config success_rate_ejection must be an object");Lo(e.success_rate_ejection,"stdev_factor","number","success_rate_ejection"),vh(e.success_rate_ejection,"enforcement_percentage","success_rate_ejection"),Lo(e.success_rate_ejection,"minimum_hosts","number","success_rate_ejection"),Lo(e.success_rate_ejection,"request_volume","number","success_rate_ejection")}if("failure_percentage_ejection"in e){if(typeof e.failure_percentage_ejection!="object")throw new Error("outlier detection config failure_percentage_ejection must be an object");vh(e.failure_percentage_ejection,"threshold","failure_percentage_ejection"),vh(e.failure_percentage_ejection,"enforcement_percentage","failure_percentage_ejection"),Lo(e.failure_percentage_ejection,"minimum_hosts","number","failure_percentage_ejection"),Lo(e.failure_percentage_ejection,"request_volume","number","failure_percentage_ejection")}return new n(e.interval?(0,ss.durationToMs)(e.interval):null,e.base_ejection_time?(0,ss.durationToMs)(e.base_ejection_time):null,e.max_ejection_time?(0,ss.durationToMs)(e.max_ejection_time):null,(t=e.max_ejection_percent)!==null&&t!==void 0?t:null,e.success_rate_ejection,e.failure_percentage_ejection,e.child_policy.map(qI.validateLoadBalancingConfig))}};fi.OutlierDetectionLoadBalancingConfig=zl;var Fv=class extends GV.BaseSubchannelWrapper{constructor(e,t){super(e),this.mapEntry=t,this.stateListeners=[],this.ejected=!1,this.refCount=0,this.childSubchannelState=e.getConnectivityState(),e.addConnectivityStateListener((r,i,s,o)=>{if(this.childSubchannelState=s,!this.ejected)for(let a of this.stateListeners)a(this,i,s,o)})}getConnectivityState(){return this.ejected?Sh.ConnectivityState.TRANSIENT_FAILURE:this.childSubchannelState}addConnectivityStateListener(e){this.stateListeners.push(e)}removeConnectivityStateListener(e){let t=this.stateListeners.indexOf(e);t>-1&&this.stateListeners.splice(t,1)}ref(){this.child.ref(),this.refCount+=1}unref(){if(this.child.unref(),this.refCount-=1,this.refCount<=0&&this.mapEntry){let e=this.mapEntry.subchannelWrappers.indexOf(this);e>=0&&this.mapEntry.subchannelWrappers.splice(e,1)}}eject(){this.ejected=!0;for(let e of this.stateListeners)e(this,this.childSubchannelState,Sh.ConnectivityState.TRANSIENT_FAILURE,-1)}uneject(){this.ejected=!1;for(let e of this.stateListeners)e(this,Sh.ConnectivityState.TRANSIENT_FAILURE,this.childSubchannelState,-1)}getMapEntry(){return this.mapEntry}getWrappedSubchannel(){return this.child}};function Pv(){return{success:0,failure:0}}var Lv=class{constructor(){this.activeBucket=Pv(),this.inactiveBucket=Pv()}addSuccess(){this.activeBucket.success+=1}addFailure(){this.activeBucket.failure+=1}switchBuckets(){this.inactiveBucket=this.activeBucket,this.activeBucket=Pv()}getLastSuccesses(){return this.inactiveBucket.success}getLastFailures(){return this.inactiveBucket.failure}},Bv=class{constructor(e,t){this.wrappedPicker=e,this.countCalls=t}pick(e){let t=this.wrappedPicker.pick(e);if(t.pickResultType===jV.PickResultType.COMPLETE){let r=t.subchannel,i=r.getMapEntry();if(i){let s=t.onCallEnded;return this.countCalls&&(s=o=>{var a;o===BI.Status.OK?i.counter.addSuccess():i.counter.addFailure(),(a=t.onCallEnded)===null||a===void 0||a.call(t,o)}),Object.assign(Object.assign({},t),{subchannel:r.getWrappedSubchannel(),onCallEnded:s})}else return Object.assign(Object.assign({},t),{subchannel:r.getWrappedSubchannel()})}else return t}},_h=class{constructor(e){this.addressMap=new Map,this.latestConfig=null,this.timerStartTime=null,this.childBalancer=new zV.ChildLoadBalancerHandler((0,VI.createChildChannelControlHelper)(e,{createSubchannel:(t,r)=>{let i=e.createSubchannel(t,r),s=this.addressMap.get((0,LI.subchannelAddressToString)(t)),o=new Fv(i,s);return s?.currentEjectionTimestamp!==null&&o.eject(),s?.subchannelWrappers.push(o),o},updateState:(t,r)=>{t===Sh.ConnectivityState.READY?e.updateState(t,new Bv(r,this.isCountingEnabled())):e.updateState(t,r)}})),this.ejectionTimer=setInterval(()=>{},0),clearInterval(this.ejectionTimer)}isCountingEnabled(){return this.latestConfig!==null&&(this.latestConfig.getSuccessRateEjectionConfig()!==null||this.latestConfig.getFailurePercentageEjectionConfig()!==null)}getCurrentEjectionPercent(){let e=0;for(let t of this.addressMap.values())t.currentEjectionTimestamp!==null&&(e+=1);return e*100/this.addressMap.size}runSuccessRateCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getSuccessRateEjectionConfig();if(!t)return;it("Running success rate check");let r=t.request_volume,i=0,s=[];for(let[d,h]of this.addressMap){let p=h.counter.getLastSuccesses(),y=h.counter.getLastFailures();it("Stats for "+d+": successes="+p+" failures="+y+" targetRequestVolume="+r),p+y>=r&&(i+=1,s.push(p/(p+y)))}if(it("Found "+i+" success rate candidates; currentEjectionPercent="+this.getCurrentEjectionPercent()+" successRates=["+s+"]"),i<t.minimum_hosts)return;let o=s.reduce((d,h)=>d+h)/s.length,a=0;for(let d of s){let h=d-o;a+=h*h}let l=a/s.length,c=Math.sqrt(l),u=o-c*(t.stdev_factor/1e3);it("stdev="+c+" ejectionThreshold="+u);for(let[d,h]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let p=h.counter.getLastSuccesses(),y=h.counter.getLastFailures();if(p+y<r)continue;let S=p/(p+y);if(it("Checking candidate "+d+" successRate="+S),S<u){let _=Math.random()*100;it("Candidate "+d+" randomNumber="+_+" enforcement_percentage="+t.enforcement_percentage),_<t.enforcement_percentage&&(it("Ejecting candidate "+d),this.eject(h,e))}}}runFailurePercentageCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getFailurePercentageEjectionConfig();if(!t)return;it("Running failure percentage check. threshold="+t.threshold+" request volume threshold="+t.request_volume);let r=0;for(let i of this.addressMap.values()){let s=i.counter.getLastSuccesses(),o=i.counter.getLastFailures();s+o>=t.request_volume&&(r+=1)}if(!(r<t.minimum_hosts))for(let[i,s]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let o=s.counter.getLastSuccesses(),a=s.counter.getLastFailures();if(it("Candidate successes="+o+" failures="+a),o+a<t.request_volume)continue;if(a*100/(a+o)>t.threshold){let c=Math.random()*100;it("Candidate "+i+" randomNumber="+c+" enforcement_percentage="+t.enforcement_percentage),c<t.enforcement_percentage&&(it("Ejecting candidate "+i),this.eject(s,e))}}}eject(e,t){e.currentEjectionTimestamp=new Date,e.ejectionTimeMultiplier+=1;for(let r of e.subchannelWrappers)r.eject()}uneject(e){e.currentEjectionTimestamp=null;for(let t of e.subchannelWrappers)t.uneject()}switchAllBuckets(){for(let e of this.addressMap.values())e.counter.switchBuckets()}startTimer(e){var t,r;this.ejectionTimer=setTimeout(()=>this.runChecks(),e),(r=(t=this.ejectionTimer).unref)===null||r===void 0||r.call(t)}runChecks(){let e=new Date;if(it("Ejection timer running"),this.switchAllBuckets(),!!this.latestConfig){this.timerStartTime=e,this.startTimer(this.latestConfig.getIntervalMs()),this.runSuccessRateCheck(e),this.runFailurePercentageCheck(e);for(let[t,r]of this.addressMap.entries())if(r.currentEjectionTimestamp===null)r.ejectionTimeMultiplier>0&&(r.ejectionTimeMultiplier-=1);else{let i=this.latestConfig.getBaseEjectionTimeMs(),s=this.latestConfig.getMaxEjectionTimeMs(),o=new Date(r.currentEjectionTimestamp.getTime());o.setMilliseconds(o.getMilliseconds()+Math.min(i*r.ejectionTimeMultiplier,Math.max(i,s))),o<new Date&&(it("Unejecting "+t),this.uneject(r))}}}updateAddressList(e,t,r){if(!(t instanceof zl))return;let i=new Set;for(let o of e)i.add((0,LI.subchannelAddressToString)(o));for(let o of i)this.addressMap.has(o)||(it("Adding map entry for "+o),this.addressMap.set(o,{counter:new Lv,currentEjectionTimestamp:null,ejectionTimeMultiplier:0,subchannelWrappers:[]}));for(let o of this.addressMap.keys())i.has(o)||(it("Removing map entry for "+o),this.addressMap.delete(o));let s=(0,qI.getFirstUsableConfig)(t.getChildPolicy(),!0);if(this.childBalancer.updateAddressList(e,s,r),t.getSuccessRateEjectionConfig()||t.getFailurePercentageEjectionConfig())if(this.timerStartTime){it("Previous timer existed. Replacing timer"),clearTimeout(this.ejectionTimer);let o=t.getIntervalMs()-(new Date().getTime()-this.timerStartTime.getTime());this.startTimer(o)}else it("Starting new timer"),this.timerStartTime=new Date,this.startTimer(t.getIntervalMs()),this.switchAllBuckets();else{it("Counting disabled. Cancelling timer."),this.timerStartTime=null,clearTimeout(this.ejectionTimer);for(let o of this.addressMap.values())this.uneject(o),o.ejectionTimeMultiplier=0}this.latestConfig=t}exitIdle(){this.childBalancer.exitIdle()}resetBackoff(){this.childBalancer.resetBackoff()}destroy(){clearTimeout(this.ejectionTimer),this.childBalancer.destroy()}getTypeName(){return Vv}};fi.OutlierDetectionLoadBalancer=_h;function YV(){WV&&(0,VI.registerLoadBalancerType)(Vv,_h,zl)}fi.setup=YV});var Uv=E(Y=>{"use strict";Object.defineProperty(Y,"__esModule",{value:!0});Y.OutlierDetectionLoadBalancingConfig=Y.BaseSubchannelWrapper=Y.registerAdminService=Y.FilterStackFactory=Y.BaseFilter=Y.PickResultType=Y.QueuePicker=Y.UnavailablePicker=Y.ChildLoadBalancerHandler=Y.subchannelAddressToString=Y.validateLoadBalancingConfig=Y.getFirstUsableConfig=Y.registerLoadBalancerType=Y.createChildChannelControlHelper=Y.BackoffTimeout=Y.durationToMs=Y.uriToString=Y.createResolver=Y.registerResolver=Y.log=Y.trace=void 0;var UI=Fe();Object.defineProperty(Y,"trace",{enumerable:!0,get:function(){return UI.trace}});Object.defineProperty(Y,"log",{enumerable:!0,get:function(){return UI.log}});var zI=zn();Object.defineProperty(Y,"registerResolver",{enumerable:!0,get:function(){return zI.registerResolver}});Object.defineProperty(Y,"createResolver",{enumerable:!0,get:function(){return zI.createResolver}});var XV=Wt();Object.defineProperty(Y,"uriToString",{enumerable:!0,get:function(){return XV.uriToString}});var JV=xv();Object.defineProperty(Y,"durationToMs",{enumerable:!0,get:function(){return JV.durationToMs}});var ZV=ul();Object.defineProperty(Y,"BackoffTimeout",{enumerable:!0,get:function(){return ZV.BackoffTimeout}});var Eh=jr();Object.defineProperty(Y,"createChildChannelControlHelper",{enumerable:!0,get:function(){return Eh.createChildChannelControlHelper}});Object.defineProperty(Y,"registerLoadBalancerType",{enumerable:!0,get:function(){return Eh.registerLoadBalancerType}});Object.defineProperty(Y,"getFirstUsableConfig",{enumerable:!0,get:function(){return Eh.getFirstUsableConfig}});Object.defineProperty(Y,"validateLoadBalancingConfig",{enumerable:!0,get:function(){return Eh.validateLoadBalancingConfig}});var eq=Gn();Object.defineProperty(Y,"subchannelAddressToString",{enumerable:!0,get:function(){return eq.subchannelAddressToString}});var tq=Xu();Object.defineProperty(Y,"ChildLoadBalancerHandler",{enumerable:!0,get:function(){return tq.ChildLoadBalancerHandler}});var zv=Wr();Object.defineProperty(Y,"UnavailablePicker",{enumerable:!0,get:function(){return zv.UnavailablePicker}});Object.defineProperty(Y,"QueuePicker",{enumerable:!0,get:function(){return zv.QueuePicker}});Object.defineProperty(Y,"PickResultType",{enumerable:!0,get:function(){return zv.PickResultType}});var nq=Kd();Object.defineProperty(Y,"BaseFilter",{enumerable:!0,get:function(){return nq.BaseFilter}});var rq=ev();Object.defineProperty(Y,"FilterStackFactory",{enumerable:!0,get:function(){return rq.FilterStackFactory}});var iq=Zu();Object.defineProperty(Y,"registerAdminService",{enumerable:!0,get:function(){return iq.registerAdminService}});var sq=ah();Object.defineProperty(Y,"BaseSubchannelWrapper",{enumerable:!0,get:function(){return sq.BaseSubchannelWrapper}});var oq=qv();Object.defineProperty(Y,"OutlierDetectionLoadBalancingConfig",{enumerable:!0,get:function(){return oq.OutlierDetectionLoadBalancingConfig}})});var jI=E(wh=>{"use strict";Object.defineProperty(wh,"__esModule",{value:!0});wh.setup=void 0;var aq=zn(),jv=class{constructor(e,t,r){this.listener=t,this.addresses=[],this.hasReturnedResult=!1;let i;e.authority===""?i="/"+e.path:i=e.path,this.addresses=[{path:i}]}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(this.listener.onSuccessfulResolution,this.addresses,null,null,null,{}))}destroy(){}static getDefaultAuthority(e){return"localhost"}};function lq(){(0,aq.registerResolver)("unix",jv)}wh.setup=lq});var $I=E(bh=>{"use strict";Object.defineProperty(bh,"__esModule",{value:!0});bh.setup=void 0;var GI=he("net"),Th=ce(),Gv=Nt(),HI=zn(),KI=Wt(),cq=Fe(),uq="ip_resolver";function WI(n){cq.trace(Th.LogVerbosity.DEBUG,uq,n)}var Hv="ipv4",Kv="ipv6",dq=443,Ch=class{constructor(e,t,r){var i;this.listener=t,this.addresses=[],this.error=null,this.hasReturnedResult=!1,WI("Resolver constructed for target "+(0,KI.uriToString)(e));let s=[];if(!(e.scheme===Hv||e.scheme===Kv)){this.error={code:Th.Status.UNAVAILABLE,details:`Unrecognized scheme ${e.scheme} in IP resolver`,metadata:new Gv.Metadata};return}let o=e.path.split(",");for(let a of o){let l=(0,KI.splitHostPort)(a);if(l===null){this.error={code:Th.Status.UNAVAILABLE,details:`Failed to parse ${e.scheme} address ${a}`,metadata:new Gv.Metadata};return}if(e.scheme===Hv&&!(0,GI.isIPv4)(l.host)||e.scheme===Kv&&!(0,GI.isIPv6)(l.host)){this.error={code:Th.Status.UNAVAILABLE,details:`Failed to parse ${e.scheme} address ${a}`,metadata:new Gv.Metadata};return}s.push({host:l.host,port:(i=l.port)!==null&&i!==void 0?i:dq})}this.addresses=s,WI("Parsed "+e.scheme+" address list "+this.addresses)}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(()=>{this.error?this.listener.onError(this.error):this.listener.onSuccessfulResolution(this.addresses,null,null,null,{})}))}destroy(){this.hasReturnedResult=!1}static getDefaultAuthority(e){return e.path.split(",")[0]}};function hq(){(0,HI.registerResolver)(Hv,Ch),(0,HI.registerResolver)(Kv,Ch)}bh.setup=hq});var XI=E(rr=>{"use strict";Object.defineProperty(rr,"__esModule",{value:!0});rr.setup=rr.PickFirstLoadBalancer=rr.shuffled=rr.PickFirstLoadBalancingConfig=void 0;var QI=jr(),Et=nn(),Ah=Wr(),fq=Fe(),pq=ce(),gq="pick_first";function Wv(n){fq.trace(pq.LogVerbosity.DEBUG,gq,n)}var jl="pick_first",mq=250,Gl=class n{constructor(e){this.shuffleAddressList=e}getLoadBalancerName(){return jl}toJsonObject(){return{[jl]:{shuffleAddressList:this.shuffleAddressList}}}getShuffleAddressList(){return this.shuffleAddressList}static createFromJson(e){if("shuffleAddressList"in e&&typeof e.shuffleAddressList!="boolean")throw new Error("pick_first config field shuffleAddressList must be a boolean if provided");return new n(e.shuffleAddressList===!0)}};rr.PickFirstLoadBalancingConfig=Gl;var $v=class{constructor(e){this.subchannel=e}pick(e){return{pickResultType:Ah.PickResultType.COMPLETE,subchannel:this.subchannel,status:null,onCallStarted:null,onCallEnded:null}}};function YI(n){let e=n.slice();for(let t=e.length-1;t>1;t--){let r=Math.floor(Math.random()*(t+1)),i=e[t];e[t]=e[r],e[r]=i}return e}rr.shuffled=YI;var Ih=class{constructor(e){this.channelControlHelper=e,this.children=[],this.currentState=Et.ConnectivityState.IDLE,this.currentSubchannelIndex=0,this.currentPick=null,this.subchannelStateListener=(t,r,i,s,o)=>{this.onSubchannelStateUpdate(t,r,i,o)},this.triedAllSubchannels=!1,this.stickyTransientFailureMode=!1,this.requestedResolutionSinceLastUpdate=!1,this.lastError=null,this.latestAddressList=null,this.connectionDelayTimeout=setTimeout(()=>{},0),clearTimeout(this.connectionDelayTimeout)}allChildrenHaveReportedTF(){return this.children.every(e=>e.hasReportedTransientFailure)}calculateAndReportNewState(){this.currentPick?this.updateState(Et.ConnectivityState.READY,new $v(this.currentPick)):this.children.length===0?this.updateState(Et.ConnectivityState.IDLE,new Ah.QueuePicker(this)):this.stickyTransientFailureMode?this.updateState(Et.ConnectivityState.TRANSIENT_FAILURE,new Ah.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(Et.ConnectivityState.CONNECTING,new Ah.QueuePicker(this))}requestReresolution(){this.requestedResolutionSinceLastUpdate=!0,this.channelControlHelper.requestReresolution()}maybeEnterStickyTransientFailureMode(){if(this.allChildrenHaveReportedTF()&&(this.requestedResolutionSinceLastUpdate||this.requestReresolution(),!this.stickyTransientFailureMode)){this.stickyTransientFailureMode=!0;for(let{subchannel:e}of this.children)e.startConnecting();this.calculateAndReportNewState()}}removeCurrentPick(){if(this.currentPick!==null){let e=this.currentPick;this.currentPick=null,e.unref(),e.removeConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.removeChannelzChild(e.getChannelzRef())}}onSubchannelStateUpdate(e,t,r,i){var s;if(!((s=this.currentPick)===null||s===void 0)&&s.realSubchannelEquals(e)){r!==Et.ConnectivityState.READY&&(this.removeCurrentPick(),this.calculateAndReportNewState(),this.requestReresolution());return}for(let[o,a]of this.children.entries())if(e.realSubchannelEquals(a.subchannel)){r===Et.ConnectivityState.READY&&this.pickSubchannel(a.subchannel),r===Et.ConnectivityState.TRANSIENT_FAILURE&&(a.hasReportedTransientFailure=!0,i&&(this.lastError=i),this.maybeEnterStickyTransientFailureMode(),o===this.currentSubchannelIndex&&this.startNextSubchannelConnecting(o+1)),a.subchannel.startConnecting();return}}startNextSubchannelConnecting(e){if(clearTimeout(this.connectionDelayTimeout),!this.triedAllSubchannels){for(let[t,r]of this.children.entries())if(t>=e){let i=r.subchannel.getConnectivityState();if(i===Et.ConnectivityState.IDLE||i===Et.ConnectivityState.CONNECTING){this.startConnecting(t);return}}this.triedAllSubchannels=!0,this.maybeEnterStickyTransientFailureMode()}}startConnecting(e){var t,r;clearTimeout(this.connectionDelayTimeout),this.currentSubchannelIndex=e,this.children[e].subchannel.getConnectivityState()===Et.ConnectivityState.IDLE&&(Wv("Start connecting to subchannel with address "+this.children[e].subchannel.getAddress()),process.nextTick(()=>{var i;(i=this.children[e])===null||i===void 0||i.subchannel.startConnecting()})),this.connectionDelayTimeout=(r=(t=setTimeout(()=>{this.startNextSubchannelConnecting(e+1)},mq)).unref)===null||r===void 0?void 0:r.call(t)}pickSubchannel(e){this.currentPick&&e.realSubchannelEquals(this.currentPick)||(Wv("Pick subchannel with address "+e.getAddress()),this.stickyTransientFailureMode=!1,this.currentPick!==null&&(this.currentPick.unref(),this.channelControlHelper.removeChannelzChild(this.currentPick.getChannelzRef()),this.currentPick.removeConnectivityStateListener(this.subchannelStateListener)),this.currentPick=e,e.ref(),this.channelControlHelper.addChannelzChild(e.getChannelzRef()),this.resetSubchannelList(),clearTimeout(this.connectionDelayTimeout),this.calculateAndReportNewState())}updateState(e,t){Wv(Et.ConnectivityState[this.currentState]+" -> "+Et.ConnectivityState[e]),this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.children)this.currentPick&&e.subchannel.realSubchannelEquals(this.currentPick)||e.subchannel.removeConnectivityStateListener(this.subchannelStateListener),e.subchannel.unref(),this.channelControlHelper.removeChannelzChild(e.subchannel.getChannelzRef());this.currentSubchannelIndex=0,this.children=[],this.triedAllSubchannels=!1,this.requestedResolutionSinceLastUpdate=!1}connectToAddressList(e){let t=e.map(r=>({subchannel:this.channelControlHelper.createSubchannel(r,{}),hasReportedTransientFailure:!1}));for(let{subchannel:r}of t)r.ref(),this.channelControlHelper.addChannelzChild(r.getChannelzRef());this.resetSubchannelList(),this.children=t;for(let{subchannel:r}of this.children)if(r.addConnectivityStateListener(this.subchannelStateListener),r.getConnectivityState()===Et.ConnectivityState.READY){this.pickSubchannel(r);return}for(let r of this.children)r.subchannel.getConnectivityState()===Et.ConnectivityState.TRANSIENT_FAILURE&&(r.hasReportedTransientFailure=!0);this.startNextSubchannelConnecting(0),this.calculateAndReportNewState()}updateAddressList(e,t){t instanceof Gl&&(t.getShuffleAddressList()&&(e=YI(e)),this.latestAddressList=e,this.connectToAddressList(e))}exitIdle(){this.currentState===Et.ConnectivityState.IDLE&&this.latestAddressList&&this.connectToAddressList(this.latestAddressList)}resetBackoff(){}destroy(){this.resetSubchannelList(),this.removeCurrentPick()}getTypeName(){return jl}};rr.PickFirstLoadBalancer=Ih;function yq(){(0,QI.registerLoadBalancerType)(jl,Ih,Gl),(0,QI.registerDefaultLoadBalancerType)(jl)}rr.setup=yq});var ZI=E(Bo=>{"use strict";Object.defineProperty(Bo,"__esModule",{value:!0});Bo.setup=Bo.RoundRobinLoadBalancer=void 0;var vq=jr(),wt=nn(),Dh=Wr(),Sq=Gn(),_q=Fe(),Eq=ce(),wq="round_robin";function JI(n){_q.trace(Eq.LogVerbosity.DEBUG,wq,n)}var Rh="round_robin",Qv=class n{getLoadBalancerName(){return Rh}constructor(){}toJsonObject(){return{[Rh]:{}}}static createFromJson(e){return new n}},Yv=class{constructor(e,t=0){this.subchannelList=e,this.nextIndex=t}pick(e){let t=this.subchannelList[this.nextIndex];return this.nextIndex=(this.nextIndex+1)%this.subchannelList.length,{pickResultType:Dh.PickResultType.COMPLETE,subchannel:t,status:null,onCallStarted:null,onCallEnded:null}}peekNextSubchannel(){return this.subchannelList[this.nextIndex]}},kh=class{constructor(e){this.channelControlHelper=e,this.subchannels=[],this.currentState=wt.ConnectivityState.IDLE,this.currentReadyPicker=null,this.lastError=null,this.subchannelStateListener=(t,r,i,s,o)=>{this.calculateAndUpdateState(),(i===wt.ConnectivityState.TRANSIENT_FAILURE||i===wt.ConnectivityState.IDLE)&&(o&&(this.lastError=o),this.channelControlHelper.requestReresolution(),t.startConnecting())}}countSubchannelsWithState(e){return this.subchannels.filter(t=>t.getConnectivityState()===e).length}calculateAndUpdateState(){if(this.countSubchannelsWithState(wt.ConnectivityState.READY)>0){let e=this.subchannels.filter(r=>r.getConnectivityState()===wt.ConnectivityState.READY),t=0;this.currentReadyPicker!==null&&(t=e.indexOf(this.currentReadyPicker.peekNextSubchannel()),t<0&&(t=0)),this.updateState(wt.ConnectivityState.READY,new Yv(e,t))}else this.countSubchannelsWithState(wt.ConnectivityState.CONNECTING)>0?this.updateState(wt.ConnectivityState.CONNECTING,new Dh.QueuePicker(this)):this.countSubchannelsWithState(wt.ConnectivityState.TRANSIENT_FAILURE)>0?this.updateState(wt.ConnectivityState.TRANSIENT_FAILURE,new Dh.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(wt.ConnectivityState.IDLE,new Dh.QueuePicker(this))}updateState(e,t){JI(wt.ConnectivityState[this.currentState]+" -> "+wt.ConnectivityState[e]),e===wt.ConnectivityState.READY?this.currentReadyPicker=t:this.currentReadyPicker=null,this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.subchannels)e.removeConnectivityStateListener(this.subchannelStateListener),e.unref(),this.channelControlHelper.removeChannelzChild(e.getChannelzRef());this.subchannels=[]}updateAddressList(e,t){this.resetSubchannelList(),JI("Connect to address list "+e.map(r=>(0,Sq.subchannelAddressToString)(r))),this.subchannels=e.map(r=>this.channelControlHelper.createSubchannel(r,{}));for(let r of this.subchannels){r.ref(),r.addConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.addChannelzChild(r.getChannelzRef());let i=r.getConnectivityState();(i===wt.ConnectivityState.IDLE||i===wt.ConnectivityState.TRANSIENT_FAILURE)&&r.startConnecting()}this.calculateAndUpdateState()}exitIdle(){for(let e of this.subchannels)e.startConnecting()}resetBackoff(){}destroy(){this.resetSubchannelList()}getTypeName(){return Rh}};Bo.RoundRobinLoadBalancer=kh;function Tq(){(0,vq.registerLoadBalancerType)(Rh,kh,Qv)}Bo.setup=Tq});var rD=E(U=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0});U.experimental=U.addAdminServicesToServer=U.getChannelzHandlers=U.getChannelzServiceDefinition=U.InterceptorConfigurationError=U.InterceptingCall=U.RequesterBuilder=U.ListenerBuilder=U.StatusBuilder=U.getClientChannel=U.ServerCredentials=U.Server=U.setLogVerbosity=U.setLogger=U.load=U.loadObject=U.CallCredentials=U.ChannelCredentials=U.waitForClientReady=U.closeClient=U.Channel=U.makeGenericClientConstructor=U.makeClientConstructor=U.loadPackageDefinition=U.Client=U.compressionAlgorithms=U.propagate=U.connectivityState=U.status=U.logVerbosity=U.Metadata=U.credentials=void 0;var Nh=Kg();Object.defineProperty(U,"CallCredentials",{enumerable:!0,get:function(){return Nh.CallCredentials}});var Cq=Cm();Object.defineProperty(U,"Channel",{enumerable:!0,get:function(){return Cq.ChannelImplementation}});var bq=tv();Object.defineProperty(U,"compressionAlgorithms",{enumerable:!0,get:function(){return bq.CompressionAlgorithms}});var Aq=nn();Object.defineProperty(U,"connectivityState",{enumerable:!0,get:function(){return Aq.ConnectivityState}});var xh=Gu();Object.defineProperty(U,"ChannelCredentials",{enumerable:!0,get:function(){return xh.ChannelCredentials}});var eD=Tm();Object.defineProperty(U,"Client",{enumerable:!0,get:function(){return eD.Client}});var Xv=ce();Object.defineProperty(U,"logVerbosity",{enumerable:!0,get:function(){return Xv.LogVerbosity}});Object.defineProperty(U,"status",{enumerable:!0,get:function(){return Xv.Status}});Object.defineProperty(U,"propagate",{enumerable:!0,get:function(){return Xv.Propagate}});var tD=Fe(),Jv=Am();Object.defineProperty(U,"loadPackageDefinition",{enumerable:!0,get:function(){return Jv.loadPackageDefinition}});Object.defineProperty(U,"makeClientConstructor",{enumerable:!0,get:function(){return Jv.makeClientConstructor}});Object.defineProperty(U,"makeGenericClientConstructor",{enumerable:!0,get:function(){return Jv.makeClientConstructor}});var Iq=Nt();Object.defineProperty(U,"Metadata",{enumerable:!0,get:function(){return Iq.Metadata}});var Dq=PI();Object.defineProperty(U,"Server",{enumerable:!0,get:function(){return Dq.Server}});var Rq=Dv();Object.defineProperty(U,"ServerCredentials",{enumerable:!0,get:function(){return Rq.ServerCredentials}});var kq=FI();Object.defineProperty(U,"StatusBuilder",{enumerable:!0,get:function(){return kq.StatusBuilder}});U.credentials={combineChannelCredentials:(n,...e)=>e.reduce((t,r)=>t.compose(r),n),combineCallCredentials:(n,...e)=>e.reduce((t,r)=>t.compose(r),n),createInsecure:xh.ChannelCredentials.createInsecure,createSsl:xh.ChannelCredentials.createSsl,createFromSecureContext:xh.ChannelCredentials.createFromSecureContext,createFromMetadataGenerator:Nh.CallCredentials.createFromMetadataGenerator,createFromGoogleCredential:Nh.CallCredentials.createFromGoogleCredential,createEmpty:Nh.CallCredentials.createEmpty};var Nq=n=>n.close();U.closeClient=Nq;var xq=(n,e,t)=>n.waitForReady(e,t);U.waitForClientReady=xq;var Mq=(n,e)=>{throw new Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")};U.loadObject=Mq;var Oq=(n,e,t)=>{throw new Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")};U.load=Oq;var Pq=n=>{tD.setLogger(n)};U.setLogger=Pq;var Fq=n=>{tD.setLoggerVerbosity(n)};U.setLogVerbosity=Fq;var Lq=n=>eD.Client.prototype.getChannel.call(n);U.getClientChannel=Lq;var Mh=_m();Object.defineProperty(U,"ListenerBuilder",{enumerable:!0,get:function(){return Mh.ListenerBuilder}});Object.defineProperty(U,"RequesterBuilder",{enumerable:!0,get:function(){return Mh.RequesterBuilder}});Object.defineProperty(U,"InterceptingCall",{enumerable:!0,get:function(){return Mh.InterceptingCall}});Object.defineProperty(U,"InterceptorConfigurationError",{enumerable:!0,get:function(){return Mh.InterceptorConfigurationError}});var nD=ns();Object.defineProperty(U,"getChannelzServiceDefinition",{enumerable:!0,get:function(){return nD.getChannelzServiceDefinition}});Object.defineProperty(U,"getChannelzHandlers",{enumerable:!0,get:function(){return nD.getChannelzHandlers}});var Bq=Zu();Object.defineProperty(U,"addAdminServicesToServer",{enumerable:!0,get:function(){return Bq.addAdminServicesToServer}});var Vq=Uv();U.experimental=Vq;var qq=zy(),Uq=jI(),zq=$I(),jq=XI(),Gq=ZI(),Hq=qv(),Kq=ns();qq.setup(),Uq.setup(),zq.setup(),jq.setup(),Gq.setup(),Hq.setup(),Kq.setup()});var QN="firebase",YN="10.7.1";Lr(QN,YN,"app");var zs=new bp("ANGULARFIRE2_VERSION");var XN=(n,e)=>{let t=e?[e]:YE(),r=[];return t.forEach(i=>{i.container.getProvider(n).instances.forEach(o=>{r.includes(o)||r.push(o)})}),r},Gi=class{constructor(){return XN(JN)}},JN="app-check";function Np(){}var su=class{zone;delegate;constructor(e,t=CE){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,r){let i=this.zone,s=function(o){i.runGuarded(()=>{e.apply(this,[o])})};return this.delegate.schedule(s,t,r)}},xp=class{zone;task=null;constructor(e){this.zone=e}call(e,t){let r=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",Np,{},Np,Np)),t.pipe(RE({next:r,complete:r,error:r})).subscribe(e).add(r)}unscheduleTask(){setTimeout(()=>{this.task!=null&&this.task.state==="scheduled"&&(this.task.invoke(),this.task=null)},10)}},ou=(()=>{class n{ngZone;outsideAngular;insideAngular;constructor(t){this.ngZone=t,this.outsideAngular=t.runOutsideAngular(()=>new su(Zone.current)),this.insideAngular=t.run(()=>new su(Zone.current,Yc)),globalThis.\u0275AngularFireScheduler||=this}static \u0275fac=function(r){return new(r||n)(ie(Fr))};static \u0275prov=Ui({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function ZN(){let n=globalThis.\u0275AngularFireScheduler;if(!n)throw new Error(`Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using
provideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).`);return n}function qt(n){return ex(ZN())(n)}function ex(n){return function(t){return t=t.lift(new xp(n.ngZone)),t.pipe(qs(n.outsideAngular),Bi(n.insideAngular))}}var rx=new Map,ix={activated:!1,tokenObservers:[]},sx={initialized:!1,enabled:!1};function vn(n){return rx.get(n)||Object.assign({},ix)}function nw(){return sx}var ox="https://content-firebaseappcheck.googleapis.com/v1";var ax="exchangeDebugToken",JE={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3},q5=24*60*60*1e3;var Op=class{constructor(e,t,r,i,s){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=r,this.lowerBound=i,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=i,i>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){return g(this,null,function*(){this.stop();try{this.pending=new kp,this.pending.promise.catch(t=>{}),yield lx(this.getNextRun(e)),this.pending.resolve(),yield this.pending.promise,this.pending=new kp,this.pending.promise.catch(t=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}};function lx(n){return new Promise(e=>{setTimeout(e,n)})}var cx={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"},Br=new $E("appCheck","AppCheck",cx);function rw(n){if(!vn(n).activated)throw Br.create("use-before-activation",{appName:n.name})}function iw(r,i){return g(this,arguments,function*({url:n,body:e},t){let s={"Content-Type":"application/json"},o=t.getImmediate({optional:!0});if(o){let p=yield o.getHeartbeatsHeader();p&&(s["X-Firebase-Client"]=p)}let a={method:"POST",body:JSON.stringify(e),headers:s},l;try{l=yield fetch(n,a)}catch(p){throw Br.create("fetch-network-error",{originalErrorMessage:p?.message})}if(l.status!==200)throw Br.create("fetch-status-error",{httpStatus:l.status});let c;try{c=yield l.json()}catch(p){throw Br.create("fetch-parse-error",{originalErrorMessage:p?.message})}let u=c.ttl.match(/^([\d.]+)(s)$/);if(!u||!u[2]||isNaN(Number(u[1])))throw Br.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${c.ttl}`});let d=Number(u[1])*1e3,h=Date.now();return{token:c.token,expireTimeMillis:h+d,issuedAtTimeMillis:h}})}function sw(n,e){let{projectId:t,appId:r,apiKey:i}=n.options;return{url:`${ox}/projects/${t}/apps/${r}:${ax}?key=${i}`,body:{debug_token:e}}}var ux="firebase-app-check-database",dx=1,Pp="firebase-app-check-store";var au=null;function hx(){return au||(au=new Promise((n,e)=>{try{let t=indexedDB.open(ux,dx);t.onsuccess=r=>{n(r.target.result)},t.onerror=r=>{var i;e(Br.create("storage-open",{originalErrorMessage:(i=r.target.error)===null||i===void 0?void 0:i.message}))},t.onupgradeneeded=r=>{let i=r.target.result;switch(r.oldVersion){case 0:i.createObjectStore(Pp,{keyPath:"compositeKey"})}}}catch(t){e(Br.create("storage-open",{originalErrorMessage:t?.message}))}}),au)}function fx(n,e){return px(gx(n),e)}function px(n,e){return g(this,null,function*(){let r=(yield hx()).transaction(Pp,"readwrite"),s=r.objectStore(Pp).put({compositeKey:n,value:e});return new Promise((o,a)=>{s.onsuccess=l=>{o()},r.onerror=l=>{var c;a(Br.create("storage-set",{originalErrorMessage:(c=l.target.error)===null||c===void 0?void 0:c.message}))}})})}function gx(n){return`${n.options.appId}-${n.name}`}var Fp=new iu("@firebase/app-check");function Mp(n,e){return ru()?fx(n,e).catch(t=>{Fp.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function ow(){return nw().enabled}function aw(){return g(this,null,function*(){let n=nw();if(n.enabled&&n.token)return n.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var mx={error:"UNKNOWN_ERROR"};function yx(n){return GE.encodeString(JSON.stringify(n),!1)}function Lp(n,e=!1){return g(this,null,function*(){let t=n.app;rw(t);let r=vn(t),i=r.token,s;if(i&&!qa(i)&&(r.token=void 0,i=void 0),!i){let l=yield r.cachedTokenPromise;l&&(qa(l)?i=l:yield Mp(t,void 0))}if(!e&&i&&qa(i))return{token:i.token};let o=!1;if(ow()){r.exchangeTokenPromise||(r.exchangeTokenPromise=iw(sw(t,yield aw()),n.heartbeatServiceProvider).finally(()=>{r.exchangeTokenPromise=void 0}),o=!0);let l=yield r.exchangeTokenPromise;return yield Mp(t,l),r.token=l,{token:l.token}}try{r.exchangeTokenPromise||(r.exchangeTokenPromise=r.provider.getToken().finally(()=>{r.exchangeTokenPromise=void 0}),o=!0),i=yield vn(t).exchangeTokenPromise}catch(l){l.code==="appCheck/throttled"?Fp.warn(l.message):Fp.error(l),s=l}let a;return i?s?qa(i)?a={token:i.token,internalError:s}:a=ew(s):(a={token:i.token},r.token=i,yield Mp(t,i)):a=ew(s),o&&Ex(t,a),a})}function vx(n){return g(this,null,function*(){let e=n.app;rw(e);let{provider:t}=vn(e);if(ow()){let r=yield aw(),{token:i}=yield iw(sw(e,r),n.heartbeatServiceProvider);return{token:i}}else{let{token:r}=yield t.getToken();return{token:r}}})}function Sx(n,e,t,r){let{app:i}=n,s=vn(i),o={next:t,error:r,type:e};if(s.tokenObservers=[...s.tokenObservers,o],s.token&&qa(s.token)){let a=s.token;Promise.resolve().then(()=>{t({token:a.token}),ZE(n)}).catch(()=>{})}s.cachedTokenPromise.then(()=>ZE(n))}function lw(n,e){let t=vn(n),r=t.tokenObservers.filter(i=>i.next!==e);r.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=r}function ZE(n){let{app:e}=n,t=vn(e),r=t.tokenRefresher;r||(r=_x(n),t.tokenRefresher=r),!r.isRunning()&&t.isTokenAutoRefreshEnabled&&r.start()}function _x(n){let{app:e}=n;return new Op(()=>g(this,null,function*(){let t=vn(e),r;if(t.token?r=yield Lp(n,!0):r=yield Lp(n),r.error)throw r.error;if(r.internalError)throw r.internalError}),()=>!0,()=>{let t=vn(e);if(t.token){let r=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5,i=t.token.expireTimeMillis-5*60*1e3;return r=Math.min(r,i),Math.max(0,r-Date.now())}else return 0},JE.RETRIAL_MIN_WAIT,JE.RETRIAL_MAX_WAIT)}function Ex(n,e){let t=vn(n).tokenObservers;for(let r of t)try{r.type==="EXTERNAL"&&e.error!=null?r.error(e.error):r.next(e)}catch{}}function qa(n){return n.expireTimeMillis-Date.now()>0}function ew(n){return{token:yx(mx),error:n}}var Bp=class{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:e}=vn(this.app);for(let t of e)lw(this.app,t.next);return Promise.resolve()}};function wx(n,e){return new Bp(n,e)}function Tx(n){return{getToken:e=>Lp(n,e),getLimitedUseToken:()=>vx(n),addTokenListener:e=>Sx(n,"INTERNAL",e),removeTokenListener:e=>lw(n.app,e)}}var Cx="@firebase/app-check",bx="0.8.1";var Ax="app-check",tw="app-check-internal";function Ix(){Va(new ji(Ax,n=>{let e=n.getProvider("app").getImmediate(),t=n.getProvider("heartbeat");return wx(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(tw).initialize()})),Va(new ji(tw,n=>{let e=n.getProvider("app-check").getImmediate();return Tx(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),Lr(Cx,bx)}Ix();var Dx=["localhost","0.0.0.0","127.0.0.1"],J5=typeof window<"u"&&Dx.includes(window.location.hostname);var Rx="firebase",kx="10.7.1";Vt.registerVersion(Rx,kx,"app-compat");var Nx=["ngOnDestroy"],dw=(n,e,t,r={})=>new Proxy(n,{get:(i,s)=>t.runOutsideAngular(()=>{if(n[s])return r?.spy?.get&&r.spy.get(s,n[s]),n[s];if(Nx.indexOf(s)>-1)return()=>{};let o=e.toPromise().then(a=>{let l=a?.[s];return typeof l=="function"?l.bind(a):l?.then?l.then(c=>t.run(()=>c)):t.run(()=>l)});return new Proxy(()=>{},{get:(a,l)=>o[l],apply:(a,l,c)=>o.then(u=>{let d=u?.(...c);return r?.spy?.apply&&r.spy.apply(s,c,d),d})})})});var lu=class{constructor(e){return e}},js=new qe("angularfire2.app.options"),Gs=new qe("angularfire2.app.name");function Ua(n,e,t){let r=typeof t=="string"&&t||"[DEFAULT]",i=typeof t=="object"&&t||{};i.name=i.name||r;let o=Vt.apps.filter(a=>a&&a.name===i.name)[0]||e.runOutsideAngular(()=>Vt.initializeApp(n,i));try{if(JSON.stringify(n)!==JSON.stringify(o.options)){let a=!!module.hot;xx("error",`${o.name} Firebase App already initialized with different options${a?", you may need to reload as Firebase is not HMR aware.":"."}`)}}catch{}return new lu(o)}var xx=(n,...e)=>{Ap()&&typeof console<"u"&&console[n](...e)},Mx={provide:lu,useFactory:Ua,deps:[js,Fr,[new kE,Gs]]},hw=(()=>{class n{static initializeApp(t,r){return{ngModule:n,providers:[{provide:js,useValue:t},{provide:Gs,useValue:r}]}}constructor(t){Vt.registerVersion("angularfire",zs.full,"core"),Vt.registerVersion("angularfire",zs.full,"app-compat"),Vt.registerVersion("angular",FE.full,t.toString())}static \u0275fac=function(r){return new(r||n)(ie(Us))};static \u0275mod=It({type:n});static \u0275inj=At({providers:[Mx]})}return n})();function cu(n,e,t,r,i){let[,s,o]=globalThis.\u0275AngularfireInstanceCache.find(a=>a[0]===n)||[];if(s)return Ox(i,o)||(uw("error",`${e} was already initialized on the ${t} Firebase App with different settings.${Px?" You may need to reload as Firebase is not HMR aware.":""}`),uw("warn",{is:i,was:o})),s;{let a=r();return globalThis.\u0275AngularfireInstanceCache.push([n,a,i]),a}}function Ox(n,e){try{return n.toString()===e.toString()}catch{return n===e}}var Px=typeof module<"u"&&!!module.hot,uw=(n,...e)=>{Ap()&&typeof console<"u"&&console[n](...e)};globalThis.\u0275AngularfireInstanceCache||=[];var Vp=new qe("angularfire2.auth.use-emulator"),qp=new qe("angularfire2.auth.settings"),Up=new qe("angularfire2.auth.tenant-id"),zp=new qe("angularfire2.auth.langugage-code"),jp=new qe("angularfire2.auth.use-device-language"),Gp=new qe("angularfire.auth.persistence"),Hp=(n,e,t,r,i,s,o,a)=>cu(`${n.name}.auth`,"AngularFireAuth",n.name,()=>{let l=e.runOutsideAngular(()=>n.auth());if(t&&l.useEmulator(...t),r&&(l.tenantId=r),l.languageCode=i,s&&l.useDeviceLanguage(),o)for(let[c,u]of Object.entries(o))l.settings[c]=u;return a&&l.setPersistence(a),l},[t,r,i,s,o,a]),fw=(()=>{class n{authState;idToken;user;idTokenResult;credential;constructor(t,r,i,s,o,a,l,c,u,d,h,p){let y=new TE,S=Or(void 0).pipe(Bi(o.outsideAngular),Vi(()=>s.runOutsideAngular(()=>import("./chunk-2YTKQEPF.mjs"))),ct(()=>Ua(t,s,r)),ct(_=>Hp(_,s,a,c,u,d,l,h)),Ep({bufferSize:1,refCount:!1}));if(tu(i))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=Or(null);else{S.pipe(DE()).subscribe();let _=S.pipe(Vi(x=>x.getRedirectResult().then(M=>M,()=>null)),qt,Ep({bufferSize:1,refCount:!1})),k=S.pipe(Vi(x=>new Vs(M=>({unsubscribe:s.runOutsideAngular(()=>x.onAuthStateChanged(z=>M.next(z),z=>M.error(z),()=>M.complete()))})))),w=S.pipe(Vi(x=>new Vs(M=>({unsubscribe:s.runOutsideAngular(()=>x.onIdTokenChanged(z=>M.next(z),z=>M.error(z),()=>M.complete()))}))));this.authState=_.pipe(wp(k),qs(o.outsideAngular),Bi(o.insideAngular)),this.user=_.pipe(wp(w),qs(o.outsideAngular),Bi(o.insideAngular)),this.idToken=this.user.pipe(Vi(x=>x?Pn(x.getIdToken()):Or(null))),this.idTokenResult=this.user.pipe(Vi(x=>x?Pn(x.getIdTokenResult()):Or(null))),this.credential=AE(_,y,this.authState.pipe(Ma(x=>!x))).pipe(ct(x=>x?.user?x:null),qs(o.outsideAngular),Bi(o.insideAngular))}return dw(this,S,s,{spy:{apply:(_,k,w)=>{(_.startsWith("signIn")||_.startsWith("createUser"))&&w.then(x=>y.next(x))}}})}static \u0275fac=function(r){return new(r||n)(ie(js),ie(Gs,8),ie(Us),ie(Fr),ie(ou),ie(Vp,8),ie(qp,8),ie(Up,8),ie(zp,8),ie(jp,8),ie(Gp,8),ie(Gi,8))};static \u0275prov=Ui({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})();import{inspect as Wq,TextEncoder as $q,TextDecoder as Qq}from"util";import{randomBytes as Yq}from"crypto";var Lx=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},_n={},F,fg=fg||{},Q=Lx||self;function Tu(n){var e=typeof n;return e=e!="object"?e:n?Array.isArray(n)?"array":e:"null",e=="array"||e=="object"&&typeof n.length=="number"}function tl(n){var e=typeof n;return e=="object"&&n!=null||e=="function"}function Bx(n){return Object.prototype.hasOwnProperty.call(n,Kp)&&n[Kp]||(n[Kp]=++Vx)}var Kp="closure_uid_"+(1e9*Math.random()>>>0),Vx=0;function qx(n,e,t){return n.call.apply(n.bind,arguments)}function Ux(n,e,t){if(!n)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,r),n.apply(e,i)}}return function(){return n.apply(e,arguments)}}function mt(n,e,t){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?mt=qx:mt=Ux,mt.apply(null,arguments)}function uu(n,e){var t=Array.prototype.slice.call(arguments,1);return function(){var r=t.slice();return r.push.apply(r,arguments),n.apply(this,r)}}function tt(n,e){function t(){}t.prototype=e.prototype,n.$=e.prototype,n.prototype=new t,n.prototype.constructor=n,n.ac=function(r,i,s){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return e.prototype[i].apply(r,o)}}function Vr(){this.s=this.s,this.o=this.o}var zx=0;Vr.prototype.s=!1;Vr.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),zx!=0)&&Bx(this)};Vr.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var Aw=Array.prototype.indexOf?function(n,e){return Array.prototype.indexOf.call(n,e,void 0)}:function(n,e){if(typeof n=="string")return typeof e!="string"||e.length!=1?-1:n.indexOf(e,0);for(let t=0;t<n.length;t++)if(t in n&&n[t]===e)return t;return-1};function pg(n){let e=n.length;if(0<e){let t=Array(e);for(let r=0;r<e;r++)t[r]=n[r];return t}return[]}function pw(n,e){for(let t=1;t<arguments.length;t++){let r=arguments[t];if(Tu(r)){let i=n.length||0,s=r.length||0;n.length=i+s;for(let o=0;o<s;o++)n[i+o]=r[o]}else n.push(r)}}function yt(n,e){this.type=n,this.g=this.target=e,this.defaultPrevented=!1}yt.prototype.h=function(){this.defaultPrevented=!0};var jx=function(){if(!Q.addEventListener||!Object.defineProperty)return!1;var n=!1,e=Object.defineProperty({},"passive",{get:function(){n=!0}});try{let t=()=>{};Q.addEventListener("test",t,e),Q.removeEventListener("test",t,e)}catch{}return n}();function Wa(n){return/^[\s\xa0]*$/.test(n)}function Cu(){var n=Q.navigator;return n&&(n=n.userAgent)?n:""}function Vn(n){return Cu().indexOf(n)!=-1}function gg(n){return gg[" "](n),n}gg[" "]=function(){};function Gx(n,e){var t=xM;return Object.prototype.hasOwnProperty.call(t,n)?t[n]:t[n]=e(n)}var Hx=Vn("Opera"),$s=Vn("Trident")||Vn("MSIE"),Iw=Vn("Edge"),Xp=Iw||$s,Dw=Vn("Gecko")&&!(Cu().toLowerCase().indexOf("webkit")!=-1&&!Vn("Edge"))&&!(Vn("Trident")||Vn("MSIE"))&&!Vn("Edge"),Kx=Cu().toLowerCase().indexOf("webkit")!=-1&&!Vn("Edge");function Rw(){var n=Q.document;return n?n.documentMode:void 0}var Jp;e:{if(du="",hu=function(){var n=Cu();if(Dw)return/rv:([^\);]+)(\)|;)/.exec(n);if(Iw)return/Edge\/([\d\.]+)/.exec(n);if($s)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n);if(Kx)return/WebKit\/(\S+)/.exec(n);if(Hx)return/(?:Version)[ \/]?(\S+)/.exec(n)}(),hu&&(du=hu?hu[1]:""),$s&&(fu=Rw(),fu!=null&&fu>parseFloat(du))){Jp=String(fu);break e}Jp=du}var du,hu,fu,Zp;Q.document&&$s?(Wp=Rw(),Zp=Wp||parseInt(Jp,10)||void 0):Zp=void 0;var Wp,Wx=Zp;function $a(n,e){if(yt.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var t=this.type=n.type,r=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=e,e=n.relatedTarget){if(Dw){e:{try{gg(e.nodeName);var i=!0;break e}catch{}i=!1}i||(e=null)}}else t=="mouseover"?e=n.fromElement:t=="mouseout"&&(e=n.toElement);this.relatedTarget=e,r?(this.clientX=r.clientX!==void 0?r.clientX:r.pageX,this.clientY=r.clientY!==void 0?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=n.clientX!==void 0?n.clientX:n.pageX,this.clientY=n.clientY!==void 0?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType=typeof n.pointerType=="string"?n.pointerType:$x[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&$a.$.h.call(this)}}tt($a,yt);var $x={2:"touch",3:"pen",4:"mouse"};$a.prototype.h=function(){$a.$.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var nl="closure_listenable_"+(1e6*Math.random()|0),Qx=0;function Yx(n,e,t,r,i){this.listener=n,this.proxy=null,this.src=e,this.type=t,this.capture=!!r,this.la=i,this.key=++Qx,this.fa=this.ia=!1}function bu(n){n.fa=!0,n.listener=null,n.proxy=null,n.src=null,n.la=null}function mg(n,e,t){for(let r in n)e.call(t,n[r],r,n)}function Xx(n,e){for(let t in n)e.call(void 0,n[t],t,n)}function kw(n){let e={};for(let t in n)e[t]=n[t];return e}var gw="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Nw(n,e){let t,r;for(let i=1;i<arguments.length;i++){r=arguments[i];for(t in r)n[t]=r[t];for(let s=0;s<gw.length;s++)t=gw[s],Object.prototype.hasOwnProperty.call(r,t)&&(n[t]=r[t])}}function Au(n){this.src=n,this.g={},this.h=0}Au.prototype.add=function(n,e,t,r,i){var s=n.toString();n=this.g[s],n||(n=this.g[s]=[],this.h++);var o=tg(n,e,r,i);return-1<o?(e=n[o],t||(e.ia=!1)):(e=new Yx(e,this.src,s,!!r,i),e.ia=t,n.push(e)),e};function eg(n,e){var t=e.type;if(t in n.g){var r=n.g[t],i=Aw(r,e),s;(s=0<=i)&&Array.prototype.splice.call(r,i,1),s&&(bu(e),n.g[t].length==0&&(delete n.g[t],n.h--))}}function tg(n,e,t,r){for(var i=0;i<n.length;++i){var s=n[i];if(!s.fa&&s.listener==e&&s.capture==!!t&&s.la==r)return i}return-1}var yg="closure_lm_"+(1e6*Math.random()|0),$p={};function xw(n,e,t,r,i){if(r&&r.once)return Ow(n,e,t,r,i);if(Array.isArray(e)){for(var s=0;s<e.length;s++)xw(n,e[s],t,r,i);return null}return t=_g(t),n&&n[nl]?n.O(e,t,tl(r)?!!r.capture:!!r,i):Mw(n,e,t,!1,r,i)}function Mw(n,e,t,r,i,s){if(!e)throw Error("Invalid event type");var o=tl(i)?!!i.capture:!!i,a=Sg(n);if(a||(n[yg]=a=new Au(n)),t=a.add(e,t,r,o,s),t.proxy)return t;if(r=Jx(),t.proxy=r,r.src=n,r.listener=t,n.addEventListener)jx||(i=o),i===void 0&&(i=!1),n.addEventListener(e.toString(),r,i);else if(n.attachEvent)n.attachEvent(Fw(e.toString()),r);else if(n.addListener&&n.removeListener)n.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return t}function Jx(){function n(t){return e.call(n.src,n.listener,t)}let e=Zx;return n}function Ow(n,e,t,r,i){if(Array.isArray(e)){for(var s=0;s<e.length;s++)Ow(n,e[s],t,r,i);return null}return t=_g(t),n&&n[nl]?n.P(e,t,tl(r)?!!r.capture:!!r,i):Mw(n,e,t,!0,r,i)}function Pw(n,e,t,r,i){if(Array.isArray(e))for(var s=0;s<e.length;s++)Pw(n,e[s],t,r,i);else r=tl(r)?!!r.capture:!!r,t=_g(t),n&&n[nl]?(n=n.i,e=String(e).toString(),e in n.g&&(s=n.g[e],t=tg(s,t,r,i),-1<t&&(bu(s[t]),Array.prototype.splice.call(s,t,1),s.length==0&&(delete n.g[e],n.h--)))):n&&(n=Sg(n))&&(e=n.g[e.toString()],n=-1,e&&(n=tg(e,t,r,i)),(t=-1<n?e[n]:null)&&vg(t))}function vg(n){if(typeof n!="number"&&n&&!n.fa){var e=n.src;if(e&&e[nl])eg(e.i,n);else{var t=n.type,r=n.proxy;e.removeEventListener?e.removeEventListener(t,r,n.capture):e.detachEvent?e.detachEvent(Fw(t),r):e.addListener&&e.removeListener&&e.removeListener(r),(t=Sg(e))?(eg(t,n),t.h==0&&(t.src=null,e[yg]=null)):bu(n)}}}function Fw(n){return n in $p?$p[n]:$p[n]="on"+n}function Zx(n,e){if(n.fa)n=!0;else{e=new $a(e,this);var t=n.listener,r=n.la||n.src;n.ia&&vg(n),n=t.call(r,e)}return n}function Sg(n){return n=n[yg],n instanceof Au?n:null}var Qp="__closure_events_fn_"+(1e9*Math.random()>>>0);function _g(n){return typeof n=="function"?n:(n[Qp]||(n[Qp]=function(e){return n.handleEvent(e)}),n[Qp])}function et(){Vr.call(this),this.i=new Au(this),this.S=this,this.J=null}tt(et,Vr);et.prototype[nl]=!0;et.prototype.removeEventListener=function(n,e,t,r){Pw(this,n,e,t,r)};function dt(n,e){var t,r=n.J;if(r)for(t=[];r;r=r.J)t.push(r);if(n=n.S,r=e.type||e,typeof e=="string")e=new yt(e,n);else if(e instanceof yt)e.target=e.target||n;else{var i=e;e=new yt(r,n),Nw(e,i)}if(i=!0,t)for(var s=t.length-1;0<=s;s--){var o=e.g=t[s];i=pu(o,r,!0,e)&&i}if(o=e.g=n,i=pu(o,r,!0,e)&&i,i=pu(o,r,!1,e)&&i,t)for(s=0;s<t.length;s++)o=e.g=t[s],i=pu(o,r,!1,e)&&i}et.prototype.N=function(){if(et.$.N.call(this),this.i){var n=this.i,e;for(e in n.g){for(var t=n.g[e],r=0;r<t.length;r++)bu(t[r]);delete n.g[e],n.h--}}this.J=null};et.prototype.O=function(n,e,t,r){return this.i.add(String(n),e,!1,t,r)};et.prototype.P=function(n,e,t,r){return this.i.add(String(n),e,!0,t,r)};function pu(n,e,t,r){if(e=n.i.g[String(e)],!e)return!0;e=e.concat();for(var i=!0,s=0;s<e.length;++s){var o=e[s];if(o&&!o.fa&&o.capture==t){var a=o.listener,l=o.la||o.src;o.ia&&eg(n.i,o),i=a.call(l,r)!==!1&&i}}return i&&!r.defaultPrevented}var Eg=Q.JSON.stringify,ng=class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}};function eM(){var n=wg;let e=null;return n.g&&(e=n.g,n.g=n.g.next,n.g||(n.h=null),e.next=null),e}var rg=class{constructor(){this.h=this.g=null}add(e,t){let r=Lw.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}},Lw=new ng(()=>new ig,n=>n.reset()),ig=class{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}};function tM(n){var e=1;n=n.split(":");let t=[];for(;0<e&&n.length;)t.push(n.shift()),e--;return n.length&&t.push(n.join(":")),t}function nM(n){Q.setTimeout(()=>{throw n},0)}var Qa,Ya=!1,wg=new rg,Bw=()=>{let n=Q.Promise.resolve(void 0);Qa=()=>{n.then(rM)}},rM=()=>{for(var n;n=eM();){try{n.h.call(n.g)}catch(t){nM(t)}var e=Lw;e.j(n),100>e.h&&(e.h++,n.next=e.g,e.g=n)}Ya=!1};function Iu(n,e){et.call(this),this.h=n||1,this.g=e||Q,this.j=mt(this.qb,this),this.l=Date.now()}tt(Iu,et);F=Iu.prototype;F.ga=!1;F.T=null;F.qb=function(){if(this.ga){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-n):(this.T&&(this.g.clearTimeout(this.T),this.T=null),dt(this,"tick"),this.ga&&(Tg(this),this.start()))}};F.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function Tg(n){n.ga=!1,n.T&&(n.g.clearTimeout(n.T),n.T=null)}F.N=function(){Iu.$.N.call(this),Tg(this),delete this.g};function Cg(n,e,t){if(typeof n=="function")t&&(n=mt(n,t));else if(n&&typeof n.handleEvent=="function")n=mt(n.handleEvent,n);else throw Error("Invalid listener argument");return 2147483647<Number(e)?-1:Q.setTimeout(n,e||0)}function Vw(n){n.g=Cg(()=>{n.g=null,n.i&&(n.i=!1,Vw(n))},n.j);let e=n.h;n.h=null,n.m.apply(null,e)}var sg=class extends Vr{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:Vw(this)}N(){super.N(),this.g&&(Q.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}};function Xa(n){Vr.call(this),this.h=n,this.g={}}tt(Xa,Vr);var mw=[];function qw(n,e,t,r){Array.isArray(t)||(t&&(mw[0]=t.toString()),t=mw);for(var i=0;i<t.length;i++){var s=xw(e,t[i],r||n.handleEvent,!1,n.h||n);if(!s)break;n.g[s.key]=s}}function Uw(n){mg(n.g,function(e,t){this.g.hasOwnProperty(t)&&vg(e)},n),n.g={}}Xa.prototype.N=function(){Xa.$.N.call(this),Uw(this)};Xa.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function Du(){this.g=!0}Du.prototype.Ea=function(){this.g=!1};function iM(n,e,t,r,i,s){n.info(function(){if(n.g)if(s)for(var o="",a=s.split("&"),l=0;l<a.length;l++){var c=a[l].split("=");if(1<c.length){var u=c[0];c=c[1];var d=u.split("_");o=2<=d.length&&d[1]=="type"?o+(u+"="+c+"&"):o+(u+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+`
`+t+`
`+o})}function sM(n,e,t,r,i,s,o){n.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+`
`+t+`
`+s+" "+o})}function Ks(n,e,t,r){n.info(function(){return"XMLHTTP TEXT ("+e+"): "+aM(n,t)+(r?" "+r:"")})}function oM(n,e){n.info(function(){return"TIMEOUT: "+e})}Du.prototype.info=function(){};function aM(n,e){if(!n.g)return e;if(!e)return null;try{var t=JSON.parse(e);if(t){for(n=0;n<t.length;n++)if(Array.isArray(t[n])){var r=t[n];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if(s!="noop"&&s!="stop"&&s!="close")for(var o=1;o<i.length;o++)i[o]=""}}}}return Eg(t)}catch{return e}}var $i={},yw=null;function Ru(){return yw=yw||new et}$i.Ta="serverreachability";function zw(n){yt.call(this,$i.Ta,n)}tt(zw,yt);function Ja(n){let e=Ru();dt(e,new zw(e))}$i.STAT_EVENT="statevent";function jw(n,e){yt.call(this,$i.STAT_EVENT,n),this.stat=e}tt(jw,yt);function Rt(n){let e=Ru();dt(e,new jw(e,n))}$i.Ua="timingevent";function Gw(n,e){yt.call(this,$i.Ua,n),this.size=e}tt(Gw,yt);function rl(n,e){if(typeof n!="function")throw Error("Fn must not be null and must be a function");return Q.setTimeout(function(){n()},e)}var ku={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},Hw={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function bg(){}bg.prototype.h=null;function vw(n){return n.h||(n.h=n.i())}function Kw(){}var il={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function Ag(){yt.call(this,"d")}tt(Ag,yt);function Ig(){yt.call(this,"c")}tt(Ig,yt);var og;function Nu(){}tt(Nu,bg);Nu.prototype.g=function(){return new XMLHttpRequest};Nu.prototype.i=function(){return{}};og=new Nu;function sl(n,e,t,r){this.l=n,this.j=e,this.m=t,this.W=r||1,this.U=new Xa(this),this.P=lM,n=Xp?125:void 0,this.V=new Iu(n),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new Ww}function Ww(){this.i=null,this.g="",this.h=!1}var lM=45e3,$w={},ag={};F=sl.prototype;F.setTimeout=function(n){this.P=n};function lg(n,e,t){n.L=1,n.A=Mu(gr(e)),n.u=t,n.S=!0,Qw(n,null)}function Qw(n,e){n.G=Date.now(),ol(n),n.B=gr(n.A);var t=n.B,r=n.W;Array.isArray(r)||(r=[String(r)]),rT(t.i,"t",r),n.o=0,t=n.l.J,n.h=new Ww,n.g=CT(n.l,t?e:null,!n.u),0<n.O&&(n.M=new sg(mt(n.Pa,n,n.g),n.O)),qw(n.U,n.g,"readystatechange",n.nb),e=n.I?kw(n.I):{},n.u?(n.v||(n.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",n.g.ha(n.B,n.v,n.u,e)):(n.v="GET",n.g.ha(n.B,n.v,null,e)),Ja(),iM(n.j,n.v,n.B,n.m,n.W,n.u)}F.nb=function(n){n=n.target;let e=this.M;e&&qn(n)==3?e.l():this.Pa(n)};F.Pa=function(n){try{if(n==this.g)e:{let u=qn(this.g);var e=this.g.Ia();let d=this.g.da();if(!(3>u)&&(u!=3||Xp||this.g&&(this.h.h||this.g.ja()||ww(this.g)))){this.J||u!=4||e==7||(e==8||0>=d?Ja(3):Ja(2)),xu(this);var t=this.g.da();this.ca=t;t:if(Yw(this)){var r=ww(this.g);n="";var i=r.length,s=qn(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Hi(this),Ka(this);var o="";break t}this.h.i=new Q.TextDecoder}for(e=0;e<i;e++)this.h.h=!0,n+=this.h.i.decode(r[e],{stream:s&&e==i-1});r.length=0,this.h.g+=n,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=t==200,sM(this.j,this.v,this.B,this.m,this.W,u,t),this.i){if(this.aa&&!this.K){t:{if(this.g){var a,l=this.g;if((a=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Wa(a)){var c=a;break t}}c=null}if(t=c)Ks(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,cg(this,t);else{this.i=!1,this.s=3,Rt(12),Hi(this),Ka(this);break e}}this.S?(Xw(this,u,o),Xp&&this.i&&u==3&&(qw(this.U,this.V,"tick",this.mb),this.V.start())):(Ks(this.j,this.m,o,null),cg(this,o)),u==4&&Hi(this),this.i&&!this.J&&(u==4?_T(this.l,this):(this.i=!1,ol(this)))}else RM(this.g),t==400&&0<o.indexOf("Unknown SID")?(this.s=3,Rt(12)):(this.s=0,Rt(13)),Hi(this),Ka(this)}}}catch{}finally{}};function Yw(n){return n.g?n.v=="GET"&&n.L!=2&&n.l.Ha:!1}function Xw(n,e,t){let r=!0,i;for(;!n.J&&n.o<t.length;)if(i=cM(n,t),i==ag){e==4&&(n.s=4,Rt(14),r=!1),Ks(n.j,n.m,null,"[Incomplete Response]");break}else if(i==$w){n.s=4,Rt(15),Ks(n.j,n.m,t,"[Invalid Chunk]"),r=!1;break}else Ks(n.j,n.m,i,null),cg(n,i);Yw(n)&&n.o!=0&&(n.h.g=n.h.g.slice(n.o),n.o=0),e!=4||t.length!=0||n.h.h||(n.s=1,Rt(16),r=!1),n.i=n.i&&r,r?0<t.length&&!n.ba&&(n.ba=!0,e=n.l,e.g==n&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+t.length),Mg(e),e.M=!0,Rt(11))):(Ks(n.j,n.m,t,"[Invalid Chunked Response]"),Hi(n),Ka(n))}F.mb=function(){if(this.g){var n=qn(this.g),e=this.g.ja();this.o<e.length&&(xu(this),Xw(this,n,e),this.i&&n!=4&&ol(this))}};function cM(n,e){var t=n.o,r=e.indexOf(`
`,t);return r==-1?ag:(t=Number(e.substring(t,r)),isNaN(t)?$w:(r+=1,r+t>e.length?ag:(e=e.slice(r,r+t),n.o=r+t,e)))}F.cancel=function(){this.J=!0,Hi(this)};function ol(n){n.Y=Date.now()+n.P,Jw(n,n.P)}function Jw(n,e){if(n.C!=null)throw Error("WatchDog timer not null");n.C=rl(mt(n.lb,n),e)}function xu(n){n.C&&(Q.clearTimeout(n.C),n.C=null)}F.lb=function(){this.C=null;let n=Date.now();0<=n-this.Y?(oM(this.j,this.B),this.L!=2&&(Ja(),Rt(17)),Hi(this),this.s=2,Ka(this)):Jw(this,this.Y-n)};function Ka(n){n.l.H==0||n.J||_T(n.l,n)}function Hi(n){xu(n);var e=n.M;e&&typeof e.sa=="function"&&e.sa(),n.M=null,Tg(n.V),Uw(n.U),n.g&&(e=n.g,n.g=null,e.abort(),e.sa())}function cg(n,e){try{var t=n.l;if(t.H!=0&&(t.g==n||ug(t.i,n))){if(!n.K&&ug(t.i,n)&&t.H==3){try{var r=t.Ja.g.parse(e)}catch{r=null}if(Array.isArray(r)&&r.length==3){var i=r;if(i[0]==0){e:if(!t.u){if(t.g)if(t.g.G+3e3<n.G)Su(t),Fu(t);else break e;xg(t),Rt(18)}}else t.Fa=i[1],0<t.Fa-t.V&&37500>i[2]&&t.G&&t.A==0&&!t.v&&(t.v=rl(mt(t.ib,t),6e3));if(1>=oT(t.i)&&t.oa){try{t.oa()}catch{}t.oa=void 0}}else Ki(t,11)}else if((n.K||t.g==n)&&Su(t),!Wa(e))for(i=t.Ja.g.parse(e),e=0;e<i.length;e++){let c=i[e];if(t.V=c[0],c=c[1],t.H==2)if(c[0]=="c"){t.K=c[1],t.pa=c[2];let u=c[3];u!=null&&(t.ra=u,t.l.info("VER="+t.ra));let d=c[4];d!=null&&(t.Ga=d,t.l.info("SVER="+t.Ga));let h=c[5];h!=null&&typeof h=="number"&&0<h&&(r=1.5*h,t.L=r,t.l.info("backChannelRequestTimeoutMs_="+r)),r=t;let p=n.g;if(p){let y=p.g?p.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(y){var s=r.i;s.g||y.indexOf("spdy")==-1&&y.indexOf("quic")==-1&&y.indexOf("h2")==-1||(s.j=s.l,s.g=new Set,s.h&&(Dg(s,s.h),s.h=null))}if(r.F){let S=p.g?p.g.getResponseHeader("X-HTTP-Session-Id"):null;S&&(r.Da=S,Ce(r.I,r.F,S))}}t.H=3,t.h&&t.h.Ba(),t.ca&&(t.S=Date.now()-n.G,t.l.info("Handshake RTT: "+t.S+"ms")),r=t;var o=n;if(r.wa=TT(r,r.J?r.pa:null,r.Y),o.K){aT(r.i,o);var a=o,l=r.L;l&&a.setTimeout(l),a.C&&(xu(a),ol(a)),r.g=o}else vT(r);0<t.j.length&&Lu(t)}else c[0]!="stop"&&c[0]!="close"||Ki(t,7);else t.H==3&&(c[0]=="stop"||c[0]=="close"?c[0]=="stop"?Ki(t,7):Ng(t):c[0]!="noop"&&t.h&&t.h.Aa(c),t.A=0)}}Ja(4)}catch{}}function uM(n){if(n.Z&&typeof n.Z=="function")return n.Z();if(typeof Map<"u"&&n instanceof Map||typeof Set<"u"&&n instanceof Set)return Array.from(n.values());if(typeof n=="string")return n.split("");if(Tu(n)){for(var e=[],t=n.length,r=0;r<t;r++)e.push(n[r]);return e}e=[],t=0;for(r in n)e[t++]=n[r];return e}function dM(n){if(n.ta&&typeof n.ta=="function")return n.ta();if(!n.Z||typeof n.Z!="function"){if(typeof Map<"u"&&n instanceof Map)return Array.from(n.keys());if(!(typeof Set<"u"&&n instanceof Set)){if(Tu(n)||typeof n=="string"){var e=[];n=n.length;for(var t=0;t<n;t++)e.push(t);return e}e=[],t=0;for(let r in n)e[t++]=r;return e}}}function Zw(n,e){if(n.forEach&&typeof n.forEach=="function")n.forEach(e,void 0);else if(Tu(n)||typeof n=="string")Array.prototype.forEach.call(n,e,void 0);else for(var t=dM(n),r=uM(n),i=r.length,s=0;s<i;s++)e.call(void 0,r[s],t&&t[s],n)}var eT=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function hM(n,e){if(n){n=n.split("&");for(var t=0;t<n.length;t++){var r=n[t].indexOf("="),i=null;if(0<=r){var s=n[t].substring(0,r);i=n[t].substring(r+1)}else s=n[t];e(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}function Wi(n){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,n instanceof Wi){this.h=n.h,yu(this,n.j),this.s=n.s,this.g=n.g,vu(this,n.m),this.l=n.l;var e=n.i,t=new Za;t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),Sw(this,t),this.o=n.o}else n&&(e=String(n).match(eT))?(this.h=!1,yu(this,e[1]||"",!0),this.s=Ga(e[2]||""),this.g=Ga(e[3]||"",!0),vu(this,e[4]),this.l=Ga(e[5]||"",!0),Sw(this,e[6]||"",!0),this.o=Ga(e[7]||"")):(this.h=!1,this.i=new Za(null,this.h))}Wi.prototype.toString=function(){var n=[],e=this.j;e&&n.push(Ha(e,_w,!0),":");var t=this.g;return(t||e=="file")&&(n.push("//"),(e=this.s)&&n.push(Ha(e,_w,!0),"@"),n.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t=this.m,t!=null&&n.push(":",String(t))),(t=this.l)&&(this.g&&t.charAt(0)!="/"&&n.push("/"),n.push(Ha(t,t.charAt(0)=="/"?gM:pM,!0))),(t=this.i.toString())&&n.push("?",t),(t=this.o)&&n.push("#",Ha(t,yM)),n.join("")};function gr(n){return new Wi(n)}function yu(n,e,t){n.j=t?Ga(e,!0):e,n.j&&(n.j=n.j.replace(/:$/,""))}function vu(n,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);n.m=e}else n.m=null}function Sw(n,e,t){e instanceof Za?(n.i=e,vM(n.i,n.h)):(t||(e=Ha(e,mM)),n.i=new Za(e,n.h))}function Ce(n,e,t){n.i.set(e,t)}function Mu(n){return Ce(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function Ga(n,e){return n?e?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function Ha(n,e,t){return typeof n=="string"?(n=encodeURI(n).replace(e,fM),t&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function fM(n){return n=n.charCodeAt(0),"%"+(n>>4&15).toString(16)+(n&15).toString(16)}var _w=/[#\/\?@]/g,pM=/[#\?:]/g,gM=/[#\?]/g,mM=/[#\?@]/g,yM=/#/g;function Za(n,e){this.h=this.g=null,this.i=n||null,this.j=!!e}function qr(n){n.g||(n.g=new Map,n.h=0,n.i&&hM(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}F=Za.prototype;F.add=function(n,e){qr(this),this.i=null,n=Qs(this,n);var t=this.g.get(n);return t||this.g.set(n,t=[]),t.push(e),this.h+=1,this};function tT(n,e){qr(n),e=Qs(n,e),n.g.has(e)&&(n.i=null,n.h-=n.g.get(e).length,n.g.delete(e))}function nT(n,e){return qr(n),e=Qs(n,e),n.g.has(e)}F.forEach=function(n,e){qr(this),this.g.forEach(function(t,r){t.forEach(function(i){n.call(e,i,r,this)},this)},this)};F.ta=function(){qr(this);let n=Array.from(this.g.values()),e=Array.from(this.g.keys()),t=[];for(let r=0;r<e.length;r++){let i=n[r];for(let s=0;s<i.length;s++)t.push(e[r])}return t};F.Z=function(n){qr(this);let e=[];if(typeof n=="string")nT(this,n)&&(e=e.concat(this.g.get(Qs(this,n))));else{n=Array.from(this.g.values());for(let t=0;t<n.length;t++)e=e.concat(n[t])}return e};F.set=function(n,e){return qr(this),this.i=null,n=Qs(this,n),nT(this,n)&&(this.h-=this.g.get(n).length),this.g.set(n,[e]),this.h+=1,this};F.get=function(n,e){return n?(n=this.Z(n),0<n.length?String(n[0]):e):e};function rT(n,e,t){tT(n,e),0<t.length&&(n.i=null,n.g.set(Qs(n,e),pg(t)),n.h+=t.length)}F.toString=function(){if(this.i)return this.i;if(!this.g)return"";let n=[],e=Array.from(this.g.keys());for(var t=0;t<e.length;t++){var r=e[t];let s=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var i=s;o[r]!==""&&(i+="="+encodeURIComponent(String(o[r]))),n.push(i)}}return this.i=n.join("&")};function Qs(n,e){return e=String(e),n.j&&(e=e.toLowerCase()),e}function vM(n,e){e&&!n.j&&(qr(n),n.i=null,n.g.forEach(function(t,r){var i=r.toLowerCase();r!=i&&(tT(this,r),rT(this,i,t))},n)),n.j=e}var SM=class{constructor(n,e){this.g=n,this.map=e}};function iT(n){this.l=n||_M,Q.PerformanceNavigationTiming?(n=Q.performance.getEntriesByType("navigation"),n=0<n.length&&(n[0].nextHopProtocol=="hq"||n[0].nextHopProtocol=="h2")):n=!!(Q.g&&Q.g.Ka&&Q.g.Ka()&&Q.g.Ka().dc),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var _M=10;function sT(n){return n.h?!0:n.g?n.g.size>=n.j:!1}function oT(n){return n.h?1:n.g?n.g.size:0}function ug(n,e){return n.h?n.h==e:n.g?n.g.has(e):!1}function Dg(n,e){n.g?n.g.add(e):n.h=e}function aT(n,e){n.h&&n.h==e?n.h=null:n.g&&n.g.has(e)&&n.g.delete(e)}iT.prototype.cancel=function(){if(this.i=lT(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let n of this.g.values())n.cancel();this.g.clear()}};function lT(n){if(n.h!=null)return n.i.concat(n.h.F);if(n.g!=null&&n.g.size!==0){let e=n.i;for(let t of n.g.values())e=e.concat(t.F);return e}return pg(n.i)}var EM=class{stringify(n){return Q.JSON.stringify(n,void 0)}parse(n){return Q.JSON.parse(n,void 0)}};function wM(){this.g=new EM}function TM(n,e,t){let r=t||"";try{Zw(n,function(i,s){let o=i;tl(i)&&(o=Eg(i)),e.push(r+s+"="+encodeURIComponent(o))})}catch(i){throw e.push(r+"type="+encodeURIComponent("_badmap")),i}}function CM(n,e){let t=new Du;if(Q.Image){let r=new Image;r.onload=uu(gu,t,r,"TestLoadImage: loaded",!0,e),r.onerror=uu(gu,t,r,"TestLoadImage: error",!1,e),r.onabort=uu(gu,t,r,"TestLoadImage: abort",!1,e),r.ontimeout=uu(gu,t,r,"TestLoadImage: timeout",!1,e),Q.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=n}else e(!1)}function gu(n,e,t,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch{}}function al(n){this.l=n.ec||null,this.j=n.ob||!1}tt(al,bg);al.prototype.g=function(){return new Ou(this.l,this.j)};al.prototype.i=function(n){return function(){return n}}({});function Ou(n,e){et.call(this),this.F=n,this.u=e,this.m=void 0,this.readyState=Rg,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}tt(Ou,et);var Rg=0;F=Ou.prototype;F.open=function(n,e){if(this.readyState!=Rg)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=e,this.readyState=1,el(this)};F.send=function(n){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(e.body=n),(this.F||Q).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))};F.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,ll(this)),this.readyState=Rg};F.$a=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,el(this)),this.g&&(this.readyState=3,el(this),this.g)))if(this.responseType==="arraybuffer")n.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof Q.ReadableStream<"u"&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;cT(this)}else n.text().then(this.Za.bind(this),this.ka.bind(this))};function cT(n){n.j.read().then(n.Xa.bind(n)).catch(n.ka.bind(n))}F.Xa=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var e=n.value?n.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!n.done}))&&(this.response=this.responseText+=e)}n.done?ll(this):el(this),this.readyState==3&&cT(this)}};F.Za=function(n){this.g&&(this.response=this.responseText=n,ll(this))};F.Ya=function(n){this.g&&(this.response=n,ll(this))};F.ka=function(){this.g&&ll(this)};function ll(n){n.readyState=4,n.l=null,n.j=null,n.A=null,el(n)}F.setRequestHeader=function(n,e){this.v.append(n,e)};F.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""};F.getAllResponseHeaders=function(){if(!this.h)return"";let n=[],e=this.h.entries();for(var t=e.next();!t.done;)t=t.value,n.push(t[0]+": "+t[1]),t=e.next();return n.join(`\r
`)};function el(n){n.onreadystatechange&&n.onreadystatechange.call(n)}Object.defineProperty(Ou.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(n){this.m=n?"include":"same-origin"}});var bM=Q.JSON.parse;function Pe(n){et.call(this),this.headers=new Map,this.u=n||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=uT,this.L=this.M=!1}tt(Pe,et);var uT="",AM=/^https?$/i,IM=["POST","PUT"];F=Pe.prototype;F.Oa=function(n){this.M=n};F.ha=function(n,e,t,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+n);e=e?e.toUpperCase():"GET",this.I=n,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():og.g(),this.C=this.u?vw(this.u):vw(og),this.g.onreadystatechange=mt(this.La,this);try{this.G=!0,this.g.open(e,String(n),!0),this.G=!1}catch(s){Ew(this,s);return}if(n=t||"",t=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)t.set(i,r[i]);else if(typeof r.keys=="function"&&typeof r.get=="function")for(let s of r.keys())t.set(s,r.get(s));else throw Error("Unknown input type for opt_headers: "+String(r));r=Array.from(t.keys()).find(s=>s.toLowerCase()=="content-type"),i=Q.FormData&&n instanceof Q.FormData,!(0<=Aw(IM,e))||r||i||t.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[s,o]of t)this.g.setRequestHeader(s,o);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{fT(this),0<this.B&&((this.L=DM(this.g))?(this.g.timeout=this.B,this.g.ontimeout=mt(this.ua,this)):this.A=Cg(this.ua,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(s){Ew(this,s)}};function DM(n){return $s&&typeof n.timeout=="number"&&n.ontimeout!==void 0}F.ua=function(){typeof fg<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,dt(this,"timeout"),this.abort(8))};function Ew(n,e){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=e,n.m=5,dT(n),Pu(n)}function dT(n){n.F||(n.F=!0,dt(n,"complete"),dt(n,"error"))}F.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,dt(this,"complete"),dt(this,"abort"),Pu(this))};F.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Pu(this,!0)),Pe.$.N.call(this)};F.La=function(){this.s||(this.G||this.v||this.l?hT(this):this.kb())};F.kb=function(){hT(this)};function hT(n){if(n.h&&typeof fg<"u"&&(!n.C[1]||qn(n)!=4||n.da()!=2)){if(n.v&&qn(n)==4)Cg(n.La,0,n);else if(dt(n,"readystatechange"),qn(n)==4){n.h=!1;try{let o=n.da();e:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var t;if(!(t=e)){var r;if(r=o===0){var i=String(n.I).match(eT)[1]||null;!i&&Q.self&&Q.self.location&&(i=Q.self.location.protocol.slice(0,-1)),r=!AM.test(i?i.toLowerCase():"")}t=r}if(t)dt(n,"complete"),dt(n,"success");else{n.m=6;try{var s=2<qn(n)?n.g.statusText:""}catch{s=""}n.j=s+" ["+n.da()+"]",dT(n)}}finally{Pu(n)}}}}function Pu(n,e){if(n.g){fT(n);let t=n.g,r=n.C[0]?()=>{}:null;n.g=null,n.C=null,e||dt(n,"ready");try{t.onreadystatechange=r}catch{}}}function fT(n){n.g&&n.L&&(n.g.ontimeout=null),n.A&&(Q.clearTimeout(n.A),n.A=null)}F.isActive=function(){return!!this.g};function qn(n){return n.g?n.g.readyState:0}F.da=function(){try{return 2<qn(this)?this.g.status:-1}catch{return-1}};F.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}};F.Wa=function(n){if(this.g){var e=this.g.responseText;return n&&e.indexOf(n)==0&&(e=e.substring(n.length)),bM(e)}};function ww(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.K){case uT:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch{return null}}function RM(n){let e={};n=(n.g&&2<=qn(n)&&n.g.getAllResponseHeaders()||"").split(`\r
`);for(let r=0;r<n.length;r++){if(Wa(n[r]))continue;var t=tM(n[r]);let i=t[0];if(t=t[1],typeof t!="string")continue;t=t.trim();let s=e[i]||[];e[i]=s,s.push(t)}Xx(e,function(r){return r.join(", ")})}F.Ia=function(){return this.m};F.Sa=function(){return typeof this.j=="string"?this.j:String(this.j)};function pT(n){let e="";return mg(n,function(t,r){e+=r,e+=":",e+=t,e+=`\r
`}),e}function kg(n,e,t){e:{for(r in t){var r=!1;break e}r=!0}r||(t=pT(t),typeof n=="string"?t!=null&&encodeURIComponent(String(t)):Ce(n,e,t))}function za(n,e,t){return t&&t.internalChannelParams&&t.internalChannelParams[n]||e}function gT(n){this.Ga=0,this.j=[],this.l=new Du,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=za("failFast",!1,n),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=za("baseRetryDelayMs",5e3,n),this.hb=za("retryDelaySeedMs",1e4,n),this.eb=za("forwardChannelMaxRetries",2,n),this.xa=za("forwardChannelRequestTimeoutMs",2e4,n),this.va=n&&n.xmlHttpFactory||void 0,this.Ha=n&&n.useFetchStreams||!1,this.L=void 0,this.J=n&&n.supportsCrossDomainXhr||!1,this.K="",this.i=new iT(n&&n.concurrentRequestLimit),this.Ja=new wM,this.P=n&&n.fastHandshake||!1,this.O=n&&n.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=n&&n.bc||!1,n&&n.Ea&&this.l.Ea(),n&&n.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&n&&n.detectBufferingProxy||!1,this.qa=void 0,n&&n.longPollingTimeout&&0<n.longPollingTimeout&&(this.qa=n.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}F=gT.prototype;F.ra=8;F.H=1;function Ng(n){if(mT(n),n.H==3){var e=n.W++,t=gr(n.I);if(Ce(t,"SID",n.K),Ce(t,"RID",e),Ce(t,"TYPE","terminate"),cl(n,t),e=new sl(n,n.l,e),e.L=2,e.A=Mu(gr(t)),t=!1,Q.navigator&&Q.navigator.sendBeacon)try{t=Q.navigator.sendBeacon(e.A.toString(),"")}catch{}!t&&Q.Image&&(new Image().src=e.A,t=!0),t||(e.g=CT(e.l,null),e.g.ha(e.A)),e.G=Date.now(),ol(e)}wT(n)}function Fu(n){n.g&&(Mg(n),n.g.cancel(),n.g=null)}function mT(n){Fu(n),n.u&&(Q.clearTimeout(n.u),n.u=null),Su(n),n.i.cancel(),n.m&&(typeof n.m=="number"&&Q.clearTimeout(n.m),n.m=null)}function Lu(n){if(!sT(n.i)&&!n.m){n.m=!0;var e=n.Na;Qa||Bw(),Ya||(Qa(),Ya=!0),wg.add(e,n),n.C=0}}function kM(n,e){return oT(n.i)>=n.i.j-(n.m?1:0)?!1:n.m?(n.j=e.F.concat(n.j),!0):n.H==1||n.H==2||n.C>=(n.cb?0:n.eb)?!1:(n.m=rl(mt(n.Na,n,e),ET(n,n.C)),n.C++,!0)}F.Na=function(n){if(this.m)if(this.m=null,this.H==1){if(!n){this.W=Math.floor(1e5*Math.random()),n=this.W++;let i=new sl(this,this.l,n),s=this.s;if(this.U&&(s?(s=kw(s),Nw(s,this.U)):s=this.U),this.o!==null||this.O||(i.I=s,s=null),this.P)e:{for(var e=0,t=0;t<this.j.length;t++){t:{var r=this.j[t];if("__data__"in r.map&&(r=r.map.__data__,typeof r=="string")){r=r.length;break t}r=void 0}if(r===void 0)break;if(e+=r,4096<e){e=t;break e}if(e===4096||t===this.j.length-1){e=t+1;break e}}e=1e3}else e=1e3;e=yT(this,i,e),t=gr(this.I),Ce(t,"RID",n),Ce(t,"CVER",22),this.F&&Ce(t,"X-HTTP-Session-Id",this.F),cl(this,t),s&&(this.O?e="headers="+encodeURIComponent(String(pT(s)))+"&"+e:this.o&&kg(t,this.o,s)),Dg(this.i,i),this.bb&&Ce(t,"TYPE","init"),this.P?(Ce(t,"$req",e),Ce(t,"SID","null"),i.aa=!0,lg(i,t,null)):lg(i,t,e),this.H=2}}else this.H==3&&(n?Tw(this,n):this.j.length==0||sT(this.i)||Tw(this))};function Tw(n,e){var t;e?t=e.m:t=n.W++;let r=gr(n.I);Ce(r,"SID",n.K),Ce(r,"RID",t),Ce(r,"AID",n.V),cl(n,r),n.o&&n.s&&kg(r,n.o,n.s),t=new sl(n,n.l,t,n.C+1),n.o===null&&(t.I=n.s),e&&(n.j=e.F.concat(n.j)),e=yT(n,t,1e3),t.setTimeout(Math.round(.5*n.xa)+Math.round(.5*n.xa*Math.random())),Dg(n.i,t),lg(t,r,e)}function cl(n,e){n.na&&mg(n.na,function(t,r){Ce(e,r,t)}),n.h&&Zw({},function(t,r){Ce(e,r,t)})}function yT(n,e,t){t=Math.min(n.j.length,t);var r=n.h?mt(n.h.Va,n.h,n):null;e:{var i=n.j;let s=-1;for(;;){let o=["count="+t];s==-1?0<t?(s=i[0].g,o.push("ofs="+s)):s=0:o.push("ofs="+s);let a=!0;for(let l=0;l<t;l++){let c=i[l].g,u=i[l].map;if(c-=s,0>c)s=Math.max(0,i[l].g-100),a=!1;else try{TM(u,o,"req"+c+"_")}catch{r&&r(u)}}if(a){r=o.join("&");break e}}}return n=n.j.splice(0,t),e.F=n,r}function vT(n){if(!n.g&&!n.u){n.ba=1;var e=n.Ma;Qa||Bw(),Ya||(Qa(),Ya=!0),wg.add(e,n),n.A=0}}function xg(n){return n.g||n.u||3<=n.A?!1:(n.ba++,n.u=rl(mt(n.Ma,n),ET(n,n.A)),n.A++,!0)}F.Ma=function(){if(this.u=null,ST(this),this.ca&&!(this.M||this.g==null||0>=this.S)){var n=2*this.S;this.l.info("BP detection timer enabled: "+n),this.B=rl(mt(this.jb,this),n)}};F.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,Rt(10),Fu(this),ST(this))};function Mg(n){n.B!=null&&(Q.clearTimeout(n.B),n.B=null)}function ST(n){n.g=new sl(n,n.l,"rpc",n.ba),n.o===null&&(n.g.I=n.s),n.g.O=0;var e=gr(n.wa);Ce(e,"RID","rpc"),Ce(e,"SID",n.K),Ce(e,"AID",n.V),Ce(e,"CI",n.G?"0":"1"),!n.G&&n.qa&&Ce(e,"TO",n.qa),Ce(e,"TYPE","xmlhttp"),cl(n,e),n.o&&n.s&&kg(e,n.o,n.s),n.L&&n.g.setTimeout(n.L);var t=n.g;n=n.pa,t.L=1,t.A=Mu(gr(e)),t.u=null,t.S=!0,Qw(t,n)}F.ib=function(){this.v!=null&&(this.v=null,Fu(this),xg(this),Rt(19))};function Su(n){n.v!=null&&(Q.clearTimeout(n.v),n.v=null)}function _T(n,e){var t=null;if(n.g==e){Su(n),Mg(n),n.g=null;var r=2}else if(ug(n.i,e))t=e.F,aT(n.i,e),r=1;else return;if(n.H!=0){if(e.i)if(r==1){t=e.u?e.u.length:0,e=Date.now()-e.G;var i=n.C;r=Ru(),dt(r,new Gw(r,t)),Lu(n)}else vT(n);else if(i=e.s,i==3||i==0&&0<e.ca||!(r==1&&kM(n,e)||r==2&&xg(n)))switch(t&&0<t.length&&(e=n.i,e.i=e.i.concat(t)),i){case 1:Ki(n,5);break;case 4:Ki(n,10);break;case 3:Ki(n,6);break;default:Ki(n,2)}}}function ET(n,e){let t=n.ab+Math.floor(Math.random()*n.hb);return n.isActive()||(t*=2),t*e}function Ki(n,e){if(n.l.info("Error code "+e),e==2){var t=null;n.h&&(t=null);var r=mt(n.pb,n);t||(t=new Wi("//www.google.com/images/cleardot.gif"),Q.location&&Q.location.protocol=="http"||yu(t,"https"),Mu(t)),CM(t.toString(),r)}else Rt(2);n.H=0,n.h&&n.h.za(e),wT(n),mT(n)}F.pb=function(n){n?(this.l.info("Successfully pinged google.com"),Rt(2)):(this.l.info("Failed to ping google.com"),Rt(1))};function wT(n){if(n.H=0,n.ma=[],n.h){let e=lT(n.i);(e.length!=0||n.j.length!=0)&&(pw(n.ma,e),pw(n.ma,n.j),n.i.i.length=0,pg(n.j),n.j.length=0),n.h.ya()}}function TT(n,e,t){var r=t instanceof Wi?gr(t):new Wi(t);if(r.g!="")e&&(r.g=e+"."+r.g),vu(r,r.m);else{var i=Q.location;r=i.protocol,e=e?e+"."+i.hostname:i.hostname,i=+i.port;var s=new Wi(null);r&&yu(s,r),e&&(s.g=e),i&&vu(s,i),t&&(s.l=t),r=s}return t=n.F,e=n.Da,t&&e&&Ce(r,t,e),Ce(r,"VER",n.ra),cl(n,r),r}function CT(n,e,t){if(e&&!n.J)throw Error("Can't create secondary domain capable XhrIo object.");return e=n.Ha&&!n.va?new Pe(new al({ob:t})):new Pe(n.va),e.Oa(n.J),e}F.isActive=function(){return!!this.h&&this.h.isActive(this)};function bT(){}F=bT.prototype;F.Ba=function(){};F.Aa=function(){};F.za=function(){};F.ya=function(){};F.isActive=function(){return!0};F.Va=function(){};function _u(){if($s&&!(10<=Number(Wx)))throw Error("Environmental error: no available transport.")}_u.prototype.g=function(n,e){return new Kt(n,e)};function Kt(n,e){et.call(this),this.g=new gT(e),this.l=n,this.h=e&&e.messageUrlParams||null,n=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(n?n["X-WebChannel-Content-Type"]=e.messageContentType:n={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(n?n["X-WebChannel-Client-Profile"]=e.Ca:n={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=n,(n=e&&e.cc)&&!Wa(n)&&(this.g.o=n),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Wa(e)&&(this.g.F=e,n=this.h,n!==null&&e in n&&(n=this.h,e in n&&delete n[e])),this.j=new Ys(this)}tt(Kt,et);Kt.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var n=this.g,e=this.l,t=this.h||void 0;Rt(0),n.Y=e,n.na=t||{},n.G=n.aa,n.I=TT(n,null,n.Y),Lu(n)};Kt.prototype.close=function(){Ng(this.g)};Kt.prototype.u=function(n){var e=this.g;if(typeof n=="string"){var t={};t.__data__=n,n=t}else this.v&&(t={},t.__data__=Eg(n),n=t);e.j.push(new SM(e.fb++,n)),e.H==3&&Lu(e)};Kt.prototype.N=function(){this.g.h=null,delete this.j,Ng(this.g),delete this.g,Kt.$.N.call(this)};function AT(n){Ag.call(this),n.__headers__&&(this.headers=n.__headers__,this.statusCode=n.__status__,delete n.__headers__,delete n.__status__);var e=n.__sm__;if(e){e:{for(let t in e){n=t;break e}n=void 0}(this.i=n)&&(n=this.i,e=e!==null&&n in e?e[n]:void 0),this.data=e}else this.data=n}tt(AT,Ag);function IT(){Ig.call(this),this.status=1}tt(IT,Ig);function Ys(n){this.g=n}tt(Ys,bT);Ys.prototype.Ba=function(){dt(this.g,"a")};Ys.prototype.Aa=function(n){dt(this.g,new AT(n))};Ys.prototype.za=function(n){dt(this.g,new IT)};Ys.prototype.ya=function(){dt(this.g,"b")};function NM(){this.blockSize=-1}function Sn(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}tt(Sn,NM);Sn.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0};function Yp(n,e,t){t||(t=0);var r=Array(16);if(typeof e=="string")for(var i=0;16>i;++i)r[i]=e.charCodeAt(t++)|e.charCodeAt(t++)<<8|e.charCodeAt(t++)<<16|e.charCodeAt(t++)<<24;else for(i=0;16>i;++i)r[i]=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;e=n.g[0],t=n.g[1],i=n.g[2];var s=n.g[3],o=e+(s^t&(i^s))+r[0]+3614090360&4294967295;e=t+(o<<7&4294967295|o>>>25),o=s+(i^e&(t^i))+r[1]+3905402710&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(t^s&(e^t))+r[2]+606105819&4294967295,i=s+(o<<17&4294967295|o>>>15),o=t+(e^i&(s^e))+r[3]+3250441966&4294967295,t=i+(o<<22&4294967295|o>>>10),o=e+(s^t&(i^s))+r[4]+4118548399&4294967295,e=t+(o<<7&4294967295|o>>>25),o=s+(i^e&(t^i))+r[5]+1200080426&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(t^s&(e^t))+r[6]+2821735955&4294967295,i=s+(o<<17&4294967295|o>>>15),o=t+(e^i&(s^e))+r[7]+4249261313&4294967295,t=i+(o<<22&4294967295|o>>>10),o=e+(s^t&(i^s))+r[8]+1770035416&4294967295,e=t+(o<<7&4294967295|o>>>25),o=s+(i^e&(t^i))+r[9]+2336552879&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(t^s&(e^t))+r[10]+4294925233&4294967295,i=s+(o<<17&4294967295|o>>>15),o=t+(e^i&(s^e))+r[11]+2304563134&4294967295,t=i+(o<<22&4294967295|o>>>10),o=e+(s^t&(i^s))+r[12]+1804603682&4294967295,e=t+(o<<7&4294967295|o>>>25),o=s+(i^e&(t^i))+r[13]+4254626195&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(t^s&(e^t))+r[14]+2792965006&4294967295,i=s+(o<<17&4294967295|o>>>15),o=t+(e^i&(s^e))+r[15]+1236535329&4294967295,t=i+(o<<22&4294967295|o>>>10),o=e+(i^s&(t^i))+r[1]+4129170786&4294967295,e=t+(o<<5&4294967295|o>>>27),o=s+(t^i&(e^t))+r[6]+3225465664&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^t&(s^e))+r[11]+643717713&4294967295,i=s+(o<<14&4294967295|o>>>18),o=t+(s^e&(i^s))+r[0]+3921069994&4294967295,t=i+(o<<20&4294967295|o>>>12),o=e+(i^s&(t^i))+r[5]+3593408605&4294967295,e=t+(o<<5&4294967295|o>>>27),o=s+(t^i&(e^t))+r[10]+38016083&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^t&(s^e))+r[15]+3634488961&4294967295,i=s+(o<<14&4294967295|o>>>18),o=t+(s^e&(i^s))+r[4]+3889429448&4294967295,t=i+(o<<20&4294967295|o>>>12),o=e+(i^s&(t^i))+r[9]+568446438&4294967295,e=t+(o<<5&4294967295|o>>>27),o=s+(t^i&(e^t))+r[14]+3275163606&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^t&(s^e))+r[3]+4107603335&4294967295,i=s+(o<<14&4294967295|o>>>18),o=t+(s^e&(i^s))+r[8]+1163531501&4294967295,t=i+(o<<20&4294967295|o>>>12),o=e+(i^s&(t^i))+r[13]+2850285829&4294967295,e=t+(o<<5&4294967295|o>>>27),o=s+(t^i&(e^t))+r[2]+4243563512&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^t&(s^e))+r[7]+1735328473&4294967295,i=s+(o<<14&4294967295|o>>>18),o=t+(s^e&(i^s))+r[12]+2368359562&4294967295,t=i+(o<<20&4294967295|o>>>12),o=e+(t^i^s)+r[5]+4294588738&4294967295,e=t+(o<<4&4294967295|o>>>28),o=s+(e^t^i)+r[8]+2272392833&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^t)+r[11]+1839030562&4294967295,i=s+(o<<16&4294967295|o>>>16),o=t+(i^s^e)+r[14]+4259657740&4294967295,t=i+(o<<23&4294967295|o>>>9),o=e+(t^i^s)+r[1]+2763975236&4294967295,e=t+(o<<4&4294967295|o>>>28),o=s+(e^t^i)+r[4]+1272893353&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^t)+r[7]+4139469664&4294967295,i=s+(o<<16&4294967295|o>>>16),o=t+(i^s^e)+r[10]+3200236656&4294967295,t=i+(o<<23&4294967295|o>>>9),o=e+(t^i^s)+r[13]+681279174&4294967295,e=t+(o<<4&4294967295|o>>>28),o=s+(e^t^i)+r[0]+3936430074&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^t)+r[3]+3572445317&4294967295,i=s+(o<<16&4294967295|o>>>16),o=t+(i^s^e)+r[6]+76029189&4294967295,t=i+(o<<23&4294967295|o>>>9),o=e+(t^i^s)+r[9]+3654602809&4294967295,e=t+(o<<4&4294967295|o>>>28),o=s+(e^t^i)+r[12]+3873151461&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^t)+r[15]+530742520&4294967295,i=s+(o<<16&4294967295|o>>>16),o=t+(i^s^e)+r[2]+3299628645&4294967295,t=i+(o<<23&4294967295|o>>>9),o=e+(i^(t|~s))+r[0]+4096336452&4294967295,e=t+(o<<6&4294967295|o>>>26),o=s+(t^(e|~i))+r[7]+1126891415&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~t))+r[14]+2878612391&4294967295,i=s+(o<<15&4294967295|o>>>17),o=t+(s^(i|~e))+r[5]+4237533241&4294967295,t=i+(o<<21&4294967295|o>>>11),o=e+(i^(t|~s))+r[12]+1700485571&4294967295,e=t+(o<<6&4294967295|o>>>26),o=s+(t^(e|~i))+r[3]+2399980690&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~t))+r[10]+4293915773&4294967295,i=s+(o<<15&4294967295|o>>>17),o=t+(s^(i|~e))+r[1]+2240044497&4294967295,t=i+(o<<21&4294967295|o>>>11),o=e+(i^(t|~s))+r[8]+1873313359&4294967295,e=t+(o<<6&4294967295|o>>>26),o=s+(t^(e|~i))+r[15]+4264355552&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~t))+r[6]+2734768916&4294967295,i=s+(o<<15&4294967295|o>>>17),o=t+(s^(i|~e))+r[13]+1309151649&4294967295,t=i+(o<<21&4294967295|o>>>11),o=e+(i^(t|~s))+r[4]+4149444226&4294967295,e=t+(o<<6&4294967295|o>>>26),o=s+(t^(e|~i))+r[11]+3174756917&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~t))+r[2]+718787259&4294967295,i=s+(o<<15&4294967295|o>>>17),o=t+(s^(i|~e))+r[9]+3951481745&4294967295,n.g[0]=n.g[0]+e&4294967295,n.g[1]=n.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,n.g[2]=n.g[2]+i&4294967295,n.g[3]=n.g[3]+s&4294967295}Sn.prototype.j=function(n,e){e===void 0&&(e=n.length);for(var t=e-this.blockSize,r=this.m,i=this.h,s=0;s<e;){if(i==0)for(;s<=t;)Yp(this,n,s),s+=this.blockSize;if(typeof n=="string"){for(;s<e;)if(r[i++]=n.charCodeAt(s++),i==this.blockSize){Yp(this,r),i=0;break}}else for(;s<e;)if(r[i++]=n[s++],i==this.blockSize){Yp(this,r),i=0;break}}this.h=i,this.i+=e};Sn.prototype.l=function(){var n=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);n[0]=128;for(var e=1;e<n.length-8;++e)n[e]=0;var t=8*this.i;for(e=n.length-8;e<n.length;++e)n[e]=t&255,t/=256;for(this.j(n),n=Array(16),e=t=0;4>e;++e)for(var r=0;32>r;r+=8)n[t++]=this.g[e]>>>r&255;return n};function fe(n,e){this.h=e;for(var t=[],r=!0,i=n.length-1;0<=i;i--){var s=n[i]|0;r&&s==e||(t[i]=s,r=!1)}this.g=t}var xM={};function Og(n){return-128<=n&&128>n?Gx(n,function(e){return new fe([e|0],0>e?-1:0)}):new fe([n|0],0>n?-1:0)}function Un(n){if(isNaN(n)||!isFinite(n))return Ws;if(0>n)return ut(Un(-n));for(var e=[],t=1,r=0;n>=t;r++)e[r]=n/t|0,t*=dg;return new fe(e,0)}function DT(n,e){if(n.length==0)throw Error("number format error: empty string");if(e=e||10,2>e||36<e)throw Error("radix out of range: "+e);if(n.charAt(0)=="-")return ut(DT(n.substring(1),e));if(0<=n.indexOf("-"))throw Error('number format error: interior "-" character');for(var t=Un(Math.pow(e,8)),r=Ws,i=0;i<n.length;i+=8){var s=Math.min(8,n.length-i),o=parseInt(n.substring(i,i+s),e);8>s?(s=Un(Math.pow(e,s)),r=r.R(s).add(Un(o))):(r=r.R(t),r=r.add(Un(o)))}return r}var dg=4294967296,Ws=Og(0),hg=Og(1),Cw=Og(16777216);F=fe.prototype;F.ea=function(){if(en(this))return-ut(this).ea();for(var n=0,e=1,t=0;t<this.g.length;t++){var r=this.D(t);n+=(0<=r?r:dg+r)*e,e*=dg}return n};F.toString=function(n){if(n=n||10,2>n||36<n)throw Error("radix out of range: "+n);if(pr(this))return"0";if(en(this))return"-"+ut(this).toString(n);for(var e=Un(Math.pow(n,6)),t=this,r="";;){var i=wu(t,e).g;t=Eu(t,i.R(e));var s=((0<t.g.length?t.g[0]:t.h)>>>0).toString(n);if(t=i,pr(t))return s+r;for(;6>s.length;)s="0"+s;r=s+r}};F.D=function(n){return 0>n?0:n<this.g.length?this.g[n]:this.h};function pr(n){if(n.h!=0)return!1;for(var e=0;e<n.g.length;e++)if(n.g[e]!=0)return!1;return!0}function en(n){return n.h==-1}F.X=function(n){return n=Eu(this,n),en(n)?-1:pr(n)?0:1};function ut(n){for(var e=n.g.length,t=[],r=0;r<e;r++)t[r]=~n.g[r];return new fe(t,~n.h).add(hg)}F.abs=function(){return en(this)?ut(this):this};F.add=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0,i=0;i<=e;i++){var s=r+(this.D(i)&65535)+(n.D(i)&65535),o=(s>>>16)+(this.D(i)>>>16)+(n.D(i)>>>16);r=o>>>16,s&=65535,o&=65535,t[i]=o<<16|s}return new fe(t,t[t.length-1]&-2147483648?-1:0)};function Eu(n,e){return n.add(ut(e))}F.R=function(n){if(pr(this)||pr(n))return Ws;if(en(this))return en(n)?ut(this).R(ut(n)):ut(ut(this).R(n));if(en(n))return ut(this.R(ut(n)));if(0>this.X(Cw)&&0>n.X(Cw))return Un(this.ea()*n.ea());for(var e=this.g.length+n.g.length,t=[],r=0;r<2*e;r++)t[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<n.g.length;i++){var s=this.D(r)>>>16,o=this.D(r)&65535,a=n.D(i)>>>16,l=n.D(i)&65535;t[2*r+2*i]+=o*l,mu(t,2*r+2*i),t[2*r+2*i+1]+=s*l,mu(t,2*r+2*i+1),t[2*r+2*i+1]+=o*a,mu(t,2*r+2*i+1),t[2*r+2*i+2]+=s*a,mu(t,2*r+2*i+2)}for(r=0;r<e;r++)t[r]=t[2*r+1]<<16|t[2*r];for(r=e;r<2*e;r++)t[r]=0;return new fe(t,0)};function mu(n,e){for(;(n[e]&65535)!=n[e];)n[e+1]+=n[e]>>>16,n[e]&=65535,e++}function ja(n,e){this.g=n,this.h=e}function wu(n,e){if(pr(e))throw Error("division by zero");if(pr(n))return new ja(Ws,Ws);if(en(n))return e=wu(ut(n),e),new ja(ut(e.g),ut(e.h));if(en(e))return e=wu(n,ut(e)),new ja(ut(e.g),e.h);if(30<n.g.length){if(en(n)||en(e))throw Error("slowDivide_ only works with positive integers.");for(var t=hg,r=e;0>=r.X(n);)t=bw(t),r=bw(r);var i=Hs(t,1),s=Hs(r,1);for(r=Hs(r,2),t=Hs(t,2);!pr(r);){var o=s.add(r);0>=o.X(n)&&(i=i.add(t),s=o),r=Hs(r,1),t=Hs(t,1)}return e=Eu(n,i.R(e)),new ja(i,e)}for(i=Ws;0<=n.X(e);){for(t=Math.max(1,Math.floor(n.ea()/e.ea())),r=Math.ceil(Math.log(t)/Math.LN2),r=48>=r?1:Math.pow(2,r-48),s=Un(t),o=s.R(e);en(o)||0<o.X(n);)t-=r,s=Un(t),o=s.R(e);pr(s)&&(s=hg),i=i.add(s),n=Eu(n,o)}return new ja(i,n)}F.gb=function(n){return wu(this,n).h};F.and=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)&n.D(r);return new fe(t,this.h&n.h)};F.or=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)|n.D(r);return new fe(t,this.h|n.h)};F.xor=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)^n.D(r);return new fe(t,this.h^n.h)};function bw(n){for(var e=n.g.length+1,t=[],r=0;r<e;r++)t[r]=n.D(r)<<1|n.D(r-1)>>>31;return new fe(t,n.h)}function Hs(n,e){var t=e>>5;e%=32;for(var r=n.g.length-t,i=[],s=0;s<r;s++)i[s]=0<e?n.D(s+t)>>>e|n.D(s+t+1)<<32-e:n.D(s+t);return new fe(i,n.h)}_u.prototype.createWebChannel=_u.prototype.g;Kt.prototype.send=Kt.prototype.u;Kt.prototype.open=Kt.prototype.m;Kt.prototype.close=Kt.prototype.close;ku.NO_ERROR=0;ku.TIMEOUT=8;ku.HTTP_ERROR=6;Hw.COMPLETE="complete";Kw.EventType=il;il.OPEN="a";il.CLOSE="b";il.ERROR="c";il.MESSAGE="d";et.prototype.listen=et.prototype.O;Pe.prototype.listenOnce=Pe.prototype.P;Pe.prototype.getLastError=Pe.prototype.Sa;Pe.prototype.getLastErrorCode=Pe.prototype.Ia;Pe.prototype.getStatus=Pe.prototype.da;Pe.prototype.getResponseJson=Pe.prototype.Wa;Pe.prototype.getResponseText=Pe.prototype.ja;Pe.prototype.send=Pe.prototype.ha;Pe.prototype.setWithCredentials=Pe.prototype.Oa;Sn.prototype.digest=Sn.prototype.l;Sn.prototype.reset=Sn.prototype.reset;Sn.prototype.update=Sn.prototype.j;fe.prototype.add=fe.prototype.add;fe.prototype.multiply=fe.prototype.R;fe.prototype.modulo=fe.prototype.gb;fe.prototype.compare=fe.prototype.X;fe.prototype.toNumber=fe.prototype.ea;fe.prototype.toString=fe.prototype.toString;fe.prototype.getBits=fe.prototype.D;fe.fromNumber=Un;fe.fromString=DT;var TH=_n.createWebChannelTransport=function(){return new _u},CH=_n.getStatEventTarget=function(){return Ru()},bH=_n.ErrorCode=ku,AH=_n.EventType=Hw,IH=_n.Event=$i,DH=_n.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},RH=_n.FetchXmlHttpFactory=al,kH=_n.WebChannel=Kw,NH=_n.XhrIo=Pe,RT=_n.Md5=Sn,Qi=_n.Integer=fe;var gs=wE(rD(),1),g1=wE(Ry(),1);var iD="@firebase/firestore",sD="4.4.0";var Xe=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};Xe.UNAUTHENTICATED=new Xe(null);Xe.GOOGLE_CREDENTIALS=new Xe("google-credentials-uid");Xe.FIRST_PARTY=new Xe("first-party-uid");Xe.MOCK_USER=new Xe("mock-user");var Xq="10.7.0";var va=Xq;function Jq(n){va=n}function Zq(n){return Wq(n,{depth:100})}var Ei=new iu("@firebase/firestore");function Ko(){return Ei.logLevel}function m1(n){Ei.setLogLevel(n)}function R(n,...e){if(Ei.logLevel<=Bn.DEBUG){let t=e.map(o_);Ei.debug(`Firestore (${va}): ${n}`,...t)}}function Ne(n,...e){if(Ei.logLevel<=Bn.ERROR){let t=e.map(o_);Ei.error(`Firestore (${va}): ${n}`,...t)}}function pn(n,...e){if(Ei.logLevel<=Bn.WARN){let t=e.map(o_);Ei.warn(`Firestore (${va}): ${n}`,...t)}}function o_(n){if(typeof n=="string")return n;try{return Zq(n)}catch{return n}}function V(n="Unexpected state"){let e=`FIRESTORE (${va}) INTERNAL ASSERTION FAILED: `+n;throw Ne(e),new Error(e)}function j(n,e){n||V()}function y1(n,e){n||V()}function L(n,e){return n}var v={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},T=class extends WE{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var je=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var Gh=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},l0=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Xe.UNAUTHENTICATED))}shutdown(){}},c0=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},u0=class{constructor(e){this.authProvider=e,this.currentUser=Xe.UNAUTHENTICATED,this.tokenCounter=0,this.forceRefresh=!1,this.auth=null}start(e,t){let r=this.tokenCounter,i=l=>this.tokenCounter!==r?(r=this.tokenCounter,t(l)):Promise.resolve(),s=new je;this.tokenListener=()=>{this.tokenCounter++,this.currentUser=this.getUser(),s.resolve(),s=new je,e.enqueueRetryable(()=>i(this.currentUser))};let o=()=>{let l=s;e.enqueueRetryable(()=>g(this,null,function*(){yield l.promise,yield i(this.currentUser)}))},a=l=>{R("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.auth.addAuthTokenListener(this.tokenListener),o()};this.authProvider.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){let l=this.authProvider.getImmediate({optional:!0});l?a(l):(R("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new je)}},0),o()}getToken(){let e=this.tokenCounter,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.tokenCounter!==e?(R("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(j(typeof r.accessToken=="string"),new Gh(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.tokenListener)}getUser(){let e=this.auth&&this.auth.getUid();return j(e===null||typeof e=="string"),new Xe(e)}},d0=class{constructor(e,t,r){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=r,this.type="FirstParty",this.user=Xe.FIRST_PARTY,this._headers=new Map}getAuthToken(){return this.authTokenFactory?this.authTokenFactory():null}get headers(){this._headers.set("X-Goog-AuthUser",this.sessionIndex);let e=this.getAuthToken();return e&&this._headers.set("Authorization",e),this.iamToken&&this._headers.set("X-Goog-Iam-Authorization-Token",this.iamToken),this._headers}},h0=class{constructor(e,t,r){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=r}getToken(){return Promise.resolve(new d0(this.sessionIndex,this.iamToken,this.authTokenFactory))}start(e,t){e.enqueueRetryable(()=>t(Xe.FIRST_PARTY))}shutdown(){}invalidateToken(){}},f0=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},p0=class{constructor(e){this.appCheckProvider=e,this.forceRefresh=!1,this.appCheck=null,this.latestAppCheckToken=null}start(e,t){let r=s=>{s.error!=null&&R("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.latestAppCheckToken;return this.latestAppCheckToken=s.token,R("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.tokenListener=s=>{e.enqueueRetryable(()=>r(s))};let i=s=>{R("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.tokenListener)};this.appCheckProvider.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.appCheckProvider.getImmediate({optional:!0});s?i(s):R("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(j(typeof t.token=="string"),this.latestAppCheckToken=t.token,new f0(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.tokenListener)}};function eU(n){if(!n)return new l0;switch(n.type){case"firstParty":return new h0(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new T(v.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}function tU(n){return Yq(n)}var Hh=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,r="",i=20;for(;r.length<i;){let s=tU(40);for(let o=0;o<s.length;++o)r.length<i&&s[o]<t&&(r+=e.charAt(s[o]%e.length))}return r}};function J(n,e){return n<e?-1:n>e?1:0}function ms(n,e,t){return n.length!==e.length?!1:n.every((r,i)=>t(r,e[i]))}function v1(n){return n+"\0"}var oD=-62135596800,aD=1e6,xe=class n{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new T(v.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new T(v.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<oD)throw new T(v.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new T(v.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-t*1e3)*aD);return new n(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return this.seconds*1e3+this.nanoseconds/aD}_compareTo(e){return this.seconds===e.seconds?J(this.nanoseconds,e.nanoseconds):J(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds-oD,t=String(e).padStart(12,"0"),r=String(this.nanoseconds).padStart(9,"0");return t+"."+r}};var K=class n{constructor(e){this.timestamp=e}static fromTimestamp(e){return new n(e)}static min(){return new n(new xe(0,0))}static max(){return new n(new xe(253402300799,1e9-1))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return this.timestamp.seconds*1e6+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var lD="__name__",Kh=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&V(),r===void 0?r=e.length-t:r>e.length-t&&V(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let s=e.get(i),o=t.get(i);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}},de=class n extends Kh{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new T(v.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new n(t)}static emptyPath(){return new n([])}},nU=/^[_a-zA-Z][_a-zA-Z0-9]*$/,He=class n extends Kh{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return nU.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===lD}static keyField(){return new n([lD])}static fromServerFormat(e){let t=[],r="",i=0,s=()=>{if(r.length===0)throw new T(v.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},o=!1;for(;i<e.length;){let a=e[i];if(a==="\\"){if(i+1===e.length)throw new T(v.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let l=e[i+1];if(!(l==="\\"||l==="."||l==="`"))throw new T(v.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,i+=2}else a==="`"?(o=!o,i++):a==="."&&!o?(s(),i++):(r+=a,i++)}if(s(),o)throw new T(v.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var P=class n{constructor(e){this.path=e}static fromPath(e){return new n(de.fromString(e))}static fromName(e){return new n(de.fromString(e).popFirst(5))}static empty(){return new n(de.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&de.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return de.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2===0}static fromSegments(e){return new n(new de(e.slice()))}};var ta=-1,rU=0,g0=(()=>{class n{constructor(t,r,i,s){this.indexId=t,this.collectionGroup=r,this.fields=i,this.indexState=s}}return n.UNKNOWN_ID=-1,n})();function a_(n){return n.fields.find(e=>e.kind===2)}function ys(n){return n.fields.filter(e=>e.kind!==2)}function iU(n){let e=ys(n);return e.length===0?0:e[e.length-1].kind}function sU(n){return`id=${n.indexId}|cg=${n.collectionGroup}|f=${n.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")}`}var Jo=class{constructor(e,t){this.fieldPath=e,this.kind=t}};var rc=class n{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new n(rU,gn.min())}};function S1(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=K.fromTimestamp(r===1e9?new xe(t+1,0):new xe(t,r));return new gn(i,P.empty(),e)}function _1(n){return new gn(n.readTime,n.key,ta)}var gn=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n(K.min(),P.empty(),ta)}static max(){return new n(K.max(),P.empty(),ta)}};function l_(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0||(t=P.comparator(n.documentKey,e.documentKey),t!==0)?t:J(n.largestBatchId,e.largestBatchId)}var E1="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Wh=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function Mi(n){return g(this,null,function*(){if(n.code===v.FAILED_PRECONDITION&&n.message===E1)R("LocalStore","Unexpectedly lost primary lease");else throw n})}var m=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&V(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let i=0,s=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&t()},l=>r(l))}),o=!0,s===i&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(i=>i?n.resolve(i):r());return t}static forEach(e,t){let r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new n((r,i)=>{let s=e.length,o=new Array(s),a=0;for(let l=0;l<s;l++){let c=l;t(e[c]).next(u=>{o[c]=u,++a,a===s&&r(o)},u=>i(u))}})}static doWhile(e,t){return new n((r,i)=>{let s=()=>{e()===!0?t().next(()=>{s()},i):r()};s()})}};var Yt="SimpleDb",oU=3,$h=class n{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.completionDeferred=new je,this.transaction.oncomplete=()=>{this.completionDeferred.resolve()},this.transaction.onabort=()=>{t.error?this.completionDeferred.reject(new ps(e,t.error)):this.completionDeferred.resolve()},this.transaction.onerror=r=>{let i=c_(r.target.error);this.completionDeferred.reject(new ps(e,i))}}static open(e,t,r,i){try{return new n(t,e.transaction(i,r))}catch(s){throw new ps(t,s)}}get completionPromise(){return this.completionDeferred.promise}abort(e){e&&this.completionDeferred.reject(e),this.aborted||(R(Yt,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}maybeCommit(){let e=this.transaction;!this.aborted&&typeof e.commit=="function"&&e.commit()}store(e){let t=this.transaction.objectStore(e);return new y0(t)}},wi=class n{constructor(e,t,r){this.name=e,this.version=t,this.schemaConverter=r,n.getIOSVersion(nu())===12.2&&Ne("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return R(Yt,"Removing database:",e),as(window.indexedDB.deleteDatabase(e)).toPromise()}static isAvailable(){if(!ru())return!1;if(n.isMockPersistence())return!0;let e=nu(),t=n.getIOSVersion(e),r=0<t&&t<10,i=n.getAndroidVersion(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static isMockPersistence(){var e;return typeof process<"u"&&((e=process.env)===null||e===void 0?void 0:e.USE_MOCK_PERSISTENCE)==="YES"}static getStore(e,t){return e.store(t)}static getIOSVersion(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}static getAndroidVersion(e){let t=e.match(/Android ([\d.]+)/i),r=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(r)}ensureDb(e){return g(this,null,function*(){return this.db||(R(Yt,"Opening database:",this.name),this.db=yield new Promise((t,r)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let o=s.target.result;t(o)},i.onblocked=()=>{r(new ps(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let o=s.target.error;o.name==="VersionError"?r(new T(v.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new T(v.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new ps(e,o))},i.onupgradeneeded=s=>{R(Yt,'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let o=s.target.result;this.schemaConverter.createOrUpgrade(o,i.transaction,s.oldVersion,this.version).next(()=>{R(Yt,"Database upgrade to version "+this.version+" complete")})}})),this.versionchangelistener&&(this.db.onversionchange=t=>this.versionchangelistener(t)),this.db})}setVersionChangeListener(e){this.versionchangelistener=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,r,i){return g(this,null,function*(){let s=t==="readonly",o=0;for(;;){++o;try{this.db=yield this.ensureDb(e);let a=$h.open(this.db,e,s?"readonly":"readwrite",r),l=i(a).next(c=>(a.maybeCommit(),c)).catch(c=>(a.abort(c),m.reject(c))).toPromise();return l.catch(()=>{}),yield a.completionPromise,l}catch(a){let l=a,c=l.name!=="FirebaseError"&&o<oU;if(R(Yt,"Transaction failed with error:",l.message,"Retrying:",c),this.close(),!c)return Promise.reject(l)}}})}close(){this.db&&this.db.close(),this.db=void 0}},m0=class{constructor(e){this.dbCursor=e,this.shouldStop=!1,this.nextKey=null}get isDone(){return this.shouldStop}get skipToKey(){return this.nextKey}set cursor(e){this.dbCursor=e}done(){this.shouldStop=!0}skip(e){this.nextKey=e}delete(){return as(this.dbCursor.delete())}},ps=class extends T{constructor(e,t){super(v.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}};function Oi(n){return n.name==="IndexedDbTransactionError"}var y0=class{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(R(Yt,"PUT",this.store.name,e,t),r=this.store.put(t,e)):(R(Yt,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),as(r)}add(e){R(Yt,"ADD",this.store.name,e,e);let t=this.store.add(e);return as(t)}get(e){let t=this.store.get(e);return as(t).next(r=>(r===void 0&&(r=null),R(Yt,"GET",this.store.name,e,r),r))}delete(e){R(Yt,"DELETE",this.store.name,e);let t=this.store.delete(e);return as(t)}count(){R(Yt,"COUNT",this.store.name);let e=this.store.count();return as(e)}loadAll(e,t){let r=this.options(e,t);if(!r.index&&typeof this.store.getAll=="function"){let i=this.store.getAll(r.range);return new m((s,o)=>{i.onerror=a=>{o(a.target.error)},i.onsuccess=a=>{s(a.target.result)}})}else{let i=this.cursor(r),s=[];return this.iterateCursor(i,(o,a)=>{s.push(a)}).next(()=>s)}}loadFirst(e,t){let r=this.store.getAll(e,t===null?void 0:t);return new m((i,s)=>{r.onerror=o=>{s(o.target.error)},r.onsuccess=o=>{i(o.target.result)}})}deleteAll(e,t){R(Yt,"DELETE ALL",this.store.name);let r=this.options(e,t);r.keysOnly=!1;let i=this.cursor(r);return this.iterateCursor(i,(s,o,a)=>a.delete())}iterate(e,t){let r;t?r=e:(r={},t=e);let i=this.cursor(r);return this.iterateCursor(i,t)}iterateSerial(e){let t=this.cursor({});return new m((r,i)=>{t.onerror=s=>{let o=c_(s.target.error);i(o)},t.onsuccess=s=>{let o=s.target.result;if(!o){r();return}e(o.primaryKey,o.value).next(a=>{a?o.continue():r()})}})}iterateCursor(e,t){let r=[];return new m((i,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{let a=o.target.result;if(!a){i();return}let l=new m0(a),c=t(a.primaryKey,a.value,l);if(c instanceof m){let u=c.catch(d=>(l.done(),m.reject(d)));r.push(u)}l.isDone?i():l.skipToKey===null?a.continue():a.continue(l.skipToKey)}}).next(()=>m.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let r=this.store.index(e.index);return e.keysOnly?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}else return this.store.openCursor(e.range,t)}};function as(n){return new m((e,t)=>{n.onsuccess=r=>{let i=r.target.result;e(i)},n.onerror=r=>{let i=c_(r.target.error);t(i)}})}var cD=!1;function c_(n){let e=wi.getIOSVersion(nu());if(e>=12.2&&e<13){let t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){let r=new T("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return cD||(cD=!0,setTimeout(()=>{throw r},0)),r}}return n}var Xl="IndexBackiller",aU=15*1e3,lU=60*1e3,cU=50,v0=class{constructor(e,t){this.asyncQueue=e,this.backfiller=t,this.task=null}start(){this.schedule(aU)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}schedule(e){R(Xl,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,()=>g(this,null,function*(){this.task=null;try{let t=yield this.backfiller.backfill();R(Xl,`Documents written: ${t}`)}catch(t){Oi(t)?R(Xl,"Ignoring IndexedDB error during index backfill: ",t):yield Mi(t)}yield this.schedule(lU)}))}},S0=class{constructor(e,t){this.localStore=e,this.persistence=t}backfill(){return g(this,arguments,function*(e=cU){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.writeIndexEntries(t,e))})}writeIndexEntries(e,t){let r=new Set,i=t,s=!0;return m.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o===null||r.has(o))s=!1;else return R(Xl,`Processing collection: ${o}`),this.writeEntriesForCollectionGroup(e,o,i).next(a=>{i-=a,r.add(o)})})).next(()=>t-i)}writeEntriesForCollectionGroup(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,r).next(s=>{let o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.getNewOffset(i,s)).next(a=>(R(Xl,`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}getNewOffset(e,t){let r=e;return t.changes.forEach((i,s)=>{let o=_1(s);l_(o,r)>0&&(r=o)}),new gn(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}};var Xt=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.setPreviousValue(i),this.writeNewSequenceNumber=i=>r.writeSequenceNumber(i))}setPreviousValue(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(t),t}}n.INVALID=-1;return n})(),Zo="",_0="",w1="",T1="";function Ot(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=uD(e)),e=uU(n.get(t),e);return uD(e)}function uU(n,e){let t=e,r=n.length;for(let i=0;i<r;i++){let s=n.charAt(i);switch(s){case"\0":t+=Zo+w1;break;case Zo:t+=Zo+T1;break;default:t+=s}}return t}function uD(n){return n+Zo+_0}function sr(n){let e=n.length;if(j(e>=2),e===2)return j(n.charAt(0)===Zo&&n.charAt(1)===_0),de.emptyPath();let t=e-2,r=[],i="";for(let s=0;s<e;){let o=n.indexOf(Zo,s);switch((o<0||o>t)&&V(),n.charAt(o+1)){case _0:let l=n.substring(s,o),c;i.length===0?c=l:(i+=l,c=i,i=""),r.push(c);break;case w1:i+=n.substring(s,o),i+="\0";break;case T1:i+=n.substring(s,o+1);break;default:V()}s=o+2}return new de(r)}var ls="remoteDocuments";var Rc="owner",Vo="owner",kc="mutationQueues",dU="userId",Rn="mutations",C1="batchId",hs="userMutationsIndex",b1=["userId","batchId"];function hU(n){return[n]}function Bh(n,e){return[n,Ot(e)]}function A1(n,e,t){return[n,Ot(e),t]}var fU={},Sa="documentMutations",Lf="remoteDocumentsV14",pU=["prefixPath","collectionGroup","readTime","documentId"],Vh="documentKeyIndex",gU=["prefixPath","collectionGroup","documentId"],I1="collectionGroupIndex",mU=["collectionGroup","readTime","prefixPath","documentId"],Nc="remoteDocumentGlobal",E0="remoteDocumentGlobalKey",_a="targets",yU="targetId",D1="queryTargetsIndex",vU=["canonicalId","targetId"],Ea="targetDocuments",SU=["targetId","path"],u_="documentTargetsIndex",_U=["path","targetId"],Qh="targetGlobalKey",ks="targetGlobal",ic="collectionParents",EU=["collectionId","parent"],na="clientMetadata",wU="clientId",Bf="bundles",TU="bundleId",Vf="namedQueries",CU="name",d_="indexConfiguration",bU="indexId",w0="collectionGroupIndex",AU="collectionGroup",h_="indexState",IU=["indexId","uid"],R1="sequenceNumberIndex",DU=["uid","sequenceNumber"],f_="indexEntries",RU=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],k1="documentKeyIndex",kU=["indexId","uid","orderedDocumentKey"],qf="documentOverlays",NU=["userId","collectionPath","documentId"],T0="collectionPathOverlayIndex",xU=["userId","collectionPath","largestBatchId"],N1="collectionGroupOverlayIndex",MU=["userId","collectionGroup","largestBatchId"],OU=[kc,Rn,Sa,ls,_a,Rc,ks,Ea],PU=OU,FU=[...PU,na],LU=[...FU,Nc],BU=[...LU,ic],x1=[...BU,Bf,Vf],VU=[...x1,qf],M1=[kc,Rn,Sa,Lf,_a,Rc,ks,Ea,na,Nc,ic,Bf,Vf,qf],O1=M1,qU=[...O1,d_,h_,f_];function UU(n){if(n===15)return qU;if(n===14)return O1;if(n===13)return M1;if(n===12)return VU;if(n===11)return x1;V()}var sc=class extends Wh{constructor(e,t){super(),this.simpleDbTransaction=e,this.currentSequenceNumber=t}};function at(n,e){let t=L(n);return wi.getStore(t.simpleDbTransaction,e)}function dD(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Ns(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function P1(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var be=class n{constructor(e,t){this.comparator=e,this.root=t||Jl.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Jl.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Jl.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Yo(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Yo(this.root,e,this.comparator,!1)}getReverseIterator(){return new Yo(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Yo(this.root,e,this.comparator,!0)}},Yo=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)this.isReverse?e=e.left:e=e.right;else if(s===0){this.nodeStack.push(e);break}else this.nodeStack.push(e),this.isReverse?e=e.right:e=e.left}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},Jl=(()=>{class n{constructor(t,r,i,s,o){this.key=t,this.value=r,this.color=i??n.RED,this.left=s??n.EMPTY,this.right=o??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,r,i,s,o){return new n(t??this.key,r??this.value,i??this.color,s??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,r,i){let s=this,o=i(t,s.key);return o<0?s=s.copy(null,null,null,s.left.insert(t,r,i),null):o===0?s=s.copy(null,r,null,null,null):s=s.copy(null,null,null,null,s.right.insert(t,r,i)),s.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let t=this;return!t.left.isRed()&&!t.left.left.isRed()&&(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,r){let i,s=this;if(r(t,s.key)<0)!s.left.isEmpty()&&!s.left.isRed()&&!s.left.left.isRed()&&(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,r),null);else{if(s.left.isRed()&&(s=s.rotateRight()),!s.right.isEmpty()&&!s.right.isRed()&&!s.right.left.isRed()&&(s=s.moveRedRight()),r(t,s.key)===0){if(s.right.isEmpty())return n.EMPTY;i=s.right.min(),s=s.copy(i.key,i.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,r))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){let t=this.left.copy(null,null,!this.left.color,null,null),r=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,r)}checkMaxDepth(){let t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw V();let t=this.left.check();if(t!==this.right.check())throw V();return t+(this.isRed()?0:1)}}return n.EMPTY=null,n.RED=!0,n.BLACK=!1,n})(),C0=class{constructor(){this.size=0}get key(){throw V()}get value(){throw V()}get color(){throw V()}get left(){throw V()}get right(){throw V()}copy(e,t,r,i,s){return this}insert(e,t,r){return new Jl(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};Jl.EMPTY=new C0;var ve=class n{constructor(e){this.comparator=e,this.data=new be(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(t!==void 0?r=this.data.getIteratorFrom(t):r=this.data.getIterator();r.hasNext();){let i=r.getNext();if(!e(i.key))return}}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Yh(this.data.getIterator())}getIteratorFrom(e){return new Yh(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},Yh=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function zU(n,e,t,r,i){let s=n.getIterator(),o=e.getIterator(),a=qo(s),l=qo(o);for(;a||l;){let c=!1,u=!1;if(a&&l){let d=t(a,l);d<0?u=!0:d>0&&(c=!0)}else a!=null?u=!0:c=!0;c?(r(l),l=qo(o)):u?(i(a),a=qo(s)):(a=qo(s),l=qo(o))}}function qo(n){return n.hasNext()?n.getNext():void 0}var Jt=class n{constructor(e){this.fields=e,e.sort(He.comparator)}static empty(){return new n([])}unionWith(e){let t=new ve(He.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return ms(this.fields,e.fields,(t,r)=>t.isEqual(r))}};function jU(n){return Buffer.from(n,"base64").toString("binary")}function GU(n){return Buffer.from(n,"binary").toString("base64")}function F1(){return!0}var ot=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=jU(e);return new n(t)}static fromUint8Array(e){let t=HU(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return GU(this.binaryString)}toUint8Array(){return KU(this.binaryString)}approximateByteSize(){return this.binaryString.length*2}compareTo(e){return J(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};ot.EMPTY_BYTE_STRING=new ot("");function HU(n){let e="";for(let t=0;t<n.length;++t)e+=String.fromCharCode(n[t]);return e}function KU(n){let e=new Uint8Array(n.length);for(let t=0;t<n.length;t++)e[t]=n.charCodeAt(t);return e}var WU=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ti(n){if(j(!!n),typeof n=="string"){let e=0,t=WU.exec(n);if(j(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}else{let e=Be(n.seconds),t=Be(n.nanos);return{seconds:e,nanos:t}}}function Be(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Ci(n){return typeof n=="string"?ot.fromBase64String(n):ot.fromUint8Array(n)}var L1="server_timestamp",B1="__type__",V1="__previous_value__",q1="__local_write_time__";function Uf(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[B1])===null||t===void 0?void 0:t.stringValue)===L1}function $U(n,e){let t={fields:{[B1]:{stringValue:L1},[q1]:{timestampValue:{seconds:n.seconds,nanos:n.nanoseconds}}}};return e&&Uf(e)&&(e=p_(e)),e&&(t.fields[V1]=e),{mapValue:t}}function p_(n){let e=n.mapValue.fields[V1];return Uf(e)?p_(e):e}function oc(n){let e=Ti(n.mapValue.fields[q1].timestampValue);return new xe(e.seconds,e.nanos)}var b0=class{constructor(e,t,r,i,s,o,a,l,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=c}},hD="(default)",bi=class n{constructor(e,t){this.projectId=e,this.database=t||hD}static empty(){return new n("","")}get isDefaultDatabase(){return this.database===hD}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};function QU(n,e){if(!Object.prototype.hasOwnProperty.apply(n.options,["projectId"]))throw new T(v.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new bi(n.options.projectId,e)}var _i=-1;function xc(n){return n==null}function ac(n){return n===0&&1/n===1/-0}function U1(n){return typeof n=="number"&&Number.isInteger(n)&&!ac(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}var z1="__max__",vi={mapValue:{fields:{__type__:{stringValue:z1}}}},qh={nullValue:"NULL_VALUE"};function vs(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Uf(n)?4:j1(n)?9007199254740991:10:V()}function kn(n,e){if(n===e)return!0;let t=vs(n),r=vs(e);if(t!==r)return!1;switch(t){case 0:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return oc(n).isEqual(oc(e));case 3:return YU(n,e);case 5:return n.stringValue===e.stringValue;case 6:return JU(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return XU(n,e);case 2:return ZU(n,e);case 9:return ms(n.arrayValue.values||[],e.arrayValue.values||[],kn);case 10:return e3(n,e);case 9007199254740991:return!0;default:return V()}}function YU(n,e){if(typeof n.timestampValue=="string"&&typeof e.timestampValue=="string"&&n.timestampValue.length===e.timestampValue.length)return n.timestampValue===e.timestampValue;let t=Ti(n.timestampValue),r=Ti(e.timestampValue);return t.seconds===r.seconds&&t.nanos===r.nanos}function XU(n,e){return Be(n.geoPointValue.latitude)===Be(e.geoPointValue.latitude)&&Be(n.geoPointValue.longitude)===Be(e.geoPointValue.longitude)}function JU(n,e){return Ci(n.bytesValue).isEqual(Ci(e.bytesValue))}function ZU(n,e){if("integerValue"in n&&"integerValue"in e)return Be(n.integerValue)===Be(e.integerValue);if("doubleValue"in n&&"doubleValue"in e){let t=Be(n.doubleValue),r=Be(e.doubleValue);return t===r?ac(t)===ac(r):isNaN(t)&&isNaN(r)}return!1}function e3(n,e){let t=n.mapValue.fields||{},r=e.mapValue.fields||{};if(dD(t)!==dD(r))return!1;for(let i in t)if(t.hasOwnProperty(i)&&(r[i]===void 0||!kn(t[i],r[i])))return!1;return!0}function lc(n,e){return(n.values||[]).find(t=>kn(t,e))!==void 0}function Ai(n,e){if(n===e)return 0;let t=vs(n),r=vs(e);if(t!==r)return J(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return J(n.booleanValue,e.booleanValue);case 2:return t3(n,e);case 3:return fD(n.timestampValue,e.timestampValue);case 4:return fD(oc(n),oc(e));case 5:return J(n.stringValue,e.stringValue);case 6:return i3(n.bytesValue,e.bytesValue);case 7:return n3(n.referenceValue,e.referenceValue);case 8:return r3(n.geoPointValue,e.geoPointValue);case 9:return s3(n.arrayValue,e.arrayValue);case 10:return o3(n.mapValue,e.mapValue);default:throw V()}}function t3(n,e){let t=Be(n.integerValue||n.doubleValue),r=Be(e.integerValue||e.doubleValue);return t<r?-1:t>r?1:t===r?0:isNaN(t)?isNaN(r)?0:-1:1}function fD(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return J(n,e);let t=Ti(n),r=Ti(e),i=J(t.seconds,r.seconds);return i!==0?i:J(t.nanos,r.nanos)}function n3(n,e){let t=n.split("/"),r=e.split("/");for(let i=0;i<t.length&&i<r.length;i++){let s=J(t[i],r[i]);if(s!==0)return s}return J(t.length,r.length)}function r3(n,e){let t=J(Be(n.latitude),Be(e.latitude));return t!==0?t:J(Be(n.longitude),Be(e.longitude))}function i3(n,e){let t=Ci(n),r=Ci(e);return t.compareTo(r)}function s3(n,e){let t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){let s=Ai(t[i],r[i]);if(s)return s}return J(t.length,r.length)}function o3(n,e){if(n===vi.mapValue&&e===vi.mapValue)return 0;if(n===vi.mapValue)return 1;if(e===vi.mapValue)return-1;let t=n.fields||{},r=Object.keys(t),i=e.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let o=0;o<r.length&&o<s.length;++o){let a=J(r[o],s[o]);if(a!==0)return a;let l=Ai(t[r[o]],i[s[o]]);if(l!==0)return l}return J(r.length,s.length)}function ra(n){return g_(n)}function g_(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?l3(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?a3(n.bytesValue):"referenceValue"in n?u3(n.referenceValue):"geoPointValue"in n?c3(n.geoPointValue):"arrayValue"in n?h3(n.arrayValue):"mapValue"in n?d3(n.mapValue):V()}function a3(n){return Ci(n).toBase64()}function l3(n){let e=Ti(n);return`time(${e.seconds},${e.nanos})`}function c3(n){return`geo(${n.latitude},${n.longitude})`}function u3(n){return P.fromName(n).toString()}function d3(n){let e=Object.keys(n.fields||{}).sort(),t="{",r=!0;for(let i of e)r?r=!1:t+=",",t+=`${i}:${g_(n.fields[i])}`;return t+"}"}function h3(n){let e="[",t=!0;for(let r of n.values||[])t?t=!1:e+=",",e+=g_(r);return e+"]"}function Ss(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function A0(n){return!!n&&"integerValue"in n}function f3(n){return!!n&&"doubleValue"in n}function p3(n){return A0(n)||f3(n)}function cc(n){return!!n&&"arrayValue"in n}function pD(n){return!!n&&"nullValue"in n}function gD(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Uh(n){return!!n&&"mapValue"in n}function Zl(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return Ns(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Zl(r)),e}else if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Zl(n.arrayValue.values[t]);return e}else return Object.assign({},n)}function j1(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===z1}function g3(n){return"nullValue"in n?qh:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Ss(bi.empty(),P.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?{mapValue:{}}:V()}function m3(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Ss(bi.empty(),P.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?{mapValue:{}}:"mapValue"in n?vi:V()}function mD(n,e){let t=Ai(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function yD(n,e){let t=Ai(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}var Tt=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Uh(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){let r=this.getFieldsMap(e.popLast());r[e.lastSegment()]=Zl(t)}setAll(e){let t=He.emptyPath(),r={},i=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){let l=this.getFieldsMap(t);this.applyChanges(l,r,i),r={},i=[],t=a.popLast()}o?r[a.lastSegment()]=Zl(o):i.push(a.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){let t=this.field(e.popLast());Uh(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return kn(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];(!Uh(i)||!i.mapValue.fields)&&(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){Ns(t,(i,s)=>e[i]=s);for(let i of r)delete e[i]}clone(){return new n(Zl(this.value))}};function G1(n){let e=[];return Ns(n.fields,(t,r)=>{let i=new He([t]);if(Uh(r)){let o=G1(r.mapValue).fields;if(o.length===0)e.push(i);else for(let a of o)e.push(i.child(a))}else e.push(i)}),new Jt(e)}var Ye=class n{constructor(e,t,r,i,s,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new n(e,0,K.min(),K.min(),K.min(),Tt.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,K.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,K.min(),K.min(),Tt.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,K.min(),K.min(),Tt.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(K.min())&&(this.documentType===2||this.documentType===0)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Tt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Tt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=K.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};function y3(n,e,t){let r=e.data.field(n),i=t.data.field(n);return r!==null&&i!==null?Ai(r,i):V()}var cr=class{constructor(e,t){this.position=e,this.inclusive=t}};function H1(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let s=e[i],o=n.position[i];if(s.field.isKeyField())r=P.comparator(P.fromName(o.referenceValue),t.key);else{let a=t.data.field(s.field);r=Ai(o,a)}if(s.dir==="desc"&&(r=r*-1),r!==0)break}return r}function v3(n,e,t){let r=H1(n,e,t);return n.inclusive?r>=0:r>0}function S3(n,e,t){let r=H1(n,e,t);return n.inclusive?r<=0:r<0}function vD(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++){let r=n.position[t],i=e.position[t];if(!kn(r,i))return!1}return!0}var _s=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function _3(n){return n.field.canonicalString()+n.dir}function E3(n){return`${n.field.canonicalString()} (${n.dir})`}function w3(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var Xh=class{},re=class n extends Xh{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new R0(e,t,r):t==="array-contains"?new x0(e,r):t==="in"?new Jh(e,r):t==="not-in"?new M0(e,r):t==="array-contains-any"?new O0(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new k0(e,r):new N0(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(Ai(t,this.value)):t!==null&&vs(this.value)===vs(t)&&this.matchesComparison(Ai(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return V()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},pe=class n extends Xh{constructor(e,t){super(),this.filters=e,this.op=t,this.memoizedFlattenedFilters=null}static create(e,t){return new n(e,t)}matches(e){return ia(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.memoizedFlattenedFilters!==null?this.memoizedFlattenedFilters:(this.memoizedFlattenedFilters=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[]),this.memoizedFlattenedFilters)}getFilters(){return Object.assign([],this.filters)}};function ia(n){return n.op==="and"}function I0(n){return n.op==="or"}function m_(n){return K1(n)&&ia(n)}function K1(n){for(let e of n.filters)if(e instanceof pe)return!1;return!0}function D0(n){if(n instanceof re)return n.field.canonicalString()+n.op.toString()+ra(n.value);if(m_(n))return n.filters.map(e=>D0(e)).join(",");{let e=n.filters.map(t=>D0(t)).join(",");return`${n.op}(${e})`}}function W1(n,e){if(n instanceof re)return T3(n,e);if(n instanceof pe)return C3(n,e);V()}function T3(n,e){return e instanceof re&&n.op===e.op&&n.field.isEqual(e.field)&&kn(n.value,e.value)}function C3(n,e){return e instanceof pe&&n.op===e.op&&n.filters.length===e.filters.length?n.filters.reduce((r,i,s)=>r&&W1(i,e.filters[s]),!0):!1}function $1(n,e){let t=n.filters.concat(e);return pe.create(t,n.op)}function Q1(n){return n instanceof re?A3(n):n instanceof pe?b3(n):"Filter"}function b3(n){return n.op.toString()+" {"+n.getFilters().map(Q1).join(" ,")+"}"}function A3(n){return`${n.field.canonicalString()} ${n.op} ${ra(n.value)}`}var R0=class extends re{constructor(e,t,r){super(e,t,r),this.key=P.fromName(r.referenceValue)}matches(e){let t=P.comparator(e.key,this.key);return this.matchesComparison(t)}},k0=class extends re{constructor(e,t){super(e,"in",t),this.keys=Y1("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},N0=class extends re{constructor(e,t){super(e,"not-in",t),this.keys=Y1("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function Y1(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>P.fromName(r.referenceValue))}var x0=class extends re{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return cc(t)&&lc(t.arrayValue,this.value)}},Jh=class extends re{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&lc(this.value.arrayValue,t)}},M0=class extends re{constructor(e,t){super(e,"not-in",t)}matches(e){if(lc(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&!lc(this.value.arrayValue,t)}},O0=class extends re{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!cc(t)||!t.arrayValue.values?!1:t.arrayValue.values.some(r=>lc(this.value.arrayValue,r))}};var P0=class{constructor(e,t=null,r=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.memoizedCanonicalId=null}};function F0(n,e=null,t=[],r=[],i=null,s=null,o=null){return new P0(n,e,t,r,i,s,o)}function Es(n){let e=L(n);if(e.memoizedCanonicalId===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>D0(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>_3(r)).join(","),xc(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>ra(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>ra(r)).join(",")),e.memoizedCanonicalId=t}return e.memoizedCanonicalId}function I3(n){let e=n.path.canonicalString();return n.collectionGroup!==null&&(e+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(e+=`, filters: [${n.filters.map(t=>Q1(t)).join(", ")}]`),xc(n.limit)||(e+=", limit: "+n.limit),n.orderBy.length>0&&(e+=`, orderBy: [${n.orderBy.map(t=>E3(t)).join(", ")}]`),n.startAt&&(e+=", startAt: ",e+=n.startAt.inclusive?"b:":"a:",e+=n.startAt.position.map(t=>ra(t)).join(",")),n.endAt&&(e+=", endAt: ",e+=n.endAt.inclusive?"a:":"b:",e+=n.endAt.position.map(t=>ra(t)).join(",")),`Target(${e})`}function Mc(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!w3(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!W1(n.filters[t],e.filters[t]))return!1;return n.collectionGroup!==e.collectionGroup||!n.path.isEqual(e.path)||!vD(n.startAt,e.startAt)?!1:vD(n.endAt,e.endAt)}function Zh(n){return P.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function zf(n,e){return n.filters.filter(t=>t instanceof re&&t.field.isEqual(e))}function D3(n,e){let t=a_(e);if(t===void 0)return null;for(let r of zf(n,t.fieldPath))switch(r.op){case"array-contains-any":return r.value.arrayValue.values||[];case"array-contains":return[r.value]}return null}function R3(n,e){let t=new Map;for(let r of ys(e))for(let i of zf(n,r.fieldPath))switch(i.op){case"==":case"in":t.set(r.fieldPath.canonicalString(),i.value);break;case"not-in":case"!=":return t.set(r.fieldPath.canonicalString(),i.value),Array.from(t.values())}return null}function k3(n,e){let t=[],r=!0;for(let i of ys(e)){let s=i.kind===0?X1(n,i.fieldPath,n.startAt):J1(n,i.fieldPath,n.startAt);t.push(s.value),r&&(r=s.inclusive)}return new cr(t,r)}function N3(n,e){let t=[],r=!0;for(let i of ys(e)){let s=i.kind===0?J1(n,i.fieldPath,n.endAt):X1(n,i.fieldPath,n.endAt);t.push(s.value),r&&(r=s.inclusive)}return new cr(t,r)}function X1(n,e,t){let r=qh,i=!0;for(let s of zf(n,e)){let o=qh,a=!0;switch(s.op){case"<":case"<=":o=g3(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,a=!1;break;case"!=":case"not-in":o=qh;break}mD({value:r,inclusive:i},{value:o,inclusive:a})<0&&(r=o,i=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let a=t.position[s];mD({value:r,inclusive:i},{value:a,inclusive:t.inclusive})<0&&(r=a,i=t.inclusive);break}}return{value:r,inclusive:i}}function J1(n,e,t){let r=vi,i=!0;for(let s of zf(n,e)){let o=vi,a=!0;switch(s.op){case">=":case">":o=m3(s.value),a=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,a=!1;break;case"!=":case"not-in":o=vi;break}yD({value:r,inclusive:i},{value:o,inclusive:a})>0&&(r=o,i=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let a=t.position[s];yD({value:r,inclusive:i},{value:a,inclusive:t.inclusive})>0&&(r=a,i=t.inclusive);break}}return{value:r,inclusive:i}}function x3(n){let e=new ve(He.comparator),t=!1;for(let r of n.filters)for(let i of r.getFlattenedFilters())i.field.isKeyField()||(i.op==="array-contains"||i.op==="array-contains-any"?t=!0:e=e.add(i.field));for(let r of n.orderBy)r.field.isKeyField()||(e=e.add(r.field));return e.size+(t?1:0)}function M3(n){return n.limit!==null}var Nn=class{constructor(e,t=null,r=[],i=[],s=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=l,this.memoizedNormalizedOrderBy=null,this.memoizedTarget=null,this.memoizedAggregateTarget=null,this.startAt,this.endAt}};function Z1(n,e,t,r,i,s,o,a){return new Nn(n,e,t,r,i,s,o,a)}function wa(n){return new Nn(n)}function O3(n,e){return new Nn(e,null,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,n.startAt,n.endAt)}function SD(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function P3(n){let e=new ve(He.comparator);return n.filters.forEach(t=>{t.getFlattenedFilters().forEach(i=>{i.isInequality()&&(e=e.add(i.field))})}),e}function F3(n){return new Nn(de.emptyPath(),n)}function L3(n){return P.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function y_(n){return n.collectionGroup!==null}function sa(n){let e=L(n);if(e.memoizedNormalizedOrderBy===null){e.memoizedNormalizedOrderBy=[];let t=new Set;for(let s of e.explicitOrderBy)e.memoizedNormalizedOrderBy.push(s),t.add(s.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";P3(e).forEach(s=>{!t.has(s.canonicalString())&&!s.isKeyField()&&e.memoizedNormalizedOrderBy.push(new _s(s,r))}),t.has(He.keyField().canonicalString())||e.memoizedNormalizedOrderBy.push(new _s(He.keyField(),r))}return e.memoizedNormalizedOrderBy}function Pt(n){let e=L(n);return e.memoizedTarget||(e.memoizedTarget=B3(e,sa(n))),e.memoizedTarget}function B3(n,e){if(n.limitType==="F")return F0(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new _s(i.field,s)});let t=n.endAt?new cr(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new cr(n.startAt.position,n.startAt.inclusive):null;return F0(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function v_(n,e){let t=n.filters.concat([e]);return new Nn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function V3(n,e){let t=n.explicitOrderBy.concat([e]);return new Nn(n.path,n.collectionGroup,t,n.filters.slice(),n.limit,n.limitType,n.startAt,n.endAt)}function ef(n,e,t){return new Nn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function q3(n,e){return new Nn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,e,n.endAt)}function U3(n,e){return new Nn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,n.startAt,e)}function Oc(n,e){return Mc(Pt(n),Pt(e))&&n.limitType===e.limitType}function eR(n){return`${Es(Pt(n))}|lt:${n.limitType}`}function Wo(n){return`Query(target=${I3(Pt(n))}; limitType=${n.limitType})`}function Pc(n,e){return e.isFoundDocument()&&z3(n,e)&&j3(n,e)&&G3(n,e)&&H3(n,e)}function z3(n,e){let t=e.key.path;return n.collectionGroup!==null?e.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(t):P.isDocumentKey(n.path)?n.path.isEqual(t):n.path.isImmediateParentOf(t)}function j3(n,e){for(let t of sa(n))if(!t.field.isKeyField()&&e.data.field(t.field)===null)return!1;return!0}function G3(n,e){for(let t of n.filters)if(!t.matches(e))return!1;return!0}function H3(n,e){return!(n.startAt&&!S3(n.startAt,sa(n),e)||n.endAt&&!v3(n.endAt,sa(n),e))}function tR(n){return n.collectionGroup||(n.path.length%2===1?n.path.lastSegment():n.path.get(n.path.length-2))}function nR(n){return(e,t)=>{let r=!1;for(let i of sa(n)){let s=K3(i,e,t);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function K3(n,e,t){let r=n.field.isKeyField()?P.comparator(e.key,t.key):y3(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return V()}}var ur=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0){this.inner[r]=[[e,t]],this.innerSize++;return}for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e)){i[s]=[e,t];return}i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Ns(this.inner,(t,r)=>{for(let[i,s]of r)e(i,s)})}isEmpty(){return P1(this.inner)}size(){return this.innerSize}};var W3=new be(P.comparator);function Gt(){return W3}var rR=new be(P.comparator);function Ql(...n){let e=rR;for(let t of n)e=e.insert(t.key,t);return e}function $3(){return uc()}function iR(n){let e=rR;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function or(){return uc()}function sR(){return uc()}function uc(){return new ur(n=>n.toString(),(n,e)=>n.isEqual(e))}var Q3=new be(P.comparator);function Y3(){return Q3}var X3=new ve(P.comparator);function Z(...n){let e=X3;for(let t of n)e=e.add(t);return e}var J3=new ve(J);function S_(){return J3}function oR(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ac(e)?"-0":e}}function aR(n){return{integerValue:""+n}}function lR(n,e){return U1(e)?aR(e):oR(n,e)}var oa=class{constructor(){this._=void 0}};function Z3(n,e,t){return n instanceof Ii?$U(t,e):n instanceof Ar?uR(n,e):n instanceof Ir?dR(n,e):n4(n,e)}function e4(n,e,t){return n instanceof Ar?uR(n,e):n instanceof Ir?dR(n,e):t}function cR(n,e){return n instanceof Di?p3(e)?e:{integerValue:0}:null}function t4(n,e){return n instanceof Ar&&e instanceof Ar||n instanceof Ir&&e instanceof Ir?ms(n.elements,e.elements,kn):n instanceof Di&&e instanceof Di?kn(n.operand,e.operand):n instanceof Ii&&e instanceof Ii}var Ii=class extends oa{},Ar=class extends oa{constructor(e){super(),this.elements=e}};function uR(n,e){let t=hR(e);for(let r of n.elements)t.some(i=>kn(i,r))||t.push(r);return{arrayValue:{values:t}}}var Ir=class extends oa{constructor(e){super(),this.elements=e}};function dR(n,e){let t=hR(e);for(let r of n.elements)t=t.filter(i=>!kn(i,r));return{arrayValue:{values:t}}}var Di=class extends oa{constructor(e,t){super(),this.serializer=e,this.operand=t}};function n4(n,e){let t=cR(n,e),r=_D(t)+_D(n.operand);return A0(t)&&A0(n.operand)?aR(r):oR(n.serializer,r)}function _D(n){return Be(n.integerValue||n.doubleValue)}function hR(n){return cc(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}var ws=class{constructor(e,t){this.field=e,this.transform=t}};function r4(n,e){return n.field.isEqual(e.field)&&t4(n.transform,e.transform)}function i4(n,e){return n===void 0&&e===void 0?!0:n&&e?ms(n,e,(t,r)=>r4(t,r)):!1}var L0=class{constructor(e,t){this.version=e,this.transformResults=t}},Le=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function jf(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists!==void 0?n.exists===e.isFoundDocument():!0}var aa=class{};function fR(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new ki(n.key,Le.none()):new Ri(n.key,n.data,Le.none());{let t=n.data,r=Tt.empty(),i=new ve(He.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new xn(n.key,r,new Jt(i.toArray()),Le.none())}}function s4(n,e,t){n instanceof Ri?a4(n,e,t):n instanceof xn?c4(n,e,t):d4(n,e,t)}function ec(n,e,t,r){return n instanceof Ri?l4(n,e,t,r):n instanceof xn?u4(n,e,t,r):h4(n,e,t)}function o4(n,e){let t=null;for(let r of n.fieldTransforms){let i=e.data.field(r.field),s=cR(r.transform,i||null);s!=null&&(t===null&&(t=Tt.empty()),t.set(r.field,s))}return t||null}function ED(n,e){return n.type!==e.type||!n.key.isEqual(e.key)||!n.precondition.isEqual(e.precondition)||!i4(n.fieldTransforms,e.fieldTransforms)?!1:n.type===0?n.value.isEqual(e.value):n.type===1?n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask):!0}var Ri=class extends aa{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}};function a4(n,e,t){let r=n.value.clone(),i=gR(n.fieldTransforms,e,t.transformResults);r.setAll(i),e.convertToFoundDocument(t.version,r).setHasCommittedMutations()}function l4(n,e,t,r){if(!jf(n.precondition,e))return t;let i=n.value.clone(),s=mR(n.fieldTransforms,r,e);return i.setAll(s),e.convertToFoundDocument(e.version,i).setHasLocalMutations(),null}var xn=class extends aa{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function c4(n,e,t){if(!jf(n.precondition,e)){e.convertToUnknownDocument(t.version);return}let r=gR(n.fieldTransforms,e,t.transformResults),i=e.data;i.setAll(pR(n)),i.setAll(r),e.convertToFoundDocument(t.version,i).setHasCommittedMutations()}function u4(n,e,t,r){if(!jf(n.precondition,e))return t;let i=mR(n.fieldTransforms,r,e),s=e.data;return s.setAll(pR(n)),s.setAll(i),e.convertToFoundDocument(e.version,s).setHasLocalMutations(),t===null?null:t.unionWith(n.fieldMask.fields).unionWith(n.fieldTransforms.map(o=>o.field))}function pR(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function gR(n,e,t){let r=new Map;j(n.length===t.length);for(let i=0;i<t.length;i++){let s=n[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,e4(o,a,t[i]))}return r}function mR(n,e,t){let r=new Map;for(let i of n){let s=i.transform,o=t.data.field(i.field);r.set(i.field,Z3(s,o,e))}return r}var ki=class extends aa{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}};function d4(n,e,t){e.convertToNoDocument(t.version).setHasCommittedMutations()}function h4(n,e,t){return jf(n.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):t}var dc=class extends aa{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var hc=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];if(s.key.isEqual(e.key)){let o=r[i];s4(s,e,o)}}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=ec(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=ec(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=sR();return this.mutations.forEach(i=>{let s=e.get(i.key),o=s.overlayedDocument,a=this.applyToLocalView(o,s.mutatedFields);a=t.has(i.key)?null:a;let l=fR(o,a);l!==null&&r.set(i.key,l),o.isValidDocument()||o.convertToNoDocument(K.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Z())}isEqual(e){return this.batchId===e.batchId&&ms(this.mutations,e.mutations,(t,r)=>ED(t,r))&&ms(this.baseMutations,e.baseMutations,(t,r)=>ED(t,r))}},B0=class n{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){j(e.mutations.length===r.length);let i=Y3(),s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new n(e,t,r,i)}};var fc=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var V0=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var st=function(n){return n[n.OK=0]="OK",n[n.CANCELLED=1]="CANCELLED",n[n.UNKNOWN=2]="UNKNOWN",n[n.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",n[n.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",n[n.NOT_FOUND=5]="NOT_FOUND",n[n.ALREADY_EXISTS=6]="ALREADY_EXISTS",n[n.PERMISSION_DENIED=7]="PERMISSION_DENIED",n[n.UNAUTHENTICATED=16]="UNAUTHENTICATED",n[n.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",n[n.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",n[n.ABORTED=10]="ABORTED",n[n.OUT_OF_RANGE=11]="OUT_OF_RANGE",n[n.UNIMPLEMENTED=12]="UNIMPLEMENTED",n[n.INTERNAL=13]="INTERNAL",n[n.UNAVAILABLE=14]="UNAVAILABLE",n[n.DATA_LOSS=15]="DATA_LOSS",n}(st||{});function yR(n){switch(n){case v.OK:return V();case v.CANCELLED:case v.UNKNOWN:case v.DEADLINE_EXCEEDED:case v.RESOURCE_EXHAUSTED:case v.INTERNAL:case v.UNAVAILABLE:case v.UNAUTHENTICATED:return!1;case v.INVALID_ARGUMENT:case v.NOT_FOUND:case v.ALREADY_EXISTS:case v.PERMISSION_DENIED:case v.FAILED_PRECONDITION:case v.ABORTED:case v.OUT_OF_RANGE:case v.UNIMPLEMENTED:case v.DATA_LOSS:return!0;default:return V()}}function f4(n){return yR(n)&&n!==v.ABORTED}function zh(n){if(n===void 0)return Ne("GRPC error has no .code"),v.UNKNOWN;switch(n){case st.OK:return v.OK;case st.CANCELLED:return v.CANCELLED;case st.UNKNOWN:return v.UNKNOWN;case st.DEADLINE_EXCEEDED:return v.DEADLINE_EXCEEDED;case st.RESOURCE_EXHAUSTED:return v.RESOURCE_EXHAUSTED;case st.INTERNAL:return v.INTERNAL;case st.UNAVAILABLE:return v.UNAVAILABLE;case st.UNAUTHENTICATED:return v.UNAUTHENTICATED;case st.INVALID_ARGUMENT:return v.INVALID_ARGUMENT;case st.NOT_FOUND:return v.NOT_FOUND;case st.ALREADY_EXISTS:return v.ALREADY_EXISTS;case st.PERMISSION_DENIED:return v.PERMISSION_DENIED;case st.FAILED_PRECONDITION:return v.FAILED_PRECONDITION;case st.ABORTED:return v.ABORTED;case st.OUT_OF_RANGE:return v.OUT_OF_RANGE;case st.UNIMPLEMENTED:return v.UNIMPLEMENTED;case st.DATA_LOSS:return v.DATA_LOSS;default:return V()}}var q0=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var Zv=null;function vR(){return new $q}function p4(){return new Qq("utf-8")}var g4=new Qi([4294967295,4294967295],0);function wD(n){let e=vR().encode(n),t=new RT;return t.update(e),new Uint8Array(t.digest())}function TD(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0),o=new Qi([t,r],0),a=new Qi([i,s],0);return[o,a]}var U0=class n{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new fs(`Invalid padding: ${t}`);if(r<0)throw new fs(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new fs(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new fs(`Invalid padding when bitmap length is 0: ${t}`);this.bitCount=e.length*8-t,this.bitCountInInteger=Qi.fromNumber(this.bitCount)}getBitIndex(e,t,r){let i=e.add(t.multiply(Qi.fromNumber(r)));return i.compare(g4)===1&&(i=new Qi([i.getBits(0),i.getBits(1)],0)),i.modulo(this.bitCountInInteger).toNumber()}isBitSet(e){let t=this.bitmap[Math.floor(e/8)],r=e%8;return(t&1<<r)!==0}mightContain(e){if(this.bitCount===0)return!1;let t=wD(e),[r,i]=TD(t);for(let s=0;s<this.hashCount;s++){let o=this.getBitIndex(r,i,s);if(!this.isBitSet(o))return!1}return!0}static create(e,t,r){let i=e%8===0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new n(s,i,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.bitCount===0)return;let t=wD(e),[r,i]=TD(t);for(let s=0;s<this.hashCount;s++){let o=this.getBitIndex(r,i,s);this.setBit(o)}}setBit(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}},fs=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var pc=class n{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let i=new Map;return i.set(e,gc.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n(K.min(),i,new be(J),Gt(),Z())}},gc=class n{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n(r,t,Z(),Z(),Z())}};var ea=class{constructor(e,t,r,i){this.updatedTargetIds=e,this.removedTargetIds=t,this.key=r,this.newDoc=i}},tf=class{constructor(e,t){this.targetId=e,this.existenceFilter=t}},nf=class{constructor(e,t,r=ot.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}},rf=class{constructor(){this.pendingResponses=0,this.documentChanges=bD(),this._resumeToken=ot.EMPTY_BYTE_STRING,this._current=!1,this._hasPendingChanges=!0}get current(){return this._current}get resumeToken(){return this._resumeToken}get isPending(){return this.pendingResponses!==0}get hasPendingChanges(){return this._hasPendingChanges}updateResumeToken(e){e.approximateByteSize()>0&&(this._hasPendingChanges=!0,this._resumeToken=e)}toTargetChange(){let e=Z(),t=Z(),r=Z();return this.documentChanges.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:V()}}),new gc(this._resumeToken,this._current,e,t,r)}clearPendingChanges(){this._hasPendingChanges=!1,this.documentChanges=bD()}addDocumentChange(e,t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(e,t)}removeDocumentChange(e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(e)}recordPendingTargetRequest(){this.pendingResponses+=1}recordTargetResponse(){this.pendingResponses-=1,j(this.pendingResponses>=0)}markCurrent(){this._hasPendingChanges=!0,this._current=!0}},m4="WatchChangeAggregator",z0=class{constructor(e){this.metadataProvider=e,this.targetStates=new Map,this.pendingDocumentUpdates=Gt(),this.pendingDocumentTargetMapping=CD(),this.pendingTargetResets=new be(J)}handleDocumentChange(e){for(let t of e.updatedTargetIds)e.newDoc&&e.newDoc.isFoundDocument()?this.addDocumentToTarget(t,e.newDoc):this.removeDocumentFromTarget(t,e.key,e.newDoc);for(let t of e.removedTargetIds)this.removeDocumentFromTarget(t,e.key,e.newDoc)}handleTargetChange(e){this.forEachTarget(e,t=>{let r=this.ensureTargetState(t);switch(e.state){case 0:this.isActiveTarget(t)&&r.updateResumeToken(e.resumeToken);break;case 1:r.recordTargetResponse(),r.isPending||r.clearPendingChanges(),r.updateResumeToken(e.resumeToken);break;case 2:r.recordTargetResponse(),r.isPending||this.removeTarget(t);break;case 3:this.isActiveTarget(t)&&(r.markCurrent(),r.updateResumeToken(e.resumeToken));break;case 4:this.isActiveTarget(t)&&(this.resetTarget(t),r.updateResumeToken(e.resumeToken));break;default:V()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.targetStates.forEach((r,i)=>{this.isActiveTarget(i)&&t(i)})}handleExistenceFilter(e){let t=e.targetId,r=e.existenceFilter.count,i=this.targetDataForActiveTarget(t);if(i){let s=i.target;if(Zh(s))if(r===0){let o=new P(s.path);this.removeDocumentFromTarget(t,o,Ye.newNoDocument(o,K.min()))}else j(r===1);else{let o=this.getCurrentDocumentCountForTarget(t);if(o!==r){let a=this.parseBloomFilter(e),l=a?this.applyBloomFilter(a,e,o):1;if(l!==0){this.resetTarget(t);let c=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.pendingTargetResets=this.pendingTargetResets.insert(t,c)}Zv?.notifyOnExistenceFilterMismatch(y4(o,e.existenceFilter,this.metadataProvider.getDatabaseId(),a,l))}}}}parseBloomFilter(e){let t=e.existenceFilter.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t,o;try{o=Ci(r).toUint8Array()}catch(l){if(l instanceof q0)return pn("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}let a;try{a=new U0(o,i,s)}catch(l){return l instanceof fs?pn("BloomFilter error: ",l):pn("Applying bloom filter failed: ",l),null}return a.bitCount===0?null:a}applyBloomFilter(e,t,r){let i=t.existenceFilter.count,s=this.filterRemovedDocuments(e,t.targetId);return i===r-s?0:2}filterRemovedDocuments(e,t){let r=this.metadataProvider.getRemoteKeysForTarget(t),i=0;return r.forEach(s=>{let o=this.metadataProvider.getDatabaseId(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.removeDocumentFromTarget(t,s,null),i++)}),i}createRemoteEvent(e){let t=new Map;this.targetStates.forEach((s,o)=>{let a=this.targetDataForActiveTarget(o);if(a){if(s.current&&Zh(a.target)){let l=new P(a.target.path);this.pendingDocumentUpdates.get(l)===null&&!this.targetContainsDocument(o,l)&&this.removeDocumentFromTarget(o,l,Ye.newNoDocument(l,e))}s.hasPendingChanges&&(t.set(o,s.toTargetChange()),s.clearPendingChanges())}});let r=Z();this.pendingDocumentTargetMapping.forEach((s,o)=>{let a=!0;o.forEachWhile(l=>{let c=this.targetDataForActiveTarget(l);return c&&c.purpose!=="TargetPurposeLimboResolution"?(a=!1,!1):!0}),a&&(r=r.add(s))}),this.pendingDocumentUpdates.forEach((s,o)=>o.setReadTime(e));let i=new pc(e,t,this.pendingTargetResets,this.pendingDocumentUpdates,r);return this.pendingDocumentUpdates=Gt(),this.pendingDocumentTargetMapping=CD(),this.pendingTargetResets=new be(J),i}addDocumentToTarget(e,t){if(!this.isActiveTarget(e))return;let r=this.targetContainsDocument(e,t.key)?2:0;this.ensureTargetState(e).addDocumentChange(t.key,r),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t.key,t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t.key,this.ensureDocumentTargetMapping(t.key).add(e))}removeDocumentFromTarget(e,t,r){if(!this.isActiveTarget(e))return;let i=this.ensureTargetState(e);this.targetContainsDocument(e,t)?i.addDocumentChange(t,1):i.removeDocumentChange(t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,this.ensureDocumentTargetMapping(t).delete(e)),r&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t,r))}removeTarget(e){this.targetStates.delete(e)}getCurrentDocumentCountForTarget(e){let r=this.ensureTargetState(e).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(e).size+r.addedDocuments.size-r.removedDocuments.size}recordPendingTargetRequest(e){this.ensureTargetState(e).recordPendingTargetRequest()}ensureTargetState(e){let t=this.targetStates.get(e);return t||(t=new rf,this.targetStates.set(e,t)),t}ensureDocumentTargetMapping(e){let t=this.pendingDocumentTargetMapping.get(e);return t||(t=new ve(J),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,t)),t}isActiveTarget(e){let t=this.targetDataForActiveTarget(e)!==null;return t||R(m4,"Detected inactive target",e),t}targetDataForActiveTarget(e){let t=this.targetStates.get(e);return t&&t.isPending?null:this.metadataProvider.getTargetDataForTarget(e)}resetTarget(e){this.targetStates.set(e,new rf),this.metadataProvider.getRemoteKeysForTarget(e).forEach(r=>{this.removeDocumentFromTarget(e,r,null)})}targetContainsDocument(e,t){return this.metadataProvider.getRemoteKeysForTarget(e).has(t)}};function CD(){return new be(P.comparator)}function bD(){return new be(P.comparator)}function y4(n,e,t,r,i){var s,o,a,l,c,u;let d={localCacheCount:n,existenceFilterCount:e.count,databaseId:t.database,projectId:t.projectId},h=e.unchangedNames;return h&&(d.bloomFilter={applied:i===0,hashCount:(s=h?.hashCount)!==null&&s!==void 0?s:0,bitmapLength:(l=(a=(o=h?.bits)===null||o===void 0?void 0:o.bitmap)===null||a===void 0?void 0:a.length)!==null&&l!==void 0?l:0,padding:(u=(c=h?.bits)===null||c===void 0?void 0:c.padding)!==null&&u!==void 0?u:0,mightContain:p=>{var y;return(y=r?.mightContain(p))!==null&&y!==void 0?y:!1}}),d}var v4=(()=>{let n={};return n.asc="ASCENDING",n.desc="DESCENDING",n})(),S4=(()=>{let n={};return n["<"]="LESS_THAN",n["<="]="LESS_THAN_OR_EQUAL",n[">"]="GREATER_THAN",n[">="]="GREATER_THAN_OR_EQUAL",n["=="]="EQUAL",n["!="]="NOT_EQUAL",n["array-contains"]="ARRAY_CONTAINS",n.in="IN",n["not-in"]="NOT_IN",n["array-contains-any"]="ARRAY_CONTAINS_ANY",n})(),_4=(()=>{let n={};return n.and="AND",n.or="OR",n})();var j0=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function E4(n){let e=n.code===void 0?v.UNKNOWN:zh(n.code);return new T(e,n.message||"")}function G0(n,e){return n.useProto3Json||xc(e)?e:{value:e}}function w4(n){let e;return typeof n=="object"?e=n.value:e=n,xc(e)?null:e}function la(n,e){if(n.useProto3Json){let r=new Date(e.seconds*1e3).toISOString().replace(/\.\d*/,"").replace("Z",""),i=("000000000"+e.nanoseconds).slice(-9);return`${r}.${i}Z`}else return{seconds:""+e.seconds,nanos:e.nanoseconds}}function T4(n){let e=Ti(n);return new xe(e.seconds,e.nanos)}function SR(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function C4(n,e){return n.useProto3Json?(j(e===void 0||typeof e=="string"),ot.fromBase64String(e||"")):(j(e===void 0||e instanceof Uint8Array),ot.fromUint8Array(e||new Uint8Array))}function b4(n,e){return la(n,e.toTimestamp())}function Ge(n){return j(!!n),K.fromTimestamp(T4(n))}function __(n,e){return A4(n).child("documents").child(e).canonicalString()}function _R(n){let e=de.fromString(n);return j(RR(e)),e}function mc(n,e){return __(n.databaseId,e.path)}function ar(n,e){let t=_R(e);if(t.get(1)!==n.databaseId.projectId)throw new T(v.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new T(v.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new P(wR(t))}function H0(n,e){return __(n.databaseId,e)}function ER(n){let e=_R(n);return e.length===4?de.emptyPath():wR(e)}function yc(n){return new de(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function A4(n){return new de(["projects",n.projectId,"databases",n.database])}function wR(n){return j(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function AD(n,e,t){return{name:mc(n,e),fields:t.value.mapValue.fields}}function I4(n,e){return{name:mc(n,e.key),fields:e.data.value.mapValue.fields,updateTime:la(n,e.version.toTimestamp()),createTime:la(n,e.createTime.toTimestamp())}}function TR(n,e,t){let r=ar(n,e.name),i=Ge(e.updateTime),s=e.createTime?Ge(e.createTime):K.min(),o=new Tt({mapValue:{fields:e.fields}}),a=Ye.newFoundDocument(r,i,s,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function D4(n,e){j(!!e.found),e.found.name,e.found.updateTime;let t=ar(n,e.found.name),r=Ge(e.found.updateTime),i=e.found.createTime?Ge(e.found.createTime):K.min(),s=new Tt({mapValue:{fields:e.found.fields}});return Ye.newFoundDocument(t,r,i,s)}function R4(n,e){j(!!e.missing),j(!!e.readTime);let t=ar(n,e.missing),r=Ge(e.readTime);return Ye.newNoDocument(t,r)}function k4(n,e){return"found"in e?D4(n,e):"missing"in e?R4(n,e):V()}function N4(n,e){let t;if("targetChange"in e){e.targetChange;let r=x4(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=C4(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&E4(o);t=new nf(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=ar(n,r.document.name),s=Ge(r.document.updateTime),o=r.document.createTime?Ge(r.document.createTime):K.min(),a=new Tt({mapValue:{fields:r.document.fields}}),l=Ye.newFoundDocument(i,s,o,a),c=r.targetIds||[],u=r.removedTargetIds||[];t=new ea(c,u,l.key,l)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=ar(n,r.document),s=r.readTime?Ge(r.readTime):K.min(),o=Ye.newNoDocument(i,s),a=r.removedTargetIds||[];t=new ea([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=ar(n,r.document),s=r.removedTargetIds||[];t=new ea([],s,i,null)}else if("filter"in e){e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:s}=r,o=new V0(i,s),a=r.targetId;t=new tf(a,o)}else return V();return t}function x4(n){return n==="NO_CHANGE"?0:n==="ADD"?1:n==="REMOVE"?2:n==="CURRENT"?3:n==="RESET"?4:V()}function M4(n){if(!("targetChange"in n))return K.min();let e=n.targetChange;return e.targetIds&&e.targetIds.length||!e.readTime?K.min():Ge(e.readTime)}function vc(n,e){let t;if(e instanceof Ri)t={update:AD(n,e.key,e.value)};else if(e instanceof ki)t={delete:mc(n,e.key)};else if(e instanceof xn)t={update:AD(n,e.key,e.data),updateMask:h6(e.fieldMask)};else if(e instanceof dc)t={verify:mc(n,e.key)};else return V();return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>B4(n,r))),e.precondition.isNone||(t.currentDocument=O4(n,e.precondition)),t}function K0(n,e){let t=e.currentDocument?P4(e.currentDocument):Le.none(),r=e.updateTransforms?e.updateTransforms.map(i=>V4(n,i)):[];if(e.update){e.update.name;let i=ar(n,e.update.name),s=new Tt({mapValue:{fields:e.update.fields}});if(e.updateMask){let o=f6(e.updateMask);return new xn(i,s,o,t,r)}else return new Ri(i,s,t,r)}else if(e.delete){let i=ar(n,e.delete);return new ki(i,t)}else if(e.verify){let i=ar(n,e.verify);return new dc(i,t)}else return V()}function O4(n,e){return e.updateTime!==void 0?{updateTime:b4(n,e.updateTime)}:e.exists!==void 0?{exists:e.exists}:V()}function P4(n){return n.updateTime!==void 0?Le.updateTime(Ge(n.updateTime)):n.exists!==void 0?Le.exists(n.exists):Le.none()}function F4(n,e){let t=n.updateTime?Ge(n.updateTime):Ge(e);return t.isEqual(K.min())&&(t=Ge(e)),new L0(t,n.transformResults||[])}function L4(n,e){return n&&n.length>0?(j(e!==void 0),n.map(t=>F4(t,e))):[]}function B4(n,e){let t=e.transform;if(t instanceof Ii)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(t instanceof Ar)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:t.elements}};if(t instanceof Ir)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:t.elements}};if(t instanceof Di)return{fieldPath:e.field.canonicalString(),increment:t.operand};throw V()}function V4(n,e){let t=null;if("setToServerValue"in e)j(e.setToServerValue==="REQUEST_TIME"),t=new Ii;else if("appendMissingElements"in e){let i=e.appendMissingElements.values||[];t=new Ar(i)}else if("removeAllFromArray"in e){let i=e.removeAllFromArray.values||[];t=new Ir(i)}else"increment"in e?t=new Di(n,e.increment):V();let r=He.fromServerFormat(e.fieldPath);return new ws(r,t)}function CR(n,e){return{documents:[H0(n,e.path)]}}function q4(n){let e=n.documents.length;j(e===1);let t=n.documents[0];return Pt(wa(ER(t)))}function bR(n,e){let t={structuredQuery:{}},r=e.path;e.collectionGroup!==null?(t.parent=H0(n,r),t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(t.parent=H0(n,r.popLast()),t.structuredQuery.from=[{collectionId:r.lastSegment()}]);let i=H4(e.filters);i&&(t.structuredQuery.where=i);let s=W4(e.orderBy);s&&(t.structuredQuery.orderBy=s);let o=G0(n,e.limit);return o!==null&&(t.structuredQuery.limit=o),e.startAt&&(t.structuredQuery.startAt=Q4(e.startAt)),e.endAt&&(t.structuredQuery.endAt=Y4(e.endAt)),t}function AR(n){let e=ER(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){j(r===1);let u=t.from[0];u.allDescendants?i=u.collectionId:e=e.child(u.collectionId)}let s=[];t.where&&(s=K4(t.where));let o=[];t.orderBy&&(o=$4(t.orderBy));let a=null;t.limit&&(a=w4(t.limit));let l=null;t.startAt&&(l=X4(t.startAt));let c=null;return t.endAt&&(c=J4(t.endAt)),Z1(e,i,o,s,a,"F",l,c)}function U4(n){return Pt(AR(n))}function z4(n,e){let t=j4(e.purpose);return t==null?null:{"goog-listen-tags":t}}function j4(n){switch(n){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return V()}}function G4(n,e){let t,r=e.target;if(Zh(r)?t={documents:CR(n,r)}:t={query:bR(n,r)},t.targetId=e.targetId,e.resumeToken.approximateByteSize()>0){t.resumeToken=SR(n,e.resumeToken);let i=G0(n,e.expectedCount);i!==null&&(t.expectedCount=i)}else if(e.snapshotVersion.compareTo(K.min())>0){t.readTime=la(n,e.snapshotVersion.toTimestamp());let i=G0(n,e.expectedCount);i!==null&&(t.expectedCount=i)}return t}function H4(n){if(n.length!==0)return DR(pe.create(n,"and"))}function K4(n){let e=IR(n);return e instanceof pe&&m_(e)?e.getFilters():[e]}function IR(n){return n.unaryFilter!==void 0?c6(n):n.fieldFilter!==void 0?u6(n):n.compositeFilter!==void 0?d6(n):V()}function W4(n){if(n.length!==0)return n.map(e=>s6(e))}function $4(n){return n.map(e=>o6(e))}function Q4(n){return{before:n.inclusive,values:n.position}}function Y4(n){return{before:!n.inclusive,values:n.position}}function X4(n){let e=!!n.before,t=n.values||[];return new cr(t,e)}function J4(n){let e=!n.before,t=n.values||[];return new cr(t,e)}function Z4(n){return v4[n]}function e6(n){switch(n){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}function t6(n){return S4[n]}function n6(n){return _4[n]}function r6(n){switch(n){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return V();default:return V()}}function i6(n){switch(n){case"AND":return"and";case"OR":return"or";default:return V()}}function $o(n){return{fieldPath:n.canonicalString()}}function Xo(n){return He.fromServerFormat(n.fieldPath)}function s6(n){return{field:$o(n.field),direction:Z4(n.dir)}}function o6(n){return new _s(Xo(n.field),e6(n.direction))}function DR(n){return n instanceof re?l6(n):n instanceof pe?a6(n):V()}function a6(n){let e=n.getFilters().map(t=>DR(t));return e.length===1?e[0]:{compositeFilter:{op:n6(n.op),filters:e}}}function l6(n){if(n.op==="=="){if(gD(n.value))return{unaryFilter:{field:$o(n.field),op:"IS_NAN"}};if(pD(n.value))return{unaryFilter:{field:$o(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(gD(n.value))return{unaryFilter:{field:$o(n.field),op:"IS_NOT_NAN"}};if(pD(n.value))return{unaryFilter:{field:$o(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:$o(n.field),op:t6(n.op),value:n.value}}}function c6(n){switch(n.unaryFilter.op){case"IS_NAN":let e=Xo(n.unaryFilter.field);return re.create(e,"==",{doubleValue:NaN});case"IS_NULL":let t=Xo(n.unaryFilter.field);return re.create(t,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let r=Xo(n.unaryFilter.field);return re.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=Xo(n.unaryFilter.field);return re.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return V();default:return V()}}function u6(n){return re.create(Xo(n.fieldFilter.field),r6(n.fieldFilter.op),n.fieldFilter.value)}function d6(n){return pe.create(n.compositeFilter.filters.map(e=>IR(e)),i6(n.compositeFilter.op))}function h6(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function f6(n){let e=n.fieldPaths||[];return new Jt(e.map(t=>He.fromServerFormat(t)))}function RR(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var ca=class n{constructor(e,t,r,i,s=K.min(),o=K.min(),a=ot.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var sf=class{constructor(e){this.remoteSerializer=e}};function p6(n,e){let t;if(e.document)t=TR(n.remoteSerializer,e.document,!!e.hasCommittedMutations);else if(e.noDocument){let r=P.fromSegments(e.noDocument.path),i=Cs(e.noDocument.readTime);t=Ye.newNoDocument(r,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else if(e.unknownDocument){let r=P.fromSegments(e.unknownDocument.path),i=Cs(e.unknownDocument.version);t=Ye.newUnknownDocument(r,i)}else return V();return e.readTime&&t.setReadTime(g6(e.readTime)),t}function ID(n,e){let t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Gf(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=I4(n.remoteSerializer,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:Ts(e.version)};else if(e.isUnknownDocument())r.unknownDocument={path:t.path.toArray(),version:Ts(e.version)};else return V();return r}function Gf(n){let e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function g6(n){let e=new xe(n[0],n[1]);return K.fromTimestamp(e)}function Ts(n){let e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Cs(n){let e=new xe(n.seconds,n.nanoseconds);return K.fromTimestamp(e)}function m6(n,e,t){let r=t.baseMutations.map(s=>vc(n.remoteSerializer,s)),i=t.mutations.map(s=>vc(n.remoteSerializer,s));return{userId:e,batchId:t.batchId,localWriteTimeMs:t.localWriteTime.toMillis(),baseMutations:r,mutations:i}}function cs(n,e){let t=(e.baseMutations||[]).map(s=>K0(n.remoteSerializer,s));for(let s=0;s<e.mutations.length-1;++s){let o=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){let l=e.mutations[s+1];o.updateTransforms=l.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}let r=e.mutations.map(s=>K0(n.remoteSerializer,s)),i=xe.fromMillis(e.localWriteTimeMs);return new hc(e.batchId,i,t,r)}function Yl(n){let e=Cs(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?Cs(n.lastLimboFreeSnapshotVersion):K.min(),r;return y6(n.query)?r=q4(n.query):r=U4(n.query),new ca(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,ot.fromBase64String(n.resumeToken))}function kR(n,e){let t=Ts(e.snapshotVersion),r=Ts(e.lastLimboFreeSnapshotVersion),i;Zh(e.target)?i=CR(n.remoteSerializer,e.target):i=bR(n.remoteSerializer,e.target);let s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Es(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function y6(n){return n.documents!==void 0}function v6(n){return{id:n.bundleId,createTime:Cs(n.createTime),version:n.version}}function S6(n){return{bundleId:n.id,createTime:Ts(Ge(n.createTime)),version:n.version}}function _6(n){return{name:n.name,query:E_(n.bundledQuery),readTime:Cs(n.readTime)}}function E6(n){return{name:n.name,readTime:Ts(Ge(n.readTime)),bundledQuery:n.bundledQuery}}function E_(n){let e=AR({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?ef(e,e.limit,"L"):e}function w6(n){return{name:n.name,query:E_(n.bundledQuery),readTime:Ge(n.readTime)}}function T6(n){return{id:n.id,version:n.version,createTime:Ge(n.createTime)}}function e0(n,e){return new fc(e.largestBatchId,K0(n.remoteSerializer,e.overlayMutation))}function C6(n,e,t){let[r,i,s]=NR(e,t.mutation.key);return{userId:e,collectionPath:i,documentId:s,collectionGroup:t.mutation.key.getCollectionGroup(),largestBatchId:t.largestBatchId,overlayMutation:vc(n.remoteSerializer,t.mutation)}}function NR(n,e){let t=e.path.lastSegment(),r=Ot(e.path.popLast());return[n,r,t]}function b6(n){return{indexId:n.indexId,collectionGroup:n.collectionGroup,fields:n.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])}}function A6(n,e){let t=e?new rc(e.sequenceNumber,new gn(Cs(e.readTime),new P(sr(e.documentKey)),e.largestBatchId)):rc.empty(),r=n.fields.map(([i,s])=>new Jo(He.fromServerFormat(i),s));return new g0(n.indexId,n.collectionGroup,r,t)}function DD(n,e,t,r){return{indexId:n,uid:e.uid||"",sequenceNumber:t,readTime:Ts(r.readTime),documentKey:Ot(r.documentKey.path),largestBatchId:r.largestBatchId}}var W0=class{getBundleMetadata(e,t){return RD(e).get(t).next(r=>{if(r)return v6(r)})}saveBundleMetadata(e,t){return RD(e).put(S6(t))}getNamedQuery(e,t){return kD(e).get(t).next(r=>{if(r)return _6(r)})}saveNamedQuery(e,t){return kD(e).put(E6(t))}};function RD(n){return at(n,Bf)}function kD(n){return at(n,Vf)}var of=class n{constructor(e,t){this.serializer=e,this.userId=t}static forUser(e,t){let r=t.uid||"";return new n(e,r)}getOverlay(e,t){return Hl(e).get(NR(this.userId,t)).next(r=>r?e0(this.serializer,r):null)}getOverlays(e,t){let r=or();return m.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){let i=[];return r.forEach((s,o)=>{let a=new fc(t,o);i.push(this.saveOverlay(e,a))}),m.waitFor(i)}removeOverlaysForBatchId(e,t,r){let i=new Set;t.forEach(o=>i.add(Ot(o.getCollectionPath())));let s=[];return i.forEach(o=>{let a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);s.push(Hl(e).deleteAll(T0,a))}),m.waitFor(s)}getOverlaysForCollection(e,t,r){let i=or(),s=Ot(t),o=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return Hl(e).loadAll(T0,o).next(a=>{for(let l of a){let c=e0(this.serializer,l);i.set(c.getKey(),c)}return i})}getOverlaysForCollectionGroup(e,t,r,i){let s=or(),o,a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Hl(e).iterate({index:N1,range:a},(l,c,u)=>{let d=e0(this.serializer,c);s.size()<i||d.largestBatchId===o?(s.set(d.getKey(),d),o=d.largestBatchId):u.done()}).next(()=>s)}saveOverlay(e,t){return Hl(e).put(C6(this.serializer,this.userId,t))}};function Hl(n){return at(n,qf)}var I6=5,D6=10,R6=13,ND=15,k6=20,N6=25,x6=30,M6=37,O6=45,P6=50,F6=55,L6=60,B6=2,br=class{constructor(){}writeIndexValue(e,t){this.writeIndexValueAux(e,t),t.writeInfinity()}writeIndexValueAux(e,t){if("nullValue"in e)this.writeValueTypeLabel(t,I6);else if("booleanValue"in e)this.writeValueTypeLabel(t,D6),t.writeNumber(e.booleanValue?1:0);else if("integerValue"in e)this.writeValueTypeLabel(t,ND),t.writeNumber(Be(e.integerValue));else if("doubleValue"in e){let r=Be(e.doubleValue);isNaN(r)?this.writeValueTypeLabel(t,R6):(this.writeValueTypeLabel(t,ND),ac(r)?t.writeNumber(0):t.writeNumber(r))}else if("timestampValue"in e){let r=e.timestampValue;this.writeValueTypeLabel(t,k6),typeof r=="string"?t.writeString(r):(t.writeString(`${r.seconds||""}`),t.writeNumber(r.nanos||0))}else if("stringValue"in e)this.writeIndexString(e.stringValue,t),this.writeTruncationMarker(t);else if("bytesValue"in e)this.writeValueTypeLabel(t,x6),t.writeBytes(Ci(e.bytesValue)),this.writeTruncationMarker(t);else if("referenceValue"in e)this.writeIndexEntityRef(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.writeValueTypeLabel(t,O6),t.writeNumber(r.latitude||0),t.writeNumber(r.longitude||0)}else"mapValue"in e?j1(e)?this.writeValueTypeLabel(t,Number.MAX_SAFE_INTEGER):(this.writeIndexMap(e.mapValue,t),this.writeTruncationMarker(t)):"arrayValue"in e?(this.writeIndexArray(e.arrayValue,t),this.writeTruncationMarker(t)):V()}writeIndexString(e,t){this.writeValueTypeLabel(t,N6),this.writeUnlabeledIndexString(e,t)}writeUnlabeledIndexString(e,t){t.writeString(e)}writeIndexMap(e,t){let r=e.fields||{};this.writeValueTypeLabel(t,F6);for(let i of Object.keys(r))this.writeIndexString(i,t),this.writeIndexValueAux(r[i],t)}writeIndexArray(e,t){let r=e.values||[];this.writeValueTypeLabel(t,P6);for(let i of r)this.writeIndexValueAux(i,t)}writeIndexEntityRef(e,t){this.writeValueTypeLabel(t,M6),P.fromName(e).path.forEach(i=>{this.writeValueTypeLabel(t,L6),this.writeUnlabeledIndexString(i,t)})}writeValueTypeLabel(e,t){e.writeNumber(t)}writeTruncationMarker(e){e.writeNumber(B6)}};br.INSTANCE=new br;var xD="\uD800",MD="\uDBFF",Uo=0,OD=255,PD=1,zo=255,FD=255,LD=0,V6=64,q6=8,U6=1024;function z6(n){let e=new DataView(new ArrayBuffer(8));return e.setFloat64(0,n,!1),new Uint8Array(e.buffer)}function j6(n){if(n===0)return 8;let e=0;return n>>4||(e+=4,n=n<<4),n>>6||(e+=2,n=n<<2),n>>7||(e+=1),e}function G6(n){let e=0;for(let t=0;t<8;++t){let r=j6(n[t]&255);if(e+=r,r!==8)break}return e}function BD(n){let e=V6-G6(n);return Math.ceil(e/q6)}var $0=class{constructor(){this.buffer=new Uint8Array(U6),this.position=0}writeBytesAscending(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.writeByteAscending(r.value),r=t.next();this.writeSeparatorAscending()}writeBytesDescending(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.writeByteDescending(r.value),r=t.next();this.writeSeparatorDescending()}writeUtf8Ascending(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.writeByteAscending(r);else if(r<2048)this.writeByteAscending(960|r>>>6),this.writeByteAscending(128|63&r);else if(t<xD||MD<t)this.writeByteAscending(480|r>>>12),this.writeByteAscending(128|63&r>>>6),this.writeByteAscending(128|63&r);else{let i=t.codePointAt(0);this.writeByteAscending(240|i>>>18),this.writeByteAscending(128|63&i>>>12),this.writeByteAscending(128|63&i>>>6),this.writeByteAscending(128|63&i)}}this.writeSeparatorAscending()}writeUtf8Descending(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.writeByteDescending(r);else if(r<2048)this.writeByteDescending(960|r>>>6),this.writeByteDescending(128|63&r);else if(t<xD||MD<t)this.writeByteDescending(480|r>>>12),this.writeByteDescending(128|63&r>>>6),this.writeByteDescending(128|63&r);else{let i=t.codePointAt(0);this.writeByteDescending(240|i>>>18),this.writeByteDescending(128|63&i>>>12),this.writeByteDescending(128|63&i>>>6),this.writeByteDescending(128|63&i)}}this.writeSeparatorDescending()}writeNumberAscending(e){let t=this.toOrderedBits(e),r=BD(t);this.ensureAvailable(1+r),this.buffer[this.position++]=r&255;for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=t[i]&255}writeNumberDescending(e){let t=this.toOrderedBits(e),r=BD(t);this.ensureAvailable(1+r),this.buffer[this.position++]=~(r&255);for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=~(t[i]&255)}writeInfinityAscending(){this.writeEscapedByteAscending(zo),this.writeEscapedByteAscending(FD)}writeInfinityDescending(){this.writeEscapedByteDescending(zo),this.writeEscapedByteDescending(FD)}reset(){this.position=0}seed(e){this.ensureAvailable(e.length),this.buffer.set(e,this.position),this.position+=e.length}encodedBytes(){return this.buffer.slice(0,this.position)}toOrderedBits(e){let t=z6(e),r=(t[0]&128)!==0;t[0]^=r?255:128;for(let i=1;i<t.length;++i)t[i]^=r?255:0;return t}writeByteAscending(e){let t=e&255;t===Uo?(this.writeEscapedByteAscending(Uo),this.writeEscapedByteAscending(OD)):t===zo?(this.writeEscapedByteAscending(zo),this.writeEscapedByteAscending(LD)):this.writeEscapedByteAscending(t)}writeByteDescending(e){let t=e&255;t===Uo?(this.writeEscapedByteDescending(Uo),this.writeEscapedByteDescending(OD)):t===zo?(this.writeEscapedByteDescending(zo),this.writeEscapedByteDescending(LD)):this.writeEscapedByteDescending(e)}writeSeparatorAscending(){this.writeEscapedByteAscending(Uo),this.writeEscapedByteAscending(PD)}writeSeparatorDescending(){this.writeEscapedByteDescending(Uo),this.writeEscapedByteDescending(PD)}writeEscapedByteAscending(e){this.ensureAvailable(1),this.buffer[this.position++]=e}writeEscapedByteDescending(e){this.ensureAvailable(1),this.buffer[this.position++]=~e}ensureAvailable(e){let t=e+this.position;if(t<=this.buffer.length)return;let r=this.buffer.length*2;r<t&&(r=t);let i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}},Q0=class{constructor(e){this.orderedCode=e}writeBytes(e){this.orderedCode.writeBytesAscending(e)}writeString(e){this.orderedCode.writeUtf8Ascending(e)}writeNumber(e){this.orderedCode.writeNumberAscending(e)}writeInfinity(){this.orderedCode.writeInfinityAscending()}},Y0=class{constructor(e){this.orderedCode=e}writeBytes(e){this.orderedCode.writeBytesDescending(e)}writeString(e){this.orderedCode.writeUtf8Descending(e)}writeNumber(e){this.orderedCode.writeNumberDescending(e)}writeInfinity(){this.orderedCode.writeInfinityDescending()}},us=class{constructor(){this.orderedCode=new $0,this.ascending=new Q0(this.orderedCode),this.descending=new Y0(this.orderedCode)}seed(e){this.orderedCode.seed(e)}forKind(e){return e===0?this.ascending:this.descending}encodedBytes(){return this.orderedCode.encodedBytes()}reset(){this.orderedCode.reset()}};var ds=class n{constructor(e,t,r,i){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=i}successor(){let e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new n(this.indexId,this.documentKey,this.arrayValue,r)}};function pi(n,e){let t=n.indexId-e.indexId;return t!==0||(t=VD(n.arrayValue,e.arrayValue),t!==0)||(t=VD(n.directionalValue,e.directionalValue),t!==0)?t:P.comparator(n.documentKey,e.documentKey)}function VD(n,e){for(let t=0;t<n.length&&t<e.length;++t){let r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}var af=class{constructor(e){this.inequalityFilters=new ve((t,r)=>He.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.orderBys=e.orderBy,this.equalityFilters=[];for(let t of e.filters){let r=t;r.isInequality()?this.inequalityFilters=this.inequalityFilters.add(r):this.equalityFilters.push(r)}}get hasMultipleInequality(){return this.inequalityFilters.size>1}servedByIndex(e){if(j(e.collectionGroup===this.collectionId),this.hasMultipleInequality)return!1;let t=a_(e);if(t!==void 0&&!this.hasMatchingEqualityFilter(t))return!1;let r=ys(e),i=new Set,s=0,o=0;for(;s<r.length&&this.hasMatchingEqualityFilter(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(this.inequalityFilters.size>0){let a=this.inequalityFilters.getIterator().getNext();if(!i.has(a.field.canonicalString())){let l=r[s];if(!this.matchesFilter(a,l)||!this.matchesOrderBy(this.orderBys[o++],l))return!1}++s}for(;s<r.length;++s){let a=r[s];if(o>=this.orderBys.length||!this.matchesOrderBy(this.orderBys[o++],a))return!1}return!0}buildTargetIndex(){if(this.hasMultipleInequality)return null;let e=new ve(He.comparator),t=[];for(let r of this.equalityFilters){if(r.field.isKeyField())continue;if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new Jo(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new Jo(r.field,0))}}for(let r of this.orderBys)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new Jo(r.field,r.dir==="asc"?0:1)));return new g0(g0.UNKNOWN_ID,this.collectionId,t,rc.empty())}hasMatchingEqualityFilter(e){for(let t of this.equalityFilters)if(this.matchesFilter(t,e))return!0;return!1}matchesFilter(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;let r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}matchesOrderBy(e,t){return e.field.isEqual(t.fieldPath)?t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc":!1}};function xR(n){var e,t;if(j(n instanceof re||n instanceof pe),n instanceof re)if(n instanceof Jh){let i=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(s=>re.create(n.field,"==",s)))||[];return pe.create(i,"or")}else return n;let r=n.filters.map(i=>xR(i));return pe.create(r,n.op)}function H6(n){if(n.getFilters().length===0)return[];let e=X0(xR(n));return j(MR(e)),w_(e)||T_(e)?[e]:e.getFilters()}function w_(n){return n instanceof re}function T_(n){return n instanceof pe&&m_(n)}function MR(n){return w_(n)||T_(n)||K6(n)}function K6(n){if(n instanceof pe&&I0(n)){for(let e of n.getFilters())if(!w_(e)&&!T_(e))return!1;return!0}return!1}function X0(n){if(j(n instanceof re||n instanceof pe),n instanceof re)return n;if(n.filters.length===1)return X0(n.filters[0]);let e=n.filters.map(r=>X0(r)),t=pe.create(e,n.op);return t=lf(t),MR(t)?t:(j(t instanceof pe),j(ia(t)),j(t.filters.length>1),t.filters.reduce((r,i)=>C_(r,i)))}function C_(n,e){j(n instanceof re||n instanceof pe),j(e instanceof re||e instanceof pe);let t;return n instanceof re?e instanceof re?t=W6(n,e):t=qD(n,e):e instanceof re?t=qD(e,n):t=$6(n,e),lf(t)}function W6(n,e){return pe.create([n,e],"and")}function $6(n,e){if(j(n.filters.length>0&&e.filters.length>0),ia(n)&&ia(e))return $1(n,e.getFilters());let t=I0(n)?n:e,r=I0(n)?e:n,i=t.filters.map(s=>C_(s,r));return pe.create(i,"or")}function qD(n,e){if(ia(e))return $1(e,n.getFilters());{let t=e.filters.map(r=>C_(n,r));return pe.create(t,"or")}}function lf(n){if(j(n instanceof re||n instanceof pe),n instanceof re)return n;let e=n.getFilters();if(e.length===1)return lf(e[0]);if(K1(n))return n;let t=e.map(i=>lf(i)),r=[];return t.forEach(i=>{i instanceof re?r.push(i):i instanceof pe&&(i.op===n.op?r.push(...i.filters):r.push(i))}),r.length===1?r[0]:pe.create(r,n.op)}var J0=class{constructor(){this.collectionParentIndex=new Sc}addToCollectionParentIndex(e,t){return this.collectionParentIndex.add(t),m.resolve()}getCollectionParents(e,t){return m.resolve(this.collectionParentIndex.getEntries(t))}addFieldIndex(e,t){return m.resolve()}deleteFieldIndex(e,t){return m.resolve()}deleteAllFieldIndexes(e){return m.resolve()}createTargetIndexes(e,t){return m.resolve()}getDocumentsMatchingTarget(e,t){return m.resolve(null)}getIndexType(e,t){return m.resolve(0)}getFieldIndexes(e,t){return m.resolve([])}getNextCollectionGroupToUpdate(e){return m.resolve(null)}getMinOffset(e,t){return m.resolve(gn.min())}getMinOffsetFromCollectionGroup(e,t){return m.resolve(gn.min())}updateCollectionGroup(e,t,r){return m.resolve()}updateIndexEntries(e,t){return m.resolve()}},Sc=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new ve(de.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new ve(de.comparator)).toArray()}};var UD="IndexedDbIndexManager",Oh=new Uint8Array(0),Z0=class{constructor(e,t){this.user=e,this.databaseId=t,this.collectionParentsCache=new Sc,this.targetToDnfSubTargets=new ur(r=>Es(r),(r,i)=>Mc(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.collectionParentsCache.has(t)){let r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.collectionParentsCache.add(t)});let s={collectionId:r,parent:Ot(i)};return zD(e).put(s)}return m.resolve()}getCollectionParents(e,t){let r=[],i=IDBKeyRange.bound([t,""],[v1(t),""],!1,!0);return zD(e).loadAll(i).next(s=>{for(let o of s){if(o.collectionId!==t)break;r.push(sr(o.parent))}return r})}addFieldIndex(e,t){let r=Kl(e),i=b6(t);delete i.indexId;let s=r.add(i);if(t.indexState){let o=Go(e);return s.next(a=>{o.put(DD(a,this.user,t.indexState.sequenceNumber,t.indexState.offset))})}else return s.next()}deleteFieldIndex(e,t){let r=Kl(e),i=Go(e),s=jo(e);return r.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=Kl(e),r=jo(e),i=Go(e);return t.deleteAll().next(()=>r.deleteAll()).next(()=>i.deleteAll())}createTargetIndexes(e,t){return m.forEach(this.getSubTargets(t),r=>this.getIndexType(e,r).next(i=>{if(i===0||i===1){let o=new af(r).buildTargetIndex();if(o!=null)return this.addFieldIndex(e,o)}}))}getDocumentsMatchingTarget(e,t){let r=jo(e),i=!0,s=new Map;return m.forEach(this.getSubTargets(t),o=>this.getFieldIndex(e,o).next(a=>{i&&(i=!!a),s.set(o,a)})).next(()=>{if(i){let o=Z(),a=[];return m.forEach(s,(l,c)=>{R(UD,`Using index ${sU(l)} to execute ${Es(t)}`);let u=D3(c,l),d=R3(c,l),h=k3(c,l),p=N3(c,l),y=this.encodeBound(l,c,h),S=this.encodeBound(l,c,p),_=this.encodeValues(l,c,d),k=this.generateIndexRanges(l.indexId,u,y,h.inclusive,S,p.inclusive,_);return m.forEach(k,w=>r.loadFirst(w,t.limit).next(x=>{x.forEach(M=>{let z=P.fromSegments(M.documentKey);o.has(z)||(o=o.add(z),a.push(z))})}))}).next(()=>a)}else return m.resolve(null)})}getSubTargets(e){let t=this.targetToDnfSubTargets.get(e);return t||(e.filters.length===0?t=[e]:t=H6(pe.create(e.filters,"and")).map(i=>F0(e.path,e.collectionGroup,e.orderBy,i.getFilters(),e.limit,e.startAt,e.endAt)),this.targetToDnfSubTargets.set(e,t),t)}generateIndexRanges(e,t,r,i,s,o,a){let l=(t!=null?t.length:1)*Math.max(r.length,s.length),c=l/(t!=null?t.length:1),u=[];for(let d=0;d<l;++d){let h=t?this.encodeSingleElement(t[d/c]):Oh,p=this.generateLowerBound(e,h,r[d%c],i),y=this.generateUpperBound(e,h,s[d%c],o),S=a.map(_=>this.generateLowerBound(e,h,_,!0));u.push(...this.createRange(p,y,S))}return u}generateLowerBound(e,t,r,i){let s=new ds(e,P.empty(),t,r);return i?s:s.successor()}generateUpperBound(e,t,r,i){let s=new ds(e,P.empty(),t,r);return i?s.successor():s}getFieldIndex(e,t){let r=new af(t),i=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let o=null;for(let a of s)r.servedByIndex(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2,i=this.getSubTargets(t);return m.forEach(i,s=>this.getFieldIndex(e,s).next(o=>{o?r!==0&&o.fields.length<x3(s)&&(r=1):r=0})).next(()=>M3(t)&&i.length>1&&r===2?1:r)}encodeDirectionalElements(e,t){let r=new us;for(let i of ys(e)){let s=t.data.field(i.fieldPath);if(s==null)return null;let o=r.forKind(i.kind);br.INSTANCE.writeIndexValue(s,o)}return r.encodedBytes()}encodeSingleElement(e){let t=new us;return br.INSTANCE.writeIndexValue(e,t.forKind(0)),t.encodedBytes()}encodeDirectionalKey(e,t){let r=new us;return br.INSTANCE.writeIndexValue(Ss(this.databaseId,t),r.forKind(iU(e))),r.encodedBytes()}encodeValues(e,t,r){if(r===null)return[];let i=[];i.push(new us);let s=0;for(let o of ys(e)){let a=r[s++];for(let l of i)if(this.isInFilter(t,o.fieldPath)&&cc(a))i=this.expandIndexValues(i,o,a);else{let c=l.forKind(o.kind);br.INSTANCE.writeIndexValue(a,c)}}return this.getEncodedBytes(i)}encodeBound(e,t,r){return this.encodeValues(e,t,r.position)}getEncodedBytes(e){let t=[];for(let r=0;r<e.length;++r)t[r]=e[r].encodedBytes();return t}expandIndexValues(e,t,r){let i=[...e],s=[];for(let o of r.arrayValue.values||[])for(let a of i){let l=new us;l.seed(a.encodedBytes()),br.INSTANCE.writeIndexValue(o,l.forKind(t.kind)),s.push(l)}return s}isInFilter(e,t){return!!e.filters.find(r=>r instanceof re&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){let r=Kl(e),i=Go(e);return(t?r.loadAll(w0,IDBKeyRange.bound(t,t)):r.loadAll()).next(s=>{let o=[];return m.forEach(s,a=>i.get([a.indexId,this.uid]).next(l=>{o.push(A6(a,l))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,i)=>{let s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:J(r.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){let i=Kl(e),s=Go(e);return this.getNextSequenceNumber(e).next(o=>i.loadAll(w0,IDBKeyRange.bound(t,t)).next(a=>m.forEach(a,l=>s.put(DD(l.indexId,this.user,o,r)))))}updateIndexEntries(e,t){let r=new Map;return m.forEach(t,(i,s)=>{let o=r.get(i.collectionGroup);return(o?m.resolve(o):this.getFieldIndexes(e,i.collectionGroup)).next(l=>(r.set(i.collectionGroup,l),m.forEach(l,c=>this.getExistingIndexEntries(e,i,c).next(u=>{let d=this.computeIndexEntries(s,c);return u.isEqual(d)?m.resolve():this.updateEntries(e,s,c,u,d)}))))})}addIndexEntry(e,t,r,i){return jo(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.encodeDirectionalKey(r,t.key),documentKey:t.key.path.toArray()})}deleteIndexEntry(e,t,r,i){return jo(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.encodeDirectionalKey(r,t.key),t.key.path.toArray()])}getExistingIndexEntries(e,t,r){let i=jo(e),s=new ve(pi);return i.iterate({index:k1,range:IDBKeyRange.only([r.indexId,this.uid,this.encodeDirectionalKey(r,t)])},(o,a)=>{s=s.add(new ds(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>s)}computeIndexEntries(e,t){let r=new ve(pi),i=this.encodeDirectionalElements(t,e);if(i==null)return r;let s=a_(t);if(s!=null){let o=e.data.field(s.fieldPath);if(cc(o))for(let a of o.arrayValue.values||[])r=r.add(new ds(t.indexId,e.key,this.encodeSingleElement(a),i))}else r=r.add(new ds(t.indexId,e.key,Oh,i));return r}updateEntries(e,t,r,i,s){R(UD,"Updating index entries for document '%s'",t.key);let o=[];return zU(i,s,pi,a=>{o.push(this.addIndexEntry(e,t,r,a))},a=>{o.push(this.deleteIndexEntry(e,t,r,a))}),m.waitFor(o)}getNextSequenceNumber(e){let t=1;return Go(e).iterate({index:R1,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(i,s,o)=>{o.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>pi(o,a)).filter((o,a,l)=>!a||pi(o,l[a-1])!==0);let i=[];i.push(e);for(let o of r){let a=pi(o,e),l=pi(o,t);if(a===0)i[0]=e.successor();else if(a>0&&l<0)i.push(o),i.push(o.successor());else if(l>0)break}i.push(t);let s=[];for(let o=0;o<i.length;o+=2){if(this.isRangeMatchable(i[o],i[o+1]))return[];let a=[i[o].indexId,this.uid,i[o].arrayValue,i[o].directionalValue,Oh,[]],l=[i[o+1].indexId,this.uid,i[o+1].arrayValue,i[o+1].directionalValue,Oh,[]];s.push(IDBKeyRange.bound(a,l))}return s}isRangeMatchable(e,t){return pi(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(jD)}getMinOffset(e,t){return m.mapArray(this.getSubTargets(t),r=>this.getFieldIndex(e,r).next(i=>i||V())).next(jD)}};function zD(n){return at(n,ic)}function jo(n){return at(n,f_)}function Kl(n){return at(n,d_)}function Go(n){return at(n,h_)}function jD(n){j(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){let i=n[r].indexState.offset;l_(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new gn(e.readTime,e.documentKey,t)}function OR(n,e,t){let r=n.store(Rn),i=n.store(Sa),s=[],o=IDBKeyRange.only(t.batchId),a=0,l=r.iterate({range:o},(u,d,h)=>(a++,h.delete()));s.push(l.next(()=>{j(a===1)}));let c=[];for(let u of t.mutations){let d=A1(e,u.key.path,t.batchId);s.push(i.delete(d)),c.push(u.key)}return m.waitFor(s).next(()=>c)}function cf(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else if(n.noDocument)e=n.noDocument;else throw V();return JSON.stringify(e).length}var uf=class n{constructor(e,t,r,i){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=i,this.documentKeysByBatchId={}}static forUser(e,t,r,i){j(e.uid!=="");let s=e.isAuthenticated()?e.uid:"";return new n(s,t,r,i)}checkEmpty(e){let t=!0,r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return gi(e).iterate({index:hs,range:r},(i,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,i){let s=Qo(e),o=gi(e);return o.add({}).next(a=>{j(typeof a=="number");let l=new hc(a,t,r,i),c=m6(this.serializer,this.userId,l),u=[],d=new ve((h,p)=>J(h.canonicalString(),p.canonicalString()));for(let h of i){let p=A1(this.userId,h.key.path,a);d=d.add(h.key.path.popLast()),u.push(o.put(c)),u.push(s.put(p,fU))}return d.forEach(h=>{u.push(this.indexManager.addToCollectionParentIndex(e,h))}),e.addOnCommittedListener(()=>{this.documentKeysByBatchId[a]=l.keys()}),m.waitFor(u).next(()=>l)})}lookupMutationBatch(e,t){return gi(e).get(t).next(r=>r?(j(r.userId===this.userId),cs(this.serializer,r)):null)}lookupMutationKeys(e,t){return this.documentKeysByBatchId[t]?m.resolve(this.documentKeysByBatchId[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){let i=r.keys();return this.documentKeysByBatchId[t]=i,i}else return null})}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]),s=null;return gi(e).iterate({index:hs,range:i},(o,a,l)=>{a.userId===this.userId&&(j(a.batchId>=r),s=cs(this.serializer,a)),l.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=_i;return gi(e).iterate({index:hs,range:t,reverse:!0},(i,s,o)=>{r=s.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,_i],[this.userId,Number.POSITIVE_INFINITY]);return gi(e).loadAll(hs,t).next(r=>r.map(i=>cs(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){let r=Bh(this.userId,t.path),i=IDBKeyRange.lowerBound(r),s=[];return Qo(e).iterate({range:i},(o,a,l)=>{let[c,u,d]=o,h=sr(u);if(c!==this.userId||!t.path.isEqual(h)){l.done();return}return gi(e).get(d).next(p=>{if(!p)throw V();j(p.userId===this.userId),s.push(cs(this.serializer,p))})}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new ve(J),i=[];return t.forEach(s=>{let o=Bh(this.userId,s.path),a=IDBKeyRange.lowerBound(o),l=Qo(e).iterate({range:a},(c,u,d)=>{let[h,p,y]=c,S=sr(p);if(h!==this.userId||!s.path.isEqual(S)){d.done();return}r=r.add(y)});i.push(l)}),m.waitFor(i).next(()=>this.lookupMutationBatches(e,r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=Bh(this.userId,r),o=IDBKeyRange.lowerBound(s),a=new ve(J);return Qo(e).iterate({range:o},(l,c,u)=>{let[d,h,p]=l,y=sr(h);if(d!==this.userId||!r.isPrefixOf(y)){u.done();return}y.length===i&&(a=a.add(p))}).next(()=>this.lookupMutationBatches(e,a))}lookupMutationBatches(e,t){let r=[],i=[];return t.forEach(s=>{i.push(gi(e).get(s).next(o=>{if(o===null)throw V();j(o.userId===this.userId),r.push(cs(this.serializer,o))}))}),m.waitFor(i).next(()=>r)}removeMutationBatch(e,t){return OR(e.simpleDbTransaction,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.removeCachedMutationKeys(t.batchId)}),m.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}removeCachedMutationKeys(e){delete this.documentKeysByBatchId[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return m.resolve();let r=IDBKeyRange.lowerBound(hU(this.userId)),i=[];return Qo(e).iterate({range:r},(s,o,a)=>{if(s[0]!==this.userId){a.done();return}else{let c=sr(s[1]);i.push(c)}}).next(()=>{j(i.length===0)})})}containsKey(e,t){return PR(e,this.userId,t)}getMutationQueueMetadata(e){return FR(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:_i,lastStreamToken:""})}};function PR(n,e,t){let r=Bh(e,t.path),i=r[1],s=IDBKeyRange.lowerBound(r),o=!1;return Qo(n).iterate({range:s,keysOnly:!0},(a,l,c)=>{let[u,d,h]=a;u===e&&d===i&&(o=!0),c.done()}).next(()=>o)}function Q6(n,e){let t=!1;return FR(n).iterateSerial(r=>PR(n,r,e).next(i=>(i&&(t=!0),m.resolve(!i)))).next(()=>t)}function gi(n){return at(n,Rn)}function Qo(n){return at(n,Sa)}function FR(n){return at(n,kc)}var t0=2,ua=class n{constructor(e){this.lastId=e}next(){return this.lastId+=t0,this.lastId}static forTargetCache(){return new n(2-t0)}static forSyncEngine(){return new n(1-t0)}};var eS=class{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.retrieveMetadata(e).next(t=>{let r=new ua(t.highestTargetId);return t.highestTargetId=r.next(),this.saveMetadata(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.retrieveMetadata(e).next(t=>K.fromTimestamp(new xe(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.retrieveMetadata(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.retrieveMetadata(e).next(i=>(i.highestListenSequenceNumber=t,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.saveMetadata(e,i)))}addTargetData(e,t){return this.saveTargetData(e,t).next(()=>this.retrieveMetadata(e).next(r=>(r.targetCount+=1,this.updateMetadataFromTargetData(t,r),this.saveMetadata(e,r))))}updateTargetData(e,t){return this.saveTargetData(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Ho(e).delete(t.targetId)).next(()=>this.retrieveMetadata(e)).next(r=>(j(r.targetCount>0),r.targetCount-=1,this.saveMetadata(e,r)))}removeTargets(e,t,r){let i=0,s=[];return Ho(e).iterate((o,a)=>{let l=Yl(a);l.sequenceNumber<=t&&r.get(l.targetId)===null&&(i++,s.push(this.removeTargetData(e,l)))}).next(()=>m.waitFor(s)).next(()=>i)}forEachTarget(e,t){return Ho(e).iterate((r,i)=>{let s=Yl(i);t(s)})}retrieveMetadata(e){return GD(e).get(Qh).next(t=>(j(t!==null),t))}saveMetadata(e,t){return GD(e).put(Qh,t)}saveTargetData(e,t){return Ho(e).put(kR(this.serializer,t))}updateMetadataFromTargetData(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.retrieveMetadata(e).next(t=>t.targetCount)}getTargetData(e,t){let r=Es(t),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),s=null;return Ho(e).iterate({range:i,index:D1},(o,a,l)=>{let c=Yl(a);Mc(t,c.target)&&(s=c,l.done())}).next(()=>s)}addMatchingKeys(e,t,r){let i=[],s=yi(e);return t.forEach(o=>{let a=Ot(o.path);i.push(s.put({targetId:r,path:a})),i.push(this.referenceDelegate.addReference(e,r,o))}),m.waitFor(i)}removeMatchingKeys(e,t,r){let i=yi(e);return m.forEach(t,s=>{let o=Ot(s.path);return m.waitFor([i.delete([r,o]),this.referenceDelegate.removeReference(e,r,s)])})}removeMatchingKeysForTargetId(e,t){let r=yi(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,t){let r=IDBKeyRange.bound([t],[t+1],!1,!0),i=yi(e),s=Z();return i.iterate({range:r,keysOnly:!0},(o,a,l)=>{let c=sr(o[1]),u=new P(c);s=s.add(u)}).next(()=>s)}containsKey(e,t){let r=Ot(t.path),i=IDBKeyRange.bound([r],[v1(r)],!1,!0),s=0;return yi(e).iterate({index:u_,keysOnly:!0,range:i},([o,a],l,c)=>{o!==0&&(s++,c.done())}).next(()=>s>0)}getTargetDataForTarget(e,t){return Ho(e).get(t).next(r=>r?Yl(r):null)}};function Ho(n){return at(n,_a)}function GD(n){return at(n,ks)}function yi(n){return at(n,Ea)}var HD={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Fc=-1,LR=40*1024*1024,fn=class n{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};fn.DEFAULT_COLLECTION_PERCENTILE=10;fn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3;fn.DEFAULT=new fn(LR,fn.DEFAULT_COLLECTION_PERCENTILE,fn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT);fn.DISABLED=new fn(Fc,0,0);var KD="LruGarbageCollector",WD=1*1024*1024,Y6=1*60*1e3,X6=5*60*1e3;function $D([n,e],[t,r]){let i=J(n,t);return i===0?J(e,r):i}var tS=class{constructor(e){this.maxElements=e,this.buffer=new ve($D),this.previousIndex=0}nextIndex(){return++this.previousIndex}addElement(e){let t=[e,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(t);else{let r=this.buffer.last();$D(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}},nS=class{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.gcTask=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==Fc&&this.scheduleGC(Y6)}stop(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)}get started(){return this.gcTask!==null}scheduleGC(e){R(KD,`Garbage collection scheduled in ${e}ms`),this.gcTask=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>g(this,null,function*(){this.gcTask=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){Oi(t)?R(KD,"Ignoring IndexedDB error during garbage collection: ",t):yield Mi(t)}yield this.scheduleGC(X6)}))}},rS=class{constructor(e,t){this.delegate=e,this.params=t}calculateTargetCount(e,t){return this.delegate.getSequenceNumberCount(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return m.resolve(Xt.INVALID);let r=new tS(t);return this.delegate.forEachTarget(e,i=>r.addElement(i.sequenceNumber)).next(()=>this.delegate.forEachOrphanedDocumentSequenceNumber(e,i=>r.addElement(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.delegate.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.delegate.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===Fc?(R("LruGarbageCollector","Garbage collection skipped; disabled"),m.resolve(HD)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(R("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),HD):this.runGarbageCollection(e,t))}getCacheSize(e){return this.delegate.getCacheSize(e)}runGarbageCollection(e,t){let r,i,s,o,a,l,c,u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(d=>(d>this.params.maximumSequenceNumbersToCollect?(R("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${d}`),i=this.params.maximumSequenceNumbersToCollect):i=d,o=Date.now(),this.nthSequenceNumber(e,i))).next(d=>(r=d,a=Date.now(),this.removeTargets(e,r,t))).next(d=>(s=d,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(d=>{if(c=Date.now(),Ko()<=Bn.DEBUG){let h=`LRU Garbage Collection
	Counted targets in ${o-u}ms
	Determined least recently used ${i} in ${a-o}ms
	Removed ${s} targets in ${l-a}ms
	Removed ${d} documents in ${c-l}ms
Total Duration: ${c-u}ms`;R("LruGarbageCollector",h)}return m.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:d})})}};function J6(n,e){return new rS(n,e)}var iS=class{constructor(e,t){this.db=e,this.garbageCollector=J6(this,t)}getSequenceNumberCount(e){let t=this.orphanedDocumentCount(e);return this.db.getTargetCache().getTargetCount(e).next(i=>t.next(s=>i+s))}orphanedDocumentCount(e){let t=0;return this.forEachOrphanedDocumentSequenceNumber(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}forEachOrphanedDocumentSequenceNumber(e,t){return this.forEachOrphanedDocument(e,(r,i)=>t(i))}addReference(e,t,r){return Ph(e,r)}removeReference(e,t,r){return Ph(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return Ph(e,t)}isPinned(e,t){return Q6(e,t)}removeOrphanedDocuments(e,t){let i=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[],o=0;return this.forEachOrphanedDocument(e,(l,c)=>{if(c<=t){let u=this.isPinned(e,l).next(d=>{if(!d)return o++,i.getEntry(e,l).next(()=>(i.removeEntry(l,K.min()),yi(e).delete(Z6(l))))});s.push(u)}}).next(()=>m.waitFor(s)).next(()=>i.apply(e)).next(()=>o)}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return Ph(e,t)}forEachOrphanedDocument(e,t){let r=yi(e),i=Xt.INVALID,s;return r.iterate({index:u_},([o,a],{path:l,sequenceNumber:c})=>{o===0?(i!==Xt.INVALID&&t(new P(sr(s)),i),i=c,s=l):i=Xt.INVALID}).next(()=>{i!==Xt.INVALID&&t(new P(sr(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}};function Z6(n){return[0,Ot(n.path)]}function ez(n,e){return{targetId:0,path:Ot(n.path),sequenceNumber:e}}function Ph(n,e){return yi(n).put(ez(e,n.currentSequenceNumber))}var df=class{constructor(){this.changes=new ur(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Ye.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?m.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var sS=class{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return os(e).put(r)}removeEntry(e,t,r){return os(e).delete(tz(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.setMetadata(e,r)))}getEntry(e,t){let r=Ye.newInvalidDocument(t);return os(e).iterate({index:Vh,range:IDBKeyRange.only(Wl(t))},(i,s)=>{r=this.maybeDecodeDocument(t,s)}).next(()=>r)}getSizedEntry(e,t){let r={size:0,document:Ye.newInvalidDocument(t)};return os(e).iterate({index:Vh,range:IDBKeyRange.only(Wl(t))},(i,s)=>{r={document:this.maybeDecodeDocument(t,s),size:cf(s)}}).next(()=>r)}getEntries(e,t){let r=Gt();return this.forEachDbEntry(e,t,(i,s)=>{let o=this.maybeDecodeDocument(i,s);r=r.insert(i,o)}).next(()=>r)}getSizedEntries(e,t){let r=Gt(),i=new be(P.comparator);return this.forEachDbEntry(e,t,(s,o)=>{let a=this.maybeDecodeDocument(s,o);r=r.insert(s,a),i=i.insert(s,cf(o))}).next(()=>({documents:r,sizeMap:i}))}forEachDbEntry(e,t,r){if(t.isEmpty())return m.resolve();let i=new ve(XD);t.forEach(l=>i=i.add(l));let s=IDBKeyRange.bound(Wl(i.first()),Wl(i.last())),o=i.getIterator(),a=o.getNext();return os(e).iterate({index:Vh,range:s},(l,c,u)=>{let d=P.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&XD(a,d)<0;)r(a,null),a=o.getNext();a&&a.isEqual(d)&&(r(a,c),a=o.hasNext()?o.getNext():null),a?u.skip(Wl(a)):u.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,i,s){let o=t.path,a=[o.popLast().toArray(),o.lastSegment(),Gf(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],l=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return os(e).loadAll(IDBKeyRange.bound(a,l,!0)).next(c=>{s?.incrementDocumentReadCount(c.length);let u=Gt();for(let d of c){let h=this.maybeDecodeDocument(P.fromSegments(d.prefixPath.concat(d.collectionGroup,d.documentId)),d);h.isFoundDocument()&&(Pc(t,h)||i.has(h.key))&&(u=u.insert(h.key,h))}return u})}getAllFromCollectionGroup(e,t,r,i){let s=Gt(),o=YD(t,r),a=YD(t,gn.max());return os(e).iterate({index:I1,range:IDBKeyRange.bound(o,a,!0)},(l,c,u)=>{let d=this.maybeDecodeDocument(P.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);s=s.insert(d.key,d),s.size===i&&u.done()}).next(()=>s)}newChangeBuffer(e){return new oS(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return QD(e).get(E0).next(t=>(j(!!t),t))}setMetadata(e,t){return QD(e).put(E0,t)}maybeDecodeDocument(e,t){if(t){let r=p6(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(K.min())))return r}return Ye.newInvalidDocument(e)}};function BR(n){return new sS(n)}var oS=class extends df{constructor(e,t){super(),this.documentCache=e,this.trackRemovals=t,this.documentStates=new ur(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){let t=[],r=0,i=new ve((s,o)=>J(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{let a=this.documentStates.get(s);if(t.push(this.documentCache.removeEntry(e,s,a.readTime)),o.isValidDocument()){let l=ID(this.documentCache.serializer,o);i=i.add(s.path.popLast());let c=cf(l);r+=c-a.size,t.push(this.documentCache.addEntry(e,s,l))}else if(r-=a.size,this.trackRemovals){let l=ID(this.documentCache.serializer,o.convertToNoDocument(K.min()));t.push(this.documentCache.addEntry(e,s,l))}}),i.forEach(s=>{t.push(this.documentCache.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.documentCache.updateMetadata(e,r)),m.waitFor(t)}getFromCache(e,t){return this.documentCache.getSizedEntry(e,t).next(r=>(this.documentStates.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.documentCache.getSizedEntries(e,t).next(({documents:r,sizeMap:i})=>(i.forEach((s,o)=>{this.documentStates.set(s,{size:o,readTime:r.get(s).readTime})}),r))}};function QD(n){return at(n,Nc)}function os(n){return at(n,Lf)}function Wl(n){let e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function tz(n,e){let t=n.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],Gf(e),t[t.length-1]]}function YD(n,e){let t=e.documentKey.path.toArray();return[n,Gf(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function XD(n,e){let t=n.path.toArray(),r=e.path.toArray(),i=0;for(let s=0;s<t.length-2&&s<r.length-2;++s)if(i=J(t[s],r[s]),i)return i;return i=J(t.length,r.length),i||(i=J(t[t.length-2],r[r.length-2]),i)?i:J(t[t.length-1],r[r.length-1])}var nz=15;var aS=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var hf=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&ec(r.mutation,i,Jt.empty(),xe.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,Z()).next(()=>r))}getLocalViewOfDocuments(e,t,r=Z()){let i=or();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let o=Ql();return s.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){let r=or();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,Z()))}populateOverlays(e,t,r){let i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,i){let s=Gt(),o=uc(),a=$3();return t.forEach((l,c)=>{let u=r.get(c.key);i.has(c.key)&&(u===void 0||u.mutation instanceof xn)?s=s.insert(c.key,c):u!==void 0?(o.set(c.key,u.mutation.getFieldMask()),ec(u.mutation,c,u.mutation.getFieldMask(),xe.now())):o.set(c.key,Jt.empty())}),this.recalculateAndSaveOverlays(e,s).next(l=>(l.forEach((c,u)=>o.set(c,u)),t.forEach((c,u)=>{var d;return a.set(c,new aS(u,(d=o.get(c))!==null&&d!==void 0?d:null))}),a))}recalculateAndSaveOverlays(e,t){let r=uc(),i=new be((o,a)=>o-a),s=Z();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(let a of o)a.keys().forEach(l=>{let c=t.get(l);if(c===null)return;let u=r.get(l)||Jt.empty();u=a.applyToLocalView(c,u),r.set(l,u);let d=(i.get(a.batchId)||Z()).add(l);i=i.insert(a.batchId,d)})}).next(()=>{let o=[],a=i.getReverseIterator();for(;a.hasNext();){let l=a.getNext(),c=l.key,u=l.value,d=sR();u.forEach(h=>{if(!s.has(h)){let p=fR(t.get(h),r.get(h));p!==null&&d.set(h,p),s=s.add(h)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,d))}return m.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return L3(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):y_(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{let o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):m.resolve(or()),a=ta,l=s;return o.next(c=>m.forEach(c,(u,d)=>(a<d.largestBatchId&&(a=d.largestBatchId),s.get(u)?m.resolve():this.remoteDocumentCache.getEntry(e,u).next(h=>{l=l.insert(u,h)}))).next(()=>this.populateOverlays(e,c,s)).next(()=>this.computeViews(e,l,c,Z())).next(u=>({batchId:a,changes:iR(u)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new P(t)).next(r=>{let i=Ql();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let s=t.collectionGroup,o=Ql();return this.indexManager.getCollectionParents(e,s).next(a=>m.forEach(a,l=>{let c=O3(t,l.child(s));return this.getDocumentsMatchingCollectionQuery(e,c,r,i).next(u=>{u.forEach((d,h)=>{o=o.insert(d,h)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(o=>{s.forEach((l,c)=>{let u=c.getKey();o.get(u)===null&&(o=o.insert(u,Ye.newInvalidDocument(u)))});let a=Ql();return o.forEach((l,c)=>{let u=s.get(l);u!==void 0&&ec(u.mutation,c,Jt.empty(),xe.now()),Pc(t,c)&&(a=a.insert(l,c))}),a})}};var lS=class{constructor(e){this.serializer=e,this.bundles=new Map,this.namedQueries=new Map}getBundleMetadata(e,t){return m.resolve(this.bundles.get(t))}saveBundleMetadata(e,t){return this.bundles.set(t.id,T6(t)),m.resolve()}getNamedQuery(e,t){return m.resolve(this.namedQueries.get(t))}saveNamedQuery(e,t){return this.namedQueries.set(t.name,w6(t)),m.resolve()}};var cS=class{constructor(){this.overlays=new be(P.comparator),this.overlayByBatchId=new Map}getOverlay(e,t){return m.resolve(this.overlays.get(t))}getOverlays(e,t){let r=or();return m.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.saveOverlay(e,t,s)}),m.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.overlayByBatchId.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.overlayByBatchId.delete(r)),m.resolve()}getOverlaysForCollection(e,t,r){let i=or(),s=t.length+1,o=new P(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){let c=a.getNext().value,u=c.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===s&&c.largestBatchId>r&&i.set(c.getKey(),c)}return m.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new be((c,u)=>c-u),o=this.overlays.getIterator();for(;o.hasNext();){let u=o.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>r){let h=s.get(u.largestBatchId);h===null&&(h=or(),s=s.insert(u.largestBatchId,h)),h.set(u.getKey(),u)}}let a=or(),l=s.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((d,h)=>a.set(d,h)),!(a.size()>=i)););return m.resolve(a)}saveOverlay(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let o=this.overlayByBatchId.get(i.largestBatchId).delete(r.key);this.overlayByBatchId.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new fc(t,r));let s=this.overlayByBatchId.get(t);s===void 0&&(s=Z(),this.overlayByBatchId.set(t,s)),this.overlayByBatchId.set(t,s.add(r.key))}};var _c=class{constructor(){this.refsByKey=new ve(Qe.compareByKey),this.refsByTarget=new ve(Qe.compareByTargetId)}isEmpty(){return this.refsByKey.isEmpty()}addReference(e,t){let r=new Qe(e,t);this.refsByKey=this.refsByKey.add(r),this.refsByTarget=this.refsByTarget.add(r)}addReferences(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.removeRef(new Qe(e,t))}removeReferences(e,t){e.forEach(r=>this.removeReference(r,t))}removeReferencesForId(e){let t=new P(new de([])),r=new Qe(t,e),i=new Qe(t,e+1),s=[];return this.refsByTarget.forEachInRange([r,i],o=>{this.removeRef(o),s.push(o.key)}),s}removeAllReferences(){this.refsByKey.forEach(e=>this.removeRef(e))}removeRef(e){this.refsByKey=this.refsByKey.delete(e),this.refsByTarget=this.refsByTarget.delete(e)}referencesForId(e){let t=new P(new de([])),r=new Qe(t,e),i=new Qe(t,e+1),s=Z();return this.refsByTarget.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){let t=new Qe(e,0),r=this.refsByKey.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},Qe=class{constructor(e,t){this.key=e,this.targetOrBatchId=t}static compareByKey(e,t){return P.comparator(e.key,t.key)||J(e.targetOrBatchId,t.targetOrBatchId)}static compareByTargetId(e,t){return J(e.targetOrBatchId,t.targetOrBatchId)||P.comparator(e.key,t.key)}};var uS=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.nextBatchId=1,this.batchesByDocumentKey=new ve(Qe.compareByKey)}checkEmpty(e){return m.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let s=this.nextBatchId;this.nextBatchId++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new hc(s,t,r,i);this.mutationQueue.push(o);for(let a of i)this.batchesByDocumentKey=this.batchesByDocumentKey.add(new Qe(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return m.resolve(o)}lookupMutationBatch(e,t){return m.resolve(this.findMutationBatch(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.indexOfBatchId(r),s=i<0?0:i;return m.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return m.resolve(this.mutationQueue.length===0?_i:this.nextBatchId-1)}getAllMutationBatches(e){return m.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new Qe(t,0),i=new Qe(t,Number.POSITIVE_INFINITY),s=[];return this.batchesByDocumentKey.forEachInRange([r,i],o=>{let a=this.findMutationBatch(o.targetOrBatchId);s.push(a)}),m.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new ve(J);return t.forEach(i=>{let s=new Qe(i,0),o=new Qe(i,Number.POSITIVE_INFINITY);this.batchesByDocumentKey.forEachInRange([s,o],a=>{r=r.add(a.targetOrBatchId)})}),m.resolve(this.findMutationBatches(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=r;P.isDocumentKey(s)||(s=s.child(""));let o=new Qe(new P(s),0),a=new ve(J);return this.batchesByDocumentKey.forEachWhile(l=>{let c=l.key.path;return r.isPrefixOf(c)?(c.length===i&&(a=a.add(l.targetOrBatchId)),!0):!1},o),m.resolve(this.findMutationBatches(a))}findMutationBatches(e){let t=[];return e.forEach(r=>{let i=this.findMutationBatch(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){let r=this.indexOfExistingBatchId(t.batchId,"removed");j(r===0),this.mutationQueue.shift();let i=this.batchesByDocumentKey;return m.forEach(t.mutations,s=>{let o=new Qe(s.key,t.batchId);return i=i.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.batchesByDocumentKey=i})}removeCachedMutationKeys(e){}containsKey(e,t){let r=new Qe(t,0),i=this.batchesByDocumentKey.firstAfterOrEqual(r);return m.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,m.resolve()}indexOfExistingBatchId(e,t){return this.indexOfBatchId(e)}indexOfBatchId(e){if(this.mutationQueue.length===0)return 0;let t=this.mutationQueue[0].batchId;return e-t}findMutationBatch(e){let t=this.indexOfBatchId(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};function rz(){return new be(P.comparator)}var dS=class{constructor(e){this.sizer=e,this.docs=rz(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.sizer(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return m.resolve(r?r.document.mutableCopy():Ye.newInvalidDocument(t))}getEntries(e,t){let r=Gt();return t.forEach(i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():Ye.newInvalidDocument(i))}),m.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=Gt(),o=t.path,a=new P(o.child("")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){let{key:c,value:{document:u}}=l.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||l_(_1(u),r)<=0||!i.has(u.key)&&!Pc(t,u)||(s=s.insert(u.key,u.mutableCopy()))}return m.resolve(s)}getAllFromCollectionGroup(e,t,r,i){V()}forEachDocumentKey(e,t){return m.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new hS(this)}getSize(e){return m.resolve(this.size)}};function iz(n){return new dS(n)}var hS=class extends df{constructor(e){super(),this.documentCache=e}applyChanges(e){let t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.documentCache.addEntry(e,i)):this.documentCache.removeEntry(r)}),m.waitFor(t)}getFromCache(e,t){return this.documentCache.getEntry(e,t)}getAllFromCache(e,t){return this.documentCache.getEntries(e,t)}};var fS=class{constructor(e){this.persistence=e,this.targets=new ur(t=>Es(t),Mc),this.lastRemoteSnapshotVersion=K.min(),this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new _c,this.targetCount=0,this.targetIdGenerator=ua.forTargetCache()}forEachTarget(e,t){return this.targets.forEach((r,i)=>t(i)),m.resolve()}getLastRemoteSnapshotVersion(e){return m.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return m.resolve(this.highestSequenceNumber)}allocateTargetId(e){return this.highestTargetId=this.targetIdGenerator.next(),m.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.highestSequenceNumber&&(this.highestSequenceNumber=t),m.resolve()}saveTargetData(e){this.targets.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.targetIdGenerator=new ua(t),this.highestTargetId=t),e.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=e.sequenceNumber)}addTargetData(e,t){return this.saveTargetData(t),this.targetCount+=1,m.resolve()}updateTargetData(e,t){return this.saveTargetData(t),m.resolve()}removeTargetData(e,t){return this.targets.delete(t.target),this.references.removeReferencesForId(t.targetId),this.targetCount-=1,m.resolve()}removeTargets(e,t,r){let i=0,s=[];return this.targets.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.targets.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),m.waitFor(s).next(()=>i)}getTargetCount(e){return m.resolve(this.targetCount)}getTargetData(e,t){let r=this.targets.get(t)||null;return m.resolve(r)}addMatchingKeys(e,t,r){return this.references.addReferences(t,r),m.resolve()}removeMatchingKeys(e,t,r){this.references.removeReferences(t,r);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),m.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.references.removeReferencesForId(t),m.resolve()}getMatchingKeysForTargetId(e,t){let r=this.references.referencesForId(t);return m.resolve(r)}containsKey(e,t){return m.resolve(this.references.containsKey(t))}};var sz="MemoryPersistence",ff=class{constructor(e,t){this.mutationQueues={},this.overlays={},this.listenSequence=new Xt(0),this._started=!1,this._started=!0,this.referenceDelegate=e(this),this.targetCache=new fS(this);let r=i=>this.referenceDelegate.documentSize(i);this.indexManager=new J0,this.remoteDocumentCache=iz(r),this.serializer=new sf(t),this.bundleCache=new lS(this.serializer)}start(){return Promise.resolve()}shutdown(){return this._started=!1,Promise.resolve()}get started(){return this._started}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new cS,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.mutationQueues[e.toKey()];return r||(r=new uS(t,this.referenceDelegate),this.mutationQueues[e.toKey()]=r),r}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.bundleCache}runTransaction(e,t,r){R(sz,"Starting transaction:",e);let i=new pS(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),r(i).next(s=>this.referenceDelegate.onTransactionCommitted(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}mutationQueuesContainKey(e,t){return m.or(Object.values(this.mutationQueues).map(r=>()=>r.containsKey(e,t)))}},pS=class extends Wh{constructor(e){super(),this.currentSequenceNumber=e}},pf=class n{constructor(e){this.persistence=e,this.localViewReferences=new _c,this._orphanedDocuments=null}static factory(e){return new n(e)}get orphanedDocuments(){if(this._orphanedDocuments)return this._orphanedDocuments;throw V()}addReference(e,t,r){return this.localViewReferences.addReference(r,t),this.orphanedDocuments.delete(r.toString()),m.resolve()}removeReference(e,t,r){return this.localViewReferences.removeReference(r,t),this.orphanedDocuments.add(r.toString()),m.resolve()}markPotentiallyOrphaned(e,t){return this.orphanedDocuments.add(t.toString()),m.resolve()}removeTarget(e,t){this.localViewReferences.removeReferencesForId(t.targetId).forEach(s=>this.orphanedDocuments.add(s.toString()));let i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(o=>this.orphanedDocuments.add(o.toString()))}).next(()=>i.removeTargetData(e,t))}onTransactionStarted(){this._orphanedDocuments=new Set}onTransactionCommitted(e){let r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return m.forEach(this.orphanedDocuments,i=>{let s=P.fromPath(i);return this.isReferenced(e,s).next(o=>{o||r.removeEntry(s,K.min())})}).next(()=>(this._orphanedDocuments=null,r.apply(e)))}updateLimboDocument(e,t){return this.isReferenced(e,t).next(r=>{r?this.orphanedDocuments.delete(t.toString()):this.orphanedDocuments.add(t.toString())})}documentSize(e){return 0}isReferenced(e,t){return m.or([()=>m.resolve(this.localViewReferences.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.mutationQueuesContainKey(e,t)])}};var gS=class{constructor(e){this.serializer=e}createOrUpgrade(e,t,r,i){let s=new $h("createOrUpgrade",t);r<1&&i>=1&&(az(e),lz(e),JD(e),uz(e));let o=m.resolve();return r<3&&i>=3&&(r!==0&&(fz(e),JD(e)),o=o.next(()=>gz(s))),r<4&&i>=4&&(r!==0&&(o=o.next(()=>cz(e,s))),o=o.next(()=>{mz(e)})),r<5&&i>=5&&(o=o.next(()=>this.removeAcknowledgedMutations(s))),r<6&&i>=6&&(o=o.next(()=>(hz(e),this.addDocumentGlobal(s)))),r<7&&i>=7&&(o=o.next(()=>this.ensureSequenceNumbers(s))),r<8&&i>=8&&(o=o.next(()=>this.createCollectionParentIndex(e,s))),r<9&&i>=9&&(o=o.next(()=>{pz(e)})),r<10&&i>=10&&(o=o.next(()=>this.rewriteCanonicalIds(s))),r<11&&i>=11&&(o=o.next(()=>{yz(e),vz(e)})),r<12&&i>=12&&(o=o.next(()=>{_z(e)})),r<13&&i>=13&&(o=o.next(()=>dz(e)).next(()=>this.rewriteRemoteDocumentCache(e,s)).next(()=>e.deleteObjectStore(ls))),r<14&&i>=14&&(o=o.next(()=>this.runOverlayMigration(e,s))),r<15&&i>=15&&(o=o.next(()=>Sz(e))),o}addDocumentGlobal(e){let t=0;return e.store(ls).iterate((r,i)=>{t+=cf(i)}).next(()=>{let r={byteSize:t};return e.store(Nc).put(E0,r)})}removeAcknowledgedMutations(e){let t=e.store(kc),r=e.store(Rn);return t.loadAll().next(i=>m.forEach(i,s=>{let o=IDBKeyRange.bound([s.userId,_i],[s.userId,s.lastAcknowledgedBatchId]);return r.loadAll(hs,o).next(a=>m.forEach(a,l=>{j(l.userId===s.userId);let c=cs(this.serializer,l);return OR(e,s.userId,c).next(()=>{})}))}))}ensureSequenceNumbers(e){let t=e.store(Ea),r=e.store(ls);return e.store(ks).get(Qh).next(s=>{let o=l=>t.put({targetId:0,path:Ot(l),sequenceNumber:s.highestListenSequenceNumber}),a=[];return r.iterate((l,c)=>{let u=new de(l),d=oz(u);a.push(t.get(d).next(h=>h?m.resolve():o(u)))}).next(()=>m.waitFor(a))})}createCollectionParentIndex(e,t){e.createObjectStore(ic,{keyPath:EU});let r=t.store(ic),i=new Sc,s=o=>{if(i.add(o)){let a=o.lastSegment(),l=o.popLast();return r.put({collectionId:a,parent:Ot(l)})}};return t.store(ls).iterate({keysOnly:!0},(o,a)=>{let l=new de(o);return s(l.popLast())}).next(()=>t.store(Sa).iterate({keysOnly:!0},([o,a,l],c)=>{let u=sr(a);return s(u.popLast())}))}rewriteCanonicalIds(e){let t=e.store(_a);return t.iterate((r,i)=>{let s=Yl(i),o=kR(this.serializer,s);return t.put(o)})}rewriteRemoteDocumentCache(e,t){let r=t.store(ls),i=[];return r.iterate((s,o)=>{let a=t.store(Lf),l=Ez(o).path.toArray(),c={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};i.push(a.put(c))}).next(()=>m.waitFor(i))}runOverlayMigration(e,t){let r=t.store(Rn),i=BR(this.serializer),s=new ff(pf.factory,this.serializer.remoteSerializer);return r.loadAll().next(o=>{let a=new Map;return o.forEach(l=>{var c;let u=(c=a.get(l.userId))!==null&&c!==void 0?c:Z();cs(this.serializer,l).keys().forEach(h=>u=u.add(h)),a.set(l.userId,u)}),m.forEach(a,(l,c)=>{let u=new Xe(c),d=of.forUser(this.serializer,u),h=s.getIndexManager(u),p=uf.forUser(u,this.serializer,h,s.referenceDelegate);return new hf(i,p,d,h).recalculateAndSaveOverlaysForDocumentKeys(new sc(t,Xt.INVALID),l).next()})})}};function oz(n){return[0,Ot(n)]}function az(n){n.createObjectStore(Rc)}function lz(n){n.createObjectStore(kc,{keyPath:dU}),n.createObjectStore(Rn,{keyPath:C1,autoIncrement:!0}).createIndex(hs,b1,{unique:!0}),n.createObjectStore(Sa)}function cz(n,e){return e.store(Rn).loadAll().next(r=>{n.deleteObjectStore(Rn),n.createObjectStore(Rn,{keyPath:C1,autoIncrement:!0}).createIndex(hs,b1,{unique:!0});let s=e.store(Rn),o=r.map(a=>s.put(a));return m.waitFor(o)})}function uz(n){n.createObjectStore(ls)}function dz(n){let e=n.createObjectStore(Lf,{keyPath:pU});e.createIndex(Vh,gU),e.createIndex(I1,mU)}function hz(n){n.createObjectStore(Nc)}function JD(n){n.createObjectStore(Ea,{keyPath:SU}).createIndex(u_,_U,{unique:!0}),n.createObjectStore(_a,{keyPath:yU}).createIndex(D1,vU,{unique:!0}),n.createObjectStore(ks)}function fz(n){n.deleteObjectStore(Ea),n.deleteObjectStore(_a),n.deleteObjectStore(ks)}function pz(n){n.objectStoreNames.contains("remoteDocumentChanges")&&n.deleteObjectStore("remoteDocumentChanges")}function gz(n){let e=n.store(ks),t={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:K.min().toTimestamp(),targetCount:0};return e.put(Qh,t)}function mz(n){n.createObjectStore(na,{keyPath:wU})}function yz(n){n.createObjectStore(Bf,{keyPath:TU})}function vz(n){n.createObjectStore(Vf,{keyPath:CU})}function Sz(n){n.createObjectStore(d_,{keyPath:bU,autoIncrement:!0}).createIndex(w0,AU,{unique:!1}),n.createObjectStore(h_,{keyPath:IU}).createIndex(R1,DU,{unique:!1}),n.createObjectStore(f_,{keyPath:RU}).createIndex(k1,kU,{unique:!1})}function _z(n){let e=n.createObjectStore(qf,{keyPath:NU});e.createIndex(T0,xU,{unique:!1}),e.createIndex(N1,MU,{unique:!1})}function Ez(n){return n.document?new P(de.fromString(n.document.name).popFirst(5)):n.noDocument?P.fromSegments(n.noDocument.path):n.unknownDocument?P.fromSegments(n.unknownDocument.path):V()}var mi="IndexedDbPersistence",n0=30*60*1e3,r0=5e3,wz=4e3,i0="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Tz="This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.",Cz="firestore_zombie",VR="main",mS=class n{constructor(e,t,r,i,s,o,a,l,c,u,d=nz){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.queue=s,this.window=o,this.document=a,this.sequenceNumberSyncer=c,this.forceOwningTab=u,this.schemaVersion=d,this.listenSequence=null,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.windowUnloadHandler=null,this.inForeground=!1,this.documentVisibilityHandler=null,this.clientMetadataRefresher=null,this.lastGarbageCollectionTime=Number.NEGATIVE_INFINITY,this.primaryStateListener=h=>Promise.resolve(),!n.isAvailable())throw new T(v.UNIMPLEMENTED,Tz);this.referenceDelegate=new iS(this,i),this.dbName=t+VR,this.serializer=new sf(l),this.simpleDb=new wi(this.dbName,this.schemaVersion,new gS(this.serializer)),this.targetCache=new eS(this.referenceDelegate,this.serializer),this.remoteDocumentCache=BR(this.serializer),this.bundleCache=new W0,this.window&&this.window.localStorage?this.webStorage=this.window.localStorage:(this.webStorage=null,u===!1&&Ne(mi,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.updateClientMetadataAndTryBecomePrimary().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new T(v.FAILED_PRECONDITION,i0);return this.attachVisibilityHandler(),this.attachWindowUnloadHook(),this.scheduleClientMetadataAndPrimaryLeaseRefreshes(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.targetCache.getHighestSequenceNumber(e))}).then(e=>{this.listenSequence=new Xt(e,this.sequenceNumberSyncer)}).then(()=>{this._started=!0}).catch(e=>(this.simpleDb&&this.simpleDb.close(),Promise.reject(e)))}setPrimaryStateListener(e){return this.primaryStateListener=t=>g(this,null,function*(){if(this.started)return e(t)}),e(this.isPrimary)}setDatabaseDeletedListener(e){this.simpleDb.setVersionChangeListener(t=>g(this,null,function*(){t.newVersion===null&&(yield e())}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.queue.enqueueAndForget(()=>g(this,null,function*(){this.started&&(yield this.updateClientMetadataAndTryBecomePrimary())})))}updateClientMetadataAndTryBecomePrimary(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Fh(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.verifyPrimaryLease(e).next(r=>{r||(this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)))})}).next(()=>this.canActAsPrimary(e)).next(r=>this.isPrimary&&!r?this.releasePrimaryLeaseIfHeld(e).next(()=>!1):r?this.acquireOrExtendPrimaryLease(e).next(()=>!0):!1)).catch(e=>{if(Oi(e))return R(mi,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return R(mi,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.queue.enqueueRetryable(()=>this.primaryStateListener(e)),this.isPrimary=e})}verifyPrimaryLease(e){return $l(e).get(Vo).next(r=>m.resolve(this.isLocalClient(r)))}removeClientMetadata(e){return Fh(e).delete(this.clientId)}maybeGarbageCollectMultiClientState(){return g(this,null,function*(){if(this.isPrimary&&!this.isWithinAge(this.lastGarbageCollectionTime,n0)){this.lastGarbageCollectionTime=Date.now();let e=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{let r=at(t,na);return r.loadAll().next(i=>{let s=this.filterActiveClients(i,n0),o=i.filter(a=>s.indexOf(a)===-1);return m.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.webStorage)for(let t of e)this.webStorage.removeItem(this.zombiedClientLocalStorageKey(t.clientId))}})}scheduleClientMetadataAndPrimaryLeaseRefreshes(){this.clientMetadataRefresher=this.queue.enqueueAfterDelay("client_metadata_refresh",wz,()=>this.updateClientMetadataAndTryBecomePrimary().then(()=>this.maybeGarbageCollectMultiClientState()).then(()=>this.scheduleClientMetadataAndPrimaryLeaseRefreshes()))}isLocalClient(e){return e?e.ownerId===this.clientId:!1}canActAsPrimary(e){return this.forceOwningTab?m.resolve(!0):$l(e).get(Vo).next(r=>{if(r!==null&&this.isWithinAge(r.leaseTimestampMs,r0)&&!this.isClientZombied(r.ownerId)){if(this.isLocalClient(r)&&this.networkEnabled)return!0;if(!this.isLocalClient(r)){if(!r.allowTabSynchronization)throw new T(v.FAILED_PRECONDITION,i0);return!1}}return this.networkEnabled&&this.inForeground?!0:Fh(e).loadAll().next(s=>this.filterActiveClients(s,r0).find(a=>{if(this.clientId!==a.clientId){let l=!this.networkEnabled&&a.networkEnabled,c=!this.inForeground&&a.inForeground,u=this.networkEnabled===a.networkEnabled;if(l||c&&u)return!0}return!1})===void 0)}).next(r=>(this.isPrimary!==r&&R(mi,`Client ${r?"is":"is not"} eligible for a primary lease.`),r))}shutdown(){return g(this,null,function*(){this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&(this.clientMetadataRefresher.cancel(),this.clientMetadataRefresher=null),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),yield this.simpleDb.runTransaction("shutdown","readwrite",[Rc,na],e=>{let t=new sc(e,Xt.INVALID);return this.releasePrimaryLeaseIfHeld(t).next(()=>this.removeClientMetadata(t))}),this.simpleDb.close(),this.removeClientZombiedEntry()})}filterActiveClients(e,t){return e.filter(r=>this.isWithinAge(r.updateTimeMs,t)&&!this.isClientZombied(r.clientId))}getActiveClients(){return this.runTransaction("getActiveClients","readonly",e=>Fh(e).loadAll().next(t=>this.filterActiveClients(t,n0).map(r=>r.clientId)))}get started(){return this._started}getMutationQueue(e,t){return uf.forUser(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new Z0(e,this.serializer.remoteSerializer.databaseId)}getDocumentOverlayCache(e){return of.forUser(this.serializer,e)}getBundleCache(){return this.bundleCache}runTransaction(e,t,r){R(mi,"Starting transaction:",e);let i=t==="readonly"?"readonly":"readwrite",s=UU(this.schemaVersion),o;return this.simpleDb.runTransaction(e,i,s,a=>(o=new sc(a,this.listenSequence?this.listenSequence.next():Xt.INVALID),t==="readwrite-primary"?this.verifyPrimaryLease(o).next(l=>l?!0:this.canActAsPrimary(o)).next(l=>{if(!l)throw Ne(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)),new T(v.FAILED_PRECONDITION,E1);return r(o)}).next(l=>this.acquireOrExtendPrimaryLease(o).next(()=>l)):this.verifyAllowTabSynchronization(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}verifyAllowTabSynchronization(e){return $l(e).get(Vo).next(r=>{if(r!==null&&this.isWithinAge(r.leaseTimestampMs,r0)&&!this.isClientZombied(r.ownerId)&&!this.isLocalClient(r)&&!this.forceOwningTab&&(!this.allowTabSynchronization||!r.allowTabSynchronization))throw new T(v.FAILED_PRECONDITION,i0)})}acquireOrExtendPrimaryLease(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return $l(e).put(Vo,t)}static isAvailable(){return wi.isAvailable()}releasePrimaryLeaseIfHeld(e){let t=$l(e);return t.get(Vo).next(r=>this.isLocalClient(r)?(R(mi,"Releasing primary lease."),t.delete(Vo)):m.resolve())}isWithinAge(e,t){let r=Date.now(),i=r-t,s=r;return e<i?!1:e>s?(Ne(`Detected an update time that is in the future: ${e} > ${s}`),!1):!0}attachVisibilityHandler(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.documentVisibilityHandler=()=>{this.queue.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.updateClientMetadataAndTryBecomePrimary()))},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground=this.document.visibilityState==="visible")}detachVisibilityHandler(){this.documentVisibilityHandler&&(this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)}attachWindowUnloadHook(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.windowUnloadHandler=()=>{this.markClientZombied();let t=/(?:Version|Mobile)\/1[456]/;KE()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.queue.enterRestrictedMode(!0),this.queue.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.windowUnloadHandler))}detachWindowUnloadHook(){this.windowUnloadHandler&&(this.window.removeEventListener("pagehide",this.windowUnloadHandler),this.windowUnloadHandler=null)}isClientZombied(e){var t;try{let r=((t=this.webStorage)===null||t===void 0?void 0:t.getItem(this.zombiedClientLocalStorageKey(e)))!==null;return R(mi,`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return Ne(mi,"Failed to get zombied client id.",r),!1}}markClientZombied(){if(this.webStorage)try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(e){Ne("Failed to set zombie client id.",e)}}removeClientZombiedEntry(){if(this.webStorage)try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch{}}zombiedClientLocalStorageKey(e){return`${Cz}_${this.persistenceKey}_${e}`}};function $l(n){return at(n,Rc)}function Fh(n){return at(n,na)}function b_(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}function bz(n){return g(this,null,function*(){if(!wi.isAvailable())return Promise.resolve();let e=n+VR;yield wi.delete(e)})}var A_="LocalStore",Az=5*60*1e6,Ec=class{constructor(e,t,r,i){this.persistence=e,this.queryEngine=t,this.serializer=i,this.targetDataByTarget=new be(J),this.targetIdByTarget=new ur(s=>Es(s),Mc),this.collectionGroupReadTime=new Map,this.remoteDocuments=e.getRemoteDocumentCache(),this.targetCache=e.getTargetCache(),this.bundleCache=e.getBundleCache(),this.initializeUserComponents(r)}initializeUserComponents(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new hf(this.remoteDocuments,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.remoteDocuments.setIndexManager(this.indexManager),this.queryEngine.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.targetDataByTarget))}};function qR(n,e,t,r){return new Ec(n,e,t,r)}function UR(n,e){return g(this,null,function*(){let t=L(n);return yield t.persistence.runTransaction("Handle user change","readonly",i=>{let s;return t.mutationQueue.getAllMutationBatches(i).next(o=>(s=o,t.initializeUserComponents(e),t.mutationQueue.getAllMutationBatches(i))).next(o=>{let a=[],l=[],c=Z();for(let u of s){a.push(u.batchId);for(let d of u.mutations)c=c.add(d.key)}for(let u of o){l.push(u.batchId);for(let d of u.mutations)c=c.add(d.key)}return t.localDocuments.getDocuments(i,c).next(u=>({affectedDocuments:u,removedBatchIds:a,addedBatchIds:l}))})})})}function Iz(n,e){let t=L(n),r=xe.now(),i=e.reduce((a,l)=>a.add(l.key),Z()),s,o;return t.persistence.runTransaction("Locally write mutations","readwrite",a=>{let l=Gt(),c=Z();return t.remoteDocuments.getEntries(a,i).next(u=>{l=u,l.forEach((d,h)=>{h.isValidDocument()||(c=c.add(d))})}).next(()=>t.localDocuments.getOverlayedDocuments(a,l)).next(u=>{s=u;let d=[];for(let h of e){let p=o4(h,s.get(h.key).overlayedDocument);p!=null&&d.push(new xn(h.key,p,G1(p.value.mapValue),Le.exists(!0)))}return t.mutationQueue.addMutationBatch(a,r,d,e)}).next(u=>{o=u;let d=u.applyToLocalDocumentSet(s,c);return t.documentOverlayCache.saveOverlays(a,u.batchId,d)})}).then(()=>({batchId:o.batchId,changes:iR(s)}))}function Dz(n,e){let t=L(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=e.batch.keys(),s=t.remoteDocuments.newChangeBuffer({trackRemovals:!0});return Bz(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,Rz(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function Rz(n){let e=Z();for(let t=0;t<n.mutationResults.length;++t)n.mutationResults[t].transformResults.length>0&&(e=e.add(n.batch.mutations[t].key));return e}function kz(n,e){let t=L(n);return t.persistence.runTransaction("Reject batch","readwrite-primary",r=>{let i;return t.mutationQueue.lookupMutationBatch(r,e).next(s=>(j(s!==null),i=s.keys(),t.mutationQueue.removeMutationBatch(r,s))).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,i)).next(()=>t.localDocuments.getDocuments(r,i))})}function Nz(n){let e=L(n);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",t=>e.mutationQueue.getHighestUnacknowledgedBatchId(t))}function zR(n){let e=L(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.targetCache.getLastRemoteSnapshotVersion(t))}function xz(n,e){let t=L(n),r=e.snapshotVersion,i=t.targetDataByTarget;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=t.remoteDocuments.newChangeBuffer({trackRemovals:!0});i=t.targetDataByTarget;let a=[];e.targetChanges.forEach((u,d)=>{let h=i.get(d);if(!h)return;a.push(t.targetCache.removeMatchingKeys(s,u.removedDocuments,d).next(()=>t.targetCache.addMatchingKeys(s,u.addedDocuments,d)));let p=h.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(d)!==null?p=p.withResumeToken(ot.EMPTY_BYTE_STRING,K.min()).withLastLimboFreeSnapshotVersion(K.min()):u.resumeToken.approximateByteSize()>0&&(p=p.withResumeToken(u.resumeToken,r)),i=i.insert(d,p),Mz(h,p,u)&&a.push(t.targetCache.updateTargetData(s,p))});let l=Gt(),c=Z();if(e.documentUpdates.forEach(u=>{e.resolvedLimboDocuments.has(u)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(s,u))}),a.push(jR(s,o,e.documentUpdates).next(u=>{l=u.changedDocuments,c=u.existenceChangedKeys})),!r.isEqual(K.min())){let u=t.targetCache.getLastRemoteSnapshotVersion(s).next(d=>t.targetCache.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(u)}return m.waitFor(a).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,l,c)).next(()=>l)}).then(s=>(t.targetDataByTarget=i,s))}function jR(n,e,t){let r=Z(),i=Z();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let o=Gt();return t.forEach((a,l)=>{let c=s.get(a);l.isFoundDocument()!==c.isFoundDocument()&&(i=i.add(a)),l.isNoDocument()&&l.version.isEqual(K.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!c.isValidDocument()||l.version.compareTo(c.version)>0||l.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):R(A_,"Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",l.version)}),{changedDocuments:o,existenceChangedKeys:i}})}function Mz(n,e,t){return n.resumeToken.approximateByteSize()===0||e.snapshotVersion.toMicroseconds()-n.snapshotVersion.toMicroseconds()>=Az?!0:t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size>0}function Oz(n,e){return g(this,null,function*(){let t=L(n);try{yield t.persistence.runTransaction("notifyLocalViewChanges","readwrite",r=>m.forEach(e,i=>m.forEach(i.addedKeys,s=>t.persistence.referenceDelegate.addReference(r,i.targetId,s)).next(()=>m.forEach(i.removedKeys,s=>t.persistence.referenceDelegate.removeReference(r,i.targetId,s)))))}catch(r){if(Oi(r))R(A_,"Failed to update sequence numbers: "+r);else throw r}for(let r of e){let i=r.targetId;if(!r.fromCache){let s=t.targetDataByTarget.get(i),o=s.snapshotVersion,a=s.withLastLimboFreeSnapshotVersion(o);t.targetDataByTarget=t.targetDataByTarget.insert(i,a)}}})}function Pz(n,e){let t=L(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=_i),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function Fz(n,e){let t=L(n);return t.persistence.runTransaction("read document","readonly",r=>t.localDocuments.getDocument(r,e))}function da(n,e){let t=L(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.targetCache.getTargetData(r,e).next(s=>s?(i=s,m.resolve(i)):t.targetCache.allocateTargetId(r).next(o=>(i=new ca(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.targetCache.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=t.targetDataByTarget.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.targetDataByTarget=t.targetDataByTarget.insert(r.targetId,r),t.targetIdByTarget.set(e,r.targetId)),r})}function Lz(n,e,t){let r=L(n),i=r.targetIdByTarget.get(t);return i!==void 0?m.resolve(r.targetDataByTarget.get(i)):r.targetCache.getTargetData(e,t)}function ha(n,e,t){return g(this,null,function*(){let r=L(n),i=r.targetDataByTarget.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(Oi(o))R(A_,`Failed to update sequence numbers for target ${e}: ${o}`);else throw o}r.targetDataByTarget=r.targetDataByTarget.remove(e),r.targetIdByTarget.delete(i.target)})}function Hf(n,e,t){let r=L(n),i=K.min(),s=Z();return r.persistence.runTransaction("Execute query","readwrite",o=>Lz(r,o,Pt(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.targetCache.getMatchingKeysForTargetId(o,a.targetId).next(l=>{s=l})}).next(()=>r.queryEngine.getDocumentsMatchingQuery(o,e,t?i:K.min(),t?s:Z())).next(a=>(KR(r,tR(e),a),{documents:a,remoteKeys:s})))}function Bz(n,e,t,r){let i=t.batch,s=i.keys(),o=m.resolve();return s.forEach(a=>{o=o.next(()=>r.getEntry(e,a)).next(l=>{let c=t.docVersions.get(a);j(c!==null),l.version.compareTo(c)<0&&(i.applyToRemoteDocument(l,t),l.isValidDocument()&&(l.setReadTime(t.commitVersion),r.addEntry(l)))})}),o.next(()=>n.mutationQueue.removeMutationBatch(e,i))}function Vz(n,e){let t=L(n),r=L(t.mutationQueue);return t.persistence.runTransaction("Lookup mutation documents","readonly",i=>r.lookupMutationKeys(i,e).next(s=>s?t.localDocuments.getDocuments(i,s):m.resolve(null)))}function qz(n,e){L(L(n,Ec).mutationQueue).removeCachedMutationKeys(e)}function Uz(n){return L(L(n,Ec).persistence).getActiveClients()}function GR(n,e){let t=L(n),r=L(t.targetCache),i=t.targetDataByTarget.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>r.getTargetDataForTarget(s,e).next(o=>o?o.target:null))}function HR(n,e){let t=L(n),r=t.collectionGroupReadTime.get(e)||K.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.remoteDocuments.getAllFromCollectionGroup(i,e,S1(r,ta),Number.MAX_SAFE_INTEGER)).then(i=>(KR(t,e,i),i))}function KR(n,e,t){let r=n.collectionGroupReadTime.get(e)||K.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.collectionGroupReadTime.set(e,r)}function zz(n){return Pt(wa(de.fromString(`__bundle__/docs/${n}`)))}function jz(n,e,t,r){return g(this,null,function*(){let i=L(n),s=Z(),o=Gt();for(let c of t){let u=e.toDocumentKey(c.metadata.name);c.document&&(s=s.add(u));let d=e.toMutableDocument(c);d.setReadTime(e.toSnapshotVersion(c.metadata.readTime)),o=o.insert(u,d)}let a=i.remoteDocuments.newChangeBuffer({trackRemovals:!0}),l=yield da(i,zz(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",c=>jR(c,a,o).next(u=>(a.apply(c),u)).next(u=>i.targetCache.removeMatchingKeysForTargetId(c,l.targetId).next(()=>i.targetCache.addMatchingKeys(c,s,l.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(c,u.changedDocuments,u.existenceChangedKeys)).next(()=>u.changedDocuments)))})}function Gz(n,e){let t=L(n),r=Ge(e.createTime);return t.persistence.runTransaction("hasNewerBundle","readonly",i=>t.bundleCache.getBundleMetadata(i,e.id)).then(i=>!!i&&i.createTime.compareTo(r)>=0)}function Hz(n,e){let t=L(n);return t.persistence.runTransaction("Save bundle","readwrite",r=>t.bundleCache.saveBundleMetadata(r,e))}function Kz(n,e){let t=L(n);return t.persistence.runTransaction("Get named query","readonly",r=>t.bundleCache.getNamedQuery(r,e))}function Wz(r,i){return g(this,arguments,function*(n,e,t=Z()){let s=yield da(n,Pt(E_(e.bundledQuery))),o=L(n);return o.persistence.runTransaction("Save named query","readwrite",a=>{let l=Ge(e.readTime);if(s.snapshotVersion.compareTo(l)>=0)return o.bundleCache.saveNamedQuery(a,e);let c=s.withResumeToken(ot.EMPTY_BYTE_STRING,l);return o.targetDataByTarget=o.targetDataByTarget.insert(c.targetId,c),o.targetCache.updateTargetData(a,c).next(()=>o.targetCache.removeMatchingKeysForTargetId(a,s.targetId)).next(()=>o.targetCache.addMatchingKeys(a,t,s.targetId)).next(()=>o.bundleCache.saveNamedQuery(a,e))})})}var yS=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var $z=100,Qz=8,gf=class{constructor(){this.initialized=!1,this.indexAutoCreationEnabled=!1,this.indexAutoCreationMinCollectionSize=$z,this.relativeIndexReadCostPerDocument=Qz}initialize(e,t){this.localDocumentsView=e,this.indexManager=t,this.initialized=!0}getDocumentsMatchingQuery(e,t,r,i){let s={result:null};return this.performQueryUsingIndex(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.performQueryUsingRemoteKeys(e,t,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new yS;return this.executeFullCollectionScan(e,t,o).next(a=>{if(s.result=a,this.indexAutoCreationEnabled)return this.createCacheIndexes(e,t,o,a.size)})}).next(()=>s.result)}createCacheIndexes(e,t,r,i){return r.documentReadCount<this.indexAutoCreationMinCollectionSize?(Ko()<=Bn.DEBUG&&R("QueryEngine","SDK will not create cache indexes for query:",Wo(t),"since it only creates cache indexes for collection contains","more than or equal to",this.indexAutoCreationMinCollectionSize,"documents"),m.resolve()):(Ko()<=Bn.DEBUG&&R("QueryEngine","Query:",Wo(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.relativeIndexReadCostPerDocument*i?(Ko()<=Bn.DEBUG&&R("QueryEngine","The SDK decides to create cache indexes for query:",Wo(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Pt(t))):m.resolve())}performQueryUsingIndex(e,t){if(SD(t))return m.resolve(null);let r=Pt(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=ef(t,null,"F"),r=Pt(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{let o=Z(...s);return this.localDocumentsView.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{let c=this.applyQuery(t,a);return this.needsRefill(t,c,o,l.readTime)?this.performQueryUsingIndex(e,ef(t,null,"F")):this.appendRemainingResults(e,c,t,l)}))})))}performQueryUsingRemoteKeys(e,t,r,i){return SD(t)||i.isEqual(K.min())?m.resolve(null):this.localDocumentsView.getDocuments(e,r).next(s=>{let o=this.applyQuery(t,s);return this.needsRefill(t,o,r,i)?m.resolve(null):(Ko()<=Bn.DEBUG&&R("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Wo(t)),this.appendRemainingResults(e,o,t,S1(i,ta)).next(a=>a))})}applyQuery(e,t){let r=new ve(nR(e));return t.forEach((i,s)=>{Pc(e,s)&&(r=r.add(s))}),r}needsRefill(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return s?s.hasPendingWrites||s.version.compareTo(i)>0:!1}executeFullCollectionScan(e,t,r){return Ko()<=Bn.DEBUG&&R("QueryEngine","Using full collection scan to execute query:",Wo(t)),this.localDocumentsView.getDocumentsMatchingQuery(e,t,gn.min(),r)}appendRemainingResults(e,t,r,i){return this.localDocumentsView.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}};var WR="firestore_clients";function ZD(n,e){return`${WR}_${n}_${e}`}var $R="firestore_mutations";function e1(n,e,t){let r=`${$R}_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}var QR="firestore_targets";function s0(n,e){return`${QR}_${n}_${e}`}var Yz="firestore_online_state";function Xz(n){return`${Yz}_${n}`}var Jz="firestore_bundle_loaded_v2";function Zz(n){return`${Jz}_${n}`}var ej="firestore_sequence_number";function tj(n){return`${ej}_${n}`}var ir="SharedClientState",mf=class n{constructor(e,t,r,i){this.user=e,this.batchId=t,this.state=r,this.error=i}static fromWebStorageEntry(e,t,r){let i=JSON.parse(r),s=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object"),o;return s&&i.error&&(s=typeof i.error.message=="string"&&typeof i.error.code=="string",s&&(o=new T(i.error.code,i.error.message))),s?new n(e,t,i.state,o):(Ne(ir,`Failed to parse mutation state for ID '${t}': ${r}`),null)}toWebStorageJSON(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},tc=class n{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static fromWebStorageEntry(e,t){let r=JSON.parse(t),i=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object"),s;return i&&r.error&&(i=typeof r.error.message=="string"&&typeof r.error.code=="string",i&&(s=new T(r.error.code,r.error.message))),i?new n(e,r.state,s):(Ne(ir,`Failed to parse target state for ID '${e}': ${t}`),null)}toWebStorageJSON(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},yf=class n{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static fromWebStorageEntry(e,t){let r=JSON.parse(t),i=typeof r=="object"&&r.activeTargetIds instanceof Array,s=S_();for(let o=0;i&&o<r.activeTargetIds.length;++o)i=U1(r.activeTargetIds[o]),s=s.add(r.activeTargetIds[o]);return i?new n(e,s):(Ne(ir,`Failed to parse client data for instance '${e}': ${t}`),null)}},vS=class n{constructor(e,t){this.clientId=e,this.onlineState=t}static fromWebStorageEntry(e){let t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new n(t.clientId,t.onlineState):(Ne(ir,`Failed to parse online state: ${e}`),null)}},wc=class{constructor(){this.activeTargetIds=S_()}addQueryTarget(e){this.activeTargetIds=this.activeTargetIds.add(e)}removeQueryTarget(e){this.activeTargetIds=this.activeTargetIds.delete(e)}toWebStorageJSON(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}},nc=class{constructor(e,t,r,i,s){this.window=e,this.queue=t,this.persistenceKey=r,this.localClientId=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.storageListener=this.handleWebStorageEvent.bind(this),this.activeClients=new be(J),this.started=!1,this.earlyEvents=[];let o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.localClientStorageKey=ZD(this.persistenceKey,this.localClientId),this.sequenceNumberKey=tj(this.persistenceKey),this.activeClients=this.activeClients.insert(this.localClientId,new wc),this.clientStateKeyRe=new RegExp(`^${WR}_${o}_([^_]*)$`),this.mutationBatchKeyRe=new RegExp(`^${$R}_${o}_(\\d+)(?:_(.*))?$`),this.queryTargetKeyRe=new RegExp(`^${QR}_${o}_(\\d+)$`),this.onlineStateKey=Xz(this.persistenceKey),this.bundleLoadedKey=Zz(this.persistenceKey),this.window.addEventListener("storage",this.storageListener)}static isAvailable(e){return!!(e&&e.localStorage)}start(){return g(this,null,function*(){let e=yield this.syncEngine.getActiveClients();for(let r of e){if(r===this.localClientId)continue;let i=this.getItem(ZD(this.persistenceKey,r));if(i){let s=yf.fromWebStorageEntry(r,i);s&&(this.activeClients=this.activeClients.insert(s.clientId,s))}}this.persistClientState();let t=this.storage.getItem(this.onlineStateKey);if(t){let r=this.fromWebStorageOnlineState(t);r&&this.handleOnlineStateEvent(r)}for(let r of this.earlyEvents)this.handleWebStorageEvent(r);this.earlyEvents=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(e){this.setItem(this.sequenceNumberKey,JSON.stringify(e))}getAllActiveQueryTargets(){return this.extractActiveQueryTargets(this.activeClients)}isActiveQueryTarget(e){let t=!1;return this.activeClients.forEach((r,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.persistMutationState(e,"pending")}updateMutationState(e,t,r){this.persistMutationState(e,t,r),this.removeMutationState(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){let r=this.storage.getItem(s0(this.persistenceKey,e));if(r){let i=tc.fromWebStorageEntry(e,r);i&&(t=i.state)}}return this.localClientState.addQueryTarget(e),this.persistClientState(),t}removeLocalQueryTarget(e){this.localClientState.removeQueryTarget(e),this.persistClientState()}isLocalQueryTarget(e){return this.localClientState.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(s0(this.persistenceKey,e))}updateQueryState(e,t,r){this.persistQueryTargetState(e,t,r)}handleUserChange(e,t,r){t.forEach(i=>{this.removeMutationState(i)}),this.currentUser=e,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.persistOnlineState(e)}notifyBundleLoaded(e){this.persistBundleLoadedState(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return R(ir,"READ",e,t),t}setItem(e,t){R(ir,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){R(ir,"REMOVE",e),this.storage.removeItem(e)}handleWebStorageEvent(e){let t=e;if(t.storageArea===this.storage){if(R(ir,"EVENT",t.key,t.newValue),t.key===this.localClientStorageKey){Ne("Received WebStorage notification for local change. Another client might have garbage-collected our state");return}this.queue.enqueueRetryable(()=>g(this,null,function*(){if(!this.started){this.earlyEvents.push(t);return}if(t.key!==null){if(this.clientStateKeyRe.test(t.key))if(t.newValue!=null){let r=this.fromWebStorageClientState(t.key,t.newValue);if(r)return this.handleClientStateEvent(r.clientId,r)}else{let r=this.fromWebStorageClientStateKey(t.key);return this.handleClientStateEvent(r,null)}else if(this.mutationBatchKeyRe.test(t.key)){if(t.newValue!==null){let r=this.fromWebStorageMutationMetadata(t.key,t.newValue);if(r)return this.handleMutationBatchEvent(r)}}else if(this.queryTargetKeyRe.test(t.key)){if(t.newValue!==null){let r=this.fromWebStorageQueryTargetMetadata(t.key,t.newValue);if(r)return this.handleQueryTargetEvent(r)}}else if(t.key===this.onlineStateKey){if(t.newValue!==null){let r=this.fromWebStorageOnlineState(t.newValue);if(r)return this.handleOnlineStateEvent(r)}}else if(t.key===this.sequenceNumberKey){let r=nj(t.newValue);r!==Xt.INVALID&&this.sequenceNumberHandler(r)}else if(t.key===this.bundleLoadedKey){let r=this.fromWebStoreBundleLoadedState(t.newValue);yield Promise.all(r.map(i=>this.syncEngine.synchronizeWithChangedDocuments(i)))}}}))}}get localClientState(){return this.activeClients.get(this.localClientId)}persistClientState(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())}persistMutationState(e,t,r){let i=new mf(this.currentUser,e,t,r),s=e1(this.persistenceKey,this.currentUser,e);this.setItem(s,i.toWebStorageJSON())}removeMutationState(e){let t=e1(this.persistenceKey,this.currentUser,e);this.removeItem(t)}persistOnlineState(e){let t={clientId:this.localClientId,onlineState:e};this.storage.setItem(this.onlineStateKey,JSON.stringify(t))}persistQueryTargetState(e,t,r){let i=s0(this.persistenceKey,e),s=new tc(e,t,r);this.setItem(i,s.toWebStorageJSON())}persistBundleLoadedState(e){let t=JSON.stringify(Array.from(e));this.setItem(this.bundleLoadedKey,t)}fromWebStorageClientStateKey(e){let t=this.clientStateKeyRe.exec(e);return t?t[1]:null}fromWebStorageClientState(e,t){let r=this.fromWebStorageClientStateKey(e);return yf.fromWebStorageEntry(r,t)}fromWebStorageMutationMetadata(e,t){let r=this.mutationBatchKeyRe.exec(e),i=Number(r[1]),s=r[2]!==void 0?r[2]:null;return mf.fromWebStorageEntry(new Xe(s),i,t)}fromWebStorageQueryTargetMetadata(e,t){let r=this.queryTargetKeyRe.exec(e),i=Number(r[1]);return tc.fromWebStorageEntry(i,t)}fromWebStorageOnlineState(e){return vS.fromWebStorageEntry(e)}fromWebStoreBundleLoadedState(e){return JSON.parse(e)}handleMutationBatchEvent(e){return g(this,null,function*(){if(e.user.uid!==this.currentUser.uid){R(ir,`Ignoring mutation for non-active user ${e.user.uid}`);return}return this.syncEngine.applyBatchState(e.batchId,e.state,e.error)})}handleQueryTargetEvent(e){return this.syncEngine.applyTargetState(e.targetId,e.state,e.error)}handleClientStateEvent(e,t){let r=t?this.activeClients.insert(e,t):this.activeClients.remove(e),i=this.extractActiveQueryTargets(this.activeClients),s=this.extractActiveQueryTargets(r),o=[],a=[];return s.forEach(l=>{i.has(l)||o.push(l)}),i.forEach(l=>{s.has(l)||a.push(l)}),this.syncEngine.applyActiveTargetsChange(o,a).then(()=>{this.activeClients=r})}handleOnlineStateEvent(e){this.activeClients.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}extractActiveQueryTargets(e){let t=S_();return e.forEach((r,i)=>{t=t.unionWith(i.activeTargetIds)}),t}};function nj(n){let e=Xt.INVALID;if(n!=null)try{let t=JSON.parse(n);j(typeof t=="number"),e=t}catch(t){Ne(ir,"Failed to read sequence number from WebStorage",t)}return e}var vf=class{constructor(){this.localState=new wc,this.queryState={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e){return this.localState.addQueryTarget(e),this.queryState[e]||"not-current"}updateQueryState(e,t,r){this.queryState[e]=t}removeLocalQueryTarget(e){this.localState.removeQueryTarget(e)}isLocalQueryTarget(e){return this.localState.activeTargetIds.has(e)}clearQueryState(e){delete this.queryState[e]}getAllActiveQueryTargets(){return this.localState.activeTargetIds}isActiveQueryTarget(e){return this.localState.activeTargetIds.has(e)}start(){return this.localState=new wc,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var SS=class{addCallback(e){}shutdown(){}};var _S=class{constructor(e){this.sendFn=e.sendFn,this.closeFn=e.closeFn}onOpen(e){this.wrappedOnOpen=e}onClose(e){this.wrappedOnClose=e}onMessage(e){this.wrappedOnMessage=e}close(){this.closeFn()}send(e){this.sendFn(e)}callOnOpen(){this.wrappedOnOpen()}callOnClose(e){this.wrappedOnClose(e)}callOnMessage(e){this.wrappedOnMessage(e)}};var Lh=null;function rj(){return 268435456+Math.round(2147483648*Math.random())}function o0(){return Lh===null?Lh=rj():Lh++,"0x"+Lh.toString(16)}function ij(n){return new Promise((e,t)=>{n((r,i)=>{r?t(r):e(i)})})}var sj="1.9.1",Mt="GrpcConnection",oj=`gl-node/${process.versions.node} fire/${va} grpc/${sj}`;function a0(n,e,t,r){j(e===null||e.type==="OAuth");let i=new gs.Metadata;return e&&e.headers.forEach((s,o)=>i.set(o,s)),t&&t.headers.forEach((s,o)=>i.set(o,s)),r&&i.set("X-Firebase-GMPID",r),i.set("X-Goog-Api-Client",oj),i.set("Google-Cloud-Resource-Prefix",n),i.set("x-goog-request-params",n),i}var ES=class{constructor(e,t){this.databaseInfo=t,this.cachedStub=null,this.firestore=e.google.firestore.v1,this.databasePath=`projects/${t.databaseId.projectId}/databases/${t.databaseId.database}`}get shouldResourcePathBeIncludedInRequest(){return!0}ensureActiveStub(){if(!this.cachedStub){R(Mt,"Creating Firestore stub.");let e=this.databaseInfo.ssl?gs.credentials.createSsl():gs.credentials.createInsecure();this.cachedStub=new this.firestore.Firestore(this.databaseInfo.host,e)}return this.cachedStub}invokeRPC(e,t,r,i,s){let o=o0(),a=this.ensureActiveStub(),l=a0(this.databasePath,i,s,this.databaseInfo.appId),c=Object.assign({database:this.databasePath},r);return ij(u=>(R(Mt,`RPC '${e}' ${o} invoked with request:`,r),a[e](c,l,(d,h)=>{d?(R(Mt,`RPC '${e}' ${o} failed with error:`,d),u(new T(zh(d.code),d.message))):(R(Mt,`RPC '${e}' ${o} completed with response:`,h),u(void 0,h))})))}invokeStreamingRPC(e,t,r,i,s,o){let a=o0(),l=[],c=new je;R(Mt,`RPC '${e}' ${a} invoked (streaming) with request:`,r);let u=this.ensureActiveStub(),d=a0(this.databasePath,i,s,this.databaseInfo.appId),h=Object.assign(Object.assign({},r),{database:this.databasePath}),p=u[e](h,d),y=!1;return p.on("data",S=>{R(Mt,`RPC ${e} ${a} received result:`,S),l.push(S),o!==void 0&&l.length===o&&(y=!0,c.resolve(l))}),p.on("end",()=>{R(Mt,`RPC '${e}' ${a} completed.`),y||(y=!0,c.resolve(l))}),p.on("error",S=>{R(Mt,`RPC '${e}' ${a} failed with error:`,S);let _=zh(S.code);c.reject(new T(_,S.message))}),c.promise}openStream(e,t,r){let i=o0(),s=this.ensureActiveStub(),o=a0(this.databasePath,t,r,this.databaseInfo.appId),a=s[e](o),l=!1,c=d=>{l||(l=!0,u.callOnClose(d),a.end())},u=new _S({sendFn:d=>{if(l)R(Mt,`RPC '${e}' stream ${i} not sending because gRPC stream is closed:`,d);else{R(Mt,`RPC '${e}' stream ${i} sending:`,d);try{a.write(d)}catch(h){throw Ne("Failure sending:",d),Ne("Error:",h),h}}},closeFn:()=>{R(Mt,`RPC '${e}' stream ${i} closed locally via close().`),c()}});return a.on("data",d=>{l||(R(Mt,`RPC '${e}' stream ${i} received:`,d),u.callOnMessage(d))}),a.on("end",()=>{R(Mt,`RPC '${e}' stream ${i} ended.`),c()}),a.on("error",d=>{if(!l){pn(Mt,`RPC '${e}' stream ${i} error. Code:`,d.code,"Message:",d.message);let h=zh(d.code);c(new T(h,d.message))}}),R(Mt,`Opening RPC '${e}' stream ${i} to ${this.databaseInfo.host}`),setTimeout(()=>{u.callOnOpen()},0),u}},YR={google:{nested:{protobuf:{options:{csharp_namespace:"Google.Protobuf.WellKnownTypes",go_package:"github.com/golang/protobuf/ptypes/wrappers",java_package:"com.google.protobuf",java_outer_classname:"WrappersProto",java_multiple_files:!0,objc_class_prefix:"GPB",cc_enable_arenas:!0,optimize_for:"SPEED"},nested:{Timestamp:{fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}},FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[8,8]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}},Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},Empty:{fields:{}},DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}},Any:{fields:{typeUrl:{type:"string",id:1},value:{type:"bytes",id:2}}}}},firestore:{nested:{v1:{options:{csharp_namespace:"Google.Cloud.Firestore.V1",go_package:"google.golang.org/genproto/googleapis/firestore/v1;firestore",java_multiple_files:!0,java_outer_classname:"WriteProto",java_package:"com.google.firestore.v1",objc_class_prefix:"GCFS",php_namespace:"Google\\Cloud\\Firestore\\V1",ruby_package:"Google::Cloud::Firestore::V1"},nested:{AggregationResult:{fields:{aggregateFields:{keyType:"string",type:"Value",id:2}}},BitSequence:{fields:{bitmap:{type:"bytes",id:1},padding:{type:"int32",id:2}}},BloomFilter:{fields:{bits:{type:"BitSequence",id:1},hashCount:{type:"int32",id:2}}},DocumentMask:{fields:{fieldPaths:{rule:"repeated",type:"string",id:1}}},Precondition:{oneofs:{conditionType:{oneof:["exists","updateTime"]}},fields:{exists:{type:"bool",id:1},updateTime:{type:"google.protobuf.Timestamp",id:2}}},TransactionOptions:{oneofs:{mode:{oneof:["readOnly","readWrite"]}},fields:{readOnly:{type:"ReadOnly",id:2},readWrite:{type:"ReadWrite",id:3}},nested:{ReadWrite:{fields:{retryTransaction:{type:"bytes",id:1}}},ReadOnly:{oneofs:{consistencySelector:{oneof:["readTime"]}},fields:{readTime:{type:"google.protobuf.Timestamp",id:2}}}}},Document:{fields:{name:{type:"string",id:1},fields:{keyType:"string",type:"Value",id:2},createTime:{type:"google.protobuf.Timestamp",id:3},updateTime:{type:"google.protobuf.Timestamp",id:4}}},Value:{oneofs:{valueType:{oneof:["nullValue","booleanValue","integerValue","doubleValue","timestampValue","stringValue","bytesValue","referenceValue","geoPointValue","arrayValue","mapValue"]}},fields:{nullValue:{type:"google.protobuf.NullValue",id:11},booleanValue:{type:"bool",id:1},integerValue:{type:"int64",id:2},doubleValue:{type:"double",id:3},timestampValue:{type:"google.protobuf.Timestamp",id:10},stringValue:{type:"string",id:17},bytesValue:{type:"bytes",id:18},referenceValue:{type:"string",id:5},geoPointValue:{type:"google.type.LatLng",id:8},arrayValue:{type:"ArrayValue",id:9},mapValue:{type:"MapValue",id:6}}},ArrayValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},MapValue:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Firestore:{options:{"(google.api.default_host)":"firestore.googleapis.com","(google.api.oauth_scopes)":"https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/datastore"},methods:{GetDocument:{requestType:"GetDocumentRequest",responseType:"Document",options:{"(google.api.http).get":"/v1/{name=projects/*/databases/*/documents/*/**}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{name=projects/*/databases/*/documents/*/**}"}}]},ListDocuments:{requestType:"ListDocumentsRequest",responseType:"ListDocumentsResponse",options:{"(google.api.http).get":"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"}}]},UpdateDocument:{requestType:"UpdateDocumentRequest",responseType:"Document",options:{"(google.api.http).patch":"/v1/{document.name=projects/*/databases/*/documents/*/**}","(google.api.http).body":"document","(google.api.method_signature)":"document,update_mask"},parsedOptions:[{"(google.api.http)":{patch:"/v1/{document.name=projects/*/databases/*/documents/*/**}",body:"document"}},{"(google.api.method_signature)":"document,update_mask"}]},DeleteDocument:{requestType:"DeleteDocumentRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).delete":"/v1/{name=projects/*/databases/*/documents/*/**}","(google.api.method_signature)":"name"},parsedOptions:[{"(google.api.http)":{delete:"/v1/{name=projects/*/databases/*/documents/*/**}"}},{"(google.api.method_signature)":"name"}]},BatchGetDocuments:{requestType:"BatchGetDocumentsRequest",responseType:"BatchGetDocumentsResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchGet","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchGet",body:"*"}}]},BeginTransaction:{requestType:"BeginTransactionRequest",responseType:"BeginTransactionResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:beginTransaction","(google.api.http).body":"*","(google.api.method_signature)":"database"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:beginTransaction",body:"*"}},{"(google.api.method_signature)":"database"}]},Commit:{requestType:"CommitRequest",responseType:"CommitResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:commit","(google.api.http).body":"*","(google.api.method_signature)":"database,writes"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:commit",body:"*"}},{"(google.api.method_signature)":"database,writes"}]},Rollback:{requestType:"RollbackRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:rollback","(google.api.http).body":"*","(google.api.method_signature)":"database,transaction"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:rollback",body:"*"}},{"(google.api.method_signature)":"database,transaction"}]},RunQuery:{requestType:"RunQueryRequest",responseType:"RunQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery",body:"*"}}}]},RunAggregationQuery:{requestType:"RunAggregationQueryRequest",responseType:"RunAggregationQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery",body:"*"}}}]},PartitionQuery:{requestType:"PartitionQueryRequest",responseType:"PartitionQueryResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:partitionQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:partitionQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery",body:"*"}}}]},Write:{requestType:"WriteRequest",requestStream:!0,responseType:"WriteResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:write","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:write",body:"*"}}]},Listen:{requestType:"ListenRequest",requestStream:!0,responseType:"ListenResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:listen","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:listen",body:"*"}}]},ListCollectionIds:{requestType:"ListCollectionIdsRequest",responseType:"ListCollectionIdsResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds","(google.api.http).additional_bindings.body":"*","(google.api.method_signature)":"parent"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds",body:"*"}}},{"(google.api.method_signature)":"parent"}]},BatchWrite:{requestType:"BatchWriteRequest",responseType:"BatchWriteResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchWrite","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchWrite",body:"*"}}]},CreateDocument:{requestType:"CreateDocumentRequest",responseType:"Document",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}","(google.api.http).body":"document"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}",body:"document"}}]}}},GetDocumentRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:5}}},ListDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:3},pageToken:{type:"string",id:4},orderBy:{type:"string",id:6},mask:{type:"DocumentMask",id:7},transaction:{type:"bytes",id:8},readTime:{type:"google.protobuf.Timestamp",id:10},showMissing:{type:"bool",id:12}}},ListDocumentsResponse:{fields:{documents:{rule:"repeated",type:"Document",id:1},nextPageToken:{type:"string",id:2}}},CreateDocumentRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},documentId:{type:"string",id:3},document:{type:"Document",id:4,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:5}}},UpdateDocumentRequest:{fields:{document:{type:"Document",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},updateMask:{type:"DocumentMask",id:2},mask:{type:"DocumentMask",id:3},currentDocument:{type:"Precondition",id:4}}},DeleteDocumentRequest:{fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},currentDocument:{type:"Precondition",id:2}}},BatchGetDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},documents:{rule:"repeated",type:"string",id:2},mask:{type:"DocumentMask",id:3},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:7}}},BatchGetDocumentsResponse:{oneofs:{result:{oneof:["found","missing"]}},fields:{found:{type:"Document",id:1},missing:{type:"string",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:4}}},BeginTransactionRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},options:{type:"TransactionOptions",id:2}}},BeginTransactionResponse:{fields:{transaction:{type:"bytes",id:1}}},CommitRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},transaction:{type:"bytes",id:3}}},CommitResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},commitTime:{type:"google.protobuf.Timestamp",id:2}}},RollbackRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},transaction:{type:"bytes",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}}}},RunQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},transaction:{type:"bytes",id:5},newTransaction:{type:"TransactionOptions",id:6},readTime:{type:"google.protobuf.Timestamp",id:7}}},RunQueryResponse:{fields:{transaction:{type:"bytes",id:2},document:{type:"Document",id:1},readTime:{type:"google.protobuf.Timestamp",id:3},skippedResults:{type:"int32",id:4}}},RunAggregationQueryRequest:{oneofs:{queryType:{oneof:["structuredAggregationQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredAggregationQuery:{type:"StructuredAggregationQuery",id:2},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:6}}},RunAggregationQueryResponse:{fields:{result:{type:"AggregationResult",id:1},transaction:{type:"bytes",id:2},readTime:{type:"google.protobuf.Timestamp",id:3}}},PartitionQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},partitionCount:{type:"int64",id:3},pageToken:{type:"string",id:4},pageSize:{type:"int32",id:5}}},PartitionQueryResponse:{fields:{partitions:{rule:"repeated",type:"Cursor",id:1},nextPageToken:{type:"string",id:2}}},WriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},streamId:{type:"string",id:2},writes:{rule:"repeated",type:"Write",id:3},streamToken:{type:"bytes",id:4},labels:{keyType:"string",type:"string",id:5}}},WriteResponse:{fields:{streamId:{type:"string",id:1},streamToken:{type:"bytes",id:2},writeResults:{rule:"repeated",type:"WriteResult",id:3},commitTime:{type:"google.protobuf.Timestamp",id:4}}},ListenRequest:{oneofs:{targetChange:{oneof:["addTarget","removeTarget"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},addTarget:{type:"Target",id:2},removeTarget:{type:"int32",id:3},labels:{keyType:"string",type:"string",id:4}}},ListenResponse:{oneofs:{responseType:{oneof:["targetChange","documentChange","documentDelete","documentRemove","filter"]}},fields:{targetChange:{type:"TargetChange",id:2},documentChange:{type:"DocumentChange",id:3},documentDelete:{type:"DocumentDelete",id:4},documentRemove:{type:"DocumentRemove",id:6},filter:{type:"ExistenceFilter",id:5}}},Target:{oneofs:{targetType:{oneof:["query","documents"]},resumeType:{oneof:["resumeToken","readTime"]}},fields:{query:{type:"QueryTarget",id:2},documents:{type:"DocumentsTarget",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:11},targetId:{type:"int32",id:5},once:{type:"bool",id:6},expectedCount:{type:"google.protobuf.Int32Value",id:12}},nested:{DocumentsTarget:{fields:{documents:{rule:"repeated",type:"string",id:2}}},QueryTarget:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1},structuredQuery:{type:"StructuredQuery",id:2}}}}},TargetChange:{fields:{targetChangeType:{type:"TargetChangeType",id:1},targetIds:{rule:"repeated",type:"int32",id:2},cause:{type:"google.rpc.Status",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:6}},nested:{TargetChangeType:{values:{NO_CHANGE:0,ADD:1,REMOVE:2,CURRENT:3,RESET:4}}}},ListCollectionIdsRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:2},pageToken:{type:"string",id:3}}},ListCollectionIdsResponse:{fields:{collectionIds:{rule:"repeated",type:"string",id:1},nextPageToken:{type:"string",id:2}}},BatchWriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},labels:{keyType:"string",type:"string",id:3}}},BatchWriteResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},status:{rule:"repeated",type:"google.rpc.Status",id:2}}},StructuredQuery:{fields:{select:{type:"Projection",id:1},from:{rule:"repeated",type:"CollectionSelector",id:2},where:{type:"Filter",id:3},orderBy:{rule:"repeated",type:"Order",id:4},startAt:{type:"Cursor",id:7},endAt:{type:"Cursor",id:8},offset:{type:"int32",id:6},limit:{type:"google.protobuf.Int32Value",id:5}},nested:{CollectionSelector:{fields:{collectionId:{type:"string",id:2},allDescendants:{type:"bool",id:3}}},Filter:{oneofs:{filterType:{oneof:["compositeFilter","fieldFilter","unaryFilter"]}},fields:{compositeFilter:{type:"CompositeFilter",id:1},fieldFilter:{type:"FieldFilter",id:2},unaryFilter:{type:"UnaryFilter",id:3}}},CompositeFilter:{fields:{op:{type:"Operator",id:1},filters:{rule:"repeated",type:"Filter",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,AND:1,OR:2}}}},FieldFilter:{fields:{field:{type:"FieldReference",id:1},op:{type:"Operator",id:2},value:{type:"Value",id:3}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,LESS_THAN:1,LESS_THAN_OR_EQUAL:2,GREATER_THAN:3,GREATER_THAN_OR_EQUAL:4,EQUAL:5,NOT_EQUAL:6,ARRAY_CONTAINS:7,IN:8,ARRAY_CONTAINS_ANY:9,NOT_IN:10}}}},UnaryFilter:{oneofs:{operandType:{oneof:["field"]}},fields:{op:{type:"Operator",id:1},field:{type:"FieldReference",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,IS_NAN:2,IS_NULL:3,IS_NOT_NAN:4,IS_NOT_NULL:5}}}},Order:{fields:{field:{type:"FieldReference",id:1},direction:{type:"Direction",id:2}}},FieldReference:{fields:{fieldPath:{type:"string",id:2}}},Projection:{fields:{fields:{rule:"repeated",type:"FieldReference",id:2}}},Direction:{values:{DIRECTION_UNSPECIFIED:0,ASCENDING:1,DESCENDING:2}}}},StructuredAggregationQuery:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{structuredQuery:{type:"StructuredQuery",id:1},aggregations:{rule:"repeated",type:"Aggregation",id:3}},nested:{Aggregation:{oneofs:{operator:{oneof:["count","sum","avg"]}},fields:{count:{type:"Count",id:1},sum:{type:"Sum",id:2},avg:{type:"Avg",id:3},alias:{type:"string",id:7}},nested:{Count:{fields:{upTo:{type:"google.protobuf.Int64Value",id:1}}},Sum:{fields:{field:{type:"FieldReference",id:1}}},Avg:{fields:{field:{type:"FieldReference",id:1}}}}}}},Cursor:{fields:{values:{rule:"repeated",type:"Value",id:1},before:{type:"bool",id:2}}},Write:{oneofs:{operation:{oneof:["update","delete","verify","transform"]}},fields:{update:{type:"Document",id:1},delete:{type:"string",id:2},verify:{type:"string",id:5},transform:{type:"DocumentTransform",id:6},updateMask:{type:"DocumentMask",id:3},updateTransforms:{rule:"repeated",type:"DocumentTransform.FieldTransform",id:7},currentDocument:{type:"Precondition",id:4}}},DocumentTransform:{fields:{document:{type:"string",id:1},fieldTransforms:{rule:"repeated",type:"FieldTransform",id:2}},nested:{FieldTransform:{oneofs:{transformType:{oneof:["setToServerValue","increment","maximum","minimum","appendMissingElements","removeAllFromArray"]}},fields:{fieldPath:{type:"string",id:1},setToServerValue:{type:"ServerValue",id:2},increment:{type:"Value",id:3},maximum:{type:"Value",id:4},minimum:{type:"Value",id:5},appendMissingElements:{type:"ArrayValue",id:6},removeAllFromArray:{type:"ArrayValue",id:7}},nested:{ServerValue:{values:{SERVER_VALUE_UNSPECIFIED:0,REQUEST_TIME:1}}}}}},WriteResult:{fields:{updateTime:{type:"google.protobuf.Timestamp",id:1},transformResults:{rule:"repeated",type:"Value",id:2}}},DocumentChange:{fields:{document:{type:"Document",id:1},targetIds:{rule:"repeated",type:"int32",id:5},removedTargetIds:{rule:"repeated",type:"int32",id:6}}},DocumentDelete:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:6},readTime:{type:"google.protobuf.Timestamp",id:4}}},DocumentRemove:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:2},readTime:{type:"google.protobuf.Timestamp",id:4}}},ExistenceFilter:{fields:{targetId:{type:"int32",id:1},count:{type:"int32",id:2},unchangedNames:{type:"BloomFilter",id:3}}}}}}},api:{options:{go_package:"google.golang.org/genproto/googleapis/api/annotations;annotations",java_multiple_files:!0,java_outer_classname:"HttpProto",java_package:"com.google.api",objc_class_prefix:"GAPI",cc_enable_arenas:!0},nested:{http:{type:"HttpRule",id:72295728,extend:"google.protobuf.MethodOptions"},Http:{fields:{rules:{rule:"repeated",type:"HttpRule",id:1}}},HttpRule:{oneofs:{pattern:{oneof:["get","put","post","delete","patch","custom"]}},fields:{get:{type:"string",id:2},put:{type:"string",id:3},post:{type:"string",id:4},delete:{type:"string",id:5},patch:{type:"string",id:6},custom:{type:"CustomHttpPattern",id:8},selector:{type:"string",id:1},body:{type:"string",id:7},additionalBindings:{rule:"repeated",type:"HttpRule",id:11}}},CustomHttpPattern:{fields:{kind:{type:"string",id:1},path:{type:"string",id:2}}},methodSignature:{rule:"repeated",type:"string",id:1051,extend:"google.protobuf.MethodOptions"},defaultHost:{type:"string",id:1049,extend:"google.protobuf.ServiceOptions"},oauthScopes:{type:"string",id:1050,extend:"google.protobuf.ServiceOptions"},fieldBehavior:{rule:"repeated",type:"google.api.FieldBehavior",id:1052,extend:"google.protobuf.FieldOptions"},FieldBehavior:{values:{FIELD_BEHAVIOR_UNSPECIFIED:0,OPTIONAL:1,REQUIRED:2,OUTPUT_ONLY:3,INPUT_ONLY:4,IMMUTABLE:5,UNORDERED_LIST:6,NON_EMPTY_DEFAULT:7}}}},type:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/type/latlng;latlng",java_multiple_files:!0,java_outer_classname:"LatLngProto",java_package:"com.google.type",objc_class_prefix:"GTP"},nested:{LatLng:{fields:{latitude:{type:"double",id:1},longitude:{type:"double",id:2}}}}},rpc:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/rpc/status;status",java_multiple_files:!0,java_outer_classname:"StatusProto",java_package:"com.google.rpc",objc_class_prefix:"RPC"},nested:{Status:{fields:{code:{type:"int32",id:1},message:{type:"string",id:2},details:{rule:"repeated",type:"google.protobuf.Any",id:3}}}}}}}},aj={nested:YR},lj=Object.freeze({__proto__:null,nested:YR,default:aj});var cj={longs:String,enums:String,defaults:!0,oneofs:!1};function uj(){let n=g1.fromJSON(lj,cj);return gs.loadPackageDefinition(n)}function dj(n){let e=uj();return new ES(e,n)}function hj(){return new SS}function XR(){return process.env.USE_MOCK_PERSISTENCE==="YES"?window:null}function fj(){return null}function Lc(n){return new j0(n,!1)}var pj="ExponentialBackoff",gj=1e3,mj=1.5,yj=60*1e3,Tc=class{constructor(e,t,r=gj,i=mj,s=yj){this.queue=e,this.timerId=t,this.initialDelayMs=r,this.backoffFactor=i,this.maxDelayMs=s,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}reset(){this.currentBaseMs=0}resetToMax(){this.currentBaseMs=this.maxDelayMs}backoffAndRun(e){this.cancel();let t=Math.floor(this.currentBaseMs+this.jitterDelayMs()),r=Math.max(0,Date.now()-this.lastAttemptTime),i=Math.max(0,t-r);i>0&&R(pj,`Backing off for ${i} ms (base delay: ${this.currentBaseMs} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,i,()=>(this.lastAttemptTime=Date.now(),e())),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)}skipBackoff(){this.timerPromise!==null&&(this.timerPromise.skipDelay(),this.timerPromise=null)}cancel(){this.timerPromise!==null&&(this.timerPromise.cancel(),this.timerPromise=null)}jitterDelayMs(){return(Math.random()-.5)*this.currentBaseMs}};var t1="PersistentStream",vj=60*1e3,Sj=10*1e3,Sf=class{constructor(e,t,r,i,s,o,a,l){this.queue=e,this.idleTimerId=r,this.healthTimerId=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.closeCount=0,this.idleTimer=null,this.healthCheck=null,this.stream=null,this.backoff=new Tc(e,t)}isStarted(){return this.state===1||this.state===5||this.isOpen()}isOpen(){return this.state===2||this.state===3}start(){if(this.state===4){this.performBackoff();return}this.auth()}stop(){return g(this,null,function*(){this.isStarted()&&(yield this.close(0))})}inhibitBackoff(){this.state=0,this.backoff.reset()}markIdle(){this.isOpen()&&this.idleTimer===null&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,vj,()=>this.handleIdleCloseTimer()))}sendRequest(e){this.cancelIdleCheck(),this.stream.send(e)}handleIdleCloseTimer(){return g(this,null,function*(){if(this.isOpen())return this.close(0)})}cancelIdleCheck(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)}cancelHealthCheck(){this.healthCheck&&(this.healthCheck.cancel(),this.healthCheck=null)}close(e,t){return g(this,null,function*(){this.cancelIdleCheck(),this.cancelHealthCheck(),this.backoff.cancel(),this.closeCount++,e!==4?this.backoff.reset():t&&t.code===v.RESOURCE_EXHAUSTED?(Ne(t.toString()),Ne("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):t&&t.code===v.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.onClose(t)})}tearDown(){}auth(){this.state=1;let e=this.getCloseGuardedDispatcher(this.closeCount),t=this.closeCount;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.closeCount===t&&this.startStream(r,i)},r=>{e(()=>{let i=new T(v.UNKNOWN,"Fetching auth token failed: "+r.message);return this.handleStreamClose(i)})})}startStream(e,t){let r=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(e,t),this.stream.onOpen(()=>{r(()=>(this.state=2,this.healthCheck=this.queue.enqueueAfterDelay(this.healthTimerId,Sj,()=>(this.isOpen()&&(this.state=3),Promise.resolve())),this.listener.onOpen()))}),this.stream.onClose(i=>{r(()=>this.handleStreamClose(i))}),this.stream.onMessage(i=>{r(()=>this.onMessage(i))})}performBackoff(){this.state=5,this.backoff.backoffAndRun(()=>g(this,null,function*(){this.state=0,this.start()}))}handleStreamClose(e){return R(t1,`close with error: ${e}`),this.stream=null,this.close(4,e)}getCloseGuardedDispatcher(e){return t=>{this.queue.enqueueAndForget(()=>this.closeCount===e?t():(R(t1,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},wS=class extends Sf{constructor(e,t,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}startRpc(e,t){return this.connection.openStream("Listen",e,t)}onMessage(e){this.backoff.reset();let t=N4(this.serializer,e),r=M4(e);return this.listener.onWatchChange(t,r)}watch(e){let t={};t.database=yc(this.serializer),t.addTarget=G4(this.serializer,e);let r=z4(this.serializer,e);r&&(t.labels=r),this.sendRequest(t)}unwatch(e){let t={};t.database=yc(this.serializer),t.removeTarget=e,this.sendRequest(t)}},TS=class extends Sf{constructor(e,t,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s,this.handshakeComplete_=!1}get handshakeComplete(){return this.handshakeComplete_}start(){this.handshakeComplete_=!1,this.lastStreamToken=void 0,super.start()}tearDown(){this.handshakeComplete_&&this.writeMutations([])}startRpc(e,t){return this.connection.openStream("Write",e,t)}onMessage(e){if(j(!!e.streamToken),this.lastStreamToken=e.streamToken,this.handshakeComplete_){this.backoff.reset();let t=L4(e.writeResults,e.commitTime),r=Ge(e.commitTime);return this.listener.onMutationResult(r,t)}else return j(!e.writeResults||e.writeResults.length===0),this.handshakeComplete_=!0,this.listener.onHandshakeComplete()}writeHandshake(){let e={};e.database=yc(this.serializer),this.sendRequest(e)}writeMutations(e){let t={streamToken:this.lastStreamToken,writes:e.map(r=>vc(this.serializer,r))};this.sendRequest(t)}};var CS=class{},bS=class extends CS{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.terminated=!1}verifyInitialized(){if(this.terminated)throw new T(v.FAILED_PRECONDITION,"The client has already been terminated.")}invokeRPC(e,t,r){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.invokeRPC(e,t,r,i,s)).catch(i=>{throw i.name==="FirebaseError"?(i.code===v.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new T(v.UNKNOWN,i.toString())})}invokeStreamingRPC(e,t,r,i){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.invokeStreamingRPC(e,t,r,s,o,i)).catch(s=>{throw s.name==="FirebaseError"?(s.code===v.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new T(v.UNKNOWN,s.toString())})}terminate(){this.terminated=!0}};function _j(n,e,t,r){return new bS(n,e,t,r)}function Ej(n,e){return g(this,null,function*(){let t=L(n),r=yc(t.serializer)+"/documents",i={writes:e.map(s=>vc(t.serializer,s))};yield t.invokeRPC("Commit",r,i)})}function wj(n,e){return g(this,null,function*(){let t=L(n),r=yc(t.serializer)+"/documents",i={documents:e.map(l=>mc(t.serializer,l))},s=yield t.invokeStreamingRPC("BatchGetDocuments",r,i,e.length),o=new Map;s.forEach(l=>{let c=k4(t.serializer,l);o.set(c.key.toString(),c)});let a=[];return e.forEach(l=>{let c=o.get(l.toString());j(!!c),a.push(c)}),a})}function Tj(n,e,t){let r=L(n);return r.verifyInitialized(),new TS(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,t)}function Cj(n,e,t){let r=L(n);return r.verifyInitialized(),new wS(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,t)}var bj="OnlineStateTracker",n1=1,r1=10*1e3,AS=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}handleWatchStreamStart(){this.watchStreamFailures===0&&(this.setAndBroadcast("Unknown"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay("online_state_timeout",r1,()=>(this.onlineStateTimer=null,this.logClientOfflineWarningIfNecessary(`Backend didn't respond within ${r1/1e3} seconds.`),this.setAndBroadcast("Offline"),Promise.resolve())))}handleWatchStreamFailure(e){this.state==="Online"?this.setAndBroadcast("Unknown"):(this.watchStreamFailures++,this.watchStreamFailures>=n1&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary(`Connection failed ${n1} times. Most recent error: ${e.toString()}`),this.setAndBroadcast("Offline")))}set(e){this.clearOnlineStateTimer(),this.watchStreamFailures=0,e==="Online"&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(e)}setAndBroadcast(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}logClientOfflineWarningIfNecessary(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.shouldWarnClientIsOffline?(Ne(t),this.shouldWarnClientIsOffline=!1):R(bj,t)}clearOnlineStateTimer(){this.onlineStateTimer!==null&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)}};var bs="RemoteStore",Aj=10,IS=class{constructor(e,t,r,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.writePipeline=[],this.listenTargets=new Map,this.offlineCauses=new Set,this.onNetworkStatusChange=[],this.connectivityMonitor=s,this.connectivityMonitor.addCallback(o=>{r.enqueueAndForget(()=>g(this,null,function*(){Pi(this)&&(R(bs,"Restarting streams for network reachability change."),yield jj(this))}))}),this.onlineStateTracker=new AS(r,i)}};function Ij(n,e,t,r,i){return new IS(n,e,t,r,i)}function Dj(n){let e=L(n);return e.offlineCauses.delete(0),Bc(e)}function Bc(n){return g(this,null,function*(){if(Pi(n))for(let e of n.onNetworkStatusChange)yield e(!0)})}function Rj(n){return g(this,null,function*(){let e=L(n);e.offlineCauses.add(0),yield Ta(e),e.onlineStateTracker.set("Offline")})}function Ta(n){return g(this,null,function*(){for(let e of n.onNetworkStatusChange)yield e(!1)})}function kj(n){return g(this,null,function*(){let e=L(n);R(bs,"RemoteStore shutting down."),e.offlineCauses.add(5),yield Ta(e),e.connectivityMonitor.shutdown(),e.onlineStateTracker.set("Unknown")})}function Kf(n,e){let t=L(n);t.listenTargets.has(e.targetId)||(t.listenTargets.set(e.targetId,e),R_(t)?D_(t):ba(t).isOpen()&&I_(t,e))}function Vc(n,e){let t=L(n),r=ba(t);t.listenTargets.delete(e),r.isOpen()&&JR(t,e),t.listenTargets.size===0&&(r.isOpen()?r.markIdle():Pi(t)&&t.onlineStateTracker.set("Unknown"))}function I_(n,e){if(n.watchChangeAggregator.recordPendingTargetRequest(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(K.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}ba(n).watch(e)}function JR(n,e){n.watchChangeAggregator.recordPendingTargetRequest(e),ba(n).unwatch(e)}function D_(n){n.watchChangeAggregator=new z0({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),getTargetDataForTarget:e=>n.listenTargets.get(e)||null,getDatabaseId:()=>n.datastore.serializer.databaseId}),ba(n).start(),n.onlineStateTracker.handleWatchStreamStart()}function R_(n){return Pi(n)&&!ba(n).isStarted()&&n.listenTargets.size>0}function Pi(n){return L(n).offlineCauses.size===0}function ZR(n){n.watchChangeAggregator=void 0}function Nj(n){return g(this,null,function*(){n.listenTargets.forEach((e,t)=>{I_(n,e)})})}function xj(n,e){return g(this,null,function*(){ZR(n),R_(n)?(n.onlineStateTracker.handleWatchStreamFailure(e),D_(n)):n.onlineStateTracker.set("Unknown")})}function Mj(n,e,t){return g(this,null,function*(){if(n.onlineStateTracker.set("Online"),e instanceof nf&&e.state===2&&e.cause){try{yield Pj(n,e)}catch(r){R(bs,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield _f(n,r)}return}if(e instanceof ea?n.watchChangeAggregator.handleDocumentChange(e):e instanceof tf?n.watchChangeAggregator.handleExistenceFilter(e):n.watchChangeAggregator.handleTargetChange(e),!t.isEqual(K.min()))try{let r=yield zR(n.localStore);t.compareTo(r)>=0&&(yield Oj(n,t))}catch(r){R(bs,"Failed to raise snapshot:",r),yield _f(n,r)}})}function _f(n,e,t){return g(this,null,function*(){if(Oi(e))n.offlineCauses.add(1),yield Ta(n),n.onlineStateTracker.set("Offline"),t||(t=()=>zR(n.localStore)),n.asyncQueue.enqueueRetryable(()=>g(this,null,function*(){R(bs,"Retrying IndexedDB access"),yield t(),n.offlineCauses.delete(1),yield Bc(n)}));else throw e})}function ek(n,e){return e().catch(t=>_f(n,t,e))}function Oj(n,e){let t=n.watchChangeAggregator.createRemoteEvent(e);return t.targetChanges.forEach((r,i)=>{if(r.resumeToken.approximateByteSize()>0){let s=n.listenTargets.get(i);s&&n.listenTargets.set(i,s.withResumeToken(r.resumeToken,e))}}),t.targetMismatches.forEach((r,i)=>{let s=n.listenTargets.get(r);if(!s)return;n.listenTargets.set(r,s.withResumeToken(ot.EMPTY_BYTE_STRING,s.snapshotVersion)),JR(n,r);let o=new ca(s.target,r,i,s.sequenceNumber);I_(n,o)}),n.remoteSyncer.applyRemoteEvent(t)}function Pj(n,e){return g(this,null,function*(){let t=e.cause;for(let r of e.targetIds)n.listenTargets.has(r)&&(yield n.remoteSyncer.rejectListen(r,t),n.listenTargets.delete(r),n.watchChangeAggregator.removeTarget(r))})}function Ca(n){return g(this,null,function*(){let e=L(n),t=Fi(e),r=e.writePipeline.length>0?e.writePipeline[e.writePipeline.length-1].batchId:_i;for(;Fj(e);)try{let i=yield Pz(e.localStore,r);if(i===null){e.writePipeline.length===0&&t.markIdle();break}else r=i.batchId,Lj(e,i)}catch(i){yield _f(e,i)}tk(e)&&nk(e)})}function Fj(n){return Pi(n)&&n.writePipeline.length<Aj}function Lj(n,e){n.writePipeline.push(e);let t=Fi(n);t.isOpen()&&t.handshakeComplete&&t.writeMutations(e.mutations)}function tk(n){return Pi(n)&&!Fi(n).isStarted()&&n.writePipeline.length>0}function nk(n){Fi(n).start()}function Bj(n){return g(this,null,function*(){Fi(n).writeHandshake()})}function Vj(n){return g(this,null,function*(){let e=Fi(n);for(let t of n.writePipeline)e.writeMutations(t.mutations)})}function qj(n,e,t){return g(this,null,function*(){let r=n.writePipeline.shift(),i=B0.from(r,e,t);yield ek(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield Ca(n)})}function Uj(n,e){return g(this,null,function*(){e&&Fi(n).handshakeComplete&&(yield zj(n,e)),tk(n)&&nk(n)})}function zj(n,e){return g(this,null,function*(){if(f4(e.code)){let t=n.writePipeline.shift();Fi(n).inhibitBackoff(),yield ek(n,()=>n.remoteSyncer.rejectFailedWrite(t.batchId,e)),yield Ca(n)}})}function jj(n){return g(this,null,function*(){let e=L(n);e.offlineCauses.add(4),yield Ta(e),e.onlineStateTracker.set("Unknown"),e.offlineCauses.delete(4),yield Bc(e)})}function i1(n,e){return g(this,null,function*(){let t=L(n);t.asyncQueue.verifyOperationInProgress(),R(bs,"RemoteStore received new credentials");let r=Pi(t);t.offlineCauses.add(3),yield Ta(t),r&&t.onlineStateTracker.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.offlineCauses.delete(3),yield Bc(t)})}function DS(n,e){return g(this,null,function*(){let t=L(n);e?(t.offlineCauses.delete(2),yield Bc(t)):e||(t.offlineCauses.add(2),yield Ta(t),t.onlineStateTracker.set("Unknown"))})}function ba(n){return n.watchStream||(n.watchStream=Cj(n.datastore,n.asyncQueue,{onOpen:Nj.bind(null,n),onClose:xj.bind(null,n),onWatchChange:Mj.bind(null,n)}),n.onNetworkStatusChange.push(e=>g(this,null,function*(){e?(n.watchStream.inhibitBackoff(),R_(n)?D_(n):n.onlineStateTracker.set("Unknown")):(yield n.watchStream.stop(),ZR(n))}))),n.watchStream}function Fi(n){return n.writeStream||(n.writeStream=Tj(n.datastore,n.asyncQueue,{onOpen:Bj.bind(null,n),onClose:Uj.bind(null,n),onHandshakeComplete:Vj.bind(null,n),onMutationResult:qj.bind(null,n)}),n.onNetworkStatusChange.push(e=>g(this,null,function*(){e?(n.writeStream.inhibitBackoff(),yield Ca(n)):(yield n.writeStream.stop(),n.writePipeline.length>0&&(R(bs,`Stopping write stream with ${n.writePipeline.length} pending writes`),n.writePipeline=[]))}))),n.writeStream}var Gj="AsyncQueue",RS=class n{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new je,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){let o=Date.now()+r,a=new n(e,t,o,i,s);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new T(v.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function Aa(n,e){if(Ne(Gj,`${e}: ${n}`),Oi(n))return new T(v.UNAVAILABLE,`${e}: ${n}`);throw n}var Ef=class n{constructor(e){e?this.comparator=(t,r)=>e(t,r)||P.comparator(t.key,r.key):this.comparator=(t,r)=>P.comparator(t.key,r.key),this.keyedMap=Ql(),this.sortedSet=new be(this.comparator)}static emptySet(e){return new n(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let r=new n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}};var wf=class{constructor(){this.changeMap=new be(P.comparator)}track(e){let t=e.doc.key,r=this.changeMap.get(t);if(!r){this.changeMap=this.changeMap.insert(t,e);return}e.type!==0&&r.type===3?this.changeMap=this.changeMap.insert(t,e):e.type===3&&r.type!==1?this.changeMap=this.changeMap.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.changeMap=this.changeMap.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.changeMap=this.changeMap.remove(t):e.type===1&&r.type===2?this.changeMap=this.changeMap.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):V()}getChanges(){let e=[];return this.changeMap.inorderTraversal((t,r)=>{e.push(r)}),e}},fa=class n{constructor(e,t,r,i,s,o,a,l,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,i,s){let o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new n(e,t,Ef.emptySet(t),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(this.fromCache!==e.fromCache||this.hasCachedResults!==e.hasCachedResults||this.syncStateChanged!==e.syncStateChanged||!this.mutatedKeys.isEqual(e.mutatedKeys)||!Oc(this.query,e.query)||!this.docs.isEqual(e.docs)||!this.oldDocs.isEqual(e.oldDocs))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}};var kS=class{constructor(){this.viewSnap=void 0,this.listeners=[]}};function Hj(){return new NS}var NS=class{constructor(){this.queries=new ur(e=>eR(e),Oc),this.onlineState="Unknown",this.snapshotsInSyncListeners=new Set}};function k_(n,e){return g(this,null,function*(){let t=L(n),r=e.query,i=!1,s=t.queries.get(r);if(s||(i=!0,s=new kS),i)try{s.viewSnap=yield t.onListen(r)}catch(o){let a=Aa(o,`Initialization of query '${Wo(e.query)}' failed`);e.onError(a);return}t.queries.set(r,s),s.listeners.push(e),e.applyOnlineStateChange(t.onlineState),s.viewSnap&&e.onViewSnapshot(s.viewSnap)&&x_(t)})}function N_(n,e){return g(this,null,function*(){let t=L(n),r=e.query,i=!1,s=t.queries.get(r);if(s){let o=s.listeners.indexOf(e);o>=0&&(s.listeners.splice(o,1),i=s.listeners.length===0)}if(i)return t.queries.delete(r),t.onUnlisten(r)})}function Kj(n,e){let t=L(n),r=!1;for(let i of e){let s=i.query,o=t.queries.get(s);if(o){for(let a of o.listeners)a.onViewSnapshot(i)&&(r=!0);o.viewSnap=i}}r&&x_(t)}function Wj(n,e,t){let r=L(n),i=r.queries.get(e);if(i)for(let s of i.listeners)s.onError(t);r.queries.delete(e)}function $j(n,e){let t=L(n);t.onlineState=e;let r=!1;t.queries.forEach((i,s)=>{for(let o of s.listeners)o.applyOnlineStateChange(e)&&(r=!0)}),r&&x_(t)}function Qj(n,e){L(n).snapshotsInSyncListeners.add(e),e.next()}function Yj(n,e){L(n).snapshotsInSyncListeners.delete(e)}function x_(n){n.snapshotsInSyncListeners.forEach(e=>{e.next()})}var Cc=class{constructor(e,t,r){this.query=e,this.queryObserver=t,this.raisedInitialEvent=!1,this.snap=null,this.onlineState="Unknown",this.options=r||{}}onViewSnapshot(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new fa(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.raisedInitialEvent?this.shouldRaiseEvent(e)&&(this.queryObserver.next(e),t=!0):this.shouldRaiseInitialEvent(e,this.onlineState)&&(this.raiseInitialEvent(e),t=!0),this.snap=e,t}onError(e){this.queryObserver.error(e)}applyOnlineStateChange(e){this.onlineState=e;let t=!1;return this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,e)&&(this.raiseInitialEvent(this.snap),t=!0),t}shouldRaiseInitialEvent(e,t){if(!e.fromCache)return!0;let r=t!=="Offline";return this.options.waitForSyncWhenOnline&&r?!1:!e.docs.isEmpty()||e.hasCachedResults||t==="Offline"}shouldRaiseEvent(e){if(e.docChanges.length>0)return!0;let t=this.snap&&this.snap.hasPendingWrites!==e.hasPendingWrites;return e.syncStateChanged||t?this.options.includeMetadataChanges===!0:!1}raiseInitialEvent(e){e=fa.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.raisedInitialEvent=!0,this.queryObserver.next(e)}};var xS=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.addedKeys=r,this.removedKeys=i}static fromSnapshot(e,t){let r=Z(),i=Z();for(let s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key);break}return new n(e,t.fromCache,r,i)}};var Tf=class{constructor(e){this.serializer=e}toDocumentKey(e){return ar(this.serializer,e)}toMutableDocument(e){return e.metadata.exists?TR(this.serializer,e.document,!1):Ye.newNoDocument(this.toDocumentKey(e.metadata.name),this.toSnapshotVersion(e.metadata.readTime))}toSnapshotVersion(e){return Ge(e)}},MS=class{constructor(e,t,r){this.bundleMetadata=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=rk(e)}addSizedElement(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.payload.namedQuery)this.queries.push(e.payload.namedQuery);else if(e.payload.documentMetadata){this.documents.push({metadata:e.payload.documentMetadata}),e.payload.documentMetadata.exists||++t;let r=de.fromString(e.payload.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.payload.document&&(this.documents[this.documents.length-1].document=e.payload.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}getQueryDocumentMapping(e){let t=new Map,r=new Tf(this.serializer);for(let i of e)if(i.metadata.queries){let s=r.toDocumentKey(i.metadata.name);for(let o of i.metadata.queries){let a=(t.get(o)||Z()).add(s);t.set(o,a)}}return t}complete(){return g(this,null,function*(){let e=yield jz(this.localStore,new Tf(this.serializer),this.documents,this.bundleMetadata.id),t=this.getQueryDocumentMapping(this.documents);for(let r of this.queries)yield Wz(this.localStore,r,t.get(r.name));return this.progress.taskState="Success",{progress:this.progress,changedCollectionGroups:this.collectionGroups,changedDocs:e}})}};function rk(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}function Xj(n){return{taskState:"Success",documentsLoaded:n.totalDocuments,bytesLoaded:n.totalBytes,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}var Cf=class{constructor(e){this.key=e}},bf=class{constructor(e){this.key=e}},Af=class{constructor(e,t){this.query=e,this._syncedDocuments=t,this.syncState=null,this.hasCachedResults=!1,this.current=!1,this.limboDocuments=Z(),this.mutatedKeys=Z(),this.docComparator=nR(e),this.documentSet=new Ef(this.docComparator)}get syncedDocuments(){return this._syncedDocuments}computeDocChanges(e,t){let r=t?t.changeSet:new wf,i=t?t.documentSet:this.documentSet,s=t?t.mutatedKeys:this.mutatedKeys,o=i,a=!1,l=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,c=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((u,d)=>{let h=i.get(u),p=Pc(this.query,d)?d:null,y=h?this.mutatedKeys.has(h.key):!1,S=p?p.hasLocalMutations||this.mutatedKeys.has(p.key)&&p.hasCommittedMutations:!1,_=!1;h&&p?h.data.isEqual(p.data)?y!==S&&(r.track({type:3,doc:p}),_=!0):this.shouldWaitForSyncedDocument(h,p)||(r.track({type:2,doc:p}),_=!0,(l&&this.docComparator(p,l)>0||c&&this.docComparator(p,c)<0)&&(a=!0)):!h&&p?(r.track({type:0,doc:p}),_=!0):h&&!p&&(r.track({type:1,doc:h}),_=!0,(l||c)&&(a=!0)),_&&(p?(o=o.add(p),S?s=s.add(u):s=s.delete(u)):(o=o.delete(u),s=s.delete(u)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let u=this.query.limitType==="F"?o.last():o.first();o=o.delete(u.key),s=s.delete(u.key),r.track({type:1,doc:u})}return{documentSet:o,changeSet:r,needsRefill:a,mutatedKeys:s}}shouldWaitForSyncedDocument(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){let s=this.documentSet;this.documentSet=e.documentSet,this.mutatedKeys=e.mutatedKeys;let o=e.changeSet.getChanges();o.sort((d,h)=>Jj(d.type,h.type)||this.docComparator(d.doc,h.doc)),this.applyTargetChange(r),i=i??!1;let a=t&&!i?this.updateLimboDocuments():[],c=this.limboDocuments.size===0&&this.current&&!i?1:0,u=c!==this.syncState;return this.syncState=c,o.length===0&&!u?{limboChanges:a}:{snapshot:new fa(this.query,e.documentSet,s,o,e.mutatedKeys,c===0,u,!1,r?r.resumeToken.approximateByteSize()>0:!1),limboChanges:a}}applyOnlineStateChange(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new wf,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}}shouldBeInLimbo(e){return!(this._syncedDocuments.has(e)||!this.documentSet.has(e)||this.documentSet.get(e).hasLocalMutations)}applyTargetChange(e){e&&(e.addedDocuments.forEach(t=>this._syncedDocuments=this._syncedDocuments.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this._syncedDocuments=this._syncedDocuments.delete(t)),this.current=e.current)}updateLimboDocuments(){if(!this.current)return[];let e=this.limboDocuments;this.limboDocuments=Z(),this.documentSet.forEach(r=>{this.shouldBeInLimbo(r.key)&&(this.limboDocuments=this.limboDocuments.add(r.key))});let t=[];return e.forEach(r=>{this.limboDocuments.has(r)||t.push(new bf(r))}),this.limboDocuments.forEach(r=>{e.has(r)||t.push(new Cf(r))}),t}synchronizeWithPersistedState(e){this._syncedDocuments=e.remoteKeys,this.limboDocuments=Z();let t=this.computeDocChanges(e.documents);return this.applyChanges(t,!0)}computeInitialSnapshot(){return fa.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,this.syncState===0,this.hasCachedResults)}};function Jj(n,e){let t=r=>{switch(r){case 0:return 1;case 2:return 2;case 3:return 2;case 1:return 0;default:return V()}};return t(n)-t(e)}var Li="SyncEngine",OS=class{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}},PS=class{constructor(e){this.key=e,this.receivedDocument=!1}},FS=class{constructor(e,t,r,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.syncEngineListener={},this.queryViewsByQuery=new ur(a=>eR(a),Oc),this.queriesByTarget=new Map,this.enqueuedLimboResolutions=new Set,this.activeLimboTargetsByKey=new be(P.comparator),this.activeLimboResolutionsByTarget=new Map,this.limboDocumentRefs=new _c,this.mutationUserCallbacks={},this.pendingWritesCallbacks=new Map,this.limboTargetIdGenerator=ua.forSyncEngine(),this.onlineState="Unknown",this._isPrimaryClient=void 0}get isPrimaryClient(){return this._isPrimaryClient===!0}};function Zj(n,e,t,r,i,s,o){let a=new FS(n,e,t,r,i,s);return o&&(a._isPrimaryClient=!0),a}function e9(n,e){return g(this,null,function*(){let t=B_(n),r,i,s=t.queryViewsByQuery.get(e);if(s)r=s.targetId,t.sharedClientState.addLocalQueryTarget(r),i=s.view.computeInitialSnapshot();else{let o=yield da(t.localStore,Pt(e)),a=t.sharedClientState.addLocalQueryTarget(o.targetId);r=o.targetId,i=yield M_(t,e,r,a==="current",o.resumeToken),t.isPrimaryClient&&Kf(t.remoteStore,o)}return i})}function M_(n,e,t,r,i){return g(this,null,function*(){n.applyDocChanges=(d,h,p)=>u9(n,d,h,p);let s=yield Hf(n.localStore,e,!0),o=new Af(e,s.remoteKeys),a=o.computeDocChanges(s.documents),l=gc.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),c=o.applyChanges(a,n.isPrimaryClient,l);F_(n,t,c.limboChanges);let u=new OS(e,t,o);return n.queryViewsByQuery.set(e,u),n.queriesByTarget.has(t)?n.queriesByTarget.get(t).push(e):n.queriesByTarget.set(t,[e]),c.snapshot})}function t9(n,e){return g(this,null,function*(){let t=L(n),r=t.queryViewsByQuery.get(e),i=t.queriesByTarget.get(r.targetId);if(i.length>1){t.queriesByTarget.set(r.targetId,i.filter(s=>!Oc(s,e))),t.queryViewsByQuery.delete(e);return}t.isPrimaryClient?(t.sharedClientState.removeLocalQueryTarget(r.targetId),t.sharedClientState.isActiveQueryTarget(r.targetId)||(yield ha(t.localStore,r.targetId,!1).then(()=>{t.sharedClientState.clearQueryState(r.targetId),Vc(t.remoteStore,r.targetId),pa(t,r.targetId)}).catch(Mi))):(pa(t,r.targetId),yield ha(t.localStore,r.targetId,!0))})}function n9(n,e,t){return g(this,null,function*(){let r=V_(n);try{let i=yield Iz(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),l9(r,i.batchId,t),yield Nr(r,i.changes),yield Ca(r.remoteStore)}catch(i){let s=Aa(i,"Failed to persist write");t.reject(s)}})}function ik(n,e){return g(this,null,function*(){let t=L(n);try{let r=yield xz(t.localStore,e);e.targetChanges.forEach((i,s)=>{let o=t.activeLimboResolutionsByTarget.get(s);o&&(j(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.receivedDocument=!0:i.modifiedDocuments.size>0?j(o.receivedDocument):i.removedDocuments.size>0&&(j(o.receivedDocument),o.receivedDocument=!1))}),yield Nr(t,r,e)}catch(r){yield Mi(r)}})}function s1(n,e,t){let r=L(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.queryViewsByQuery.forEach((s,o)=>{let a=o.view.applyOnlineStateChange(e);a.snapshot&&i.push(a.snapshot)}),$j(r.eventManager,e),i.length&&r.syncEngineListener.onWatchChange(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function r9(n,e,t){return g(this,null,function*(){let r=L(n);r.sharedClientState.updateQueryState(e,"rejected",t);let i=r.activeLimboResolutionsByTarget.get(e),s=i&&i.key;if(s){let o=new be(P.comparator);o=o.insert(s,Ye.newNoDocument(s,K.min()));let a=Z().add(s),l=new pc(K.min(),new Map,new be(J),o,a);yield ik(r,l),r.activeLimboTargetsByKey=r.activeLimboTargetsByKey.remove(s),r.activeLimboResolutionsByTarget.delete(e),L_(r)}else yield ha(r.localStore,e,!1).then(()=>pa(r,e,t)).catch(Mi)})}function i9(n,e){return g(this,null,function*(){let t=L(n),r=e.batch.batchId;try{let i=yield Dz(t.localStore,e);P_(t,r,null),O_(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield Nr(t,i)}catch(i){yield Mi(i)}})}function s9(n,e,t){return g(this,null,function*(){let r=L(n);try{let i=yield kz(r.localStore,e);P_(r,e,t),O_(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield Nr(r,i)}catch(i){yield Mi(i)}})}function o9(n,e){return g(this,null,function*(){let t=L(n);Pi(t.remoteStore)||R(Li,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let r=yield Nz(t.localStore);if(r===_i){e.resolve();return}let i=t.pendingWritesCallbacks.get(r)||[];i.push(e),t.pendingWritesCallbacks.set(r,i)}catch(r){let i=Aa(r,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}})}function O_(n,e){(n.pendingWritesCallbacks.get(e)||[]).forEach(t=>{t.resolve()}),n.pendingWritesCallbacks.delete(e)}function a9(n,e){n.pendingWritesCallbacks.forEach(t=>{t.forEach(r=>{r.reject(new T(v.CANCELLED,e))})}),n.pendingWritesCallbacks.clear()}function l9(n,e,t){let r=n.mutationUserCallbacks[n.currentUser.toKey()];r||(r=new be(J)),r=r.insert(e,t),n.mutationUserCallbacks[n.currentUser.toKey()]=r}function P_(n,e,t){let r=L(n),i=r.mutationUserCallbacks[r.currentUser.toKey()];if(i){let s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.mutationUserCallbacks[r.currentUser.toKey()]=i}}function pa(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let r of n.queriesByTarget.get(e))n.queryViewsByQuery.delete(r),t&&n.syncEngineListener.onWatchError(r,t);n.queriesByTarget.delete(e),n.isPrimaryClient&&n.limboDocumentRefs.removeReferencesForId(e).forEach(i=>{n.limboDocumentRefs.containsKey(i)||sk(n,i)})}function sk(n,e){n.enqueuedLimboResolutions.delete(e.path.canonicalString());let t=n.activeLimboTargetsByKey.get(e);t!==null&&(Vc(n.remoteStore,t),n.activeLimboTargetsByKey=n.activeLimboTargetsByKey.remove(e),n.activeLimboResolutionsByTarget.delete(t),L_(n))}function F_(n,e,t){for(let r of t)r instanceof Cf?(n.limboDocumentRefs.addReference(r.key,e),c9(n,r)):r instanceof bf?(R(Li,"Document no longer in limbo: "+r.key),n.limboDocumentRefs.removeReference(r.key,e),n.limboDocumentRefs.containsKey(r.key)||sk(n,r.key)):V()}function c9(n,e){let t=e.key,r=t.path.canonicalString();!n.activeLimboTargetsByKey.get(t)&&!n.enqueuedLimboResolutions.has(r)&&(R(Li,"New document in limbo: "+t),n.enqueuedLimboResolutions.add(r),L_(n))}function L_(n){for(;n.enqueuedLimboResolutions.size>0&&n.activeLimboTargetsByKey.size<n.maxConcurrentLimboResolutions;){let e=n.enqueuedLimboResolutions.values().next().value;n.enqueuedLimboResolutions.delete(e);let t=new P(de.fromString(e)),r=n.limboTargetIdGenerator.next();n.activeLimboResolutionsByTarget.set(r,new PS(t)),n.activeLimboTargetsByKey=n.activeLimboTargetsByKey.insert(t,r),Kf(n.remoteStore,new ca(Pt(wa(t.path)),r,"TargetPurposeLimboResolution",Xt.INVALID))}}function Nr(n,e,t){return g(this,null,function*(){let r=L(n),i=[],s=[],o=[];r.queryViewsByQuery.isEmpty()||(r.queryViewsByQuery.forEach((a,l)=>{o.push(r.applyDocChanges(l,e,t).then(c=>{if((c||t)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(l.targetId,c?.fromCache?"not-current":"current"),c){i.push(c);let u=xS.fromSnapshot(l.targetId,c);s.push(u)}}))}),yield Promise.all(o),r.syncEngineListener.onWatchChange(i),yield Oz(r.localStore,s))})}function u9(n,e,t,r){return g(this,null,function*(){let i=e.view.computeDocChanges(t);i.needsRefill&&(i=yield Hf(n.localStore,e.query,!1).then(({documents:l})=>e.view.computeDocChanges(l,i)));let s=r&&r.targetChanges.get(e.targetId),o=r&&r.targetMismatches.get(e.targetId)!=null,a=e.view.applyChanges(i,n.isPrimaryClient,s,o);return F_(n,e.targetId,a.limboChanges),a.snapshot})}function d9(n,e){return g(this,null,function*(){let t=L(n);if(!t.currentUser.isEqual(e)){R(Li,"User change. New user:",e.toKey());let i=yield UR(t.localStore,e);t.currentUser=e,a9(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,i.removedBatchIds,i.addedBatchIds),yield Nr(t,i.affectedDocuments)}})}function h9(n,e){let t=L(n),r=t.activeLimboResolutionsByTarget.get(e);if(r&&r.receivedDocument)return Z().add(r.key);{let i=Z(),s=t.queriesByTarget.get(e);if(!s)return i;for(let o of s){let a=t.queryViewsByQuery.get(o);i=i.unionWith(a.view.syncedDocuments)}return i}}function f9(n,e){return g(this,null,function*(){let t=L(n),r=yield Hf(t.localStore,e.query,!0),i=e.view.synchronizeWithPersistedState(r);return t.isPrimaryClient&&F_(t,e.targetId,i.limboChanges),i})}function p9(n,e){return g(this,null,function*(){let t=L(n);return HR(t.localStore,e).then(r=>Nr(t,r))})}function g9(n,e,t,r){return g(this,null,function*(){let i=L(n),s=yield Vz(i.localStore,e);if(s===null){R(Li,"Cannot apply mutation batch with id: "+e);return}t==="pending"?yield Ca(i.remoteStore):t==="acknowledged"||t==="rejected"?(P_(i,e,r||null),O_(i,e),qz(i.localStore,e)):V(),yield Nr(i,s)})}function m9(n,e){return g(this,null,function*(){let t=L(n);if(B_(t),V_(t),e===!0&&t._isPrimaryClient!==!0){let r=t.sharedClientState.getAllActiveQueryTargets(),i=yield o1(t,r.toArray());t._isPrimaryClient=!0,yield DS(t.remoteStore,!0);for(let s of i)Kf(t.remoteStore,s)}else if(e===!1&&t._isPrimaryClient!==!1){let r=[],i=Promise.resolve();t.queriesByTarget.forEach((s,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):i=i.then(()=>(pa(t,o),ha(t.localStore,o,!0))),Vc(t.remoteStore,o)}),yield i,yield o1(t,r),y9(t),t._isPrimaryClient=!1,yield DS(t.remoteStore,!1)}})}function y9(n){let e=L(n);e.activeLimboResolutionsByTarget.forEach((t,r)=>{Vc(e.remoteStore,r)}),e.limboDocumentRefs.removeAllReferences(),e.activeLimboResolutionsByTarget=new Map,e.activeLimboTargetsByKey=new be(P.comparator)}function o1(n,e,t){return g(this,null,function*(){let r=L(n),i=[],s=[];for(let o of e){let a,l=r.queriesByTarget.get(o);if(l&&l.length!==0){a=yield da(r.localStore,Pt(l[0]));for(let c of l){let u=r.queryViewsByQuery.get(c),d=yield f9(r,u);d.snapshot&&s.push(d.snapshot)}}else{let c=yield GR(r.localStore,o);a=yield da(r.localStore,c),yield M_(r,ok(c),o,!1,a.resumeToken)}i.push(a)}return r.syncEngineListener.onWatchChange(s),i})}function ok(n){return Z1(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function v9(n){let e=L(n);return Uz(e.localStore)}function S9(n,e,t,r){return g(this,null,function*(){let i=L(n);if(i._isPrimaryClient){R(Li,"Ignoring unexpected query state notification.");return}let s=i.queriesByTarget.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{let o=yield HR(i.localStore,tR(s[0])),a=pc.createSynthesizedRemoteEventForCurrentChange(e,t==="current",ot.EMPTY_BYTE_STRING);yield Nr(i,o,a);break}case"rejected":{yield ha(i.localStore,e,!0),pa(i,e,r);break}default:V()}})}function _9(n,e,t){return g(this,null,function*(){let r=B_(n);if(r._isPrimaryClient){for(let i of e){if(r.queriesByTarget.has(i)){R(Li,"Adding an already active target "+i);continue}let s=yield GR(r.localStore,i),o=yield da(r.localStore,s);yield M_(r,ok(s),o.targetId,!1,o.resumeToken),Kf(r.remoteStore,o)}for(let i of t)r.queriesByTarget.has(i)&&(yield ha(r.localStore,i,!1).then(()=>{Vc(r.remoteStore,i),pa(r,i)}).catch(Mi))}})}function B_(n){let e=L(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=ik.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=h9.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=r9.bind(null,e),e.syncEngineListener.onWatchChange=Kj.bind(null,e.eventManager),e.syncEngineListener.onWatchError=Wj.bind(null,e.eventManager),e}function V_(n){let e=L(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=i9.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=s9.bind(null,e),e}function E9(n,e,t){let r=L(n);w9(r,e,t).then(i=>{r.sharedClientState.notifyBundleLoaded(i)})}function w9(n,e,t){return g(this,null,function*(){try{let r=yield e.getMetadata();if(yield Gz(n.localStore,r))return yield e.close(),t._completeWith(Xj(r)),Promise.resolve(new Set);t._updateProgress(rk(r));let s=new MS(r,n.localStore,e.serializer),o=yield e.nextElement();for(;o;){let l=yield s.addSizedElement(o);l&&t._updateProgress(l),o=yield e.nextElement()}let a=yield s.complete();return yield Nr(n,a.changedDocs,void 0),yield Hz(n.localStore,r),t._completeWith(a.progress),Promise.resolve(a.changedCollectionGroups)}catch(r){return pn(Li,`Loading bundle failed with ${r}`),t._failWith(r),Promise.resolve(new Set)}})}var bc=class{constructor(){this.synchronizeTabs=!1}initialize(e){return g(this,null,function*(){this.serializer=Lc(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),yield this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)})}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return qR(this.persistence,new gf,e.initialUser,this.serializer)}createPersistence(e){return new ff(pf.factory,this.serializer)}createSharedClientState(e){return new vf}terminate(){return g(this,null,function*(){this.gcScheduler&&this.gcScheduler.stop(),yield this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}};var If=class n extends bc{constructor(e,t,r){super(),this.onlineComponentProvider=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.synchronizeTabs=!1}initialize(e){return g(this,null,function*(){yield _p(n.prototype,this,"initialize").call(this,e),yield this.onlineComponentProvider.initialize(this,e),yield V_(this.onlineComponentProvider.syncEngine),yield Ca(this.onlineComponentProvider.remoteStore),yield this.persistence.setPrimaryStateListener(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}createLocalStore(e){return qR(this.persistence,new gf,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){let r=this.persistence.referenceDelegate.garbageCollector;return new nS(r,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){let r=new S0(t,this.persistence);return new v0(e.asyncQueue,r)}createPersistence(e){let t=b_(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?fn.withCacheSize(this.cacheSizeBytes):fn.DEFAULT;return new mS(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,XR(),fj(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new vf}},LS=class n extends If{constructor(e,t){super(e,t,!1),this.onlineComponentProvider=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){return g(this,null,function*(){yield _p(n.prototype,this,"initialize").call(this,e);let t=this.onlineComponentProvider.syncEngine;this.sharedClientState instanceof nc&&(this.sharedClientState.syncEngine={applyBatchState:g9.bind(null,t),applyTargetState:S9.bind(null,t),applyActiveTargetsChange:_9.bind(null,t),getActiveClients:v9.bind(null,t),synchronizeWithChangedDocuments:p9.bind(null,t)},yield this.sharedClientState.start()),yield this.persistence.setPrimaryStateListener(r=>g(this,null,function*(){yield m9(this.onlineComponentProvider.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())}))})}createSharedClientState(e){let t=XR();if(!nc.isAvailable(t))throw new T(v.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let r=b_(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new nc(t,e.asyncQueue,r,e.clientId,e.initialUser)}},Ac=class{initialize(e,t){return g(this,null,function*(){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>s1(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=d9.bind(null,this.syncEngine),yield DS(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(e){return Hj()}createDatastore(e){let t=Lc(e.databaseInfo.databaseId),r=dj(e.databaseInfo);return _j(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return Ij(this.localStore,this.datastore,e.asyncQueue,t=>s1(this.syncEngine,t,0),hj())}createSyncEngine(e,t){return Zj(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return kj(this.remoteStore)}};var T9=10240;function C9(n,e=T9){let t=0;return{read(){return g(this,null,function*(){if(t<n.byteLength){let s={value:n.slice(t,t+e),done:!1};return t+=e,s}return{done:!0}})},cancel(){return g(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}function q_(n,e,t){if(!t)throw new T(v.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function U_(n,e,t,r){if(e===!0&&r===!0)throw new T(v.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function a1(n){if(!P.isDocumentKey(n))throw new T(v.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function l1(n){if(P.isDocumentKey(n))throw new T(v.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function b9(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function qc(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=A9(n);return e?`a custom ${e} object`:"an object"}}else return typeof n=="function"?"a function":V()}function A9(n){return n.constructor?n.constructor.name:null}function oe(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new T(v.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=qc(n);throw new T(v.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function ak(n,e){if(e<=0)throw new T(v.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}function I9(n,e){if(!(n instanceof Uint8Array))throw new T(v.INVALID_ARGUMENT,`NodePlatform.toByteStreamReader expects source to be Uint8Array, got ${qc(n)}`);return C9(n,e)}var ga=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.scheduleEvent(this.observer.next,e)}error(e){this.observer.error?this.scheduleEvent(this.observer.error,e):Ne("Uncaught Error in snapshot listener:",e.toString())}mute(){this.muted=!0}scheduleEvent(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}};var BS=class{constructor(e,t){this.payload=e,this.byteLength=t}isBundleMetadata(){return"metadata"in this.payload}};var VS=class{constructor(e,t){this.reader=e,this.serializer=t,this.metadata=new je,this.buffer=new Uint8Array,this.textDecoder=p4(),this.nextElementImpl().then(r=>{r&&r.isBundleMetadata()?this.metadata.resolve(r.payload.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r?.payload)}`))},r=>this.metadata.reject(r))}close(){return this.reader.cancel()}getMetadata(){return g(this,null,function*(){return this.metadata.promise})}nextElement(){return g(this,null,function*(){return yield this.getMetadata(),this.nextElementImpl()})}nextElementImpl(){return g(this,null,function*(){let e=yield this.readLength();if(e===null)return null;let t=this.textDecoder.decode(e),r=Number(t);isNaN(r)&&this.raiseError(`length string (${t}) is not valid number`);let i=yield this.readJsonString(r);return new BS(JSON.parse(i),e.length+r)})}indexOfOpenBracket(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}readLength(){return g(this,null,function*(){for(;this.indexOfOpenBracket()<0&&!(yield this.pullMoreDataToBuffer()););if(this.buffer.length===0)return null;let e=this.indexOfOpenBracket();e<0&&this.raiseError("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t})}readJsonString(e){return g(this,null,function*(){for(;this.buffer.length<e;)(yield this.pullMoreDataToBuffer())&&this.raiseError("Reached the end of bundle when more is expected.");let t=this.textDecoder.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t})}raiseError(e){throw this.reader.cancel(),new Error(`Invalid bundle format: ${e}`)}pullMoreDataToBuffer(){return g(this,null,function*(){let e=yield this.reader.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done})}};function D9(n,e){return new VS(n,e)}var qS=class{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}lookup(e){return g(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new T(v.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");let t=yield wj(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t})}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastWriteError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new ki(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){return g(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{let i=P.fromPath(r);this.mutations.push(new dc(i,this.precondition(i)))}),yield Ej(this.datastore,this.mutations),this.committed=!0})}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else if(e.isNoDocument())t=K.min();else throw V();let r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new T(v.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(K.min())?Le.exists(!1):Le.updateTime(t):Le.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(K.min()))throw new T(v.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Le.updateTime(t)}else return Le.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}};var US=class{constructor(e,t,r,i,s){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=i,this.deferred=s,this.attemptsRemaining=r.maxAttempts,this.backoff=new Tc(this.asyncQueue,"transaction_retry")}run(){this.attemptsRemaining-=1,this.runWithBackOff()}runWithBackOff(){this.backoff.backoffAndRun(()=>g(this,null,function*(){let e=new qS(this.datastore),t=this.tryRunUpdateFunction(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(i=>{this.handleTransactionError(i)}))}).catch(r=>{this.handleTransactionError(r)})}))}tryRunUpdateFunction(e){try{let t=this.updateFunction(e);return xc(t)||!t.catch||!t.then?(this.deferred.reject(Error("Transaction callback must return a Promise")),null):t}catch(t){return this.deferred.reject(t),null}}handleTransactionError(e){this.attemptsRemaining>0&&this.isRetryableTransactionError(e)?(this.attemptsRemaining-=1,this.asyncQueue.enqueueAndForget(()=>(this.runWithBackOff(),Promise.resolve()))):this.deferred.reject(e)}isRetryableTransactionError(e){if(e.name==="FirebaseError"){let t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!yR(t)}return!1}};var Ni="FirestoreClient",R9=100,k9=11,N9=20,x9=22,zS=class{constructor(e,t,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=Xe.UNAUTHENTICATED,this.clientId=Hh.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,s=>g(this,null,function*(){R(Ni,"Received user=",s.uid),yield this.authCredentialListener(s),this.user=s})),this.appCheckCredentials.start(r,s=>(R(Ni,"Received new app check token=",s),this.appCheckCredentialListener(s,this.user)))}getConfiguration(){return g(this,null,function*(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:R9}})}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new T(v.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let e=new je;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>g(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=Aa(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};function jh(n,e){return g(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),R(Ni,"Initializing OfflineComponentProvider");let t=yield n.getConfiguration();yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(i=>g(this,null,function*(){r.isEqual(i)||(yield UR(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e})}function jS(n,e){return g(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield z_(n);R(Ni,"Initializing OnlineComponentProvider");let r=yield n.getConfiguration();yield e.initialize(t,r),n.setCredentialChangeListener(i=>i1(e.remoteStore,i)),n.setAppCheckTokenChangeListener((i,s)=>i1(e.remoteStore,s)),n._onlineComponents=e})}function lk(n){return n.name==="FirebaseError"?n.code===v.FAILED_PRECONDITION||n.code===v.UNIMPLEMENTED:typeof DOMException<"u"&&n instanceof DOMException?n.code===x9||n.code===N9||n.code===k9:!0}function z_(n){return g(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){R(Ni,"Using user provided OfflineComponentProvider");try{yield jh(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!lk(t))throw t;pn("Error using user provided cache. Falling back to memory cache: "+t),yield jh(n,new bc)}}else R(Ni,"Using default OfflineComponentProvider"),yield jh(n,new bc);return n._offlineComponents})}function Wf(n){return g(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(R(Ni,"Using user provided OnlineComponentProvider"),yield jS(n,n._uninitializedComponentsProvider._online)):(R(Ni,"Using default OnlineComponentProvider"),yield jS(n,new Ac))),n._onlineComponents})}function ck(n){return z_(n).then(e=>e.persistence)}function j_(n){return z_(n).then(e=>e.localStore)}function uk(n){return Wf(n).then(e=>e.remoteStore)}function G_(n){return Wf(n).then(e=>e.syncEngine)}function M9(n){return Wf(n).then(e=>e.datastore)}function ma(n){return g(this,null,function*(){let e=yield Wf(n),t=e.eventManager;return t.onListen=e9.bind(null,e.syncEngine),t.onUnlisten=t9.bind(null,e.syncEngine),t})}function O9(n){return n.asyncQueue.enqueue(()=>g(this,null,function*(){let e=yield ck(n),t=yield uk(n);return e.setNetworkEnabled(!0),Dj(t)}))}function P9(n){return n.asyncQueue.enqueue(()=>g(this,null,function*(){let e=yield ck(n),t=yield uk(n);return e.setNetworkEnabled(!1),Rj(t)}))}function F9(n){let e=new je;return n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){let t=yield G_(n);return o9(t,e)})),e.promise}function L9(n,e,t,r){let i=new ga(r),s=new Cc(e,i,t);return n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){let o=yield ma(n);return k_(o,s)})),()=>{i.mute(),n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){let o=yield ma(n);return N_(o,s)}))}}function B9(n,e){let t=new je;return n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){let r=yield j_(n);return j9(r,e,t)})),t.promise}function dk(n,e,t={}){let r=new je;return n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){let i=yield ma(n);return G9(i,n.asyncQueue,e,t,r)})),r.promise}function V9(n,e){let t=new je;return n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){let r=yield j_(n);return H9(r,e,t)})),t.promise}function hk(n,e,t={}){let r=new je;return n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){let i=yield ma(n);return K9(i,n.asyncQueue,e,t,r)})),r.promise}function q9(n,e){let t=new je;return n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){let r=yield G_(n);return n9(r,e,t)})),t.promise}function U9(n,e){let t=new ga(e);return n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){let r=yield ma(n);return Qj(r,t)})),()=>{t.mute(),n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){let r=yield ma(n);return Yj(r,t)}))}}function z9(n,e,t){let r=new je;return n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){let i=yield M9(n);new US(n.asyncQueue,i,t,e,r).run()})),r.promise}function j9(n,e,t){return g(this,null,function*(){try{let r=yield Fz(n,e);r.isFoundDocument()?t.resolve(r):r.isNoDocument()?t.resolve(null):t.reject(new T(v.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(r){let i=Aa(r,`Failed to get document '${e} from cache`);t.reject(i)}})}function G9(n,e,t,r,i){let s=new ga({next:a=>{e.enqueueAndForget(()=>N_(n,o));let l=a.docs.has(t);!l&&a.fromCache?i.reject(new T(v.UNAVAILABLE,"Failed to get document because the client is offline.")):l&&a.fromCache&&r&&r.source==="server"?i.reject(new T(v.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(a)},error:a=>i.reject(a)}),o=new Cc(wa(t.path),s,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return k_(n,o)}function H9(n,e,t){return g(this,null,function*(){try{let r=yield Hf(n,e,!0),i=new Af(e,r.remoteKeys),s=i.computeDocChanges(r.documents),o=i.applyChanges(s,!1);t.resolve(o.snapshot)}catch(r){let i=Aa(r,`Failed to execute query '${e} against cache`);t.reject(i)}})}function K9(n,e,t,r,i){let s=new ga({next:a=>{e.enqueueAndForget(()=>N_(n,o)),a.fromCache&&r.source==="server"?i.reject(new T(v.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(a)},error:a=>i.reject(a)}),o=new Cc(t,s,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return k_(n,o)}function W9(n,e,t,r){let i=Q9(t,Lc(e));n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){E9(yield G_(n),i,r)}))}function $9(n,e){return n.asyncQueue.enqueue(()=>g(this,null,function*(){return Kz(yield j_(n),e)}))}function Q9(n,e){let t;return typeof n=="string"?t=vR().encode(n):t=n,D9(I9(t),e)}function Y9(n,e){return n.timeoutSeconds===e.timeoutSeconds}function fk(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var X9="ComponentProvider",c1=new Map;function J9(n){let e=c1.get(n);e&&(R(X9,"Removing Datastore"),c1.delete(n),e.terminate())}function Z9(n,e,t,r){return new b0(n,e,t,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,fk(r.experimentalLongPollingOptions),r.useFetchStreams)}var pk="firestore.googleapis.com",u1=!0,d1=5,h1=30,eG=!0,Df=class{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new T(v.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=pk,this.ssl=u1}else this.host=e.host,this.ssl=(t=e.ssl)!==null&&t!==void 0?t:u1;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=LR;else{if(e.cacheSizeBytes!==Fc&&e.cacheSizeBytes<WD)throw new T(v.INVALID_ARGUMENT,`cacheSizeBytes must be at least ${WD}`);this.cacheSizeBytes=e.cacheSizeBytes}U_("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=eG:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=fk((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),tG(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&Y9(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}};function tG(n){if(n.timeoutSeconds!==void 0){if(isNaN(n.timeoutSeconds))throw new T(v.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (must not be NaN)`);if(n.timeoutSeconds<d1)throw new T(v.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (minimum allowed value is ${d1})`);if(n.timeoutSeconds>h1)throw new T(v.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (maximum allowed value is ${h1})`)}}var As=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Df({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new T(v.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new T(v.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Df(e),e.credentials!==void 0&&(this._authCredentials=eU(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return J9(this),Promise.resolve()}};function gk(n,e,t,r={}){var i;n=oe(n,As);let s=n._getSettings(),o=`${e}:${t}`;if(s.host!==pk&&s.host!==o&&pn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let a,l;if(typeof r.mockUserToken=="string")a=r.mockUserToken,l=Xe.MOCK_USER;else{a=HE(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);let c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new T(v.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new Xe(c)}n._authCredentials=new c0(new Gh(a,l))}}var ht=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},we=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new lr(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}},lr=class n extends ht{constructor(e,t,r){super(e,t,wa(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new we(this.firestore,null,new P(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function H_(n,e,...t){if(n=ke(n),q_("collection","path",e),n instanceof As){let r=de.fromString(e,...t);return l1(r),new lr(n,null,r)}else{if(!(n instanceof we)&&!(n instanceof lr))throw new T(v.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(de.fromString(e,...t));return l1(r),new lr(n.firestore,null,r)}}function mk(n,e){if(n=oe(n,As),q_("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new T(v.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new ht(n,null,F3(e))}function Uc(n,e,...t){if(n=ke(n),arguments.length===1&&(e=Hh.newId()),q_("doc","path",e),n instanceof As){let r=de.fromString(e,...t);return a1(r),new we(n,null,new P(r))}else{if(!(n instanceof we)&&!(n instanceof lr))throw new T(v.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(de.fromString(e,...t));return a1(r),new we(n.firestore,n instanceof lr?n.converter:null,new P(r))}}function K_(n,e){return n=ke(n),e=ke(e),(n instanceof we||n instanceof lr)&&(e instanceof we||e instanceof lr)?n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter:!1}function W_(n,e){return n=ke(n),e=ke(e),n instanceof ht&&e instanceof ht?n.firestore===e.firestore&&Oc(n._query,e._query)&&n.converter===e.converter:!1}var nG="AsyncQueue",GS=class{constructor(){this.tail=Promise.resolve(),this.retryableOps=[],this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1,this.skipNonRestrictedTasks=!1,this.timerIdsToSkip=[],this.backoff=new Tc(this,"async_queue_retry"),this.visibilityHandler=()=>{this.backoff.skipBackoff()}}get isShuttingDown(){return this._isShuttingDown}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.verifyNotFailed(),this.enqueueInternal(e)}enterRestrictedMode(e){this._isShuttingDown||(this._isShuttingDown=!0,this.skipNonRestrictedTasks=e||!1)}enqueue(e){if(this.verifyNotFailed(),this._isShuttingDown)return new Promise(()=>{});let t=new je;return this.enqueueInternal(()=>this._isShuttingDown&&this.skipNonRestrictedTasks?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.retryableOps.push(e),this.retryNextOp()))}retryNextOp(){return g(this,null,function*(){if(this.retryableOps.length!==0){try{yield this.retryableOps[0](),this.retryableOps.shift(),this.backoff.reset()}catch(e){if(Oi(e))R(nG,"Operation failed with retryable error: "+e);else throw e}this.retryableOps.length>0&&this.backoff.backoffAndRun(()=>this.retryNextOp())}})}enqueueInternal(e){let t=this.tail.then(()=>(this.operationInProgress=!0,e().catch(r=>{this.failure=r,this.operationInProgress=!1;let i=iG(r);throw Ne("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.operationInProgress=!1,r))));return this.tail=t,t}enqueueAfterDelay(e,t,r){this.verifyNotFailed(),this.timerIdsToSkip.indexOf(e)>-1&&(t=0);let i=RS.createAndSchedule(this,e,t,r,s=>this.removeDelayedOperation(s));return this.delayedOperations.push(i),i}verifyNotFailed(){this.failure&&V()}verifyOperationInProgress(){}drain(){return g(this,null,function*(){let e;do e=this.tail,yield e;while(e!==this.tail)})}containsDelayedOperation(e){for(let t of this.delayedOperations)if(t.timerId===e)return!0;return!1}runAllDelayedOperationsUntil(e){return this.drain().then(()=>{this.delayedOperations.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this.delayedOperations)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.drain()})}skipDelaysForTimerId(e){this.timerIdsToSkip.push(e)}removeDelayedOperation(e){let t=this.delayedOperations.indexOf(e);this.delayedOperations.splice(t,1)}};function rG(){return new GS}function iG(n){let e=n.message||"";return n.stack&&(n.stack.includes(n.message)?e=n.stack:e=n.message+`
`+n.stack),e}var HS=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new je,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}};var yk=Fc,Re=class extends As{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=rG(),this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||vk(this),this._firestoreClient.terminate()}};function Ze(n){return n._firestoreClient||vk(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function vk(n){var e,t,r;let i=n._freezeSettings(),s=Z9(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._firestoreClient=new zS(n._authCredentials,n._appCheckCredentials,n._queue,s),!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}function Sk(n,e){n=oe(n,Re),Dk(n);let t=Ze(n);if(t._uninitializedComponentsProvider)throw new T(v.FAILED_PRECONDITION,"SDK cache is already specified.");pn("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let r=n._freezeSettings(),i=new Ac,s=new If(i,r.cacheSizeBytes,e?.forceOwnership);return Ek(t,i,s)}function _k(n){n=oe(n,Re),Dk(n);let e=Ze(n);if(e._uninitializedComponentsProvider)throw new T(v.FAILED_PRECONDITION,"SDK cache is already specified.");pn("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=n._freezeSettings(),r=new Ac,i=new LS(r,t.cacheSizeBytes);return Ek(e,r,i)}function Ek(n,e,t){let r=new je;return n.asyncQueue.enqueue(()=>g(this,null,function*(){try{yield jh(n,t),yield jS(n,e),r.resolve()}catch(i){let s=i;if(!lk(s))throw s;pn("Error enabling indexeddb cache. Falling back to memory cache: "+s),r.reject(s)}})).then(()=>r.promise)}function wk(n){if(n._initialized&&!n._terminated)throw new T(v.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let e=new je;return n._queue.enqueueAndForgetEvenWhileRestricted(()=>g(this,null,function*(){try{yield bz(b_(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function Tk(n){n=oe(n,Re);let e=Ze(n);return F9(e)}function Ck(n){n=oe(n,Re);let e=Ze(n);return O9(e)}function bk(n){n=oe(n,Re);let e=Ze(n);return P9(e)}function Ak(n,e){n=oe(n,Re);let t=Ze(n),r=new HS;return W9(t,n._databaseId,e,r),r}function Ik(n,e){n=oe(n,Re);let t=Ze(n);return $9(t,e).then(r=>r?new ht(n,null,r.query):null)}function Dk(n){if(n._initialized||n._terminated)throw new T(v.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}function sG(n,e=!0){Jq(QE),Va(new ji("firestore",(t,{instanceIdentifier:r,options:i})=>{let s=t.getProvider("app").getImmediate(),o=new Re(new u0(t.getProvider("auth-internal")),new p0(t.getProvider("app-check-internal")),QU(s,r),s);return i=Object.assign({useFetchStreams:e},i),o._setSettings(i),o},"PUBLIC").setMultipleInstances(!0)),Lr(iD,sD,n),Lr(iD,sD,"esm2017")}var dr=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(ot.fromBase64String(e))}catch(t){throw new T(v.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(ot.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var Mn=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new T(v.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new He(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var Dr=class{constructor(e){this._methodName=e}};var Is=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new T(v.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new T(v.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return J(this._lat,e._lat)||J(this._long,e._long)}};var oG=/^__.*__$/,KS=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new xn(e,this.data,this.fieldMask,t,this.fieldTransforms):new Ri(e,this.data,t,this.fieldTransforms)}},Rf=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new xn(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function Rk(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw V()}}var kf=class n{constructor(e,t,r,i,s,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.validatePath(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new n(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.contextWith({path:r,arrayElement:!1});return i.validatePathSegment(e),i}childContextForFieldPath(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.contextWith({path:r,arrayElement:!1});return i.validatePath(),i}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return Nf(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(e.length===0)throw this.createError("Document fields must not be empty");if(Rk(this.dataSource)&&oG.test(e))throw this.createError('Document fields cannot begin and end with "__"')}},WS=class{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Lc(e)}createContext(e,t,r,i=!1){return new kf({dataSource:e,methodName:t,targetDoc:r,path:He.emptyPath(),arrayElement:!1,hasConverter:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function xs(n){let e=n._freezeSettings(),t=Lc(n._databaseId);return new WS(n._databaseId,!!e.ignoreUndefinedProperties,t)}function $f(n,e,t,r,i,s={}){let o=n.createContext(s.merge||s.mergeFields?2:0,e,t,i);Y_("Data must be an object, but it was:",o,r);let a=xk(r,o),l,c;if(s.merge)l=new Jt(o.fieldMask),c=o.fieldTransforms;else if(s.mergeFields){let u=[];for(let d of s.mergeFields){let h=JS(e,d,t);if(!o.contains(h))throw new T(v.INVALID_ARGUMENT,`Field '${h}' is specified in your field mask but missing from your input data.`);Ok(u,h)||u.push(h)}l=new Jt(u),c=o.fieldTransforms.filter(d=>l.covers(d.field))}else l=null,c=o.fieldTransforms;return new KS(new Tt(a),l,c)}var Ic=class n extends Dr{_toFieldTransform(e){if(e.dataSource===2)e.fieldMask.push(e.path);else throw e.dataSource===1?e.createError(`${this._methodName}() can only appear at the top level of your update data`):e.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return null}isEqual(e){return e instanceof n}};function kk(n,e,t){return new kf({dataSource:3,targetDoc:e.settings.targetDoc,methodName:n._methodName,arrayElement:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}var $S=class n extends Dr{_toFieldTransform(e){return new ws(e.path,new Ii)}isEqual(e){return e instanceof n}},QS=class extends Dr{constructor(e,t){super(e),this._elements=t}_toFieldTransform(e){let t=kk(this,e,!0),r=this._elements.map(s=>Ms(s,t)),i=new Ar(r);return new ws(e.path,i)}isEqual(e){return this===e}},YS=class extends Dr{constructor(e,t){super(e),this._elements=t}_toFieldTransform(e){let t=kk(this,e,!0),r=this._elements.map(s=>Ms(s,t)),i=new Ir(r);return new ws(e.path,i)}isEqual(e){return this===e}},XS=class extends Dr{constructor(e,t){super(e),this._operand=t}_toFieldTransform(e){let t=new Di(e.serializer,lR(e.serializer,this._operand));return new ws(e.path,t)}isEqual(e){return this===e}};function $_(n,e,t,r){let i=n.createContext(1,e,t);Y_("Data must be an object, but it was:",i,r);let s=[],o=Tt.empty();Ns(r,(l,c)=>{let u=X_(e,l,t);c=ke(c);let d=i.childContextForFieldPath(u);if(c instanceof Ic)s.push(u);else{let h=Ms(c,d);h!=null&&(s.push(u),o.set(u,h))}});let a=new Jt(s);return new Rf(o,a,i.fieldTransforms)}function Q_(n,e,t,r,i,s){let o=n.createContext(1,e,t),a=[JS(e,r,t)],l=[i];if(s.length%2!==0)throw new T(v.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let h=0;h<s.length;h+=2)a.push(JS(e,s[h])),l.push(s[h+1]);let c=[],u=Tt.empty();for(let h=a.length-1;h>=0;--h)if(!Ok(c,a[h])){let p=a[h],y=l[h];y=ke(y);let S=o.childContextForFieldPath(p);if(y instanceof Ic)c.push(p);else{let _=Ms(y,S);_!=null&&(c.push(p),u.set(p,_))}}let d=new Jt(c);return new Rf(u,d,o.fieldTransforms)}function Nk(n,e,t,r=!1){let i=n.createContext(r?4:3,e);return Ms(t,i)}function Ms(n,e){if(n=ke(n),Mk(n))return Y_("Unsupported field value:",e,n),xk(n,e);if(n instanceof Dr)return lG(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.arrayElement&&e.dataSource!==4)throw e.createError("Nested arrays are not supported");return aG(n,e)}else return cG(n,e)}function xk(n,e){let t={};return P1(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Ns(n,(r,i)=>{let s=Ms(i,e.childContextForField(r));s!=null&&(t[r]=s)}),{mapValue:{fields:t}}}function aG(n,e){let t=[],r=0;for(let i of n){let s=Ms(i,e.childContextForArray(r));s==null&&(s={nullValue:"NULL_VALUE"}),t.push(s),r++}return{arrayValue:{values:t}}}function lG(n,e){if(!Rk(e.dataSource))throw e.createError(`${n._methodName}() can only be used with update() and set()`);if(!e.path)throw e.createError(`${n._methodName}() is not currently supported inside arrays`);let t=n._toFieldTransform(e);t&&e.fieldTransforms.push(t)}function cG(n,e){if(n=ke(n),n===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return lR(e.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){let t=xe.fromDate(n);return{timestampValue:la(e.serializer,t)}}else if(n instanceof xe){let t=new xe(n.seconds,Math.floor(n.nanoseconds/1e3)*1e3);return{timestampValue:la(e.serializer,t)}}else{if(n instanceof Is)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof dr)return{bytesValue:SR(e.serializer,n._byteString)};if(n instanceof we){let t=e.databaseId,r=n.firestore._databaseId;if(!r.isEqual(t))throw e.createError(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${t.projectId}/${t.database}`);return{referenceValue:__(n.firestore._databaseId||e.databaseId,n._key.path)}}else throw e.createError(`Unsupported field value: ${qc(n)}`)}}function Mk(n){return typeof n=="object"&&n!==null&&!(n instanceof Array)&&!(n instanceof Date)&&!(n instanceof xe)&&!(n instanceof Is)&&!(n instanceof dr)&&!(n instanceof we)&&!(n instanceof Dr)}function Y_(n,e,t){if(!Mk(t)||!b9(t)){let r=qc(t);throw r==="an object"?e.createError(n+" a custom object"):e.createError(n+" "+r)}}function JS(n,e,t){if(e=ke(e),e instanceof Mn)return e._internalPath;if(typeof e=="string")return X_(n,e);throw Nf("Field path arguments must be of type string or ",n,!1,void 0,t)}var uG=new RegExp("[~\\*/\\[\\]]");function X_(n,e,t){if(e.search(uG)>=0)throw Nf(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Mn(...e.split("."))._internalPath}catch{throw Nf(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Nf(n,e,t,r,i){let s=r&&!r.isEmpty(),o=i!==void 0,a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(s||o)&&(l+=" (found",s&&(l+=` in field ${r}`),o&&(l+=` in document ${i}`),l+=")"),new T(v.INVALID_ARGUMENT,a+n+l)}function Ok(n,e){return n.some(t=>t.isEqual(e))}var Ds=class{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new we(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document)if(this._converter){let e=new ZS(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}else return this._userDataWriter.convertValue(this._document.data.value);else return}get(e){if(this._document){let t=this._document.data.field(Qf("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},ZS=class extends Ds{data(){return super.data()}};function Qf(n,e){return typeof e=="string"?X_(n,e):e instanceof Mn?e._internalPath:e._delegate._internalPath}function Pk(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new T(v.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Dc=class{},Rs=class extends Dc{};function xr(n,e,...t){let r=[];e instanceof Dc&&r.push(e),r=r.concat(t),vG(r);for(let i of r)n=i._apply(n);return n}var xf=class n extends Rs{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=this._parse(e);return Hk(e._query,t),new ht(e.firestore,e.converter,v_(e._query,t))}_parse(e){let t=xs(e.firestore);return dG(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function Fk(n,e,t){let r=e,i=Qf("where",n);return xf._create(i,r,t)}var e_=class n extends Dc{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new n(e,t)}_parse(e){let t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:pe.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(mG(e._query,t),new ht(e.firestore,e.converter,v_(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var t_=class n extends Rs{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new n(e,t)}_apply(e){let t=hG(e._query,this._field,this._direction);return new ht(e.firestore,e.converter,V3(e._query,t))}};function Lk(n,e="asc"){let t=e,r=Qf("orderBy",n);return t_._create(r,t)}var Mf=class n extends Rs{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){return new ht(e.firestore,e.converter,ef(e._query,this._limit,this._limitType))}};function Bk(n){return ak("limit",n),Mf._create("limit",n,"F")}function Vk(n){return ak("limitToLast",n),Mf._create("limitToLast",n,"L")}var Of=class n extends Rs{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=Gk(e,this.type,this._docOrFields,this._inclusive);return new ht(e.firestore,e.converter,q3(e._query,t))}};function qk(...n){return Of._create("startAt",n,!0)}function Uk(...n){return Of._create("startAfter",n,!1)}var Pf=class n extends Rs{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=Gk(e,this.type,this._docOrFields,this._inclusive);return new ht(e.firestore,e.converter,U3(e._query,t))}};function zk(...n){return Pf._create("endBefore",n,!1)}function jk(...n){return Pf._create("endAt",n,!0)}function Gk(n,e,t,r){if(t[0]=ke(t[0]),t[0]instanceof Ds)return fG(n._query,n.firestore._databaseId,e,t[0]._document,r);{let i=xs(n.firestore);return pG(n._query,n.firestore._databaseId,i,e,t,r)}}function dG(n,e,t,r,i,s,o){let a;if(i.isKeyField()){if(s==="array-contains"||s==="array-contains-any")throw new T(v.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if(s==="in"||s==="not-in"){p1(o,s);let c=[];for(let u of o)c.push(f1(r,n,u));a={arrayValue:{values:c}}}else a=f1(r,n,o)}else(s==="in"||s==="not-in"||s==="array-contains-any")&&p1(o,s),a=Nk(t,e,o,s==="in"||s==="not-in");return re.create(i,s,a)}function hG(n,e,t){if(n.startAt!==null)throw new T(v.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(n.endAt!==null)throw new T(v.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new _s(e,t)}function fG(n,e,t,r,i){if(!r)throw new T(v.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${t}().`);let s=[];for(let o of sa(n))if(o.field.isKeyField())s.push(Ss(e,r.key));else{let a=r.data.field(o.field);if(Uf(a))throw new T(v.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+o.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(a!==null)s.push(a);else{let l=o.field.canonicalString();throw new T(v.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${l}' (used as the orderBy) does not exist.`)}}return new cr(s,i)}function pG(n,e,t,r,i,s){let o=n.explicitOrderBy;if(i.length>o.length)throw new T(v.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let a=[];for(let l=0;l<i.length;l++){let c=i[l];if(o[l].field.isKeyField()){if(typeof c!="string")throw new T(v.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof c}`);if(!y_(n)&&c.indexOf("/")!==-1)throw new T(v.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${c}' contains a slash.`);let d=n.path.child(de.fromString(c));if(!P.isDocumentKey(d))throw new T(v.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${d}' is not because it contains an odd number of segments.`);let h=new P(d);a.push(Ss(e,h))}else{let d=Nk(t,r,c);a.push(d)}}return new cr(a,s)}function f1(n,e,t){if(t=ke(t),typeof t=="string"){if(t==="")throw new T(v.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!y_(e)&&t.indexOf("/")!==-1)throw new T(v.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let r=e.path.child(de.fromString(t));if(!P.isDocumentKey(r))throw new T(v.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Ss(n,new P(r))}else{if(t instanceof we)return Ss(n,t._key);throw new T(v.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${qc(t)}.`)}}function p1(n,e){if(!Array.isArray(n)||n.length===0)throw new T(v.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function gG(n){switch(n){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}function Hk(n,e){let t=yG(n.filters,gG(e.op));if(t!==null)throw t===e.op?new T(v.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new T(v.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function mG(n,e){let t=n,r=e.getFlattenedFilters();for(let i of r)Hk(t,i),t=v_(t,i)}function yG(n,e){for(let t of n)for(let r of t.getFlattenedFilters())if(e.indexOf(r.op)>=0)return r.op;return null}function vG(n){let e=n.filter(r=>r instanceof e_).length,t=n.filter(r=>r instanceof xf).length;if(e>1||e>0&&t>0)throw new T(v.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}var ya=class{convertValue(e,t="none"){switch(vs(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Be(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Ci(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw V()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return Ns(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertGeoPoint(e){return new Is(Be(e.latitude),Be(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=p_(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(oc(e));default:return null}}convertTimestamp(e){let t=Ti(e);return new xe(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=de.fromString(e);j(RR(r));let i=new bi(r.get(1),r.get(3)),s=new P(r.popFirst(5));return i.isEqual(t)||Ne(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function Yf(n,e,t){let r;return n?t&&(t.merge||t.mergeFields)?r=n.toFirestore(e,t):r=n.toFirestore(e):r=e,r}var n_=class extends ya{constructor(e){super(),this.firestore=e}convertBytes(e){return new dr(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new we(this.firestore,null,t)}};function r_(n){return SG(n,["next","error","complete"])}function SG(n,e){if(typeof n!="object"||n===null)return!1;let t=n;for(let r of e)if(r in t&&typeof t[r]=="function")return!0;return!1}var Rr=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},mn=class extends Ds{constructor(e,t,r,i,s,o){super(e,t,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document)if(this._converter){let t=new xi(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}else return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps);else return}get(e,t={}){if(this._document){let r=this._document.data.field(Qf("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}},xi=class extends mn{data(e={}){return super.data(e)}},On=class{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Rr(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new xi(this._firestore,this._userDataWriter,r.key,r,new Rr(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new T(v.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return(!this._cachedChanges||this._cachedChangesIncludeMetadataChanges!==t)&&(this._cachedChanges=_G(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function _G(n,e){if(n._snapshot.oldDocs.isEmpty()){let t=0;return n._snapshot.docChanges.map(r=>{let i=new xi(n._firestore,n._userDataWriter,r.doc.key,r.doc,new Rr(n._snapshot.mutatedKeys.has(r.doc.key),n._snapshot.fromCache),n.query.converter);return r.doc,{type:"added",doc:i,oldIndex:-1,newIndex:t++}})}else{let t=n._snapshot.oldDocs;return n._snapshot.docChanges.filter(r=>e||r.type!==3).map(r=>{let i=new xi(n._firestore,n._userDataWriter,r.doc.key,r.doc,new Rr(n._snapshot.mutatedKeys.has(r.doc.key),n._snapshot.fromCache),n.query.converter),s=-1,o=-1;return r.type!==0&&(s=t.indexOf(r.doc.key),t=t.delete(r.doc.key)),r.type!==1&&(t=t.add(r.doc),o=t.indexOf(r.doc.key)),{type:EG(r.type),doc:i,oldIndex:s,newIndex:o}})}}function EG(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return V()}}function J_(n,e){return n instanceof mn&&e instanceof mn?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof On&&e instanceof On?n._firestore===e._firestore&&W_(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot):!1}function Kk(n){n=oe(n,we);let e=oe(n.firestore,Re),t=Ze(e);return dk(t,n._key).then(r=>nE(e,n,r))}var kr=class extends ya{constructor(e){super(),this.firestore=e}convertBytes(e){return new dr(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new we(this.firestore,null,t)}};function Wk(n){n=oe(n,we);let e=oe(n.firestore,Re),t=Ze(e),r=new kr(e);return B9(t,n._key).then(i=>new mn(e,r,n._key,i,new Rr(i!==null&&i.hasLocalMutations,!0),n.converter))}function $k(n){n=oe(n,we);let e=oe(n.firestore,Re),t=Ze(e);return dk(t,n._key,{source:"server"}).then(r=>nE(e,n,r))}function Qk(n){n=oe(n,ht);let e=oe(n.firestore,Re),t=Ze(e),r=new kr(e);return Pk(n._query),hk(t,n._query).then(i=>new On(e,r,n,i))}function Yk(n){n=oe(n,ht);let e=oe(n.firestore,Re),t=Ze(e),r=new kr(e);return V9(t,n._query).then(i=>new On(e,r,n,i))}function Xk(n){n=oe(n,ht);let e=oe(n.firestore,Re),t=Ze(e),r=new kr(e);return hk(t,n._query,{source:"server"}).then(i=>new On(e,r,n,i))}function Z_(n,e,t){n=oe(n,we);let r=oe(n.firestore,Re),i=Yf(n.converter,e,t),s=xs(r),a=$f(s,"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,Le.none());return Ia(r,[a])}function eE(n,e,t,...r){n=oe(n,we);let i=oe(n.firestore,Re),s=xs(i);e=ke(e);let o;typeof e=="string"||e instanceof Mn?o=Q_(s,"updateDoc",n._key,e,t,r):o=$_(s,"updateDoc",n._key,e);let a=o.toMutation(n._key,Le.exists(!0));return Ia(i,[a])}function Jk(n){let e=oe(n.firestore,Re),t=[new ki(n._key,Le.none())];return Ia(e,t)}function Zk(n,e){let t=oe(n.firestore,Re),r=Uc(n),i=Yf(n.converter,e),s=xs(n.firestore),a=$f(s,"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,Le.exists(!1));return Ia(t,[a]).then(()=>r)}function tE(n,...e){var t,r,i;n=ke(n);let s={includeMetadataChanges:!1},o=0;typeof e[o]=="object"&&!r_(e[o])&&(s=e[o],o++);let a={includeMetadataChanges:s.includeMetadataChanges};if(r_(e[o])){let h=e[o];e[o]=(t=h.next)===null||t===void 0?void 0:t.bind(h),e[o+1]=(r=h.error)===null||r===void 0?void 0:r.bind(h),e[o+2]=(i=h.complete)===null||i===void 0?void 0:i.bind(h)}let l,c,u;if(n instanceof we)c=oe(n.firestore,Re),u=wa(n._key.path),l={next:h=>{e[o]&&e[o](nE(c,n,h))},error:e[o+1],complete:e[o+2]};else{let h=oe(n,ht);c=oe(h.firestore,Re),u=h._query;let p=new kr(c);l={next:y=>{e[o]&&e[o](new On(c,p,h,y))},error:e[o+1],complete:e[o+2]},Pk(n._query)}let d=Ze(c);return L9(d,u,a,l)}function eN(n,e){n=oe(n,Re);let t=Ze(n),r=r_(e)?e:{next:e};return U9(t,r)}function Ia(n,e){let t=Ze(n);return q9(t,e)}function nE(n,e,t){let r=t.docs.get(e._key),i=new kr(n);return new mn(n,i,e._key,r,new Rr(t.hasPendingWrites,t.fromCache),e.converter)}var wG={maxAttempts:5};function TG(n){if(n.maxAttempts<1)throw new T(v.INVALID_ARGUMENT,"Max attempts must be at least 1")}var Ff=class{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=xs(e)}set(e,t,r){this._verifyNotCommitted();let i=Si(e,this._firestore),s=Yf(i.converter,t,r),o=$f(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,r);return this._mutations.push(o.toMutation(i._key,Le.none())),this}update(e,t,r,...i){this._verifyNotCommitted();let s=Si(e,this._firestore);t=ke(t);let o;return typeof t=="string"||t instanceof Mn?o=Q_(this._dataReader,"WriteBatch.update",s._key,t,r,i):o=$_(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(o.toMutation(s._key,Le.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=Si(e,this._firestore);return this._mutations=this._mutations.concat(new ki(t._key,Le.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new T(v.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function Si(n,e){if(n=ke(n),n.firestore!==e)throw new T(v.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}var i_=class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=xs(e)}get(e){let t=Si(e,this._firestore),r=new n_(this._firestore);return this._transaction.lookup([t._key]).then(i=>{if(!i||i.length!==1)return V();let s=i[0];if(s.isFoundDocument())return new Ds(this._firestore,r,s.key,s,t.converter);if(s.isNoDocument())return new Ds(this._firestore,r,t._key,null,t.converter);throw V()})}set(e,t,r){let i=Si(e,this._firestore),s=Yf(i.converter,t,r),o=$f(this._dataReader,"Transaction.set",i._key,s,i.converter!==null,r);return this._transaction.set(i._key,o),this}update(e,t,r,...i){let s=Si(e,this._firestore);t=ke(t);let o;return typeof t=="string"||t instanceof Mn?o=Q_(this._dataReader,"Transaction.update",s._key,t,r,i):o=$_(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,o),this}delete(e){let t=Si(e,this._firestore);return this._transaction.delete(t._key),this}};var s_=class extends i_{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=Si(e,this._firestore),r=new kr(this._firestore);return super.get(e).then(i=>new mn(this._firestore,r,t._key,i._document,new Rr(!1,!1),t.converter))}};function tN(n,e,t){n=oe(n,Re);let r=Object.assign(Object.assign({},wG),t);TG(r);let i=Ze(n);return z9(i,s=>e(new s_(n,s)),r)}function nN(){return new Ic("deleteField")}function rN(){return new $S("serverTimestamp")}function iN(...n){return new QS("arrayUnion",n)}function sN(...n){return new YS("arrayRemove",n)}function oN(n){return new XS("increment",n)}sG("node");var CG="@firebase/firestore-compat",bG="0.3.23";function lE(n,e){if(e===void 0)return{merge:!1};if(e.mergeFields!==void 0&&e.merge!==void 0)throw new T("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function aN(){if(typeof Uint8Array>"u")throw new T("unimplemented","Uint8Arrays are not available in this environment.")}function lN(){if(!F1())throw new T("unimplemented","Blobs are unavailable in Firestore in this environment.")}var Xf=class n{constructor(e){this._delegate=e}static fromBase64String(e){return lN(),new n(dr.fromBase64String(e))}static fromUint8Array(e){return aN(),new n(dr.fromUint8Array(e))}toBase64(){return lN(),this._delegate.toBase64()}toUint8Array(){return aN(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}};function rE(n){return AG(n,["next","error","complete"])}function AG(n,e){if(typeof n!="object"||n===null)return!1;let t=n;for(let r of e)if(r in t&&typeof t[r]=="function")return!0;return!1}var iE=class{enableIndexedDbPersistence(e,t){return Sk(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return _k(e._delegate)}clearIndexedDbPersistence(e){return wk(e._delegate)}},Jf=class{constructor(e,t,r){this._delegate=t,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},e instanceof bi||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){let t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&pn("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&(e=Object.assign(Object.assign({},t),e),delete e.merge),this._delegate._setSettings(e)}useEmulator(e,t,r={}){gk(this._delegate,e,t,r)}enableNetwork(){return Ck(this._delegate)}disableNetwork(){return bk(this._delegate)}enablePersistence(e){let t=!1,r=!1;return e&&(t=!!e.synchronizeTabs,r=!!e.experimentalForceOwningTab,U_("synchronizeTabs",t,"experimentalForceOwningTab",r)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return Tk(this._delegate)}onSnapshotsInSync(e){return eN(this._delegate,e)}get app(){if(!this._appCompat)throw new T("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new ka(this,H_(this._delegate,e))}catch(t){throw Ft(t,"collection()","Firestore.collection()")}}doc(e){try{return new hr(this,Uc(this._delegate,e))}catch(t){throw Ft(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new Ls(this,mk(this._delegate,e))}catch(t){throw Ft(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return tN(this._delegate,t=>e(new Zf(this,t)))}batch(){return Ze(this._delegate),new ep(new Ff(this._delegate,e=>Ia(this._delegate,e)))}loadBundle(e){return Ak(this._delegate,e)}namedQuery(e){return Ik(this._delegate,e).then(t=>t?new Ls(this,t):null)}},Da=class extends ya{constructor(e){super(),this.firestore=e}convertBytes(e){return new Xf(new dr(e))}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return hr.forKey(t,this.firestore,null)}};function IG(n){m1(n)}var Zf=class{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new Da(e)}get(e){let t=Os(e);return this._delegate.get(t).then(r=>new Ps(this._firestore,new mn(this._firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,t.converter)))}set(e,t,r){let i=Os(e);return r?(lE("Transaction.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){let s=Os(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){let t=Os(e);return this._delegate.delete(t),this}},ep=class{constructor(e){this._delegate=e}set(e,t,r){let i=Os(e);return r?(lE("WriteBatch.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){let s=Os(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){let t=Os(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}},Ra=class n{constructor(e,t,r){this._firestore=e,this._userDataWriter=t,this._delegate=r}fromFirestore(e,t){let r=new xi(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new Fs(this._firestore,r),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){let r=n.INSTANCES,i=r.get(e);i||(i=new WeakMap,r.set(e,i));let s=i.get(t);return s||(s=new n(e,new Da(e),t),i.set(t,s)),s}};Ra.INSTANCES=new WeakMap;var hr=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Da(e)}static forPath(e,t,r){if(e.length%2!==0)throw new T("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new n(t,new we(t._delegate,r,new P(e)))}static forKey(e,t,r){return new n(t,new we(t._delegate,r,e))}get id(){return this._delegate.id}get parent(){return new ka(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new ka(this.firestore,H_(this._delegate,e))}catch(t){throw Ft(t,"collection()","DocumentReference.collection()")}}isEqual(e){return e=ke(e),e instanceof we?K_(this._delegate,e):!1}set(e,t){t=lE("DocumentReference.set",t);try{return t?Z_(this._delegate,e,t):Z_(this._delegate,e)}catch(r){throw Ft(r,"setDoc()","DocumentReference.set()")}}update(e,t,...r){try{return arguments.length===1?eE(this._delegate,e):eE(this._delegate,e,t,...r)}catch(i){throw Ft(i,"updateDoc()","DocumentReference.update()")}}delete(){return Jk(this._delegate)}onSnapshot(...e){let t=cN(e),r=uN(e,i=>new Ps(this.firestore,new mn(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return tE(this._delegate,t,r)}get(e){let t;return e?.source==="cache"?t=Wk(this._delegate):e?.source==="server"?t=$k(this._delegate):t=Kk(this._delegate),t.then(r=>new Ps(this.firestore,new mn(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)))}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(Ra.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function Ft(n,e,t){return n.message=n.message.replace(e,t),n}function cN(n){for(let e of n)if(typeof e=="object"&&!rE(e))return e;return{}}function uN(n,e){var t,r;let i;return rE(n[0])?i=n[0]:rE(n[1])?i=n[1]:typeof n[0]=="function"?i={next:n[0],error:n[1],complete:n[2]}:i={next:n[1],error:n[2],complete:n[3]},{next:s=>{i.next&&i.next(e(s))},error:(t=i.error)===null||t===void 0?void 0:t.bind(i),complete:(r=i.complete)===null||r===void 0?void 0:r.bind(i)}}var Ps=class{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new hr(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return J_(this._delegate,e._delegate)}},Fs=class extends Ps{data(e){let t=this._delegate.data(e);return this._delegate._converter||y1(t!==void 0,"Document in a QueryDocumentSnapshot should exist"),t}},Ls=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Da(e)}where(e,t,r){try{return new n(this.firestore,xr(this._delegate,Fk(e,t,r)))}catch(i){throw Ft(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new n(this.firestore,xr(this._delegate,Lk(e,t)))}catch(r){throw Ft(r,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new n(this.firestore,xr(this._delegate,Bk(e)))}catch(t){throw Ft(t,"limit()","Query.limit()")}}limitToLast(e){try{return new n(this.firestore,xr(this._delegate,Vk(e)))}catch(t){throw Ft(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new n(this.firestore,xr(this._delegate,qk(...e)))}catch(t){throw Ft(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new n(this.firestore,xr(this._delegate,Uk(...e)))}catch(t){throw Ft(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new n(this.firestore,xr(this._delegate,zk(...e)))}catch(t){throw Ft(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new n(this.firestore,xr(this._delegate,jk(...e)))}catch(t){throw Ft(t,"endAt()","Query.endAt()")}}isEqual(e){return W_(this._delegate,e._delegate)}get(e){let t;return e?.source==="cache"?t=Yk(this._delegate):e?.source==="server"?t=Xk(this._delegate):t=Qk(this._delegate),t.then(r=>new zc(this.firestore,new On(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)))}onSnapshot(...e){let t=cN(e),r=uN(e,i=>new zc(this.firestore,new On(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return tE(this._delegate,t,r)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(Ra.getInstance(this.firestore,e)):this._delegate.withConverter(null))}},sE=class{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new Fs(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}},zc=class{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new Ls(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new Fs(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new sE(this._firestore,t))}forEach(e,t){this._delegate.forEach(r=>{e.call(t,new Fs(this._firestore,r))})}isEqual(e){return J_(this._delegate,e._delegate)}},ka=class n extends Ls{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){let e=this._delegate.parent;return e?new hr(this.firestore,e):null}doc(e){try{return e===void 0?new hr(this.firestore,Uc(this._delegate)):new hr(this.firestore,Uc(this._delegate,e))}catch(t){throw Ft(t,"doc()","CollectionReference.doc()")}}add(e){return Zk(this._delegate,e).then(t=>new hr(this.firestore,t))}isEqual(e){return K_(this._delegate,e._delegate)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(Ra.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function Os(n){return oe(n,we)}var oE=class n{constructor(...e){this._delegate=new Mn(...e)}static documentId(){return new n(He.keyField().canonicalString())}isEqual(e){return e=ke(e),e instanceof Mn?this._delegate._internalPath.isEqual(e._internalPath):!1}};var aE=class n{constructor(e){this._delegate=e}static serverTimestamp(){let e=rN();return e._methodName="FieldValue.serverTimestamp",new n(e)}static delete(){let e=nN();return e._methodName="FieldValue.delete",new n(e)}static arrayUnion(...e){let t=iN(...e);return t._methodName="FieldValue.arrayUnion",new n(t)}static arrayRemove(...e){let t=sN(...e);return t._methodName="FieldValue.arrayRemove",new n(t)}static increment(e){let t=oN(e);return t._methodName="FieldValue.increment",new n(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}};var DG={Firestore:Jf,GeoPoint:Is,Timestamp:xe,Blob:Xf,Transaction:Zf,WriteBatch:ep,DocumentReference:hr,DocumentSnapshot:Ps,Query:Ls,QueryDocumentSnapshot:Fs,QuerySnapshot:zc,CollectionReference:ka,FieldPath:oE,FieldValue:aE,setLogLevel:IG,CACHE_SIZE_UNLIMITED:yk};function RG(n,e){n.INTERNAL.registerComponent(new ji("firestore-compat",t=>{let r=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(r,i)},"PUBLIC").setServiceProps(Object.assign({},DG)))}function kG(n){RG(n,(e,t)=>new Jf(e,t,new iE)),n.registerVersion(CG,bG,"node")}kG(Vt);function NG(n,e=Yc){return new Vs(t=>{let r;return e!=null?e.schedule(()=>{r=n.onSnapshot({includeMetadataChanges:!0},t)}):r=n.onSnapshot({includeMetadataChanges:!0},t),()=>{r?.()}})}function dN(n,e){return NG(n,e)}function xG(n,e){return dN(n,e).pipe(Zc(void 0),Xc(),ct(t=>{let[r,i]=t;return i.exists?r?.exists?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}}))}function dE(n,e){return dN(n,e).pipe(ct(t=>({payload:t,type:"query"})))}var tp=class{ref;afs;constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){let r=this.ref.collection(e),{ref:i,query:s}=mN(r,t);return new rp(i,s,this.afs)}snapshotChanges(){return xG(this.ref,this.afs.schedulers.outsideAngular).pipe(qt)}valueChanges(e={}){return this.snapshotChanges().pipe(ct(({payload:t})=>e.idField?fr(Zt({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return Pn(this.ref.get(e)).pipe(qt)}};function np(n,e){return dE(n,e).pipe(Zc(void 0),Xc(),ct(t=>{let[r,i]=t,s=i.payload.docChanges(),o=s.map(a=>({type:a.type,payload:a}));return r&&JSON.stringify(r.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((a,l)=>{let c=s.find(d=>d.doc.ref.isEqual(a.ref)),u=r?.payload.docs.find(d=>d.ref.isEqual(a.ref));c&&JSON.stringify(c.doc.metadata)===JSON.stringify(a.metadata)||!c&&u&&JSON.stringify(u.metadata)===JSON.stringify(a.metadata)||o.push({type:"modified",payload:{oldIndex:l,newIndex:l,type:"modified",doc:a}})}),o}))}function hN(n,e,t){return np(n,t).pipe(Jc((r,i)=>MG(r,i.map(s=>s.payload),e),[]),IE(),ct(r=>r.map(i=>({type:i.type,payload:i}))))}function MG(n,e,t){return e.forEach(r=>{t.indexOf(r.type)>-1&&(n=OG(n,r))}),n}function cE(n,e,t,...r){let i=n.slice();return i.splice(e,t,...r),i}function OG(n,e){switch(e.type){case"added":if(!(n[e.newIndex]&&n[e.newIndex].doc.ref.isEqual(e.doc.ref)))return cE(n,e.newIndex,0,e);break;case"modified":if(n[e.oldIndex]==null||n[e.oldIndex].doc.ref.isEqual(e.doc.ref))if(e.oldIndex!==e.newIndex){let t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}else return cE(n,e.newIndex,1,e);break;case"removed":if(n[e.oldIndex]&&n[e.oldIndex].doc.ref.isEqual(e.doc.ref))return cE(n,e.oldIndex,1);break}return n}function fN(n){return(!n||n.length===0)&&(n=["added","removed","modified"]),n}var rp=class{ref;query;afs;constructor(e,t,r){this.ref=e,this.query=t,this.afs=r}stateChanges(e){let t=np(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe(ct(r=>r.filter(i=>e.indexOf(i.type)>-1)))),t.pipe(Zc(void 0),Xc(),Ma(([r,i])=>i.length>0||!r),ct(([,r])=>r),qt)}auditTrail(e){return this.stateChanges(e).pipe(Jc((t,r)=>[...t,...r],[]))}snapshotChanges(e){let t=fN(e);return hN(this.query,t,this.afs.schedulers.outsideAngular).pipe(qt)}valueChanges(e={}){return dE(this.query,this.afs.schedulers.outsideAngular).pipe(ct(t=>t.payload.docs.map(r=>e.idField?fr(Zt({},r.data()),{[e.idField]:r.id}):r.data())),qt)}get(e){return Pn(this.query.get(e)).pipe(qt)}add(e){return this.ref.add(e)}doc(e){return new tp(this.ref.doc(e),this.afs)}},uE=class{query;afs;constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return!e||e.length===0?np(this.query,this.afs.schedulers.outsideAngular).pipe(qt):np(this.query,this.afs.schedulers.outsideAngular).pipe(ct(t=>t.filter(r=>e.indexOf(r.type)>-1)),Ma(t=>t.length>0),qt)}auditTrail(e){return this.stateChanges(e).pipe(Jc((t,r)=>[...t,...r],[]))}snapshotChanges(e){let t=fN(e);return hN(this.query,t,this.afs.schedulers.outsideAngular).pipe(qt)}valueChanges(e={}){return dE(this.query,this.afs.schedulers.outsideAngular).pipe(ct(r=>r.payload.docs.map(i=>e.idField?Zt({[e.idField]:i.id},i.data()):i.data())),qt)}get(e){return Pn(this.query.get(e)).pipe(qt)}},pN=new qe("angularfire2.enableFirestorePersistence"),gN=new qe("angularfire2.firestore.persistenceSettings"),PG=new qe("angularfire2.firestore.settings"),FG=new qe("angularfire2.firestore.use-emulator");function mN(n,e=t=>t){return{query:e(n),ref:n}}var jc=(()=>{class n{schedulers;firestore;persistenceEnabled$;constructor(t,r,i,s,o,a,l,c,u,d,h,p,y,S,_,k,w){this.schedulers=l;let x=Ua(t,a,r),M=u;d&&Hp(x,a,h,y,S,_,p,k),[this.firestore,this.persistenceEnabled$]=cu(`${x.name}.firestore`,"AngularFirestore",x.name,()=>{let z=a.runOutsideAngular(()=>x.firestore());if(s&&z.settings(s),M&&z.useEmulator(...M),i&&!tu(o)){let $=()=>{try{return Pn(z.enablePersistence(c||void 0).then(()=>!0,()=>!1))}catch(te){return typeof console<"u"&&console.warn(te),Or(!1)}};return[z,a.runOutsideAngular($)]}else return[z,Or(!1)]},[s,M,i])}collection(t,r){let i;typeof t=="string"?i=this.firestore.collection(t):i=t;let{ref:s,query:o}=mN(i,r),a=this.schedulers.ngZone.run(()=>s);return new rp(a,o,this)}collectionGroup(t,r){let i=r||(o=>o),s=this.firestore.collectionGroup(t);return new uE(i(s),this)}doc(t){let r;typeof t=="string"?r=this.firestore.doc(t):r=t;let i=this.schedulers.ngZone.run(()=>r);return new tp(i,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(r){return new(r||n)(ie(js),ie(Gs,8),ie(pN,8),ie(PG,8),ie(Us),ie(Fr),ie(ou),ie(gN,8),ie(FG,8),ie(fw,8),ie(Vp,8),ie(qp,8),ie(Up,8),ie(zp,8),ie(jp,8),ie(Gp,8),ie(Gi,8))};static \u0275prov=Ui({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),yN=(()=>{class n{constructor(){Vt.registerVersion("angularfire",zs.full,"fst-compat")}static enablePersistence(t){return{ngModule:n,providers:[{provide:pN,useValue:!0},{provide:gN,useValue:t}]}}static \u0275fac=function(r){return new(r||n)};static \u0275mod=It({type:n});static \u0275inj=At({providers:[jc]})}return n})();function LG(n,e){if(n&1&&(C(0,"tr",5)(1,"td",6),q(2),N(),C(3,"td",6),q(4),N(),C(5,"td",6),q(6),N(),C(7,"td",6),q(8),N()()),n&2){let t=e.$implicit;Lt(2),Ba(t.UserName),Lt(2),Ba(t.LastName),Lt(2),Ba(t.Email),Lt(2),Ba(t.Message)}}var SN=(()=>{let e=class e{constructor(r){this.firebase=r,this.mylist=[],this.getdata()}getdata(){this.firebase.collection("contactus").valueChanges().subscribe(r=>{this.mylist=r})}};e.\u0275fac=function(i){return new(i||e)(me(jc))},e.\u0275cmp=Pr({type:e,selectors:[["app-about"]],decls:16,vars:1,consts:[[1,"btn","btn-danger",3,"click"],[1,"table-responsive"],[1,"table","table-dark"],["scope","col"],["class","",4,"ngFor","ngForOf"],[1,""],["scope","row"]],template:function(i,s){i&1&&(C(0,"button",0),Bt("click",function(){return s.getdata()}),q(1,"Get Data"),N(),C(2,"div",1)(3,"table",2)(4,"thead")(5,"tr")(6,"th",3),q(7,"User Name"),N(),C(8,"th",3),q(9,"Last Name"),N(),C(10,"th",3),q(11,"Email"),N(),C(12,"th",3),q(13,"Message"),N()()(),C(14,"tbody"),ME(15,LG,9,4,"tr",4),N()()()),i&2&&(Lt(15),Ln("ngForOf",s.mylist))},dependencies:[LE]});let n=e;return n})();var RN=(()=>{let e=class e{constructor(r,i){this._renderer=r,this._elementRef=i,this.onChange=s=>{},this.onTouched=()=>{}}setProperty(r,i){this._renderer.setProperty(this._elementRef.nativeElement,r,i)}registerOnTouched(r){this.onTouched=r}registerOnChange(r){this.onChange=r}setDisabledState(r){this.setProperty("disabled",r)}};e.\u0275fac=function(i){return new(i||e)(me(Fa),me(Pa))},e.\u0275dir=Dt({type:e});let n=e;return n})(),fE=(()=>{let e=class e extends RN{};e.\u0275fac=(()=>{let r;return function(s){return(r||(r=Oa(e)))(s||e)}})(),e.\u0275dir=Dt({type:e,features:[Fn]});let n=e;return n})(),up=new qe("NgValueAccessor");var BG={provide:up,useExisting:qi(()=>dp),multi:!0};function VG(){let n=Dp()?Dp().getUserAgent():"";return/android (\d+)/.test(n.toLowerCase())}var qG=new qe("CompositionEventMode"),dp=(()=>{let e=class e extends RN{constructor(r,i,s){super(r,i),this._compositionMode=s,this._composing=!1,this._compositionMode==null&&(this._compositionMode=!VG())}writeValue(r){let i=r??"";this.setProperty("value",i)}_handleInput(r){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(r)}_compositionStart(){this._composing=!0}_compositionEnd(r){this._composing=!1,this._compositionMode&&this.onChange(r)}};e.\u0275fac=function(i){return new(i||e)(me(Fa),me(Pa),me(qG,8))},e.\u0275dir=Dt({type:e,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(i,s){i&1&&Bt("input",function(a){return s._handleInput(a.target.value)})("blur",function(){return s.onTouched()})("compositionstart",function(){return s._compositionStart()})("compositionend",function(a){return s._compositionEnd(a.target.value)})},features:[zi([BG]),Fn]});let n=e;return n})();function UG(n){return n==null||(typeof n=="string"||Array.isArray(n))&&n.length===0}var pE=new qe("NgValidators"),kN=new qe("NgAsyncValidators");function zG(n){return UG(n.value)?{required:!0}:null}function _N(n){return null}function NN(n){return n!=null}function xN(n){return OE(n)?Pn(n):n}function MN(n){let e={};return n.forEach(t=>{e=t!=null?Zt(Zt({},e),t):e}),Object.keys(e).length===0?null:e}function ON(n,e){return e.map(t=>t(n))}function jG(n){return!n.validate}function PN(n){return n.map(e=>jG(e)?e:t=>e.validate(t))}function GG(n){if(!n)return null;let e=n.filter(NN);return e.length==0?null:function(t){return MN(ON(t,e))}}function gE(n){return n!=null?GG(PN(n)):null}function HG(n){if(!n)return null;let e=n.filter(NN);return e.length==0?null:function(t){let r=ON(t,e).map(xN);return bE(r).pipe(ct(MN))}}function mE(n){return n!=null?HG(PN(n)):null}function EN(n,e){return n===null?[e]:Array.isArray(n)?[...n,e]:[n,e]}function KG(n){return n._rawValidators}function WG(n){return n._rawAsyncValidators}function hE(n){return n?Array.isArray(n)?n:[n]:[]}function sp(n,e){return Array.isArray(n)?n.includes(e):n===e}function wN(n,e){let t=hE(e);return hE(n).forEach(i=>{sp(t,i)||t.push(i)}),t}function TN(n,e){return hE(e).filter(t=>!sp(n,t))}var op=class{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=gE(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=mE(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e=void 0){this.control&&this.control.reset(e)}hasError(e,t){return this.control?this.control.hasError(e,t):!1}getError(e,t){return this.control?this.control.getError(e,t):null}},xa=class extends op{get formDirective(){return null}get path(){return null}},Wc=class extends op{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}},ap=class{constructor(e){this._cd=e}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}},$G={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},z$=fr(Zt({},$G),{"[class.ng-submitted]":"isSubmitted"}),FN=(()=>{let e=class e extends ap{constructor(r){super(r)}};e.\u0275fac=function(i){return new(i||e)(me(Wc,2))},e.\u0275dir=Dt({type:e,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(i,s){i&2&&Cp("ng-untouched",s.isUntouched)("ng-touched",s.isTouched)("ng-pristine",s.isPristine)("ng-dirty",s.isDirty)("ng-valid",s.isValid)("ng-invalid",s.isInvalid)("ng-pending",s.isPending)},features:[Fn]});let n=e;return n})(),hp=(()=>{let e=class e extends ap{constructor(r){super(r)}};e.\u0275fac=function(i){return new(i||e)(me(xa,10))},e.\u0275dir=Dt({type:e,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(i,s){i&2&&Cp("ng-untouched",s.isUntouched)("ng-touched",s.isTouched)("ng-pristine",s.isPristine)("ng-dirty",s.isDirty)("ng-valid",s.isValid)("ng-invalid",s.isInvalid)("ng-pending",s.isPending)("ng-submitted",s.isSubmitted)},features:[Fn]});let n=e;return n})();var Gc="VALID",ip="INVALID",Na="PENDING",Hc="DISABLED";function LN(n){return(fp(n)?n.validators:n)||null}function QG(n){return Array.isArray(n)?gE(n):n||null}function BN(n,e){return(fp(e)?e.asyncValidators:n)||null}function YG(n){return Array.isArray(n)?mE(n):n||null}function fp(n){return n!=null&&!Array.isArray(n)&&typeof n=="object"}function XG(n,e,t){let r=n.controls;if(!(e?Object.keys(r):r).length)throw new eu(1e3,"");if(!r[t])throw new eu(1001,"")}function JG(n,e,t){n._forEachChild((r,i)=>{if(t[i]===void 0)throw new eu(1002,"")})}var lp=class{constructor(e,t){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(e),this._assignAsyncValidators(t)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get valid(){return this.status===Gc}get invalid(){return this.status===ip}get pending(){return this.status==Na}get disabled(){return this.status===Hc}get enabled(){return this.status!==Hc}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._assignValidators(e)}setAsyncValidators(e){this._assignAsyncValidators(e)}addValidators(e){this.setValidators(wN(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(wN(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(TN(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(TN(e,this._rawAsyncValidators))}hasValidator(e){return sp(this._rawValidators,e)}hasAsyncValidator(e){return sp(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){this.touched=!0,this._parent&&!e.onlySelf&&this._parent.markAsTouched(e)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(e=>e.markAllAsTouched())}markAsUntouched(e={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(t=>{t.markAsUntouched({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}markAsDirty(e={}){this.pristine=!1,this._parent&&!e.onlySelf&&this._parent.markAsDirty(e)}markAsPristine(e={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(t=>{t.markAsPristine({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}markAsPending(e={}){this.status=Na,e.emitEvent!==!1&&this.statusChanges.emit(this.status),this._parent&&!e.onlySelf&&this._parent.markAsPending(e)}disable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=Hc,this.errors=null,this._forEachChild(r=>{r.disable(fr(Zt({},e),{onlySelf:!0}))}),this._updateValue(),e.emitEvent!==!1&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(fr(Zt({},e),{skipPristineCheck:t})),this._onDisabledChange.forEach(r=>r(!0))}enable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=Gc,this._forEachChild(r=>{r.enable(fr(Zt({},e),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(fr(Zt({},e),{skipPristineCheck:t})),this._onDisabledChange.forEach(r=>r(!1))}_updateAncestors(e){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(e){this._parent=e}getRawValue(){return this.value}updateValueAndValidity(e={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Gc||this.status===Na)&&this._runAsyncValidator(e.emitEvent)),e.emitEvent!==!1&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(e)}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Hc:Gc}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e){if(this.asyncValidator){this.status=Na,this._hasOwnPendingAsyncValidator=!0;let t=xN(this.asyncValidator(this));this._asyncValidationSubscription=t.subscribe(r=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(r,{emitEvent:e})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(e,t={}){this.errors=e,this._updateControlsErrors(t.emitEvent!==!1)}get(e){let t=e;return t==null||(Array.isArray(t)||(t=t.split(".")),t.length===0)?null:t.reduce((r,i)=>r&&r._find(i),this)}getError(e,t){let r=t?this.get(t):this;return r&&r.errors?r.errors[e]:null}hasError(e,t){return!!this.getError(e,t)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(e)}_initObservables(){this.valueChanges=new La,this.statusChanges=new La}_calculateStatus(){return this._allControlsDisabled()?Hc:this.errors?ip:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Na)?Na:this._anyControlsHaveStatus(ip)?ip:Gc}_anyControlsHaveStatus(e){return this._anyControls(t=>t.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e={}){this.pristine=!this._anyControlsDirty(),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}_updateTouched(e={}){this.touched=this._anyControlsTouched(),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){fp(e)&&e.updateOn!=null&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){let t=this._parent&&this._parent.dirty;return!e&&!!t&&!this._parent._anyControlsDirty()}_find(e){return null}_assignValidators(e){this._rawValidators=Array.isArray(e)?e.slice():e,this._composedValidatorFn=QG(this._rawValidators)}_assignAsyncValidators(e){this._rawAsyncValidators=Array.isArray(e)?e.slice():e,this._composedAsyncValidatorFn=YG(this._rawAsyncValidators)}},cp=class extends lp{constructor(e,t,r){super(LN(t),BN(r,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(e,t){return this.controls[e]?this.controls[e]:(this.controls[e]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}addControl(e,t,r={}){this.registerControl(e,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}removeControl(e,t={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}setControl(e,t,r={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],t&&this.registerControl(e,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}contains(e){return this.controls.hasOwnProperty(e)&&this.controls[e].enabled}setValue(e,t={}){JG(this,!0,e),Object.keys(e).forEach(r=>{XG(this,!0,r),this.controls[r].setValue(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){e!=null&&(Object.keys(e).forEach(r=>{let i=this.controls[r];i&&i.patchValue(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e={},t={}){this._forEachChild((r,i)=>{r.reset(e?e[i]:null,{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this._reduceChildren({},(e,t,r)=>(e[r]=t.getRawValue(),e))}_syncPendingControls(){let e=this._reduceChildren(!1,(t,r)=>r._syncPendingControls()?!0:t);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){Object.keys(this.controls).forEach(t=>{let r=this.controls[t];r&&e(r,t)})}_setUpControls(){this._forEachChild(e=>{e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(e){for(let[t,r]of Object.entries(this.controls))if(this.contains(t)&&e(r))return!0;return!1}_reduceValue(){let e={};return this._reduceChildren(e,(t,r,i)=>((r.enabled||this.disabled)&&(t[i]=r.value),t))}_reduceChildren(e,t){let r=e;return this._forEachChild((i,s)=>{r=t(r,i,s)}),r}_allControlsDisabled(){for(let e of Object.keys(this.controls))if(this.controls[e].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(e){return this.controls.hasOwnProperty(e)?this.controls[e]:null}};var yE=new qe("CallSetDisabledState",{providedIn:"root",factory:()=>vE}),vE="always";function ZG(n,e){return[...e.path,n]}function VN(n,e,t=vE){qN(n,e),e.valueAccessor.writeValue(n.value),(n.disabled||t==="always")&&e.valueAccessor.setDisabledState?.(n.disabled),t5(n,e),r5(n,e),n5(n,e),e5(n,e)}function CN(n,e){n.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(e)})}function e5(n,e){if(e.valueAccessor.setDisabledState){let t=r=>{e.valueAccessor.setDisabledState(r)};n.registerOnDisabledChange(t),e._registerOnDestroy(()=>{n._unregisterOnDisabledChange(t)})}}function qN(n,e){let t=KG(n);e.validator!==null?n.setValidators(EN(t,e.validator)):typeof t=="function"&&n.setValidators([t]);let r=WG(n);e.asyncValidator!==null?n.setAsyncValidators(EN(r,e.asyncValidator)):typeof r=="function"&&n.setAsyncValidators([r]);let i=()=>n.updateValueAndValidity();CN(e._rawValidators,i),CN(e._rawAsyncValidators,i)}function t5(n,e){e.valueAccessor.registerOnChange(t=>{n._pendingValue=t,n._pendingChange=!0,n._pendingDirty=!0,n.updateOn==="change"&&UN(n,e)})}function n5(n,e){e.valueAccessor.registerOnTouched(()=>{n._pendingTouched=!0,n.updateOn==="blur"&&n._pendingChange&&UN(n,e),n.updateOn!=="submit"&&n.markAsTouched()})}function UN(n,e){n._pendingDirty&&n.markAsDirty(),n.setValue(n._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(n._pendingValue),n._pendingChange=!1}function r5(n,e){let t=(r,i)=>{e.valueAccessor.writeValue(r),i&&e.viewToModelUpdate(r)};n.registerOnChange(t),e._registerOnDestroy(()=>{n._unregisterOnChange(t)})}function i5(n,e){n==null,qN(n,e)}function s5(n,e){if(!n.hasOwnProperty("model"))return!1;let t=n.model;return t.isFirstChange()?!0:!Object.is(e,t.currentValue)}function o5(n){return Object.getPrototypeOf(n.constructor)===fE}function a5(n,e){n._syncPendingControls(),e.forEach(t=>{let r=t.control;r.updateOn==="submit"&&r._pendingChange&&(t.viewToModelUpdate(r._pendingValue),r._pendingChange=!1)})}function l5(n,e){if(!e)return null;Array.isArray(e);let t,r,i;return e.forEach(s=>{s.constructor===dp?t=s:o5(s)?r=s:i=s}),i||r||t||null}var c5={provide:xa,useExisting:qi(()=>$c)},Kc=(()=>Promise.resolve())(),$c=(()=>{let e=class e extends xa{constructor(r,i,s){super(),this.callSetDisabledState=s,this.submitted=!1,this._directives=new Set,this.ngSubmit=new La,this.form=new cp({},gE(r),mE(i))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(r){Kc.then(()=>{let i=this._findContainer(r.path);r.control=i.registerControl(r.name,r.control),VN(r.control,r,this.callSetDisabledState),r.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(r)})}getControl(r){return this.form.get(r.path)}removeControl(r){Kc.then(()=>{let i=this._findContainer(r.path);i&&i.removeControl(r.name),this._directives.delete(r)})}addFormGroup(r){Kc.then(()=>{let i=this._findContainer(r.path),s=new cp({});i5(s,r),i.registerControl(r.name,s),s.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(r){Kc.then(()=>{let i=this._findContainer(r.path);i&&i.removeControl(r.name)})}getFormGroup(r){return this.form.get(r.path)}updateModel(r,i){Kc.then(()=>{this.form.get(r.path).setValue(i)})}setValue(r){this.control.setValue(r)}onSubmit(r){return this.submitted=!0,a5(this.form,this._directives),this.ngSubmit.emit(r),r?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(r=void 0){this.form.reset(r),this.submitted=!1}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.form._updateOn=this.options.updateOn)}_findContainer(r){return r.pop(),r.length?this.form.get(r):this.form}};e.\u0275fac=function(i){return new(i||e)(me(pE,10),me(kN,10),me(yE,8))},e.\u0275dir=Dt({type:e,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(i,s){i&1&&Bt("submit",function(a){return s.onSubmit(a)})("reset",function(){return s.onReset()})},inputs:{options:["ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[zi([c5]),Fn]});let n=e;return n})();function bN(n,e){let t=n.indexOf(e);t>-1&&n.splice(t,1)}function AN(n){return typeof n=="object"&&n!==null&&Object.keys(n).length===2&&"value"in n&&"disabled"in n}var u5=class extends lp{constructor(e=null,t,r){super(LN(t),BN(r,t)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(e),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),fp(t)&&(t.nonNullable||t.initialValueIsDefault)&&(AN(e)?this.defaultValue=e.value:this.defaultValue=e)}setValue(e,t={}){this.value=this._pendingValue=e,this._onChange.length&&t.emitModelToViewChange!==!1&&this._onChange.forEach(r=>r(this.value,t.emitViewToModelChange!==!1)),this.updateValueAndValidity(t)}patchValue(e,t={}){this.setValue(e,t)}reset(e=this.defaultValue,t={}){this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){bN(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){bN(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(e){AN(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}};var d5={provide:Wc,useExisting:qi(()=>SE)},IN=(()=>Promise.resolve())(),SE=(()=>{let e=class e extends Wc{constructor(r,i,s,o,a,l){super(),this._changeDetectorRef=a,this.callSetDisabledState=l,this.control=new u5,this._registered=!1,this.name="",this.update=new La,this._parent=r,this._setValidators(i),this._setAsyncValidators(s),this.valueAccessor=l5(this,o)}ngOnChanges(r){if(this._checkForErrors(),!this._registered||"name"in r){if(this._registered&&(this._checkName(),this.formDirective)){let i=r.name.previousValue;this.formDirective.removeControl({name:i,path:this._getPath(i)})}this._setUpControl()}"isDisabled"in r&&this._updateDisabled(r),s5(r,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(r){this.viewModel=r,this.update.emit(r)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){VN(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(r){IN.then(()=>{this.control.setValue(r,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(r){let i=r.isDisabled.currentValue,s=i!==0&&Ip(i);IN.then(()=>{s&&!this.control.disabled?this.control.disable():!s&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(r){return this._parent?ZG(r,this._parent):[r]}};e.\u0275fac=function(i){return new(i||e)(me(xa,9),me(pE,10),me(kN,10),me(up,10),me(NE,8),me(yE,8))},e.\u0275dir=Dt({type:e,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:["disabled","isDisabled"],model:["ngModel","model"],options:["ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[zi([d5]),Fn,Tp]});let n=e;return n})(),pp=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275dir=Dt({type:e,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]});let n=e;return n})();var h5=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=It({type:e}),e.\u0275inj=At({});let n=e;return n})();var f5={provide:up,useExisting:qi(()=>gp),multi:!0};function zN(n,e){return n==null?`${e}`:(e&&typeof e=="object"&&(e="Object"),`${n}: ${e}`.slice(0,50))}function p5(n){return n.split(":")[0]}var gp=(()=>{let e=class e extends fE{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(r){this._compareWith=r}writeValue(r){this.value=r;let i=this._getOptionId(r),s=zN(i,r);this.setProperty("value",s)}registerOnChange(r){this.onChange=i=>{this.value=this._getOptionValue(i),r(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(r){for(let i of this._optionMap.keys())if(this._compareWith(this._optionMap.get(i),r))return i;return null}_getOptionValue(r){let i=p5(r);return this._optionMap.has(i)?this._optionMap.get(i):r}};e.\u0275fac=(()=>{let r;return function(s){return(r||(r=Oa(e)))(s||e)}})(),e.\u0275dir=Dt({type:e,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(i,s){i&1&&Bt("change",function(a){return s.onChange(a.target.value)})("blur",function(){return s.onTouched()})},inputs:{compareWith:"compareWith"},features:[zi([f5]),Fn]});let n=e;return n})(),mp=(()=>{let e=class e{constructor(r,i,s){this._element=r,this._renderer=i,this._select=s,this._select&&(this.id=this._select._registerOption())}set ngValue(r){this._select!=null&&(this._select._optionMap.set(this.id,r),this._setElementValue(zN(this.id,r)),this._select.writeValue(this._select.value))}set value(r){this._setElementValue(r),this._select&&this._select.writeValue(this._select.value)}_setElementValue(r){this._renderer.setProperty(this._element.nativeElement,"value",r)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}};e.\u0275fac=function(i){return new(i||e)(me(Pa),me(Fa),me(gp,9))},e.\u0275dir=Dt({type:e,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}});let n=e;return n})(),g5={provide:up,useExisting:qi(()=>jN),multi:!0};function DN(n,e){return n==null?`${e}`:(typeof e=="string"&&(e=`'${e}'`),e&&typeof e=="object"&&(e="Object"),`${n}: ${e}`.slice(0,50))}function m5(n){return n.split(":")[0]}var jN=(()=>{let e=class e extends fE{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(r){this._compareWith=r}writeValue(r){this.value=r;let i;if(Array.isArray(r)){let s=r.map(o=>this._getOptionId(o));i=(o,a)=>{o._setSelected(s.indexOf(a.toString())>-1)}}else i=(s,o)=>{s._setSelected(!1)};this._optionMap.forEach(i)}registerOnChange(r){this.onChange=i=>{let s=[],o=i.selectedOptions;if(o!==void 0){let a=o;for(let l=0;l<a.length;l++){let c=a[l],u=this._getOptionValue(c.value);s.push(u)}}else{let a=i.options;for(let l=0;l<a.length;l++){let c=a[l];if(c.selected){let u=this._getOptionValue(c.value);s.push(u)}}}this.value=s,r(s)}}_registerOption(r){let i=(this._idCounter++).toString();return this._optionMap.set(i,r),i}_getOptionId(r){for(let i of this._optionMap.keys())if(this._compareWith(this._optionMap.get(i)._value,r))return i;return null}_getOptionValue(r){let i=m5(r);return this._optionMap.has(i)?this._optionMap.get(i)._value:r}};e.\u0275fac=(()=>{let r;return function(s){return(r||(r=Oa(e)))(s||e)}})(),e.\u0275dir=Dt({type:e,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(i,s){i&1&&Bt("change",function(a){return s.onChange(a.target)})("blur",function(){return s.onTouched()})},inputs:{compareWith:"compareWith"},features:[zi([g5]),Fn]});let n=e;return n})(),yp=(()=>{let e=class e{constructor(r,i,s){this._element=r,this._renderer=i,this._select=s,this._select&&(this.id=this._select._registerOption(this))}set ngValue(r){this._select!=null&&(this._value=r,this._setElementValue(DN(this.id,r)),this._select.writeValue(this._select.value))}set value(r){this._select?(this._value=r,this._setElementValue(DN(this.id,r)),this._select.writeValue(this._select.value)):this._setElementValue(r)}_setElementValue(r){this._renderer.setProperty(this._element.nativeElement,"value",r)}_setSelected(r){this._renderer.setProperty(this._element.nativeElement,"selected",r)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}};e.\u0275fac=function(i){return new(i||e)(me(Pa),me(Fa),me(jN,9))},e.\u0275dir=Dt({type:e,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}});let n=e;return n})();var y5=(()=>{let e=class e{constructor(){this._validator=_N}ngOnChanges(r){if(this.inputName in r){let i=this.normalizeInput(r[this.inputName].currentValue);this._enabled=this.enabled(i),this._validator=this._enabled?this.createValidator(i):_N,this._onChange&&this._onChange()}}validate(r){return this._validator(r)}registerOnValidatorChange(r){this._onChange=r}enabled(r){return r!=null}};e.\u0275fac=function(i){return new(i||e)},e.\u0275dir=Dt({type:e,features:[Tp]});let n=e;return n})();var v5={provide:pE,useExisting:qi(()=>_E),multi:!0};var _E=(()=>{let e=class e extends y5{constructor(){super(...arguments),this.inputName="required",this.normalizeInput=Ip,this.createValidator=r=>zG}enabled(r){return r}};e.\u0275fac=(()=>{let r;return function(s){return(r||(r=Oa(e)))(s||e)}})(),e.\u0275dir=Dt({type:e,selectors:[["","required","","formControlName","",3,"type","checkbox"],["","required","","formControl","",3,"type","checkbox"],["","required","","ngModel","",3,"type","checkbox"]],hostVars:1,hostBindings:function(i,s){i&2&&xE("required",s._enabled?"":null)},inputs:{required:"required"},features:[zi([v5]),Fn]});let n=e;return n})();var S5=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=It({type:e}),e.\u0275inj=At({imports:[h5]});let n=e;return n})();var GN=(()=>{let e=class e{static withConfig(r){return{ngModule:e,providers:[{provide:yE,useValue:r.callSetDisabledState??vE}]}}};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=It({type:e}),e.\u0275inj=At({imports:[S5]});let n=e;return n})();var HN=(()=>{let e=class e{constructor(r){this.firebase=r}insertrecord(){let r="contactus";var i={UserName:this.username,LastName:this.lastname,Email:this.email,Message:this.message,Purpose:this.list};this.firebase.collection(r).add(i).then(s=>{alert("Data has been inserted to firebase")}).catch(s=>{console.log("Error Occured"+s)})}};e.\u0275fac=function(i){return new(i||e)(me(jc))},e.\u0275cmp=Pr({type:e,selectors:[["app-contact"]],decls:59,vars:5,consts:[[1,"container","py-4","my-5"],[1,"row"],[1,"col-lg-5","col-md-8"],[1,"search-form"],[1,"input-group"],["type","search","placeholder","Search here",1,"form-control","bg-transparent","shadow-none","rounded-0"],[1,"input-group-append"],["type","submit",1,"btn"],[1,"fas","fa-search"],[1,"col-md-10"],[1,"contact-form","bg-dark"],[1,"text-white","add-letter-space","mb-5"],[1,"col-md-6"],[1,"form-group","mb-5"],["for","firstName",1,"text-black-300"],["type","text","id","firstName","name","username","placeholder","Robert Lee","required","",1,"form-control","bg-transparent","rounded-0","border-bottom","shadow-none","pb-15","px-0",3,"ngModel","ngModelChange"],[1,"invalid-feedback"],["for","lastName",1,"text-black-300"],["type","text","id","lastName","name","lastname","placeholder","Anderson","required","",1,"form-control","bg-transparent","rounded-0","border-bottom","shadow-none","pb-15","px-0",3,"ngModel","ngModelChange"],["for","email",1,"text-black-300"],["name","email","type","email","id","email","placeholder","kevin.jones@mail.com","required","",1,"form-control","bg-transparent","rounded-0","border-bottom","shadow-none","pb-15","px-0",3,"ngModel","ngModelChange"],[1,"text-black-300"],["name","list",1,"d-block","w-100",3,"ngModel","ngModelChange"],["value","Personal Proposal"],["value","Business Purpose"],["value","Want to say hello"],[1,"col-md-12"],["for","message",1,"text-black-300"],["name","message","placeholder","Lorem Ipsum is simply dummy text of the printing and...","required","",1,"form-control","bg-transparent","rounded-0","border-bottom","shadow-none","pb-15","px-0",3,"ngModel","ngModelChange"],["type","submit",1,"btn","btn-sm","btn-primary",3,"click"],["src","images/arrow-right.png","alt",""]],template:function(i,s){i&1&&(C(0,"div",0)(1,"div",1)(2,"div",2)(3,"form",3)(4,"div",4),X(5,"input",5),C(6,"div",6)(7,"button",7),X(8,"span",8),N()()()()()(),C(9,"div",1)(10,"div",9)(11,"div",10)(12,"h1",11),q(13,"Lets Contact Us"),N(),C(14,"form")(15,"div",1)(16,"div",12)(17,"div",13)(18,"label",14),q(19,"Your First Name"),N(),C(20,"input",15),Bt("ngModelChange",function(a){return s.username=a}),N(),C(21,"p",16),q(22,"Your first-name is required!"),N()()(),C(23,"div",12)(24,"div",13)(25,"label",17),q(26,"Your Last Name"),N(),C(27,"input",18),Bt("ngModelChange",function(a){return s.lastname=a}),N(),C(28,"p",16),q(29,"Your last-name is required!"),N()()(),C(30,"div",12)(31,"div",13)(32,"label",19),q(33,"E-Mail Address"),N(),C(34,"input",20),Bt("ngModelChange",function(a){return s.email=a}),N(),C(35,"p",16),q(36,"Your email is required!"),N()()(),C(37,"div",12)(38,"div",13)(39,"label",21),q(40,"What Is This About?"),N(),C(41,"select",22),Bt("ngModelChange",function(a){return s.list=a}),C(42,"option",23),q(43,"Personal Proposal"),N(),C(44,"option",24),q(45,"Business Purpose"),N(),C(46,"option",25),q(47,"Want to say hello"),N()()()(),C(48,"div",26)(49,"div",13)(50,"label",27),q(51,"Your message"),N(),C(52,"textarea",28),Bt("ngModelChange",function(a){return s.message=a}),N(),C(53,"p",16),q(54,"Message is required!"),N()()(),C(55,"div",26)(56,"button",29),Bt("click",function(){return s.insertrecord()}),q(57,"Send Now "),X(58,"img",30),N()()()()()()()()),i&2&&(Lt(20),Ln("ngModel",s.username),Lt(7),Ln("ngModel",s.lastname),Lt(7),Ln("ngModel",s.email),Lt(7),Ln("ngModel",s.list),Lt(11),Ln("ngModel",s.message))},dependencies:[pp,mp,yp,dp,gp,FN,hp,_E,SE,$c]});let n=e;return n})();var KN=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=Pr({type:e,selectors:[["app-home"]],decls:138,vars:0,consts:[[1,"row","justify-content-between"],[1,"col-lg-7"],[1,"card","post-item","bg-transparent","border-0","mb-5"],["href","post-details.html"],["src","./assets/images/post/post-lg/01.png","alt","",1,"card-img-top","rounded-0"],[1,"card-body","px-0"],[1,"card-title"],["href","post-details.html",1,"text-white","opacity-75-onHover"],[1,"post-meta","mt-3"],[1,"d-inline-block","mr-3"],[1,"fas","fa-clock","text-primary"],["href","#",1,"ml-1"],[1,"d-inline-block"],[1,"fas","fa-list-alt","text-primary"],[1,"card-text","my-4"],["href","post-details.html",1,"btn","btn-primary"],["src","./assets/images/arrow-right.png","alt",""],["src","./assets/images/post/post-lg/02.png","alt","",1,"card-img-top","rounded-0"],["src","./assets/images/post/post-lg/03.png","alt","",1,"card-img-top","rounded-0"],[1,"col-lg-4","col-md-5"],[1,"widget","text-center"],["src","./assets/images/author-sm.png","alt","",1,"author-thumb-sm","rounded-circle","d-block","mx-auto"],[1,"widget-title","text-white","d-inline-block","mt-4"],[1,"mt-4"],[1,"list-inline","mt-3"],[1,"list-inline-item"],["href","#!",1,"text-white","text-primary-onHover","p-2"],[1,"fab","fa-twitter"],[1,"fab","fa-facebook-f"],[1,"fab","fa-instagram"],[1,"fab","fa-linkedin-in"],[1,"widget","bg-dark","p-4","text-center"],["action","#"],[1,"form-group"],["type","email","placeholder","Your Email Address",1,"form-control","bg-transparent","rounded-0","my-4"],[1,"btn","btn-primary"],[1,"widget"],[1,"mb-5","text-center"],[1,"widget-title","text-white","d-inline-block"],["src","./assets/images/post/post-sm/01.png","alt","",1,"card-img-top","rounded-0"],[1,"post-meta","mt-3","mb-4"],["src","./assets/images/post/post-sm/02.png","alt","",1,"card-img-top","rounded-0"]],template:function(i,s){i&1&&(C(0,"div",0)(1,"div",1)(2,"div",2)(3,"a",3),X(4,"img",4),N(),C(5,"div",5)(6,"h2",6)(7,"a",7),q(8,"Id reprehrenderit mollit in tempor naid incididunt cupidatat consectetura"),N()(),C(9,"ul",8)(10,"li",9),X(11,"span",10),C(12,"a",11),q(13,"24 April, 2016"),N()(),C(14,"li",12),X(15,"span",13),C(16,"a",11),q(17,"Photography"),N()()(),C(18,"p",14),q(19,"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Tincidunt leo mi, viverra urna. Arcu velit risus, condimentum ut vulputate cursus porttitor turpis in. Diam egestas nec massa, habitasse. Tincidt dui."),N(),C(20,"a",15),q(21,"Read More "),X(22,"img",16),N()()(),C(23,"div",2)(24,"a",3),X(25,"img",17),N(),C(26,"div",5)(27,"h2",6)(28,"a",7),q(29,"Excepteur ado Do minim duis laborum Fugiat ea labore qui veniam labore"),N()(),C(30,"ul",8)(31,"li",9),X(32,"span",10),C(33,"a",11),q(34,"24 April, 2016"),N()(),C(35,"li",12),X(36,"span",13),C(37,"a",11),q(38,"Photography"),N()()(),C(39,"p",14),q(40,"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Tincidunt leo mi, viverra urna. Arcu velit risus, condimentum ut vulputate cursus porttitor turpis in. Diam egestas nec massa, habitasse. Tincidt dui."),N(),C(41,"a",15),q(42,"Read More "),X(43,"img",16),N()()(),C(44,"div",2)(45,"a",3),X(46,"img",18),N(),C(47,"div",5)(48,"h2",6)(49,"a",7),q(50,"Aliquip excepteur cilludm irure laboris sint ea qui ex amet id. Ex nulla etno"),N()(),C(51,"ul",8)(52,"li",9),X(53,"span",10),C(54,"a",11),q(55,"24 April, 2016"),N()(),C(56,"li",12),X(57,"span",13),C(58,"a",11),q(59,"Photography"),N()()(),C(60,"p",14),q(61,"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Tincidunt leo mi, viverra urna. Arcu velit risus, condimentum ut vulputate cursus porttitor turpis in. Diam egestas nec massa, habitasse. Tincidt dui."),N(),C(62,"a",15),q(63,"Read More "),X(64,"img",16),N()()()(),C(65,"div",19)(66,"div",20),X(67,"img",21),C(68,"h2",22),q(69,"About Me"),N(),C(70,"p",23),q(71,"Lorem ipsum dolor sit coectetur adiing elit. Tincidunfywjt leo mi, viearra urna. Arcu ve isus, condimentum ut vulpate cursus por turpis."),N(),C(72,"ul",24)(73,"li",25)(74,"a",26),X(75,"span",27),N()(),C(76,"li",25)(77,"a",26),X(78,"span",28),N()(),C(79,"li",25)(80,"a",26),X(81,"span",29),N()(),C(82,"li",25)(83,"a",26),X(84,"span",30),N()()()(),C(85,"div",31)(86,"h2",22),q(87,"Subscribe Blog"),N(),C(88,"p",23),q(89,"Lorem ipsum dolor sit coectetur elit. Tincidu nfywjt leo mi, urna. Arcu ve isus, condimentum ut vulpate cursus por."),N(),C(90,"form",32)(91,"div",33),X(92,"input",34),C(93,"button",35),q(94,"Subscribe Now "),X(95,"img",16),N()()()(),C(96,"div",36)(97,"div",37)(98,"h2",38),q(99,"Featured Posts"),N()(),C(100,"div",2)(101,"a",3),X(102,"img",39),N(),C(103,"div",5)(104,"h2",6)(105,"a",7),q(106,"Excepteur ado Do minimal duis laborum Fugiat ea"),N()(),C(107,"ul",40)(108,"li",9),X(109,"span",10),C(110,"a",11),q(111,"24 April, 2016"),N()(),C(112,"li",12),X(113,"span",13),C(114,"a",11),q(115,"Photography"),N()()(),C(116,"a",15),q(117,"Read More "),X(118,"img",16),N()()(),C(119,"div",2)(120,"a",3),X(121,"img",41),N(),C(122,"div",5)(123,"h2",6)(124,"a",7),q(125,"Excepteur ado Do minimal duis laborum Fugiat ea"),N()(),C(126,"ul",40)(127,"li",9),X(128,"span",10),C(129,"a",11),q(130,"24 April, 2016"),N()(),C(131,"li",12),X(132,"span",13),C(133,"a",11),q(134,"Photography"),N()()(),C(135,"a",15),q(136,"Read More "),X(137,"img",16),N()()()()()())},dependencies:[pp,hp,$c]});let n=e;return n})();var _5=[{path:"",component:KN},{path:"contact",component:HN},{path:"about",component:SN}],WN=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=It({type:e}),e.\u0275inj=At({imports:[Rp.forRoot(_5),Rp]});let n=e;return n})();var E5=()=>({exact:!0}),vp=(()=>{let e=class e{constructor(){this.title="portfolio"}};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=Pr({type:e,selectors:[["app-root"]],decls:63,vars:2,consts:[[1,"d-flex"],[1,"preloader-wrapper"],[1,"preloader-inner"],[1,"spinner-border","text-red"],[1,"sidenav","position-sticky","d-flex","flex-column","justify-content-between"],["href","index.html",1,"logo"],["src","./assets/images/logo.png","alt",""],[1,"navbar","navbar-dark","my-4","p-0","font-primary"],[1,"navbar-nav","w-100"],["routerLinkActive","active",1,"nav-item",3,"routerLinkActiveOptions"],["routerLink","",1,"nav-link","text-white","px-0","pt-0"],["routerLinkActive","active",1,"nav-item"],["routerLink","about",1,"nav-link","text-white","px-0"],["routerLink","contact",1,"nav-link","text-white","px-0"],[1,"nav-item","accordion"],["id","drop-menu",1,"drop-menu","collapse"],["href","index-2.html",1,"d-block"],["href","category.html",1,"d-block"],["href","post-details.html",1,"d-block"],["href","privacy.html",1,"d-block"],["href","#!","role","button","data-toggle","collapse","data-target","#drop-menu","aria-expanded","false","aria-controls","drop-menu",1,"nav-link","text-white"],[1,"nav-item","mt-3"],["id","pick-lang",1,"custom-select","bg-transparent","rounded-0","text-white","shadow-none"],["selected","","value","en"],["value","fr"],[1,"list-inline","nml-2"],[1,"list-inline-item"],["href","#!",1,"text-white","text-red-onHover","pr-2"],[1,"fab","fa-twitter"],["href","#!",1,"text-white","text-red-onHover","p-2"],[1,"fab","fa-facebook-f"],[1,"fab","fa-instagram"],[1,"fab","fa-linkedin-in"],[1,"main-content"],[1,"mobile-nav","pt-4"],[1,"container"],[1,"row","align-items-center"],[1,"col-6"],["href","index.html"],["src","images/logo.png","alt",""],[1,"col-6","text-right"],[1,"nav-toggle","bg-transparent","border","text-white"],[1,"fas","fa-bars"],[1,"nav-toggle-overlay"],[1,"container","pt-4","mt-5"]],template:function(i,s){i&1&&(C(0,"section",0)(1,"div",1)(2,"div",2),X(3,"div",3),N()(),C(4,"aside")(5,"div",4)(6,"a",5),X(7,"img",6),N(),C(8,"div",7)(9,"ul",8)(10,"li",9)(11,"a",10),q(12,"Home"),N()(),C(13,"li",11)(14,"a",12),q(15,"See Record"),N()(),C(16,"li",11)(17,"a",13),q(18,"Contact"),N()(),C(19,"li",14)(20,"div",15)(21,"a",16),q(22,"Home 2"),N(),C(23,"a",17),q(24,"Category"),N(),C(25,"a",18),q(26,"Post Details"),N(),C(27,"a",19),q(28,"Privacy & Policy"),N()(),C(29,"a",20),q(30,"Pages"),N()(),C(31,"li",21)(32,"select",22)(33,"option",23),q(34,"English"),N(),C(35,"option",24),q(36,"French"),N()()()()(),C(37,"ul",25)(38,"li",26)(39,"a",27),X(40,"span",28),N()(),C(41,"li",26)(42,"a",29),X(43,"span",30),N()(),C(44,"li",26)(45,"a",29),X(46,"span",31),N()(),C(47,"li",26)(48,"a",29),X(49,"span",32),N()()()()(),C(50,"div",33)(51,"header",34)(52,"div",35)(53,"div",36)(54,"div",37)(55,"a",38),X(56,"img",39),N()(),C(57,"div",40)(58,"button",41),X(59,"span",42),N()()()()(),X(60,"div",43),C(61,"div",44),X(62,"router-outlet"),N()()()),i&2&&(Lt(10),Ln("routerLinkActiveOptions",PE(1,E5)))},dependencies:[UE,zE,jE,mp,yp]});let n=e;return n})();var $N=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=It({type:e,bootstrap:[vp]}),e.\u0275inj=At({providers:[VE()],imports:[BE,WN,hw.initializeApp({projectId:"dbtest2211b-d2500",appId:"1:435927507555:web:f271627d51e614191cce56",storageBucket:"dbtest2211b-d2500.appspot.com",apiKey:"AIzaSyDpCDVSWYrh_5QxKcJTW2xkvj4OgWoW8e8",authDomain:"dbtest2211b-d2500.firebaseapp.com",messagingSenderId:"435927507555",measurementId:"G-K2MN4RS5RW"}),yN,GN]});let n=e;return n})();var w5=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=It({type:e,bootstrap:[vp]}),e.\u0275inj=At({imports:[$N,qE]});let n=e;return n})();export{w5 as a};
